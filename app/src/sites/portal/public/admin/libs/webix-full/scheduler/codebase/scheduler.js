/**
 * @license
 * Webix Scheduler v.7.3.5
 * This software is covered by Webix Trial License.
 * Usage without proper license is prohibited.
 * (c) XB Software Ltd.
 */

!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t():"function"==typeof define&&define.amd?define(t):t()}(0,function(){"use strict";webix.protoUI({name:"altbutton",$cssName:"button",$renderInput:function(e){var t=" class='webixtype_"+(e.type||"base")+"' ";return"<button type='button' "+(e.popup?"aria-haspopup='true'":"")+t+">"+webix.template.escape(e.label||e.value)+"</button>"}},webix.ui.button);var e={init_date:new Date,form_date:"%d-%m-%Y %H:%i",form_all_day:"%d-%m-%Y",parse_date:"%Y-%m-%d %H:%i",week_date:"%D, %d %M",dyn_load_date:"%Y-%m-%d",item_date:"%d.%m.%Y",all_day_date:"%l, %d %F %Y",day_header_date:"%d.%m.%Y",week_header_date:"%d.%m.%Y",hour_date:"%H:%i",scale_hour:"%H",calendar_date:"%F %Y",calendar_hour:"%H:%i",form_rules:{end_date:function(e,t){return t.start_date.valueOf()<e.valueOf()}},multi_day:!0,multi_day_limit:3,views:[],tab_views:[],server_utc:!1,separate_short_events:!0,recurring:!1,endless_date:new Date(9999,1,1),recurring_dialogs:!1};var a,i,n,l,t={day_event_style:function(e){var t="";if(e.color){var a=webix.color.toRgb(e.color);t+=";border-color:"+e.color+";",t+="background-color:rgba("+a.toString()+",0.3);";var i=webix.color.rgbToHsv(a[0],a[1],a[2]);i[2]/=1.6,t+="color:"+("rgb("+webix.color.hsvToRgb(i[0],i[1],i[2])+")")}return t},multi_day_event_style:function(e){var t="";if(e.color){var a=webix.color.toRgb(e.color);t+=";background-color:rgba("+a.toString()+",0.3);";var i=webix.color.rgbToHsv(a[0],a[1],a[2]);i[2]/=1.6,t+="color:"+("rgb("+webix.color.hsvToRgb(i[0],i[1],i[2])+")")}return t},selected_event:function(e){var t="",a="",i="",n=e.start_date,r=e.end_date;if(!n)return t;if(t+="<div  class='selected_event "+scheduler.templates.event_class(e)+"'  >",t+="<div class='event_title'>"+e.text+"</div>",webix.Date.datePart(n,!0).valueOf()==webix.Date.datePart(r,!0).valueOf()){var l=webix.i18n.dateFormatStr(n);a=webix.i18n.timeFormatStr(n),i=webix.i18n.timeFormatStr(r),t+="<div class='event_text'>"+l+"</div>",t+="<div class='event_text'>"+scheduler.locale.labels.label_from+" "+a+" "+scheduler.locale.labels.label_to+" "+i+"</div>"}else{var s=webix.i18n.longDateFormatStr(n),d=webix.i18n.longDateFormatStr(r);webix.Date.datePart(n,!0).valueOf()==n.valueOf()&&webix.Date.datePart(r,!0).valueOf()==r.valueOf()||(a=webix.i18n.timeFormatStr(n)+" ",i=webix.i18n.timeFormatStr(r)+" "),t+="<div class='event_text'>"+scheduler.locale.labels.label_from+" "+a+s+"</div>",t+="<div class='event_text'>"+scheduler.locale.labels.label_to+" "+i+d+"</div>"}return e.details&&""!==e.details&&(t+="<div class='event_title'>"+scheduler.locale.labels.label_details+"</div>",t+="<div class='event_text'>"+e.details+"</div>"),t+="</div>"},week_title:function(e){var t=webix.Date.weekStart(e),a=webix.Date.add(t,6,"day",!0);return"<div aria-live='assertive' aria-atomic='true'>"+webix.i18n.headerWeekFormatStr(t)+"&nbsp;-&nbsp;"+webix.i18n.headerWeekFormatStr(a)+"</div>"},day_title:function(e){return"<div aria-live='assertive' aria-atomic='true'>"+webix.i18n.headerFormatStr(e)+"</div>"},calendar_event:function(e){return"<div class='webix_cal_day_event'>"+e.getDate()+"</div><div class='webix_cal_event_marker'></div>"},calendar_day:function(e){return e.getDate()},event_date:function(e){var t=new Date(parseInt(e,10));return"<span class='webix_unit_header_inner"+(webix.Date.datePart(t).valueOf()==webix.Date.datePart(new Date).valueOf()?" today":"")+"'>"+webix.i18n.weekDateFormatStr(t)+"</span>"},event_time:function(e){var t=e.start_date,a=e.end_date;return webix.Date.datePart(t,!0).valueOf()!=t.valueOf()||webix.Date.datePart(a,!0).valueOf()!=a.valueOf()?webix.i18n.timeFormatStr(t):scheduler.locale.labels.label_allday},event_marker:function(e){var t="";if(e.color){var a=webix.color.toRgb(e.color);t+=";border-color:"+e.color+";",t+="background-color:rgba("+a.toString()+",0.9);"}return"<div class='webix_event_marker' ><div style='"+t+"'></div></div>"},event_title:function(e,t){return"<div class='webix_event_overall "+t.eventClass(e,t)+"'><div class='webix_event_time'>"+t.timeStart(e)+"</div>"+t.marker(e,t
)+"<div class='webix_event_text' "+(e.textColor?"style='color:"+e.textColor:"")+"'>"+e.text+"</div></div>"},month_event_title:function(e,t){return"<div class='webix_event_overall "+t.eventClass(e,t)+"'><div class='webix_event_time'>"+t.timeStart(e)+"</div>"+t.marker(e,t)+"<div class='webix_event_text' "+(e.textColor?"style='color:"+e.textColor:"")+"'>"+e.text+"</div></div>"},day_event:function(e){return e.text},multi_day_event:function(e){return e.text},new_event_data:function(){var e=webix.Date.add(new Date,1,"hour",!0).getHours(),t=webix.Date.copy(this.coreData.getValue());return t.setHours(e),{start_date:t,end_date:webix.Date.add(t,1,"hour",!0)}},event_class:webix.template("")};function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}webix.protoUI({name:"dayevents",defaults:{hourFormat:"%H",hourClock:12,firstHour:0,lastHour:24,timeScaleWidth:25,minEventHeight:20,timeScaleHeight:40,scroll:!0,scaleBorder:1,eventOffset:5,separateShortEvents:!0,date:new Date},$init:function(e){this.name="DayEvents",this._dataobj=this.$view.firstChild,this._dataobj.style.position="relative",this.$view.className+=" webix_dayevents",this.data.provideApi(this,!0),this.data.attachEvent("onStoreUpdated",webix.bind(this.render,this)),window.scheduler&&(e.hourFormat=scheduler.config.scale_hour,e.timeScaleWidth=scheduler.xy.scale_width,e.minEventHeight=scheduler.xy.min_event_height,e.timeScaleHeight=2*scheduler.xy.scale_height,e.separateShortEvents=scheduler.config.separate_short_events)},render:function(){this.isVisible(this.config.id)&&!this.$blockRender&&this.callEvent("onBeforeRender",[this.data])&&(this._renderScale(),this.type.color=this.config.color,this.type.textColor=this.config.textColor,this._prepareEvents(),window.scheduler&&scheduler.templates&&(this.type.template=scheduler.templates.day_event,this.type.templateCss=scheduler.templates.event_class),this._dataobj.firstChild.innerHTML=this.data.getRange().map(this._toHTML,this).join(""),this._htmlmap=null,this.callEvent("onAfterRender",[]))},getItemNode:function(e){if(this._htmlmap)return this._htmlmap[e];this._htmlmap={};for(var t=this._dataobj.firstChild.childNodes,a=0;a<t.length;a++){var i=t[a].getAttribute(this._id);i&&(this._htmlmap[i]=t[a])}return this.getItemNode(e)},_toHTML:function(e){var t=this.data.getMark(e.id,"webix_selected")?" webix_selected":"";this.callEvent("onItemRender",[e]);var a=(e.$template?this.type["template"+e.$template]:this.type.template)(e,this.type,t);return this.type.templateStart(e,this.type,t)+a+this.type.templateEnd(e,this.type,t)},_renderScale:function(){for(var e="<div role='presentation'></div>",t=this.config.firstHour;t<this.config.lastHour;t++)e+=this.hourScaleItem(t);this._dataobj.innerHTML=e},on_click:{},hourScaleItem:function(e){var t=this.config.hourFormat,a=new Date;a.setHours(e),e=webix.Date.dateToStr(t)(a);var i="",n=this.config.timeScaleWidth,r=this.config.timeScaleHeight,l=Math.floor(this.config.timeScaleWidth),s=Math.floor(r/2),d=this.$width-this.config.scaleBorder-n;return i+="<div style='width: 100%; height:"+r+"px;' class='webix_dayevents_scale_item'>",i+="<div class='webix_dayevents_scale_hour' style='width:"+l+"px; height:"+r+"px;line-height:"+r+"px;'>"+e+"</div>",i+="<div class='webix_dayevents_scale_event'  style='width:"+d+"px'>",i+="<div class='webix_dayevents_scale_top' style='height:"+s+"px;width:"+d+"px'></div>",i+="</div>",i+="</div>"},type:{aria:function(e,t,a){return"role='option'"+(a?" aria-selected='true' tabindex='0'":" tabindex='-1'")},templateStart:webix.template("<div webix_l_id='#id#' {common.aria()} class='{common.classname()} {common.templateCss()}' style='left:#$left#px;top:#$top#px;width:#$width#px;height:#$height#px;padding:{common.padding}px;overflow:hidden; {common.templateColor()} ;'>"),template:"#text#",templateEnd:webix.template("</div>"),templateCss:webix.template(""),templateColor:function(e){
return window.scheduler?scheduler.templates.day_event_style(e):""},classname:function(e,t,a){return"webix_dayevents_event_item"+a},padding:4},_prepareEvents:function(){var e,t,a,i,n,r,l,s=this.data.getRange(),d=[];for(this._minMappedDuration=Math.ceil(60*this.config.minEventHeight/(this.config.timeScaleHeight+1)),t=0;t<s.length;t++){for((e=s[t]).$inner=!1;d.length&&this._getEventEndDate(d[d.length-1]).valueOf()<=e.start_date.valueOf();)d.splice(d.length-1,1);for(l=!1,a=0;a<d.length;a++)if(this._getEventEndDate(d[a]).valueOf()<=e.start_date.valueOf()){l=!0,e.$sorder=d[a].$sorder,d.splice(a,1),e.$inner=!0;break}if(d.length&&(d[d.length-1].$inner=!0),!l)if(d.length)if(d.length<=d[d.length-1].$sorder){if(d[d.length-1].$sorder)for(a=0;a<d.length;a++){for(n=!1,i=0;i<d.length;i++)if(d[i].$sorder==a){n=!0;break}if(!n){e.$sorder=a;break}}else e.$sorder=0;e.$inner=!0}else{for(r=d[0].$sorder,a=1;a<d.length;a++)d[a].$sorder>r&&(r=d[a].$sorder);e.$sorder=r+1,e.$inner=!1}else e.$sorder=0;d.push(e),d.length>(d.max_count||0)&&(d.max_count=d.length)}for(var o=0;o<s.length;o++)s[o].$count=d.max_count,this._setPosition(s[o])},_setPosition:function(e){var t=this.config.date.getValue?this.config.date.getValue():this.config.date,a=webix.Date.copy(e.start_date),i=webix.Date.copy(e.end_date),n=a.getHours(),r=i.getHours();webix.Date.datePart(a,!0).valueOf()>webix.Date.datePart(i,!0).valueOf()&&(i=a),webix.Date.datePart(a,!0).valueOf()<webix.Date.datePart(t,!0).valueOf()&&(a=webix.Date.datePart(t)),webix.Date.datePart(i,!0).valueOf()>webix.Date.datePart(t,!0).valueOf()&&((i=webix.Date.datePart(t,!0)).setMinutes(0),i.setHours(this.config.lastHour)),(n<this.config.firstHour||r>=this.config.lastHour)&&(n<this.config.firstHour&&(a.setHours(this.config.firstHour),a.setMinutes(0)),r>=this.config.lastHour&&(i.setMinutes(0),i.setHours(this.config.lastHour)));var l=Math.floor((this.$width-this.config.timeScaleWidth-this.config.eventOffset)/e.$count);e.$left=e.$sorder*l+this.config.timeScaleWidth+this.config.eventOffset,e.$inner||(l*=e.$count-e.$sorder),e.$width=l-this.config.eventOffset-2*this.type.padding;var s=60*a.getHours()+a.getMinutes(),d=60*i.getHours()+i.getMinutes()||60*this.config.lastHour;e.$top=Math.round((s-60*this.config.firstHour)*(this.config.timeScaleHeight+1)/60),e.$height=Math.max(this.config.minEventHeight,(d-s)*(this.config.timeScaleHeight+1)/60-1)-2*this.type.padding},_getEventEndDate:function(e){var t=e.end_date;if(this.config.separateShortEvents){var a=(e.end_date-e.start_date)/6e4;a<this.config.minEventHeight&&(t=webix.Date.add(t,this._minMappedDuration-a,"minute",!0))}return t},$setSize:function(e,t){webix.ui.view.prototype.$setSize.call(this,e,t)&&this.render()}},webix.ui.list),webix.protoUI({name:"datetext",defaults:{icon:"wxi-angle-right"},$renderIcon:function(){var e=this.config,t=e.aheight-2*e.inputPadding,a=(t-18)/2-1;return e.icon?"<span style='height:"+(t-a)+"px;padding-top:"+a+"px;' class='webix_input_icon  "+e.icon+"'></span>":""},$init:function(){this.attachEvent("onAfterRender",webix.once(this._after_render,this))},_after_render:function(){webix.event(this.getInputNode(),"keydown",function(e){var t=e.which||e.keyCode;32!=t&&13!=t&&39!=t||webix.html.triggerEvent(document.activeElement,"MouseEvents","click")},this)},setValue:function(e,t){var a=this.config.value,i=!0;if(a==e&&(i=!1,!t))return!1;this.config.value=e,this.getInputNode()&&this.$setValue(e),i&&this.callEvent("onChange",[e,a])},$setValue:function(e){this.config.value=e||"";var t=this.config.dateFormatStr||webix.i18n.dateFormatStr;this.config.text=this.getInputNode().innerHTML="object"==r(this.config.value)?t(this.config.value):this.config.value},dateFormat_setter:function(e){return this.config.dateFormatStr=webix.Date.dateToStr(e),webix.Date.strToDate(e)},getValue:function(){return this.config.value||null},getInputNode:function(){return this.$view.getElementsByTagName("DIV")[1]}},webix.ui.richselect),webix.protoUI({name:"weekevents",on_click:{},render:function(e,t){this.isVisible(this.config.id)&&this.callEvent("onBeforeRender",[this.data])&&(this.units=null,
this._htmlmap=null,this._setUnits(),this.units&&((t=this._getUnitRange()).length?this.$view.firstChild.innerHTML=t.map(this._toHTML,this).join(""):this.$view.firstChild.innerHTML="<div class='webix_noevents'>"+this.config.noEvents+"</div>"),this.callEvent("onAfterRender",[]))},_toHTML:function(e){var t=this.data.getMark(e.id,"webix_selected")?" webix_selected":"";return this.callEvent("onItemRender",[e]),e.$unit?this.type.templateStartHeader(e,this.type)+this.type.templateHeader.call(this,e.$unit)+this.type.templateEnd(e,this.type):this.type.templateStart(e,this.type,t)+(e.$template?this.type["template"+e.$template]:this.type.template)(e,this.type)+this.type.templateEnd(e,this.type)},_getUnitRange:function(){var e,t,a,i;for(a in e=[],this.units)for(e.push({$unit:a}),i=this.units[a],t=0;t<i.length;t++){var n=webix.extend({},i[t]);e.push(n)}return e},_setUnits:function(){var e=this.getTopParentView(),t=e.coreData.getValue(),a=webix.Date.weekStart(t),i=webix.Date.add(a,1,"week",!0);for(this.units={};a.valueOf()<i.valueOf();){var n=webix.Date.add(a,1,"day",!0),r=e._correctEventsDates(a,e.getEvents(a,n));r.length&&(this.units[a.valueOf()]=r),a=webix.Date.add(a,1,"day",!0)}},type:{headerHeight:28,margin:0,padding:0,aria:function(e,t,a){return" role='option'"+(a?" aria-selected='true' tabindex='0'":" tabindex='-1'")},templateHeader:function(e){var t=new Date(parseInt(e,10));return"<span class='webix_unit_header_inner"+(webix.Date.datePart(t).valueOf()==webix.Date.datePart(new Date).valueOf()?" current":"")+"'>"+webix.i18n.weekDateFormatStr(t)+"</span>"},templateStart:function(e,t,a){if(e.$unit)return t.templateStartHeader.apply(this,arguments);var i="webix_list_item webix_list_"+t.css+"_item"+(e.$selected?"_selected":"")+a,n="width:auto; height:"+t.height+"px; padding:"+t.padding+"px; margin:"+t.margin+"px; overflow:hidden;"+(t.layout&&"x"==t.layout?"float:left;":""),r=t.aria(e,t,a);return"<div webix_l_id='"+e.id+"' class='"+i+"' style='"+n+"' "+r+">"},templateStartHeader:function(e,t){var a="webix_unit_header webix_unit_"+t.css+"_header"+(e.$selected?"_selected":""),i="width:auto; height:"+t.headerHeight+"px; overflow:hidden;";return"<div webix_unit_id='"+e.$unit+"' class='"+a+"' style='"+i+"'>"}}},webix.ui.list),webix.protoUI({name:"ariabutton",$cssName:"button",$renderInput:function(e){var t="class='webixtype_"+(e.type||"base")+"' ";return"<button type='button' aria-label='"+webix.template.escape(e.label||e.value)+"'"+t+"></button>"}},webix.ui.button),webix.protoUI({name:"datecells",defaults:{css:"webix_datecells",x_count:7,cellHeight:36},_id:"webix_d_c",$init:function(){this._dataobj=this.$view},on_click:{webix_cal_day_num:function(e,t){t&&this.define("activeCell",t)}},activeCell_setter:function(e){return this.config.activeCell=e,this.render(),e},render:function(){if(this.isVisible(this.config.id)){var e=1,t="<table cellspacing='0' cellpadding='0' class='webix_rec_table'><tbody>",a=this.config.data,i=this.$width/this.config.x_count;for(var n in a){var r="",l="webix_cal_day_num";r+=";height:"+this.config.cellHeight+"px;line-height:"+this.config.cellHeight+"px;",e%this.config.x_count==1&&(t+="<tr>"),t+="<td style='"+(i?"width:"+i+"px":"")+"'>",this.config.activeCell==n&&(l+=" webix_cal_selected_day"),t+="<div webix_d_c='"+n+"' class='"+l+"' style='"+r+"'>"+a[n]+"</div>",t+="</td>",e%this.config.x_count==0&&(t+="</tr>"),e++}t+="</tbody></table>",this.$view.innerHTML=t}},$setSize:function(e,t){webix.ui.view.prototype.$setSize.call(this,e,t)&&this.render()},setValue:function(e){this.define("activeCell",e)},getValue:function(){return this.config.activeCell}},webix.MouseEvents,webix.ui.view,webix.EventSystem),webix.protoUI({name:"rectext",$setValue:function(e){this.config.value=e||"";var t="none",a=this.getTopParentView().$$("recurring"),i=this.config.value.split("_");""!==i[0]&&(t=a.config.typeToId[i[0]]),this.config.text=this.getInputNode().innerHTML=scheduler.locale.labels.recurring[t]}},webix.ui.datetext),webix.protoUI({name:"endrec",defaults:{height:42},setValue:function(e){var t=!1,a=this.config.value
;a==e?t=!0:this.config.value=e,this.getInputNode()&&this.$setValue(e),t||this.callEvent("onChange",[e,a])},$setValue:function(e){this.config.value=e||"";var t,a=this.getTopParentView().$$("recurring");"object"==r(e)&&(t=e.valueOf()==a.config.endlessDate.valueOf()?scheduler.locale.labels.recurring.never:(this.config.dateFormatStr||webix.i18n.dateFormatStr)(this.config.value)),this.config.text=this.getInputNode().innerHTML=t||this.config.value}},webix.ui.datetext),webix.protoUI({name:"reclist",defaults:{},$init:function(){this.$view.className+=" webix_reclist"},setValue:function(e){this.getItem(e)&&this.select(e)},getValue:function(){return this.getSelected()}},webix.ui.list),webix.protoUI({name:"daily",setValue:function(e){"object"==r(e)&&"day"==e[0]&&(e[1]&&""!==e[1]||(e[1]=1),this.setValues({dayCount:e[1]}))},getValue:function(){return["day",this.getValues().dayCount,"","","",""]}},webix.ui.form),webix.protoUI({name:"weekly",setValue:function(e){"object"==r(e)&&"week"==e[0]&&(e[1]||""!==e[1]||(e[1]=1),e[4]&&""!==e[4]||(e[4]=(e[5].getDay()+6)%7+1),this.setValues({weekCount:e[1],weekDays:""+e[4]}))},getValue:function(){var e=this.getValues();return e.weekDays||(e.weekDays=1),["week",e.weekCount,"","",e.weekDays,""]}},webix.ui.form),webix.protoUI({name:"weeklist",defaults:{css:"webix_weeklist",elementsConfig:{labelWidth:2,height:42},rows:[{view:"checkbox",name:1,id:1,labelRight:webix.i18n.calendar.dayFull[1]},{view:"checkbox",name:2,id:2,labelRight:webix.i18n.calendar.dayFull[2]},{view:"checkbox",name:3,id:3,labelRight:webix.i18n.calendar.dayFull[3]},{view:"checkbox",name:4,id:4,labelRight:webix.i18n.calendar.dayFull[4]},{view:"checkbox",name:5,id:5,labelRight:webix.i18n.calendar.dayFull[5]},{view:"checkbox",name:6,id:6,labelRight:webix.i18n.calendar.dayFull[6]},{view:"checkbox",name:7,id:7,labelRight:webix.i18n.calendar.dayFull[0]}]},getValue:function(){var e=this.getValues(),t=[];for(var a in e)e[a]&&t.push(a);return t.join()},setValue:function(e){for(var t={},a=1;a<8;a++)t[a]=0;"object"!=r(e)&&(e=e.split(","));for(var i=0;i<e.length;i++)t[parseInt(e[i],10)]=1;this.setValues(t)}},webix.MouseEvents,webix.EventSystem,webix.ui.form),webix.protoUI({name:"monthly",defaults:{css:"webix_monthly"},setValue:function(e){if("object"==r(e)&&"month"==e[0]){var t=this.getTopParentView();e[1]||""!==e[1]||(e[1]=1),e[2]&&""!==e[2]?t.$$("typeWeekM").expand():(e[2]=(e[5].getDay()+6)%7+1,e[3]=Math.ceil(e[5].getDate()/7)),this.setValues({monthCount:e[1],weekDayM:e[2],weekCountM:e[3],monthDayM:e[5].getDate()})}},getValue:function(){var e=this.getValues(),t=["month",e.monthCount,"","","",""];return this.getTopParentView().$$("typeDayM").config.collapsed?(t[2]=e.weekDayM,t[3]=e.weekCountM):t[5]=e.monthDayM,t}},webix.ui.form),webix.protoUI({name:"yearly",defaults:{css:"webix_yearly"},setValue:function(e){if("object"==r(e)&&"year"==e[0]){var t=this.getTopParentView();e[1]||""!==e[1]||(e[1]=1),e[2]&&""!==e[2]?t.$$("typeWeekY").setValue(1):(t.$$("typeWeekY").setValue(0),e[2]=(e[5].getDay()+6)%7+1,e[3]=Math.ceil(e[5].getDate()/7)),t.$$("typeWeekY").callEvent("onItemClick",[]),this.setValues({yearCount:e[1],weekDayY:e[2],weekCountY:e[3],monthDayY:e[5].getMonth()})}},getValue:function(){var e=this.getValues(),t=["year",e.yearCount,"","","",""];return this.getTopParentView().$$("typeWeekY").getValue()&&(t[2]=e.weekDayY,t[3]=e.weekCountY),t[5]=e.monthDayY,t}},webix.ui.form),webix.protoUI({name:"rec_dialog",defaults:{height:210,css:"webix_scheduler dialog",head:!1,body:{type:"clean",rows:[{id:"webix_confirm_message",template:"<div class='webix_dialog_text'>#text#</div>",data:{text:"You have forgot to define the text :) "}},{height:44,view:"altbutton",label:"Series",click:function(){this.getParentView().getParentView()._callback(1)}},{height:44,view:"altbutton",label:"Occurrence",click:function(){this.getParentView().getParentView()._callback(2)}},{height:44,view:"altbutton",css:"cancel",label:"Cancel",click:function(){this.getParentView().getParentView()._callback(!1)}}]}},labelSeries_setter:function(e){var t=this._body_cell._cells[1];t.config.label=e,
t.render()},labelEvent_setter:function(e){var t=this._body_cell._cells[2];t.config.label=e,t.render()},labelCancel_setter:function(e){var t=this._body_cell._cells[3];t.config.label=e,t.render()}},webix.ui.alert),webix.rec_dialog=webix.single(webix.ui.rec_dialog),window.scheduler||(window.scheduler={config:{},templates:{},xy:{},locale:{}}),scheduler.locale||(scheduler.locale={}),scheduler.locale.labels={week_tab:"Week",day_tab:"Day",month_tab:"Month",icon_today:"Today",icon_add:"Add",icon_save:"Save",icon_done:"Done",icon_delete:"Delete event",icon_cancel:"Cancel",icon_edit:"Edit",icon_back:"Back",icon_close:"Close form",icon_yes:"Yes",icon_no:"No",icon_prev_day:"Previous day",icon_next_day:"Next week",icon_prev_week:"Previous week",icon_next_week:"Next day",confirm_closing:"Your changes will be lost, are your sure ?",confirm_deleting:"The event will be deleted permanently, are you sure?",label_event:"Event",label_start:"Start",label_end:"End",label_details:"Notes",label_from:"from",label_to:"to",label_allday:"All day",label_time:"Time",label_no_events:"No Events",recurring:{none:"Never",daily:"Daily",day:"day(s)",every:"Every",weekly:"Weekly",week:"week(s) on",each:"Each",on_day:"on the",monthly:"Monthly",month:"month(s)",month_day:"on what day of the month",week_day:"on what day of the week",yearly:"Yearly",year:"year(s) in",counters:["the first","the second","the third","the fourth","the fifth"],never:"Never",repeat:"Repeat",end_repeat:"End repeat",endless_repeat:"Endless repeat",end_repeat_label:"Repeat will end by",edit_message:"Do you want to edit the whole set of repeated events?",edit_series:"Edit series",edit_occurrence:"Edit occurrence",delete_message:"Do you want to delete the whole set of repeated events?",delete_series:"Delete series",delete_occurrence:"Delete occurrence"}},scheduler.config=e,scheduler.xy={confirm_height:180,confirm_width:250,scale_width:40,min_event_height:20,scale_height:20,week_tab:60,day_tab:60,month_tab:68,icon_today:55,icon_save:90,icon_done:90,icon_cancel:80,icon_edit:90,icon_back:70,list_header_height:30,list_height:50,all_day:120,month_list_height:50,recurring:{label_end_repeat:140,label_end_by:240,label_every:65,work_days:180}},scheduler.templates=t,webix.ready(function(){webix.callEvent("onBeforeSchedulerInit",[]),scheduler.locale&&scheduler.locale.date&&(webix.Date.Locale=scheduler.locale.date);var r=scheduler.config,l=scheduler.locale.labels,e=scheduler.templates;!function s(){var e=scheduler.config,t=scheduler.locale.labels;if(e.form||(e.form=[{view:"text",label:t.label_event,labelWidth:90,name:"text"},{view:"datetext",label:t.label_start,labelWidth:90,id:"start_date",name:"start_date",dateFormat:e.form_date},{view:"datetext",label:t.label_end,labelWidth:90,id:"end_date",name:"end_date",dateFormat:e.form_date},{view:"checkbox",id:"allDay",name:"allDay",label:t.label_allday,labelWidth:100,value:0},{view:"textarea",label:t.label_details,name:"details",labelWidth:90,height:150},{}]),!e.calendar_hour){var a=e.hour_date.match(/%[h,H,g,G]/gi),i=e.hour_date.match(/%[a,A]/gi);e.calendar_hour=a[0]+(i?" "+i[0]:"")}e.bottom_toolbar||(e.bottom_toolbar=[{view:"altbutton",id:"today",name:"today",type:"flat",label:t.icon_today,inputWidth:scheduler.xy.icon_today,align:"center",width:scheduler.xy.icon_today+6},{view:"segmented",id:"buttons",value:e.mode||"week",align:"center",multiview:!0,options:[{id:"day",value:t.day_tab,width:scheduler.xy.day_tab},{id:"week",value:t.week_tab,width:scheduler.xy.week_tab},{id:"month",value:t.month_tab,width:scheduler.xy.month_tab}]},{view:"ariabutton",label:t.icon_add,type:"icon",icon:"wxi-plus",name:"add",id:"add",align:"center",width:45,batch:"default"},{view:"label",label:"",width:45,batch:"readonly"}]),e.day_toolbar||(e.day_toolbar=[{view:"ariabutton",label:t.icon_prev_day,type:"iconprev",id:"prev",align:"left",width:40},{view:"label",id:"date",align:"center"},{view:"ariabutton",label:t.icon_next_day,type:"iconnext",id:"next",align:"right",width:40}]),e.week_toolbar||(e.week_toolbar=[{view:"ariabutton",label:t.icon_prev_week,type:"iconprev",name:"prevWeek",
id:"prevWeek",width:40,align:"left"},{view:"label",id:"weekTitle",align:"center"},{view:"ariabutton",label:t.icon_next_week,type:"iconnext",id:"nextWeek",align:"right",width:40}]),e.selected_toolbar||(e.selected_toolbar=[{view:"altbutton",width:scheduler.xy.icon_back,type:"flat",name:"back",id:"back",align:"center",label:t.icon_back},{view:"altbutton",inputWidth:scheduler.xy.icon_edit,name:"edit",id:"edit",align:"right",label:t.icon_edit}]),e.form_toolbar||(e.form_toolbar=[{view:"altbutton",type:"flat",width:scheduler.xy.icon_cancel,name:"cancel",id:"cancel",align:"center",label:t.icon_cancel},{view:"altbutton",inputWidth:scheduler.xy.icon_save,name:"save",id:"save",align:"right",label:t.icon_save}]),e.date_toolbar||(e.date_toolbar=[{view:"altbutton",type:"flat",width:scheduler.xy.icon_cancel,name:"cancel_date",id:"cancel_date",align:"center",label:t.icon_cancel},{view:"label",id:"datetype",align:"center"},{view:"altbutton",width:scheduler.xy.icon_done,name:"done",id:"done",align:"right",label:t.icon_done}])}();var t={cssNoEvents:"no_events",timeStart:e.event_time,marker:e.event_marker,eventClass:e.event_class};scheduler.types={event_list:webix.extend({name:"EventsList",css:"events",headerHeight:scheduler.xy.list_header_height,height:scheduler.xy.list_height,templateHeader:e.event_date,template:e.event_title},t),day_event_list:webix.extend({name:"DayEventsList",css:"day_events",height:scheduler.xy.month_list_height,template:e.month_event_title},t),multi_day_list:{name:"MultiDayEvents",height:32,css:"multi_day_events",classname:function(e,t,a){var i="webix_list_item";return a&&a.$css&&(i+=" "+a.$css),i},aria:function(e,t,a){return"role='option'"+(a&&a.webix_selected?" aria-selected='true' tabindex='0'":" tabindex='-1'")},templateCss:scheduler.templates.event_class,templateStart:webix.template("<div webix_l_id='#id#' {common.aria()} class='{common.classname()} {common.templateCss()}' style='width:{common.widthSize()}; height:{common.heightSize()}; overflow:hidden;{common.templateColor()};'>"),template:e.multi_day_event,templateColor:function(e){return scheduler.templates.multi_day_event_style(e)}}},webix.type(webix.ui.weekevents,scheduler.types.event_list),webix.type(webix.ui.list,scheduler.types.day_event_list),webix.type(webix.ui.list,scheduler.types.multi_day_list),webix.DataDriver.scheduler={records:"/*/event"},webix.extend(webix.DataDriver.scheduler,webix.DataDriver.xml);var a=[{id:"day",rows:[{id:"dayBar",view:"toolbar",css:"webix_topbar",cols:r.day_toolbar,height:50},{id:"multiDayList",view:"list",autoheight:!0,type:"MultiDayEvents",yCount:r.multi_day_limit},{id:"dayList",view:"dayevents"}]},{id:"week",rows:[{id:"weekBar",view:"toolbar",css:"webix_topbar",elements:r.week_toolbar,height:50},{id:"weekEventsList",view:"weekevents",type:"EventsList",startDate:new Date,noEvents:l.label_no_events}]},{id:"month",view:"scrollview",scroll:!1,body:{rows:[{id:"calendar",view:"calendar",width:0,icons:!1,height:310,dayWithEvents:e.calendar_event,dayNoEvents:e.calendar_day,calendarHeader:r.calendar_date},{id:"calendarDayEvents",view:"list",type:"DayEventsList"}]}}].concat(r.tab_views),i={view:"altbutton",height:44,label:l.icon_delete,id:"delete",type:"danger",css:"delete"};500<screen.width&&(i.width=300,i={type:"clean",cols:[{},i,{}]});var n=[{rows:[{view:"multiview",id:"tabViews",animate:!!webix.env.touch&&{},cells:a},{id:"bottomBar",css:"webix_bottombar",height:55,padding:5,visibleBatch:"default",cols:r.bottom_toolbar}]},{id:"event",rows:[{id:"eventBar",view:"toolbar",css:"webix_subbar",elements:r.selected_toolbar,height:50},{type:"clean",paddingX:10,rows:[{id:"eventTemplate",view:"template",css:"webix_event_view",template:e.selected_event},i,{view:"template",height:20}]}]},{id:"form",rows:[{id:"editBar",view:"toolbar",css:"webix_subbar",elements:r.form_toolbar,height:50},{id:"editForm",view:"form",scroll:!0,elements:r.form,margin:2,padding:10,rules:r.form_rules,elementsConfig:{height:42}}]},{id:"formdate",rows:[{id:"dateBar",view:"toolbar",css:"webix_subbar",elements:r.date_toolbar,height:50},{id:"dateForm",type:"clean",rows:[
{view:"calendar",height:310,timepickerHeight:35,css:"form_calendar",icons:!1,id:"formCalendar",width:0,calendarTime:r.calendar_hour,timepicker:1,hourStart:0},{view:"template",css:"form_template"}]}]}].concat(r.views);webix.protoUI({name:"scheduler",version:"{{version}}",defaults:{rows:[{view:"multiview",id:"views",animate:!!webix.env.touch&&{},cells:n}],color:"#color#",textColor:"#textColor#"},_setDateMethods:function(){webix.i18n.dateFormat=r.item_date,webix.i18n.weekDateFormat=r.week_date,webix.i18n.formDate=r.form_date,webix.i18n.formAllDayFormat=r.form_all_day,webix.i18n.timeFormat=r.hour_date,webix.i18n.fullDateFormat=r.parse_date,webix.i18n.fullDateFormatUTC=r.server_utc,webix.i18n.longDateFormat=r.all_day_date,webix.i18n.headerFormatStr=webix.Date.dateToStr(r.day_header_date),webix.i18n.headerWeekFormatStr=webix.Date.dateToStr(r.week_header_date),webix.i18n.loadDateFormat=r.dyn_load_date;for(var e=["formDate","formAllDayFormat","loadDateFormat","weekDateFormat"],t=0;t<e.length;t++){var a=e[t],i=webix.i18n[a+"UTC"];webix.i18n[a+"Str"]=webix.Date.dateToStr(webix.i18n[a],i),webix.i18n[a+"Date"]=webix.Date.strToDate(webix.i18n[a],i)}webix.i18n.setLocale()},$init:function(){this.name="scheduler",this.$view.className+=" webix_scheduler",this._setDateMethods(r),this.data.provideApi(this),this.data.scheme({$init:function(e){"string"==typeof e.start_date&&(e.start_date=webix.i18n.fullDateFormatDate(e.start_date)),"string"==typeof e.end_date&&(e.end_date=webix.i18n.fullDateFormatDate(e.end_date))},$update:function(e){"string"==typeof e.start_date&&(e.start_date=webix.i18n.fullDateFormatDate(e.start_date)),"string"==typeof e.end_date&&(e.end_date=webix.i18n.fullDateFormatDate(e.end_date))},$serialize:function(e){var t={};return t.start_date=webix.i18n.fullDateFormatStr(webix.Date.copy(e.start_date)),t.end_date=webix.i18n.fullDateFormatStr(webix.Date.copy(e.end_date)),webix.extend(t,e),t}}),this.$ready.push(this._initStructure),webix.callEvent("onAfterSchedulerInit",[this])},syncData:function(e,t,a,i){var n=this.getEvents(t,a);e.data.clearAll();var r=e.data.pull,l=e.data.order;n=this._correctEventsDates(t,n);for(var s=0;s<n.length;s++)if(!i||i.call(e,n[s],t,a)){var d=n[s].id;l.push(d),r[d]=n[s]}},_syncAllViews:function(){this.coreData.callEvent("onChange",[]),this.$$("multiDayList").getParentView().resize()},getWeekTitle:function(e){return scheduler.templates.week_title(e)},getDayTitle:function(e){return scheduler.templates.day_title(e)},getTodayMultiEvents:function(){var e=this.getTopParentView(),i=webix.Date.datePart(e.coreData.getValue(),!0),n=webix.Date.add(i,1,"day",!0);e.syncData(this,i,n,function(e){var t=webix.Date.datePart(e.start_date,!0),a=webix.Date.datePart(e.end_date,!0);return!webix.Date.equal(t,a)&&e.start_date.valueOf()<=i.valueOf()&&e.end_date.valueOf()>=n.valueOf()}),this.resize()},getWeekEvents:function(){var e=this.getTopParentView(),i=webix.Date.weekStart(e.coreData.getValue()),n=webix.Date.add(i,6,"day",!0),t=null;r.multi_day&&e.$$("weekEventsList").isVisible()&&(t=function(e){var t=webix.Date.datePart(e.start_date,!0),a=webix.Date.datePart(e.end_date,!0);return webix.Date.equal(t,a)||e.start_date.valueOf()>i.valueOf()||e.end_date.valueOf()<n.valueOf()||e.start_date.valueOf()<=i.valueOf()&&e.end_date.valueOf()>=n.valueOf()}),e.syncData(this,i,n,t)},getTodayEvents:function(){var e=this.getTopParentView(),i=webix.Date.datePart(e.coreData.getValue(),!0),n=webix.Date.add(i,1,"day",!0),t=null;r.multi_day&&e.$$("dayList").isVisible()&&(t=function(e){var t=webix.Date.datePart(e.start_date,!0),a=webix.Date.datePart(e.end_date,!0);return webix.Date.equal(t,a)||e.start_date.valueOf()>i.valueOf()||e.end_date.valueOf()<n.valueOf()}),e.syncData(this,i,n,t)},_setMonthFlags:function(){if(this.isVisible()){var e=this.getTopParentView(),t=webix.Date.datePart(webix.Date.copy(this.getVisibleDate()));t.setDate(1);var a=webix.Date.add(t,1,"month",!0);e._eventsByDate={};for(var i=e.getEvents(t,a);t<a;){for(var n=webix.Date.add(t,1,"day",!0),r=0;r<i.length;r++)i[r].start_date<n&&i[r].end_date>t&&(e._eventsByDate[t.valueOf(
)]=!0);t=n}}},_initHotKeys:function(){function e(e){var t=e.getSelectedId()||e.locate(document.activeElement);t&&this._on_event_clicked(t)}webix.UIManager.addHotKey("enter",webix.bind(e,this),this.$$("dayList")),webix.UIManager.addHotKey("enter",webix.bind(e,this),this.$$("weekEventsList")),webix.UIManager.addHotKey("enter",webix.bind(e,this),this.$$("multiDayList")),webix.UIManager.addHotKey("enter",webix.bind(e,this),this.$$("calendarDayEvents"))},_initStructure:function(){if(this._initToolbars(),this._initMonth(),this._initHotKeys(),this.coreData=new webix.DataValue,this.coreData.setValue(r.init_date),this.$$("dayList").define("date",this.coreData),this.selectedEvent=new webix.DataRecord,this.config.readonly?this.define("readonly",this.config.readonly):r.readonly&&this.define("readonly",!0),this.$$("date")){var e=this.getDayTitle(r.init_date);this.$$("date").setValue(e),this.$$("date").config.label=this.$$("date").config.value,this.$$("date").bind(this.coreData,null,webix.i18n.headerFormatStr)}if(this.$$("weekTitle")){var t=this.getWeekTitle(r.init_date);this.$$("weekTitle").setValue(t),this.$$("weekTitle").config.label=t,this.$$("weekTitle").bind(this.coreData,null,webix.bind(this.getWeekTitle,this))}this.data.attachEvent("onStoreUpdated",this._sortDates),this.data.attachEvent("onStoreUpdated",webix.bind(this._syncAllViews,this)),r.multi_day&&(this.$$("multiDayList").define("dataFeed",this.getTodayMultiEvents),this.$$("multiDayList").bind(this.coreData)),this.$$("weekEventsList").define("dataFeed",this.getWeekEvents),this.$$("weekEventsList").bind(this.coreData),this.$$("dayList").define("dataFeed",this.getTodayEvents),this.$$("dayList").bind(this.coreData),this.$$("calendarDayEvents").define("dataFeed",this.getTodayEvents),this.$$("calendarDayEvents").bind(this.coreData),this.$$("calendar").bind(this.coreData),this.$$("calendar").attachEvent("onBeforeRender",this._setMonthFlags),this.coreData.attachEvent("onChange",webix.bind(function(){this._isFormCalendarZoomed||(this._load_mode&&this._load_url&&this.load.apply(this,[this._load_url]),this.$$("calendar").render())},this)),this.data.attachEvent("onClearAll",webix.bind(function(){this._loaded_ranges={}},this)),this.data.attachEvent("onIdChange",webix.bind(function(){this._syncAllViews()},this)),this.$$("eventTemplate").bind(this),this.$$("weekEventsList").attachEvent("onItemClick",webix.bind(this._on_event_clicked,this)),this.$$("dayList").attachEvent("onItemClick",webix.bind(this._on_event_clicked,this)),this.$$("multiDayList").attachEvent("onItemClick",webix.bind(this._on_event_clicked,this)),this.$$("calendarDayEvents").attachEvent("onItemClick",webix.bind(this._on_event_clicked,this)),this.$$("tabViews").attachEvent("onViewChange",webix.bind(this._onViewChanged,this)),this.attachEvent("onBeforeEventShow",webix.bind(this._onViewChanged,this)),this.$$(r.mode||"week").show(!1,!1),this._initForm()},_initForm:function(){this.$$("editForm").bind(this),this.dateField=new webix.DataValue,this.dateField.setValue("start_date"),this.$$("datetype").bind(this.dateField,null,function(e){return"start_date"==e?l.label_start:l.label_end}),this.$$("formCalendar").attachEvent("onAfterZoom",webix.bind(function(e){this._isFormCalendarZoomed=!!e,e&&this.$$("cancel_date").hide()},this)),this.$$("formCalendar").attachEvent("onBeforeRender",webix.bind(function(){this.$$("cancel_date").show()},this))},_onViewChanged:function(){this.$$("multiDayList").unselectAll(),this.$$("dayList").unselectAll(),this.$$("weekEventsList").unselectAll(),this.$$("calendarDayEvents").unselectAll()},_on_event_clicked:function(e){this._last_selected=(e||"").toString().split("#"),this._last_selected[1]&&this.setCursor(null),this.setCursor(this._last_selected[0]),this.callEvent("onBeforeEventShow",[this._last_selected[0]])&&this.$$("event").show()},_sortDates:function(){this.blockEvent(),this.sort(function(e,t){return e.start_date<t.start_date?-1:1}),this.unblockEvent()},_initMonth:function(){this.$$("calendar").attachEvent("onDateSelect",webix.bind(function(e){this._isMonthCalendarZoomed=!1,this.setDate(e)},
this)),this.$$("calendar").attachEvent("onChange",webix.bind(function(e){this._isMonthCalendarZoomed||(this.$$("calendar").blockEvent(),this.setDate(e),this.$$("calendar").unblockEvent())},this)),this.$$("calendar").attachEvent("onAfterZoom",webix.bind(function(e){this._isMonthCalendarZoomed=!!e,e||this.$$("calendar").callEvent("onBeforeMonthChange",[null,this.$$("calendar").config.date])},this)),this.$$("calendar").attachEvent("onBeforeMonthChange",webix.bind(function(e,t){if(!this._isFormCalendarZoomed){var a=new Date;t.getMonth()===a.getMonth()&&t.getYear()===a.getYear()?t=a:t.setDate(1),this._isMonthCalendarZoomed||(this.$$("tabViews").config.animate?webix.ui.animateView(this.$$("month").getBody(),webix.bind(function(){this.setDate(t)},this),{type:"slide",direction:e<t?"left":"right"}):this.setDate(t))}},this)),this.$$("calendar").config.dayTemplate=webix.bind(function(e){return this._eventsByDate&&this._eventsByDate[e.valueOf()]?this.$$("calendar").config.dayWithEvents(e):this.$$("calendar").config.dayNoEvents(e)},this)},getEvents:function(e,t){t||(t=new Date(9999,0,1));for(var a=[],i=this.data.getRange(),n=0;n<i.length;n++)i[n].start_date<t&&i[n].end_date>e&&a.push(webix.copy(i[n]));return a},_correctEventsDates:function(e,t){var a,i=[];if(t)for(var n=0;n<t.length;n++){a={start_date:webix.Date.copy(t[n].start_date),end_date:webix.Date.copy(t[n].end_date)},webix.extend(a,t[n]),a.start_date.valueOf()<e.valueOf()&&(a.start_date=webix.Date.add(webix.Date.datePart(a.start_date),1,"day",!0));var r=(r||"").toString().split("#"),l=a.rec_type?new Date(1e3*r[1]+1e3*a.event_length):a.end_date;l.valueOf()>webix.Date.add(e,1,"day",!0).valueOf()&&(l=webix.Date.datePart(l),a.end_date=webix.Date.add(l,1,"day",!0)),i.push(a)}return i},setDate:function(e,t,a){e=e?webix.Date.datePart(e,!0):this.coreData.getValue(),t&&(e=webix.Date.add(e,t,a,!0)),this.coreData.setValue(e)},_initToolbars:function(){this.attachEvent("onItemClick",function(e){var t=this.innerId(e);switch(t){case"today":this.setDate(new Date);break;case"add":if("form"==this.innerId(this.$$("views").getActiveId())){var a=this;webix.confirm({height:scheduler.xy.confirm_height,width:scheduler.xy.confirm_width,title:l.icon_close,message:l.confirm_closing,callback:function(e){e&&a._addEvent()},ok:l.icon_yes,cancel:l.icon_no,css:"confirm"})}else this._addEvent();break;case"prev":this.setDate(null,-1,"day");break;case"next":this.setDate(null,1,"day");break;case"prevWeek":this.setDate(null,-1,"week");break;case"nextWeek":this.setDate(null,1,"week");break;case"edit":this._editEvent();break;case"cancel_date":case"back":this.$$("views").back();break;case"cancel":this.callEvent("onAfterCursorChange",[this.getCursor()]),this.$$("views").back();break;case"save":this._saveEvent();break;case"delete":this._deleteEvent();break;case"start_date":case"end_date":"datetext"==this.$$(t).name&&this._showDateForm(t);break;case"done":if(this._isFormCalendarZoomed)this.$$("formCalendar").selectDate(this.$$("formCalendar").config.date,!0),this._isFormCalendarZoomed=!1;else{var i=this.dateField.getValue(),n=this.$$("formCalendar").getValue();this.$$(i).setValue(n),this._setDefaultDates(),this.$$("views").back(),this.$$("editForm").validate()}break;case"allDay":this._setAllDay()}}),this.attachEvent("onAfterTabClick",function(e,t){this.$$(t).show()}),this.attachEvent("onBeforeTabClick",function(e,t){return this._confirmViewChange(t)})},readonly_setter:function(e){return this.$$("add")&&(e?(this.$$("bottomBar").showBatch("readonly"),this.$$("edit").hide(),this.$$("delete").hide()):(this.$$("bottomBar").showBatch("default"),this.$$("edit").show(),this.$$("delete").show())),e},_clearNoEventsStyle:function(){this.dataCount()?this.$view.className=this.$view.className.replace(RegExp(this.type.cssNoEvents,"g"),""):this.$view.className+=" "+this.type.cssNoEvents},_saveEvent:function(){if(this.$$("editForm").validate()){if(this.config.editEvent)this.$$("editForm").save();else{var e=this.$$("editForm").getValues();e.id=webix.uid(),e.details&&""===this._trim(e.text)&&""!==this._trim(e.details)&&(e.text=e.details),
this.add(e),this.setCursor(e.id)}this.setDate(),this.$$("views").back()}},_deleteEvent:function(){var t=this;webix.confirm({height:scheduler.xy.confirm_height,width:scheduler.xy.confirm_width,title:l.icon_delete,text:l.confirm_deleting,callback:function(e){e&&(t.remove(t.getCursor()),t.setDate(),t.$$("views").back(1))},ok:l.icon_yes,cancel:l.icon_no,css:"confirm",header:!1})},_addEvent:function(){this.define("editEvent",!1),this.$$("form").show(),this.$$("editForm").clear(),this.$$("editForm").clearValidation(),this.$$("editForm").setValues(e.new_event_data.call(this)),this._setDefaultDates()},eventDefaultDate:function(){},_editEvent:function(){this.$$("delete")&&this.$$("delete").show(),this.define("editEvent",!0),this.$$("form").show(),this.$$("rec_type")&&this.$$("rec_type").setValue(this.$$("rec_type").getValue(),!0),this._setDefaultDates()},_confirmViewChange:function(t){if("form"!=this.innerId(this.$$("views").getActiveId()))return!0;var a=this;return"today"!=t&&webix.confirm({width:scheduler.xy.confirm_width,title:l.icon_close,text:l.confirm_closing,callback:function(e){e&&(a.$$(t).show(),a.$$("buttons").setValue(t))},labelOk:l.icon_yes,labelCancel:l.icon_no,css:"confirm"}),!1},_showDateForm:function(e){this.dateField.setValue(e),this.$$("editForm").elements.allDay&&this.$$("formCalendar").define("timepicker",!this.$$("editForm").elements.allDay.getValue()),this.$$("formdate").show(),webix.delay(function(){this.$$("formCalendar").resize(),this.$$("formCalendar").selectDate(webix.Date.copy(this.$$(e).getValue()),!0)},this)},_checkAllDay:function(e){return e.valueOf()==webix.Date.datePart(e,!0).valueOf()},_setAllDay:function(){for(var e="1"==this.$$("allDay").getValue()?webix.i18n.formAllDayFormatStr:webix.i18n.formDateStr,t=this.$$("editForm").elements,a=[this.$$("start_date"),this.$$("end_date")],i=0;i<2;i++)a[i].config.dateFormatStr=e,1!=t.allDay.getValue()&&a[i].setValue(this._event_date[i],!0);if(1==t.allDay.getValue()){a[0].setValue(webix.Date.datePart(this._event_date[0],!0),!0);var n=webix.Date.datePart(this._event_date[1],!0);n.valueOf()<=a[0].getValue().valueOf()&&(n=webix.Date.add(n,1,"day",!0)),a[1].setValue(n,!0)}},_setDefaultDates:function(){this._event_date=[];var e=this.$$("editForm").elements;this._event_date[0]=this.$$("start_date").getValue(),this._event_date[1]=this.$$("end_date").getValue();var t=this._checkAllDay(this._event_date[0])&&this._checkAllDay(this._event_date[1])&&this._event_date[1].valueOf()>this._event_date[0].valueOf()?1:0;if(e.allDay){e.allDay.setValue(t);for(var a=e.allDay.getValue()?webix.i18n.formAllDayFormatStr:webix.i18n.formDateStr,i=[this.$$("start_date"),this.$$("end_date")],n=0;n<2;n++)i[n].config.dateFormatStr=a,i[n].setValue(this._event_date[n],!0)}},_trim:function(e){return e=(e=e.replace(/^ */g,"")).replace(/ *$/g,"")},setLoadMode:function(e){"all"==e&&(e=""),this._load_mode=e},_loaded_ranges:{},load:function(e){this._load_url=e;var t=arguments;if(this._load_mode&&"string"==typeof e){var a;e+=(-1==e.indexOf("?")?"?":"&")+"timeshift="+(new Date).getTimezoneOffset();var i=this.coreData.getValue(),n=webix.i18n.loadDateFormatStr;a=i=webix.Date[this._load_mode+"Start"](new Date(i.valueOf())),a=webix.Date.add(a,1,this._load_mode,!0),this._loaded_ranges[n(i)]&&(i=webix.Date.add(i,1,this._load_mode,!0));for(var r=a;a=r,i<(r=webix.Date.add(a,-1,this._load_mode,!0))&&this._loaded_ranges[n(r)];);if(a<=i)return!1;for(t[0]=e+"&from="+n(i)+"&to="+n(a);i<a;)this._loaded_ranges[n(i)]=!0,i=webix.Date.add(i,1,this._load_mode,!0)}webix.DataLoader.prototype.load.apply(this,t)}},webix.IdSpace,webix.DataLoader,webix.ui.layout,webix.EventSystem,webix.Settings)}),a=scheduler.locale.labels,i=scheduler.xy,n=scheduler.config,l=scheduler.templates,webix.attachEvent("onAfterSchedulerInit",function(d){if(!n.recurring)return!1;webix.delay(function(){d.$$("editForm").define("dataFeed",function(e){delete(e=webix.copy(this.getTopParentView().getItem(e))).id,e.rec_type&&(e.endRepeat=e.end_date,e.end_date=new Date(e.start_date.valueOf()+1e3*e.event_length)),this.setValues(e)}),d.$$("editForm"
).getValueBase=d.$$("editForm").getValues,d.$$("editForm").getValues=function(){var e=this.getValueBase();return e.rec_type&&(e.event_length=Math.round((e.end_date-e.start_date)/1e3),e.end_date=e.endRepeat||e.end_date),e}}),d.getEventsBase=d.getEvents,d.getEvents=function(e,t){t=t||webix.Date.add(e,1,"month",!0);for(var a=this.getEventsBase(e,t),i=[],n=0;n<a.length;n++)a[n].rec_type?this.repeat_date(a[n],i,e,t):i.push(a[n]);return i.sort(function(e,t){return e=e.start_date,(t=t.start_date)<e?1:e<t?-1:0}),i},d._saveEventBase=d._saveEvent,d._saveEvent=function(){if(!this.config.editEvent&&this.$$("editForm").validate()){var e=this.$$("editForm").getValues();if(e.event_pid)return e.id=webix.uid(),e.details&&""===this._trim(e.text)&&""!==this._trim(e.details)&&(e.text=e.details),e.event_length=e.start_date.valueOf()/1e3,this._add_rec_marker(e,e.start_date.valueOf()),this.add(e),this.setCursor(e.id),this.setDate(),this.$$("views").back(),!0}this._saveEventBase.call(this)},d._editEventBase=d._editEvent,d._editEvent=function(){var t=this.getItem(this.getCursor());(t.rec_type||t.event_pid)&&n.recurring_dialogs?webix.rec_dialog({height:i.confirm_height,width:i.confirm_width,message:a.recurring.edit_message,callback:function(e){1==e?(t.event_pid&&d.setCursor(t.event_pid),d._editEventBase.call(d)):2==e&&d._applyRecExeption("edit")},labelSeries:a.recurring.edit_series,labelEvent:a.recurring.edit_occurrence,labelCancel:a.icon_cancel}):d._editEventBase.call(this)},d._deleteEventBase=d._deleteEvent,d._deleteEvent=function(){var e=this.getItem(this.getCursor());(e.rec_type||e.event_pid)&&n.recurring_dialogs?webix.rec_dialog({height:i.confirm_height,width:i.confirm_width,message:a.recurring.delete_message,callback:function(e){1==e?(d.remove(d.getCursor()),d.setDate(),d.$$("views").back(1)):2==e&&d._applyRecExeption("remove")},labelSeries:a.recurring.delete_series,labelEvent:a.recurring.delete_occurrence,labelCancel:a.icon_cancel}):d._deleteEventBase.call(this)},d._applyRecExeption=function(e){var t,a;if("edit"==e)if((t=webix.copy(this.getItem(this.getCursor()))).rec_type){if(this.define("editEvent",!1),this.$$("rec_type")&&!this.$$("rec_type").config.hidden&&(this._recTypeState="hide"),this.$$("form").show(),this.$$("editForm").clear(),t.event_pid=t.id,!(a=this._last_selected)&&!a[1])return d._editEventBase.call(this);t.start_date=new Date(1e3*a[1]),t.end_date=new Date(1e3*a[1]+1e3*t.event_length),delete t.id,t.rec_type=t.rec_pattern="",t.end_date=new Date(t.start_date.valueOf()+1e3*t.event_length),this.$$("editForm").setValues(t),this._setDefaultDates()}else d._editEventBase.call(this);else if("remove"==e){if((t=webix.copy(this.getItem(this.getCursor()))).event_pid=t.id,!(a=this._last_selected)||!a[1])return;t.start_date=new Date(1e3*a[1]),t.end_date=new Date(1e3*a[1]+1e3*t.event_length),t.id=webix.uid(),t.rec_type=t.rec_pattern="none",t.end_date=new Date(t.start_date.valueOf()+1e3*t.event_length),t.event_length=t.start_date.valueOf()/1e3,this._add_rec_marker(t,t.start_date.valueOf()),this.add(t),this.setDate(),this.$$("views").back()}},d._rec_markers={},d._rec_markers_pull={},d._add_rec_marker=function(e,t){e._pid_time=t,this._rec_markers[e.id]=e,this._rec_markers_pull[e.event_pid]||(this._rec_markers_pull[e.event_pid]={}),this._rec_markers_pull[e.event_pid][t]=e},d._get_rec_marker=function(e,t){var a=this._rec_markers_pull[t];return a?a[e]:null},d._get_rec_markers=function(e){return this._rec_markers_pull[e]||[]},d.data.scheme({$init:function(e){"string"==typeof e.start_date&&(e.start_date=webix.i18n.fullDateFormatDate(e.start_date)),"string"==typeof e.end_date&&(e.end_date=webix.i18n.fullDateFormatDate(e.end_date)),e.event_pid&&d._add_rec_marker(e,1e3*e.event_length)},$serialize:function(e){var t={};return t.start_date=webix.i18n.fullDateFormatStr(webix.Date.copy(e.start_date)),t.end_date=webix.i18n.fullDateFormatStr(webix.Date.copy(e.end_date)),webix.extend(t,e),t}}),d.transponse_size={day:1,week:7,month:1,year:12},d.day_week=function(e,t,a){e.setDate(1);var i=(7==t?0:1*t)+(a=7*(a-1))-e.getDay()+1;e.setDate(i<=a?7+i:i)},
d.transpose_day_week=function(e,t,a,i,n){for(var r=(e.getDay()||(webix.Date.startOnMonday?7:0))-a,l=0;l<t.length;l++)if(t[l]>r)return e.setDate(e.getDate()+1*t[l]-r-(i?a:n));d.transpose_day_week(e,t,a+i,null,a)},d.transpose_type=function(e){var t="transpose_"+e;if(!webix.Date[t]){var i=e.split("_"),n=d.transponse_size[i[0]]*i[1];if("day"==i[0]||"week"==i[0]){var r=null;if(i[4]&&(r=i[4].split(","),webix.Date.startOnMonday)){for(var a=0;a<r.length;a++)r[a]=1*r[a]||7;r.sort()}webix.Date[t]=function(e,t){var a=Math.floor((t.valueOf()-e.valueOf())/(864e5*n));0<a&&e.setDate(e.getDate()+a*n),r&&d.transpose_day_week(e,r,1,n)},webix.Date.add[e]=function(e,t){if(r)for(var a=0;a<t;a++)d.transpose_day_week(e,r,0,n);else e.setDate(e.getDate()+t*n);return e}}else"month"!=i[0]&&"year"!=i[0]||(webix.Date[t]=function(e,t){var a=Math.ceil((12*t.getFullYear()+1*t.getMonth()-(12*e.getFullYear()+1*e.getMonth()))/n);0<=a&&e.setMonth(e.getMonth()+a*n),i[3]&&d.day_week(e,i[2],i[3])},webix.Date.add[e]=function(e,t){return e.setMonth(e.getMonth()+t*n),i[3]&&d.day_week(e,i[2],i[3]),e})}},d.data.attachEvent("onStoreUpdated",function(e,t,a){if("delete"==a||"update"==a||"insert"==a&&!t.rec_type&&t.event_pid){this.blockEvent();var i=d._get_rec_markers(e);for(var n in d._rec_markers_pull[e]=null,i)i.hasOwnProperty(n)&&(e=i[n].id,this.getItem(e)&&this.remove(e));this.unblockEvent()}}),d.repeat_date=function(e,t,a,i){if("none"!=e.rec_type){var n=new Date(e.start_date.valueOf());for(e.rec_pattern=e.rec_type.split("#")[0],d.transpose_type(e.rec_pattern),webix.Date["transpose_"+e.rec_pattern](n,a);n<e.start_date||n.valueOf()+1e3*e.event_length<=a.valueOf();)n=webix.Date.add(n,1,e.rec_pattern,!0);for(;n<i&&n<e.end_date;){if(!this._get_rec_marker(n.valueOf(),e.id)){var r=new Date(n.valueOf()+1e3*e.event_length),l=webix.copy(e);l.text=e.text,l.start_date=n,l.event_pid=e.id,l.id=e.id+"#"+Math.ceil(n.valueOf()/1e3),l.end_date=r;var s=l.start_date.getTimezoneOffset()-l.end_date.getTimezoneOffset();s&&(l.end_date=0<s?new Date(n.valueOf()+1e3*e.event_length-60*s*1e3):new Date(l.end_date.valueOf()+60*s*1e3)),t.push(l)}n=webix.Date.add(n,1,e.rec_pattern,!0)}}}}),webix.attachEvent("onBeforeSchedulerInit",function(){if(!n.recurring)return!0;n.form||(n.form=[{view:"text",label:a.label_event,name:"text",labelWidth:90},{view:"datetext",label:a.label_start,id:"start_date",name:"start_date",dateFormat:n.form_date,labelWidth:90},{view:"datetext",label:a.label_end,id:"end_date",name:"end_date",dateFormat:n.form_date,labelWidth:90},{view:"checkbox",id:"allDay",name:"allDay",label:a.label_allday,value:0,labelWidth:100},{view:"rectext",label:a.recurring.repeat,id:"rec_type",name:"rec_type",readonly:!0,labelWidth:90},{view:"textarea",label:a.label_details,id:"details",name:"details",height:110,labelWidth:90},{view:"text",hidden:!0,id:"event_length",name:"event_length"}]),n.recurring_bar||(n.recurring_bar=[{view:"label",width:i.icon_cancel,id:"recCancel",name:"recCancel",css:"cancel",align:"center",label:a.icon_cancel,batch:"default"},{view:"label",width:i.icon_cancel,id:"recEndCancel",name:"recEndCancel",css:"cancel",align:"center",label:a.icon_cancel,batch:"endRepeat"},{},{view:"altbutton",width:i.icon_done,id:"recDone",name:"recDone",align:"right",label:a.icon_done,batch:"default"},{view:"altbutton",width:i.icon_done,id:"recDone2",name:"recDone2",align:"right",label:a.icon_done,batch:"other"},{view:"altbutton",width:i.icon_done,id:"recEndDone",name:"recEndDone",align:"right",label:a.icon_done,batch:"endRepeat"}]),n.recurring_views_list||(n.recurring_views_list=[{id:"none",value:a.recurring.none,readonly:!0},{id:"daily",value:a.recurring.daily},{id:"weekly",value:a.recurring.weekly},{id:"monthly",value:a.recurring.monthly},{id:"yearly",value:a.recurring.yearly}]),scheduler.templates.rec_list_item||(scheduler.templates.rec_list_item=function(e){return e.value+(e.readonly?"":"<div class='webix_arrow_icon'></div>")}),n.rec_init_form||(n.rec_init_form=[{height:10},{view:"reclist",id:"recList",type:{height:42},autoheight:!0,scroll:!1,select:!0,css:"rec_list",value:"none",
template:scheduler.templates.rec_list_item,datatype:"json",data:n.recurring_views_list,labelWidth:100},{maxHeight:42},{view:"endrec",id:"endRepeat",name:"endRepeat",labelWidth:i.recurring.label_end_repeat,label:a.recurring.end_repeat},{}]),n.end_repeat_form||(n.end_repeat_form=[{type:"clean",paddingX:10,paddingY:5,cols:[{view:"radio",css:"webix_endby_radio",vertical:!0,id:"endBy",width:290,labelWidth:i.recurring.label_end_by,height:80,options:[{value:a.recurring.endless_repeat,id:"0"},{value:a.recurring.end_repeat_label,id:"1"}]},{}]},{view:"calendar",id:"endByDate",width:0,css:"end_rep_calendar",icons:!1},{}]),n.daily_form||(n.daily_form=[{type:"clean",css:"webix_rec_counter",cols:[{view:"label",label:a.recurring.every,width:i.recurring.label_every},{view:"counter",id:"dayCount",name:"dayCount",value:1,width:125},{view:"label",label:a.recurring.day}]},{}]),l.selected_event_base=l.selected_event,l.selected_event=function(e,t){if(e.rec_type){var a=t.getTopParentView()._last_selected;if(!a||!a[1])return l.selected_event_base(e);var i=e.start_date,n=e.end_date;e.start_date=new Date(1e3*a[1]),e.end_date=new Date(1e3*a[1]+1e3*e.event_length);var r=l.selected_event_base(e);return e.start_date=i,e.end_date=n,r}return l.selected_event_base(e)},n.weekly_form||(n.weekly_form=[{height:10},{type:"clean",css:"webix_rec_counter",paddingX:8,height:42,cols:[{view:"label",borderless:!0,label:a.recurring.every,width:i.recurring.label_every},{view:"counter",id:"weekCount",name:"weekCount",value:1,width:125},{view:"label",label:a.recurring.week}]},{view:"weeklist",id:"weekDays",name:"weekDays"},{}]);for(var e={},t=1;t<32;t++)e[t]=t;scheduler.templates.rec_month_d||(scheduler.templates.rec_month_d=function(){return"<div class='radio'><div class='on'></div></div><div class='text'>"+a.recurring.month_day+"</div>"}),scheduler.templates.rec_month_w||(scheduler.templates.rec_month_w=function(){return"<div class='radio'><div class='on'></div></div><div class='text'>"+a.recurring.week_day+"</div>"}),scheduler.templates.rec_month_d_blured||(scheduler.templates.rec_month_d_blured=function(){return"<div class='radio blured'></div><div class='text'>"+a.recurring.month_day+"</div>"}),scheduler.templates.rec_month_w_blured||(scheduler.templates.rec_month_w_blured=function(){return"<div class='radio blured'></div><div class='text'>"+a.recurring.week_day+"</div>"}),n.week_day_counters||(n.week_day_counters=[{id:1,value:a.recurring.counters[0]},{id:2,value:a.recurring.counters[1]},{id:3,value:a.recurring.counters[2]},{id:4,value:a.recurring.counters[3]},{id:5,value:a.recurring.counters[4]}]),n.week_day_labels||(n.week_day_labels=[{id:1,value:webix.i18n.calendar.dayFull[1]},{id:2,value:webix.i18n.calendar.dayFull[2]},{id:3,value:webix.i18n.calendar.dayFull[3]},{id:4,value:webix.i18n.calendar.dayFull[4]},{id:5,value:webix.i18n.calendar.dayFull[5]},{id:6,value:webix.i18n.calendar.dayFull[6]},{id:7,value:webix.i18n.calendar.dayFull[0]}]),n.monthly_form||(n.monthly_form=[{type:"clean",paddingX:10,height:42,cols:[{view:"label",label:a.recurring.every,width:i.recurring.label_every},{view:"counter",id:"monthCount",name:"monthCount",value:1,width:125},{view:"label",label:a.recurring.month},{view:"text",hidden:!0,name:"monthType",value:"Day",width:1}]},{view:"accordion",id:"monthTypeSelect",rows:[{headerAltHeight:50,headerHeight:50,id:"typeDayM",header:scheduler.templates.rec_month_d,headerAlt:scheduler.templates.rec_month_d_blured,body:{view:"datecells",id:"monthDayM",name:"monthDayM",data:e}},{headerAltHeight:50,headerHeight:50,id:"typeWeekM",header:scheduler.templates.rec_month_w,headerAlt:scheduler.templates.rec_month_w_blured,collapsed:!0,body:{type:"clean",rows:[{height:10},{type:"clean",paddingX:10,cols:[{view:"select",value:1,id:"weekCountM",name:"weekCountM",css:"",options:n.week_day_counters},{view:"select",value:1,id:"weekDayM",name:"weekDayM",css:"",options:n.week_day_labels}]},{}]}}]}]),n.year_months||(n.year_months=scheduler.locale.date?scheduler.locale.date.month_short:webix.i18n.calendar.monthShort),n.yearly_form||(n.yearly_form=[{type:"clean",cols:[{
view:"label",label:a.recurring.every,width:i.recurring.label_every},{view:"counter",id:"yearCount",name:"yearCount",value:1,width:125},{view:"label",label:a.recurring.year}]},{view:"datecells",id:"monthDayY",borderless:!0,data:n.year_months,x_count:4,height:130},{view:"checkbox",label:a.recurring.week_day,id:"typeWeekY",name:"typeWeekY",labelWidth:250,value:1},{id:"yearWeekRow",type:"clean",cols:[{view:"select",value:1,id:"weekCountY",name:"weekCountY",options:n.week_day_counters},{view:"select",value:1,id:"weekDayY",name:"weekDayY",options:n.week_day_labels}]},{}]),n.recurring_views||(n.recurring_views=[{id:"recForm",view:"form",css:"webix_rec_form",padding:0,scroll:!1,elements:n.rec_init_form},{id:"endRepeatForm",view:"form",type:"clean",elements:n.end_repeat_form},{id:"daily",view:"daily",elements:n.daily_form,elementsConfig:{height:42}},{id:"weekly",view:"weekly",type:"clean",elements:n.weekly_form},{id:"monthly",view:"monthly",elements:n.monthly_form,margin:10},{id:"yearly",view:"yearly",padding:10,margin:10,type:"clean",elements:n.yearly_form,elementsConfig:{height:42}}]),n.views.push({view:"recurring",id:"recurring"}),webix.protoUI({name:"recurring",defaults:{padding:0,rows:[{view:"toolbar",id:"reccuringBar",height:50,css:"webix_subbar",elements:n.recurring_bar,visibleBatch:"default"},{id:"recViews",animate:!1,cells:n.recurring_views}],typeToId:{day:"daily",week:"weekly",month:"monthly",year:"yearly"},endlessDate:n.endless_date},$init:function(){this.name="Recurring",this.$view.className+=" webix_recurring",this.$ready.push(this._setEvents)},_setEvents:function(){var e={};for(var t in this.config.typeToId)e[this.config.typeToId[t]]=t;this.define("idToType",e),webix.delay(function(){var a=this.getTopParentView();a.$$("rec_type").attachEvent("onItemClick",this._showRecViewsList),a.$$("reccuringBar").attachEvent("onItemClick",webix.bind(function(e){switch(e=this.innerId(e)){case"recDone2":case"recEndCancel":this.$$("recViews").back(),this.$$("reccuringBar").showBatch("default");break;case"recCancel":this.$$("views").back();break;case"recDone":this.$$("recurring")._applyRecurrence(),this.$$("views").back();break;case"recEndDone":var t;t="1"==this.$$("endBy").getValue()?this.$$("endByDate").getValue():this.$$("recurring").config.endlessDate,this.$$("endRepeat").setValue(t),this.$$("recViews").back(),this.$$("reccuringBar").showBatch("default")}},a)),a.$$("recList").attachEvent("onItemClick",webix.bind(this._showRecView,a)),a.$$("endRepeat").attachEvent("onItemClick",webix.bind(function(){this._showRecView.call(a,"endRepeatForm"),a.$$("reccuringBar").showBatch("endRepeat"),this._setEndDate()},this)),a.$$("typeWeekY")&&a.$$("typeWeekY").attachEvent("onItemClick",function(){this.getValue()?a.$$("yearWeekRow").show():a.$$("yearWeekRow").hide()}),a.$$("endBy")&&a.$$("endBy").attachEvent("onItemClick",function(){"1"==this.getValue()?a.$$("endByDate").show():a.$$("endByDate").hide()}),a.$$("editForm").attachEvent("onItemClick",webix.bind(function(e){"end_date"==(e=this.innerId(e))&&this._showDateForm(e)},a)),a.$$("weekly").elements.weekDays=a.$$("weekDays"),a.$$("monthly").elements.monthDayM=a.$$("monthDayM"),a.$$("yearly").elements.monthDayY=a.$$("monthDayY"),a.$$("editForm").elements.endRepeat=a.$$("endRepeat"),a.$$("views").attachEvent("onViewChange",function(e,t){a._recTypeState&&a.$$("form").config.id==t&&("hide"==a._recTypeState?(a.$$("rec_type").hide(),a._recTypeState="show"):"show"==a._recTypeState&&a.$$("rec_type").show())})},this)},_showRecViewsList:function(){var e=this.getTopParentView();e.$$("recurring").show(),e.$$("recForm")&&(e.$$("recForm").show(),e.$$("recurring").setValue(),e.$$("endRepeat").setValue(e.$$("endRepeat").config.value))},_showRecView:function(e){this.$$(e)&&(this.$$(e).show(),this.$$("reccuringBar").showBatch("other")),this.$$("endRepeat").getValue()||this.$$("endRepeat").setValue(this.$$("recurring").config.endlessDate)},setValue:function(){var e,t=this.getTopParentView(),a=(t.$$("rec_type").getValue()||"_____").split("_"),i=t.$$("recurring").config;t.$$("recList").setValue(
a[0]&&""!==a[0]?i.typeToId[a[0]]:"none");var n=t.$$("start_date").getValue();for(var r in i.typeToId)e=r==a[0]?(a.push(n),webix.copy(a)):[r,1,"","","",n],t.$$(i.typeToId[r]).setValue(e)},getValue:function(){var e=this.getTopParentView(),t=e.$$("recList").getSelectedId();return"none"==t?["","","","","",""]:e.$$(t).getValue()},_applyRecurrence:function(){var e=this.getTopParentView(),t=this.getValue(),a=e.$$("start_date").getValue(),i=e.$$("end_date").getValue().valueOf()-a.valueOf();if(e.$$("event_length").setValue(i/1e3),!t[0])return e.$$("endRepeat").setValue(e.$$("end_date").getValue()),e.$$("rec_type").setValue(""),void e.$$("event_length").setValue("");"week"==t[0]?a=webix.Date.add(a,-1*(a.getDay()+6)%7,"day",!0):"month"==t[0]?t[5]&&a.setDate(t[5]):"year"==t[0]&&t[5]&&a.setMonth(t[5]),e.$$("start_date").setValue(a),e.$$("end_date").setValue(new Date(a.valueOf()+i)),t.pop();var n="";"0"==e.$$("endBy").getValue()&&(n="no"),e.$$("rec_type").setValue(t.join("_")+"#"+n)},_setEndDate:function(){var e=this.getTopParentView(),t=e.$$("editForm").getValues().end_date;t.valueOf()==this.config.endlessDate.valueOf()?(e.$$("endBy").setValue("0"),e.$$("endByDate").setValue(scheduler.config.end_by||webix.Date.add(e.$$("end_date").getValue(),1,"year",!0),!0)):(e.$$("endBy").setValue("1"),e.$$("endByDate").define("minDate",t),e.$$("endByDate").setValue(t)),this._setEndByVisibility()},_setEndByVisibility:function(){var e=this.getTopParentView();"1"==e.$$("endBy").getValue()?e.$$("endByDate").show():e.$$("endByDate").hide()}},webix.DataLoader,webix.ui.form,webix.EventSystem,webix.Settings)})});
//# sourceMappingURL=scheduler.js.map
