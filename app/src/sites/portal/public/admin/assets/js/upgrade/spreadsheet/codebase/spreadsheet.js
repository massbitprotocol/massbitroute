/**
 * @license
 * Webix SpreadSheet v.8.0.5
 * This software is covered by Webix Trial License.
 * Usage without proper license is prohibited.
 * (c) XB Software Ltd.
 */

!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t():"function"==typeof define&&define.amd?define(t):t()}(0,function(){"use strict";function l(e){var t=new Date(e.getFullYear(),0,0),n=e-t+60*(t.getTimezoneOffset()-e.getTimezoneOffset())*1e3;return Math.floor(n/864e5)}function w(e){var t=new Date(Math.round(86400*(e-25569)*1e3));return new Date(t.getTime()+6e4*t.getTimezoneOffset())}function o(e){return(25569+(e.getTime()-6e4*e.getTimezoneOffset())/864e5).toString()}function s(e){return!(!e&&0!==e||(e*=1,isNaN(e)))&&e}function a(e){for(var t=[],n=0;n<e.length;n++)t=t.concat(e[n]);return t}function t(e){return!e&&0!==e||e instanceof Date||isNaN(e)||(e=w(e)),e}function n(e){return e&&e instanceof Date&&(e=o(e)),e}function p(e){return(p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function c(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}function u(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function d(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&f(e,t)}function h(e){return(h=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function f(e,t){return(f=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function v(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?function n(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function k(e,t){return function n(e){if(Array.isArray(e))return e}(e)||function c(e,t){var n=[],i=!0,o=!1,r=undefined;try{for(var a,l=e[Symbol.iterator]();!(i=(a=l.next()).done)&&(n.push(a.value),!t||n.length!==t);i=!0);}catch(s){o=!0,r=s}finally{try{i||null==l["return"]||l["return"]()}finally{if(o)throw r}}return n}(e,t)||function i(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function E(e){return function i(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function t(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function n(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}webix.i18n.spreadsheet={labels:{common:"Common",currency:"Currency",number:"Number",percent:"Percent",date:"Date",string:"Text","custom-format":"Custom","decimal-places":"Decimal places",separator:"Group separator",negative:"Negative number","date-format":"Date format","format-docs":"How to create a format","undo-redo":"Undo/Redo",font:"Font",text:"Text",cell:"Cell",align:"Align",format:"Number",column:"Column",borders:"Borders",px:"px",apply:"Apply",cancel:"Cancel",save:"Save",sheet:"Sheet","conditional-format":"Conditional Format",condition:"Condition","conditional-style":"Style","conditional-operator":"Operator","conditional-between":"between","conditional-not-equal":"not equal",range:"Range","range-title":"Named ranges","range-name":"Name","range-cells":"Range","image-or":"or","image-title":"Add image","image-upload":"Select file for upload","image-url":"URL (e.g. http://*)","sparkline-title":"Add sparkline","sparkline-type":"Type","sparkline-range":"Range","sparkline-color":"Color","sparkline-positive":"Positive","sparkline-negative":"Negative","format-title":"Set format","format-pattern":"Format pattern","dropdown-empty":"Empty cells","dropdown-title":"Add dropdown","dropdown-range":"Range",ok:"OK","import-title":"Import",
"import-not-support":"Sorry, your browser does not support import","export-title":"Export","export-name":"Name of xslx file","export-all-sheets":"Export all sheets","link-title":"Add Link","link-name":"Text","link-url":"URL",image:"Image","add-image-cell":"Add to cell","add-image-top":"Add above cells",graph:"Graph","add-sparkline":"Add to cell","add-chart":"Add above cells",display:"Display",value:"Value","range-remove-confirm":"Are you sure you want to remove the range permanently?","sheet-remove-confirm":"Are you sure you want to remove the sheet permanently?","merge-cell-confirm":"Only the left top value will remain after merging. Continue?","error-range":"The range is incorrect!",print:"Print","print-title":"Before you print..","print-settings":"General settings","print-paper":"Paper size","print-layout":"Layout","current-sheet":"Current sheet","all-sheets":"All sheets",selection:"Selected cells",borderless:"Hide gridlines","sheet-names":"Show sheet names","skip-rows":"Skip empty rows",margin:"Hide margins","page-letter":"Letter","page-a4":"A4 (210x297mm)","page-a3":"A3 (297x420mm)","page-width":"Page width","page-actual":"Actual Size","page-portrait":"Portrait","page-landscape":"Landscape",comment:"Comment",width:"Width",height:"Height","fit-content":"Fit to content","default-size":"Reset to default","edit-view":"Edit","remove-view":"Remove","chart-edit":"Edit chart","chart-common":"Common","chart-series":"Series","chart-extras":"Extras","export-view":"Download","export-view-pdf":"PDF document","export-view-png":"PNG image","export-view-excel":"Excel file","line-chart":"Line","area-chart":"Area","bar-chart":"Bar","donut-chart":"Donut","pie-chart":"Pie","radar-chart":"Radar","spline-chart":"Spline","splinearea-chart":"Spline Area","chart-axis":"Axis","chart-scale":"Lines","chart-scale-color":"Scale color","chart-xAxis-title":"X axis title","chart-yAxis-title":"Y axis title","chart-col-xAxis":"Use left column as xAxis","chart-row-xAxis":"Use top row as xAxis","chart-xAxis-range":"xAxis range","chart-legend":"Legend","chart-row-legend":"Use top row as legend","chart-col-legend":"Use left column as legend","chart-legend-range":"Legend range","chart-legend-align":"Align","chart-legend-left":"Left","chart-legend-right":"Right","chart-legend-center":"Center","chart-legend-valign":"Vertical align","chart-legend-top":"Top","chart-legend-middle":"Middle","chart-legend-bottom":"Bottom","chart-item":"Data","stacked-chart":"Stacked","chart-range":"Range","chart-series-color":"Color","add-line":"Add line","chart-type":"Type","chart-tooltip":"Tooltips","chart-data-from":"Data series from","chart-columns":"columns","chart-rows":"rows","chart-markers":"Markers","chart-markers-square":"Square","chart-markers-triangle":"Triangle","chart-markers-diamond":"Diamond","chart-markers-round":"Round","chart-pie-text":"Show values inside","chart-pie-3d":"3D","chart-radar-circle":"Circled lines"},tooltips:{color:"Font color",background:"Background color","font-family":"Font family","font-size":"Font size","text-align":"Horizontal align","vertical-align":"Vertical align",borders:"Borders","borders-no":"Clear borders","borders-left":"Left border","borders-top":"Top border","borders-right":"Right border","borders-bottom":"Bottom border","borders-all":"All borders","borders-outer":"Outer borders","borders-top-bottom":"Top and bottom borders","borders-color":"Border color","align-left":"Left align","align-center":"Center align","align-right":"Right align","align-top":"Top align","align-middle":"Middle align","align-bottom":"Bottom align",span:"Merge",wrap:"Text wrap",undo:"Undo",redo:"Redo",format:"Number format","increase-decimals":"Increase decimal places","decrease-decimals":"Decrease decimal places","font-weight":"Bold","font-style":"Italic","text-decoration":"Underline","hide-gridlines":"Hide/show gridlines","hide-headers":"Hide/show headers","create-filter":"Create/remove filters","freeze-columns":"Freeze/unfreeze columns","add-range":"Set name for the selected range",conditional:"Conditional formatting","add-sheet":"Add Sheet",
"lock-cell":"Lock/unlock cell",clear:"Clear","add-link":"Add link",row:"Rows",column:"Columns",sheet:"Sheet","add-image":"Image","add-sparkline":"Graph","add-comment":"Comment"},menus:{"remove-sheet":"Remove sheet","rename-sheet":"Rename sheet",file:"File","new":"New","new-sheet":"New sheet","excel-import":"Import from Excel","excel-export":"Export to Excel",sheet:"Sheets","copy-sheet":"Copy to new sheet",edit:"Edit",undo:"Undo",redo:"Redo",columns:"Columns","insert-column":"Insert column","delete-column":"Delete column","show-column":"Show column","hide-column":"Hide column","resize-column":"Resize column",rows:"Rows","insert-row":"Insert row","delete-row":"Delete row","show-row":"Show row","hide-row":"Hide row","resize-row":"Resize row",insert:"Insert","conditional-format":"Conditional format",clear:"Clear","clear-value":"Values","clear-style":"Styles","clear-conditional-formats":"Conditional formats","clear-dropdown-editors":"Dropdowns and filters","clear-comments":"Comments","clear-all":"All",image:"Image","add-image-cell":"Add to cell","add-image-top":"Add above cells",graph:"Graph","add-sparkline":"Add to cell","add-chart":"Add above cells",data:"Data","add-link":"Add link","add-range":"Named ranges",sort:"Sort","sort-asc":"Sort A to Z","sort-desc":"Sort Z to A",view:"View","freeze-columns":"Freeze/unfreeze columns","freeze-rows":"Freeze/unfreeze rows","hide-gridlines":"Hide/show gridlines","hide-headers":"Hide/show headers","create-filter":"Create/remove filters","add-dropdown":"Add dropdown","lock-cell":"Lock/unlock cell",print:"Print","add-comment":"Comment"},table:{"math-error":"ERROR","format-error":"INCORRECT FORMAT"},liveEditor:{edit:"Edit:"},formats:{dateFormat:"mm/dd/yyyy",timeFormat:"hh:mm AM/PM",longDateFormat:"dd mmmm yyyy",fullDateFormat:"mm/dd/yyyy hh:mm AM/PM",parseDateTime:"%m/%d/%Y %G:%i:%s",parseDate:"%m/%d/%Y"}},webix.protoUI({name:"ssheet-align",$cssName:"richselect",$init:function(e){e.options={view:"datasuggest",body:{view:"ssheet-icons",tooltip:{template:"#tooltip#"},xCount:3,yCount:1},data:e.data}}},webix.ui.richselect),webix.protoUI({name:"ssheet-borders-suggest",defaults:{width:300},$init:function(e){e.body={margin:6,cols:[{view:"ssheet-icons",scroll:!1,select:!0,xCount:4,yCount:2,tooltip:{template:function(e){return webix.i18n.spreadsheet.tooltips["borders-"+e.id]}},on:{onAfterSelect:function(){this.getParentView().getParentView().updateMasterValue(!0)}},template:function(e){return"<span class='"+("webix_ssheet_button_icon webix_ssheet_icon ssi-borders-"+e.value)+"'></span>"},data:e.data},{view:"ssheet-separator"},{rows:[{view:"ssheet-color",css:e.css,name:e.name,width:68,value:"contrast"==webix.skin.$name?"#ffffff":"#000000",tooltip:webix.i18n.spreadsheet.tooltips["borders-color"],title:"<span class='webix_icon wxi-pencil'></span>",on:{onChange:function(){this.getParentView().getParentView().getParentView().updateMasterValue(!1)}}},{view:"richselect",css:"webix_ssheet_border_type",value:"thin",suggest:{fitMaster:!1,width:130,css:"webix_ssheet_suggest",body:{template:"<div class='webix_ssheet_border webix_ssheet_border_#id#'></div>"},data:[{id:"thin"},{id:"medium"},{id:"thick"},{id:"dashed"},{id:"dotted"},{id:"double"}]}},{}]}]}},updateMasterValue:function(e){var t=this.getValue();webix.$$(this.config.master).setValue(t),e&&this.hide()},setValue:function(e){e[0]&&this.getList().select(e[0]),e[1]&&this.getColorView().setValue(e[1]),e[2]&&this.getTypeView().setValue(e[2])},getValue:function(){return[this.getList().getSelectedId(),this.getColorView().getValue()||"",this.getTypeView().getValue()||""]},getList:function(){return this.getBody().getChildViews()[0]},getColorView:function(){return this.getBody().getChildViews()[2].getChildViews()[0]},getTypeView:function(){return this.getBody().getChildViews()[2].getChildViews()[1]},getItemText:function(){return"<span class='webix_ssheet_button_icon webix_ssheet_icon ssi-borders-all'>"}},webix.ui.suggest),webix.protoUI({name:"ssheet-borders",$cssName:"richselect",$init:function(e){e.options={view:"ssheet-borders-suggest",fitMaster:!1,data:e.data},
this.$ready.push(webix.bind(function(){this.getPopup().config.master=this.config.id},this))},setValue:function(e){return webix.isArray(e)&&(this.config.value&&e[0]==this.config.value[0]&&e[1]==this.config.value[1]||this.getPopup().setValue(e),(this.config.value=e)[0]&&this.callEvent("onChange")),e},getValue:function(){return this.getPopup().getValue().join(",")},getList:function(){return this.getPopup().getBody().getChildViews()[0]},getColorView:function(){return this.getPopup().getBody().getChildViews()[1].getChildViews()[0]}},webix.ui.richselect),webix.protoUI({$cssName:"colorboard",name:"ssheet-colorboard",defaults:{height:202,width:220,css:"webix_ssheet_colorboard",type:"classic",palette:[["#000000","#434343","#666666","#999999","#b7b7b7","#cccccc","#d9d9d9","#efefef","#f3f3f3","#ffffff"],["#980000","#ff0000","#ff9900","#ffff00","#00ff00","#00ffff","#4a86e8","#0000ff","#9900ff","#ff00ff"],["#e6b8af","#f4cccc","#fce5cd","#fff2cc","#d9ead3","#d0e0e3","#c9daf8","#cfe2f3","#d9d2e9","#ead1dc"],["#dd7e6b","#ea9999","#f9cb9c","#ffe599","#b6d7a8","#a2c4c9","#a4c2f4","#9fc5e8","#b4a7d6","#d5a6bd"],["#cc4125","#e06666","#f6b26b","#ffd966","#93c47d","#76a5af","#6d9eeb","#6fa8dc","#8e7cc3","#c27ba0"],["#a61c00","#cc0000","#e69138","#f1c232","#6aa84f","#45818e","#3c78d8","#3d85c6","#674ea7","#a64d79"],["#85200c","#990000","#b45f06","#bf9000","#38761d","#134f5c","#1155cc","#0b5394","#351c75","#741b47"],["#5b0f00","#660000","#783f04","#7f6000","#274e13","#0c343d","#1c4587","#073763","#20124d","#4c1130"]]},$init:function(){this.attachEvent("onSelect",function(e){this.getParentView().setMasterValue({value:e})})}},webix.ui.colorboard),webix.protoUI({$cssName:"richselect",name:"ssheet-color",defaults:{css:"webix_ssheet_color",icon:"wxi-menu-down",suggest:{borderless:!0,body:{view:"ssheet-colorboard"}}},$init:function(){this.$view.className+=" webix_ssheet_color"},$renderInput:function(o,e,t){var r=this.renderColor.call(this);return e=e.replace(/([^>]>)(.*)(<\/div)/,function(e,t,n,i){return t+o.title+r+i}),webix.ui.colorpicker.prototype.$renderInput.call(this,o,e,t)},$setValue:function(e){e=e||"",webix.$$(this.config.popup.toString()).getBody().setValue(e),this.config.value=e,this.getColorNode().style.backgroundColor=e},renderColor:function(){return"<div class='webix_ssheet_cp_color' style='background-color:"+this.config.value+";'> </div>"},getColorNode:function(){return this.$view.firstChild.firstChild.childNodes[1]},$renderIcon:function(){return webix.ui.text.prototype.$renderIcon.apply(this,arguments)}},webix.ui.colorpicker),webix.protoUI({$cssName:"datepicker",name:"ssheet-datepicker",getValue:function(){return n(webix.ui.datepicker.prototype.getValue.apply(this))||""},$prepareValue:function(e){return e=t(e),webix.ui.datepicker.prototype.$prepareValue.apply(this,[e])}},webix.ui.datepicker),webix.protoUI({$cssName:"daterangepicker",name:"ssheet-daterangepicker",getValue:function(){var e=webix.ui.datepicker.prototype.getValue.apply(this);return e&&((e=webix.copy(e)).start=n(e.start),e.end=n(e.end)),e||""},$prepareValue:function(e){return e?e.start||e.end||(e={start:e}):e={start:null,end:null},e.start=t(e.start),e.end=t(e.end),webix.ui.daterangepicker.prototype.$prepareValue.apply(this,[e])}},webix.ui.daterangepicker),webix.protoUI({$cssName:"window",name:"ssheet-dialog",$init:function(e){this.$view.className+=" webix_ssheet_dialog",this.config.buttons=e.buttons,this.config.close=!0},getBodyConfig:function(e){e.borderless=!0;var t=this.getFormElements(e);return{view:"form",css:"webix_ssheet_form",padding:webix.skin.$active.layoutPadding.form,elements:t}},getFormElements:function(e){var t;return webix.isArray(e)?t=e:(t=[]).push(e),this.config.buttons&&(t.push({height:1}),t.push({margin:10,cols:[{},{view:"button",css:"ssheet_cancel_button",label:webix.i18n.spreadsheet.labels.cancel,autowidth:!0,click:function(){this.getTopParentView().callEvent("onCancelClick",[])}},{view:"button",label:webix.i18n.spreadsheet.labels.save,hotkey:"enter",autowidth:!0,click:function(){this.getTopParentView().callEvent("onSaveClick",[])}}]})),t},
body_setter:function(e){return"object"==p(e)&&(webix.isUndefined(e.padding)&&(e.padding=webix.skin.$active.layoutPadding.form),"form"==e.view&&e.elements?(e.elements=this.getFormElements(e.elements),e.css||(e.css="webix_ssheet_form")):e=this.getBodyConfig(e)),webix.ui.window.prototype.body_setter.call(this,e)},defaults:{move:!0,head:"Dialog",buttons:!0,close:!0,autofocus:!1,width:350}},webix.ui.window,webix.IdSpace),webix.protoUI({$cssName:"datatable",name:"ssheet-dialog-table",$init:function(e){e.headerRowHeight||(e.headerRowHeight=34),this.$view.className+=" webix_ssheet_dialog_table"}},webix.ui.datatable),webix.protoUI({name:"ssheet-form-popup",defaults:{padding:0,borderless:!0},$init:function(){this.$view.className+=" webix_ssheet_form"}},webix.ui.suggest),webix.protoUI({name:"ssheet-form-suggest",defaults:{padding:0,borderless:!0},$init:function(){this.$view.className+=" webix_ssheet_suggest"}},webix.ui.suggest),webix.protoUI({$cssName:"colorpicker",name:"ssheet-colorpicker",$init:function(){this.$view.className+=" webix_ssheet_colorpicker"},defaults:{suggest:{borderless:!0,body:{view:"ssheet-colorboard"}}}},webix.ui.colorpicker),webix.protoUI({name:"formlate",setValue:function(e){return this.setHTML(e)},getValue:function(){return""}},webix.ui.template),webix.protoUI({name:"ssheet-icons",$cssName:"dataview",$init:function(){this.$view.className+=" webix_ssheet_dataview"},defaults:{borderless:!0,template:"<span class='webix_ssheet_button_icon #css#' ></span>",type:{width:36,height:36}}},webix.ui.dataview),webix.protoUI({name:"ssheet-suggest",defaults:{padding:0,css:"webix_ssheet_suggest"}},webix.ui.contextmenu),webix.protoUI({name:"suggest-formula",defaults:{fitMaster:!1,width:200,filter:function(e,t){var n=webix.$$(this.config.master),i=n.getInputNode().selectionStart,o=n.getValue();if("="===o.charAt(0)){var r=o.substring(0,i).match(/([a-zA-Z]+)$/),a=o.charAt(i).search(/[^A-Za-z0-9]/);return!r||i!==o.length&&0!==a||(t=r[0]),0===e.value.toString().toLowerCase().indexOf(t.toLowerCase())}}},$init:function(){var s=this;this.attachEvent("onBeforeShow",function(e){if(e.tagName){var t=webix.$$(s.config.master),n=t.getValue();if(!n||"="!==n.charAt(0))return!1;var i=webix.html.offset(e),o=t.getInputNode().selectionStart,r=webix.html.getTextSize(n.substring(0,o),"webix_ssheet_formula").width,a=i.y+i.height,l=i.x+r;return webix.ui.popup.prototype.show.apply(s,[{x:l,y:a}]),!1}})},setMasterValue:function(e,t){var n=e.id?this.getItemText(e.id):e.text||e.value;webix.$$(this.config.master).setValueHere(n),t||this.hide(!0),this.callEvent("onValueSuggest",[e,n])},$enterKey:function(){if(this.isVisible())return webix.ui.suggest.prototype.$enterKey.apply(this,arguments)}},webix.ui.suggest);var g={value:null,set:function(e,t){this.value?e.call(t):(this.start(),e.call(t),this.end())},start:function(){this.value=webix.uid()},end:function(){this.value=null}};function m(e,t,n){var i,o=e.config.save;if(o){if("all"==t){if(!o.all)return;n={data:e.serialize({sheets:!0})},i=o.all}else i="string"==typeof o?o+"/"+t:o[t];if(i=webix.proxy.$parse(i)){if("function"==typeof i)return i(t,n);if(i.$proxy&&i.save)return i.save(e,n,null,null);var r=webix.ajax();"all"===t&&r.headers({"Content-type":"application/json"}),r.post(i,n)}}}for(var b=Object.freeze({init:function Xr(o){for(var r,t=[{name:"onSheetAdd",type:"insert"},{name:"onSheetRemove",type:"remove"},{name:"onSheetRename",type:"rename"},{name:"onCellChange"},{name:"onStyleChange"},{name:"onAction"},{name:"onRowOperation"},{name:"onColumnOperation"},{name:"onAfterConditionSet"},{name:"onAfterRangeSet"},{name:"onAfterSpan"},{name:"onAfterSplit"},{name:"onAfterFilter",view:"cells"},{name:"onRowResize",view:"cells"},{name:"onColumnResize",view:"cells"}],e=function(e){var i=t[e];(i.view?o.$$(i.view):o).attachEvent(i.name,function(e,t){var n;o._loading_data||(n=i.type?"rename"==i.type?[i.type,t,e]:[i.type,e]:["update",o.getActiveSheet()],clearTimeout(r),r=webix.delay(function(){return o.callEvent("onChange",n)}))})},n=0;n<t.length;n++)e(n);o.attachEvent("onChange",function(){m(o,"all")})},save:m}),x={},
$={},e="ABCDEFGHIJKLMNOPQRSTUVWXYZ",_=1;_<1e3;_++){var y=parseInt((_-1)/e.length),C=(y?e[y-1]:"")+e[(_-1)%e.length];x[C]=_,$[_]=C}function S(e){var t=e.charCodeAt(1)<59?1:2,n=e.substr(0,t);return[1*e.substr(t),x[n]]}function V(e,t){var n=e.indexOf("!"),i="";-1!==n&&("'"===(i=e.substr(0,n))[0]&&(i=i.substr(1,i.length-2)),e=e.substr(n+1));var o=e.split(":");if(2!=o.length&&t){if(!(e=t.ranges.getCode(e,i)))return null;o=e.split(":")}var r=S(o[0]),a=S(o[1]);return[r[0],r[1],a[0],a[1],i]}$[0]=$[1];var A=/[^A-Za-z0-9]/;function z(e){return A.test(e)?"'".concat(e,"'"):e}function I(e,t,n,i,o){return(o?z(o)+"!":"")+$[t]+e+":"+$[i]+n}function R(e,t){if("object"===p(e))return e;var n=V(e,t);return{start:{row:n[0],column:n[1]},end:{row:n[2],column:n[3]},sheet:n[4]}}function D(e,t,n,i){for(var o=R(e),r=o.start.row;r<=o.end.row;r++)for(var a=o.start.column;a<=o.end.column;a++)n(t,{row:r,column:a},i)}var O=/(([A-Za-z0-9]+|'[^']+')!|)[A-Z]+[0-9]+:[A-Z]+[0-9]+/;function F(e){return O.test(e)}function M(e,t,n,i){var o=!1;if(F(e)){var r=k(V(e),5),a=r[0],l=r[1],s=r[2],c=r[3],u=r[4];if(s<a){var d=[s,a];a=d[0],s=d[1]}if(c<l){var h=[c,l];l=h[0],c=h[1]}if("row"===t&&i.row<=s){if((n<0&&i.row<a||0<n&&i.row<=a)&&(a+=n),(s+=n)<a)return"";o=!0}else if("column"===t&&i.column<=c){if((n<0&&i.column<l||0<n&&i.column<=l)&&(l+=n),(c+=n)<l)return"";o=!0}o&&(e=I(a,l,s,c,u))}return e}var U={width:38,margin:7,paddingY:1,sectorPadding:5,sectorMargin:0},N={color:"#666666",background:"#ffffff","font-family":"'PT Sans', Tahoma","font-size":"15px","text-align":"left","vertical-align":"middle","white-space":"nowrap",format:"common"};var T=["color","background","text-align","font-family","font-size","font-style","text-decoration","font-weight","vertical-align","wrap","borders","format","border-right","border-bottom","border-left","border-top"],j={"text-align":{left:function(){return"justify-content:flex-start;"},center:function(){return"justify-content:center;"},right:function(){return"justify-content:flex-end;"}},"vertical-align":{top:function(){return"align-items:flex-start;"},middle:function(){return"align-items:center;"},bottom:function(){return"align-items:flex-end;"}},wrap:{wrap:function(){return"white-space: normal !important;"}},"border-left":function(e){return B("border-left",e)},"border-top":function(e){return B("border-top",e)},"border-right":function(e){return B("border-right",e)},"border-bottom":function(e){return B("border-bottom",e)},"font-weight":function(e){return"bold"!=e["font-weight"]?"":"font-weight:"+("'Roboto', sans-serif"==(e["font-family"]||N["font-family"])?500:700)+";"}};function B(e,t){var n=t[e];if(n){var i=k(n.split(","),2),o=i[0],r=i[1],a="1px";return"medium"==(r=r||"thin")?a="2px":"thick"!=r&&"double"!=r||(a="3px"),-1!=["thin","medium","thick"].indexOf(r)&&(r="solid"),"".concat(e,": ").concat(a," ").concat(r," ").concat(o," !important;")}return""}var P,H={"border-left":function(e,t,n){return e.column==t.start.column||"no"==n},"border-right":function(e,t,n){return e.column==t.end.column||"all"==n||"no"==n},"border-top":function(e,t,n){return e.row==t.start.row||"no"==n},"border-bottom":function(e,t,n){return e.row==t.end.row||"all"==n||"no"==n}},L={borders:function(e,t,n,i){var o=e.$$("cells").getSelectArea(),r=(n=n.split(","))[0],a=n[1],l=n[2],s=["border-left","border-right","border-bottom","border-top"];"top-bottom"==r?s=["border-top","border-bottom"]:"no"!=r&&"all"!=r&&"outer"!=r&&(s=["border-"+r]);for(var c=0;c<s.length;c++){var u=s[c];if(!0===e.callEvent("onAction",["check-borders",{row:i.row,column:i.column,area:o,type:r,mode:u}])||H[u](i,o,r))t=G(e,t,u,"no"==r?"":"".concat(a,",").concat(l),i)}return t}};function W(e){e._styles={},e._styles_cache={},e._styles_max=1;var t=".wss_"+e.$index;webix.html.removeStyle(t)}function q(e,t){var n=e.getRow(t.row).$cellCss,i=e.$$("cells").getSpan(t.row,t.column);if(n||i){if(i)return e._styles[i[5]];var o=n[t.column];if(o)return e._styles[o]}return null}function K(e,t,n){var i={props:ie(";;;;;;;;;;;;;;;")};if(n)for(var o in n.props)i.props[o]=n.props[o];for(var r in t)i.props[r]=t[r];i.text=ne(
i);var a=e._styles_cache[i.text];return a||(te(e,i),i)}function Y(e,t){if(t.styles)for(var n=0;n<t.styles.length;n++){var i=t.styles[n];te(e,{id:i[0],text:i[1],props:ie(i[1])},!0)}for(var o=0;o<t.data.length;o++){var r=k(t.data[o],4),a=r[0],l=r[1],s=r[3];s&&Z(e,a,l,e._styles[s])}}function G(e,t,n,i,o){if(L[n])return L[n](e,t,i,o);if(t&&t.props[n]==i)return t;var r={text:"",id:0,props:t?webix.copy(t.props):{}};r.props[n]=i,r.text=ne(r);var a=e._styles_cache[r.text];return a||(te(e,r),r)}function Z(e,t,n,i){var o=e.getRow(t);o.$cellCss=o.$cellCss||{},o.$cellFormat=o.$cellFormat||{},i?(o.$cellCss[n]=i.id,o.$cellFormat[n]=i.props.format||null):(delete o.$cellCss[n],delete o.$cellFormat[n])}function X(e,t,n){return ee(e,t,n,q(e,t))}function Q(e,t,n){D(t,e,ee,n)}function J(e,t,n,i){P.innerHTML=t,P.style.width=i?i+"px":"auto",P.className="webix_table_cell webix_cell "+n,e._table.$view.appendChild(P);var o=Math.max(0,P.offsetWidth+1),r=Math.max(0,P.offsetHeight+1);return e._table.$view.removeChild(P),P.innerHTML="",{width:o,height:r}}function ee(i,o,r,a){g.set(function(){if(i.callEvent("onBeforeStyleChange",[o.row,o.column,r,a])){var e=r&&r.props.format||null,t=a&&a.props.format||null,n=e!=t;(!n||n&&i.callEvent("onBeforeFormatChange",[o.row,o.column,e,t]))&&(Z(i,o.row,o.column,r),i.callEvent("onStyleChange",[o.row,o.column,r,a]),n&&i.callEvent("onFormatChange",[o.row,o.column,e,t]),i.saveCell(o.row,o.column))}})}function te(e,t,n){for(e._styles_cache[t.text]=t;!t.id||e._styles[t.id];)t.id="wss"+e._styles_max++;var i=function r(e){var t="";for(var n in e)e[n]&&(j[n]?j[n][e[n]]?t+=j[n][e[n]](e):"function"==typeof j[n]&&(t+=j[n](e)):t+=n+":"+e[n]+";");return t}((e._styles[t.id]=t).props),o=".wss_"+e.$index;webix.html.addStyle(o+" ."+t.id+"{"+i+"}",o),n||m(e,"styles",{name:t.id,text:t.text})}function ne(e){for(var t=[],n=0;n<T.length;n++)t.push(e.props[T[n]]);return t.join(";")}function ie(e){for(var t=e.split(";"),n={},i=0;i<T.length;i++)n[T[i]]=t[i];return n}function oe(e,t){g.set(function(){D(t,e,function(e,t){q(e,t)&&X(e,t,null)})})}function re(e){for(var t=e.serialize(),n=t.data,i=t.styles,o={},r=0;r<n.length;r++){var a=n[r][3];a&&(o[a]=1)}for(var l=[],s=0;s<i.length;s++){o[i[s][0]]&&l.push(i[s])}t.styles=l,W(e),Y(e,t)}var ae=Object.freeze({style_names:T,init:function Qr(r){r.attachEvent("onStyleSet",function(e,t){return function o(t,n,i){g.set(function(){t.eachSelectedCell(function(e){!function a(e,t,n,i){var o=q(e,t),r=G(e,o,n,i,t);r&&r!=o&&ee(e,t,r,o)}(t,e,n,i)})}),t.refresh()}(r,e,t)}),r.attachEvent("onDataParse",function(e){return Y(r,e)}),r.attachEvent("onDataSerialize",function(e){return function o(e,t){var n=[];for(var i in e._styles_cache)n.push([e._styles_cache[i].id,i]);t.styles=n}(r,e)}),r.attachEvent("onReset",function(){return W(r)}),r.attachEvent("onUndo",function(e,t,n,i){"style"==e&&function o(e,t,n,i){X(e,{row:t,column:n},i)}(r,t,n,i)}),W(r),P||(P=webix.html.create("DIV",{style:"visibility:hidden; position:absolute; top:0px; left:0px; height:auto;"},""))},getStyle:q,addStyle:K,setStyle:X,setRangeStyle:Q,getTextSize:J,clearRangeStyle:oe,compactStyles:re});var le,se,ce,ue,de={};function he(){var n=webix.i18n.spreadsheet.formats;for(var e in le={},se=0,ce={},ue={},de={price:{getFormat:function(e,t){return t.css="webix_ssheet_format_price",webix.i18n.priceFormat(e)},values:webix.extend({zeros:webix.i18n.priceSettings.decimalSize,symbol:webix.i18n.priceFormat(""),separator:1,negative:1,type:"price"},fe("price"))},"int":{getFormat:function(e,t){return t.css="webix_ssheet_format_int",webix.i18n.numberFormat(e)},values:webix.extend({zeros:webix.i18n.decimalSize,separator:1,negative:1,type:"int"},fe("int"))},percent:{getFormat:function(e,t){return t.css="webix_ssheet_format_percent",Math.round(100*e)+"%"},values:webix.extend({zeros:0,separator:0,negative:1,type:"percent"},fe("percent"))},date:{getFormat:function(e,t){return t.css="webix_ssheet_format_date",xe(n.dateFormat,fe("date"))(e)},values:{type:"date",date:n.dateFormat}},string:{getFormat:function(e,t){return t.css="webix_ssheet_format_text",e},values:{
type:"string"}}})ce[e]=Ie(ze(e,de[e].values)),ue[ce[e]]=e}function fe(e){return"price"==e?{groupSign:webix.i18n.priceSettings.groupDelimiter,decimalSign:webix.i18n.priceSettings.decimalDelimiter}:{groupSign:webix.i18n.groupDelimiter,decimalSign:webix.i18n.decimalDelimiter}}function ve(e){return de[e]?de[e].getFormat:de[e]}function ge(e,t){return t?Ie(Re({values:de[e].values,format:ce[e]}),!0):ce[e]}function me(e,t){if(ue[e])return ue[e];var n="object"==p(t)?"fmt"+se:t;return se++,le[n]=e,t=webix.extend("object"==p(t)?t:{format:e,type:"custom"},fe("custom")),de[n]={getFormat:xe(e,{decimalSign:t.decimalSign,groupSign:t.groupSign}),values:t},ce[n]=e,ue[e]=n}function we(e,t,n,i,o){o||(o={format:i,type:"custom"});var r=e.getStyle(t,n),a=K(e,{format:me(i,o)},r);e.setStyle(t,n,a)}function pe(e,t,n){var i=K(e,{format:""},e.getStyle(t,n));e.setStyle(t,n,i)}function be(e){var t=e.match(/.*\[[><=].*/g),n=e.split(";");return t||1<n.length&&(n[0]=(2<n.length?"[>0]":"[>=0]")+n[0],n[1]="[<0]"+n[1],n[2]&&(n[2]="[=0]"+n[2])),n}function xe(e,t){for(var n=webix.i18n.spreadsheet.table["format-error"],i=be(e),o=['var spaces = "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;";'],r=0;r<i.length;r++){var a=Oe(i[r]);o.push(_e(a.condition,a.color.toLowerCase(),a.fmt,r,0<i.length,t))}return new Function("val","extra","try{ ".concat(o.join("\n"),' return val; } catch(err) { return "').concat(n,'"; }'))}function _e(e,t,n,i,o,r){var a="";return e&&(a+=i?"else if":"if","="===e[0]&&(e="="+e),a+="(val"+e+"){",o&&(a+="val = Math.abs(val);")),t&&(a+='extra.css = "webix_ssheet_format_'+t+'";'),(a+=function m(e,t){if(!e)return"return val;";for(var n,i,o,r,a='return ""',l="",s=1,c=[],u="date",d=0;d<e.length;d++){var h=Fe(e[d-1])&&Fe(e[d+1]);if('"'!=e[d]){if(webix.isUndefined(n))if("%"==e[d]&&(s*=100),/[a-zA-Z]/.test(e[d])){var f=ke(e.substr(d),u);if(f){if(o||r)return'throw "unexpected number placeholder";';c.push(f.format),a+="/*date*/",u=f.type,d+=f.length-1;continue}a+='+"'.concat(e[d],'"')}else if(e[d]===t.decimalSign&&h)l+=t.decimalSign;else if("@"==e[d]){if(o||c.length)return'throw "unexpected number placeholder";';r||(a+="+fmt",r=!0),l+=e[d]}else if(Fe(e[d])){if(r||c.length)return'throw "unexpected text placeholder";';o||(a+="+fmt",o=!0),l+=e[d]}else e[d]===t.groupSign&&h?i=!0:a+='+"'.concat(e[d],'"')}else n=webix.isUndefined(n)?d:(a+='+"'.concat(e.substr(n+1,d-n-1),'"'),undefined)}if(c.length){-1!=c.indexOf("%A")&&(c=c.map(function(e){switch(e){case"%G":return"%g";case"%H":return"%h";default:return e}}));for(var v=0;v<c.length;v++)a=a.replace("/*date*/","+dateParts[".concat(v,"]"))}return"\n\t\t".concat(c.length?"val = (".concat(w,')(val); var dateParts = webix.Date.dateToStr("').concat(c.join(";"),'")(val).split(";");'):"","\n\t\t").concat(l?"".concat(function g(e,t,n,i){var o='if(/^@+$/.test("'.concat(e,'") || isNaN(val)){ var fmt = val; }else {'),r=n.decimalSign,a=k(Me(e,r),2),l=a[0],s=a[1];s=(s||"").split("").reverse().join("");var c=l.indexOf("0");0<=c&&(c=l.length-c);var u=l.indexOf("?");0<=u&&(u=l.length-u);var d=s.indexOf("0");0<=d&&(d=s.length-d);var h=s.indexOf("?");0<=h&&(h=s.length-h);var f=s.length;return(o+="\n\tval = val*".concat(i,";\n\tvar parts = val.toFixed(").concat(f,').split(".");\n\tvar left = parts[0];\n\tvar lsize = left.length; \n\tvar right = parts[1] || "";\n\tif (left.length < ').concat(c,') left = "0000000000".substr(0, ').concat(c," - left.length)+left;\n\tif (left.length < ").concat(u,") left = spaces.substr(0, 6*(").concat(u," - left.length))+left;\n\tif (").concat(t,') {\n\t\tvar buf = [];\n\t\tvar start = 3;\n\t\twhile (lsize > start) { buf.push(left.substr(left.length-start,3)); start+=3; }\n\t\tvar last = left.substr(0,left.length-start+3);\n\t\tif (last !== "-")\n\t\t\tbuf.push(last);\n\t\telse\n\t\t\tbuf.push("-"+buf.pop());\n\n\t\tleft = buf.reverse().join("').concat(n.groupSign,'");\n\t}\n\tif (right){\n\t\tvar zpoint = right.length-1;\n\t\twhile (zpoint >= ').concat(d,
'){\n\t\t\tif (right[zpoint] !== "0"){\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tzpoint--;\n\t\t}\n\n\t\tif (zpoint <= right.length)\n\t\t\tright = right.substr(0, zpoint+1);\n\n\t\tif (right.length < ').concat(h,"){\n\t\t\tright += spaces.substr(0, 6*(").concat(h,' - right.length));\n\t\t}\n\t}\n\tvar fmt = left+(right?"').concat(r,'":"")+right;\n\t'))+"}\n"}(l,i,t,s),";"):"","\n\t\t").concat(a,";")}(n,r))+(e?"}":"")}var ye={yy:"%y",yyyy:"%Y",m:"%n",mm:"%m",mmm:"%M",mmmm:"%F",mmmmm:"%F",d:"%j",dd:"%d",ddd:"%D",dddd:"%l"},Ce={h:"%G",hh:"%H",m:"%i",mm:"%i",s:"%s",ss:"%s","AM/PM":"%A"},$e=Object.keys(ye).sort(function(e,t){return t.length-e.length}),Se=Object.keys(Ce).sort(function(e,t){return t.length-e.length});function ke(e,t){var n=[{name:"date",order:$e,types:ye},{name:"time",order:Se,types:Ce}];/^m{1,2}(?!m)/.test(e)&&"date"!=t&&n.reverse();for(var i=0;i<n.length;i++)for(var o=n[i],r=0;r<o.order.length;r++)if(0==e.indexOf(o.order[r]))return{format:o.types[o.order[r]],length:o.order[r].length,type:o.name}}function Ee(t,n,e,i){var o=function c(e,t,n){{if(t&&n){if("object"!==p(t)||"object"!==p(n))return[{row:t,column:n}];for(var i=[],o=t.row;o<=n.row;o++)for(var r=t.column;r<=n.column;r++)i.push({row:o,column:r});return i}return e.getSelectedId(!0)}}(t,e,i);if(0!=o.length){var r=t.$$("cells").getItem(o[0].row)[o[0].column],a=r?r.toString():r,l=t.getStyle(o[0].row,o[0].column);if(webix.rules.isNumber(a)||l&&l.props.format){g.set(function(){for(var e=0;e<o.length;e++)Ve(t,n,o[e])}),t.refresh();var s=t.getStyle(o[0].row,o[0].column).props.format||"common";s=Ae(s)?"custom":s,t.callEvent("onCommand",[{id:"toolbar-update",name:"format",value:s}])}}}function Ve(e,t,n){var i,o=e.getStyle(n.row,n.column),r=e.$$("cells").getItem(n.row)[n.column];if(r=r?r.toString():"",o&&o.props.format){var a=o.props.format;(i=webix.copy({values:de[a].values,format:ge(a)})).format=function l(e,t,n){for(var i=Re(e),o=0;o<i.length;o++){if(i[o].decimals)0<t?i[o].right.placeholders+=Array(t+1).join("0"):i[o].right.placeholders=i[o].right.placeholders.slice(0,t);else{var r=!i[o].left.text&&!i[o].right.text,a=!i[o].left.placeholders&&!i[o].right.placeholders;t<0&&r&&a&&webix.rules.isNumber(n)&&-1<n.indexOf(".")?(i[o].left.placeholders="0",i[o].right.placeholders=Array(n.split(".")[1].length).join(Array(t+1).join("0"))):0<t&&(i[o].left.placeholders||r)&&(i[o].left.placeholders=i[o].left.placeholders||"0",i[o].right.placeholders=Array(t+1).join("0"),i[o].decimals=!0)}i[o].decimals=0<i[o].right.placeholders.length}return Ie(i)}(i,t,r),i.values&&i.values.hasOwnProperty("zeros")&&(i.values.zeros=Math.max(i.values.zeros+t,0))}else{(i={values:{negative:1,zeros:webix.rules.isNumber(r)&&r.split(".")[1]?Math.max(r.split(".")[1].length+t,0):Math.max(t,0),separator:0,type:"int"}}).format=Ie(ze(i.values.type,i.values))}we(e,n.row,n.column,i.format,i.values)}function Ae(e){return"common"!=e&&(-1!=e.indexOf("fmt")||"custom"==de[e].values.type)}function ze(e,t){if("string"==e)return[{left:{text:"@"}}];if(t.date)return[{left:{text:t.date}}];var n=[{condition:">=0",left:{text:""},right:{text:""}},{condition:"<0",left:{text:""},right:{text:""}}];if(webix.extend(n,fe(e)),n[0].right.placeholders=n[1].right.placeholders=t.zeros?Array(t.zeros+1).join("0"):"",n[0].separator=n[1].separator=t.separator&&"percent"!=e,n[0].left.placeholders=n[1].left.placeholders=n[0].separator?"#"+n.groupSign+"0":"0",n[0].decimals=n[1].decimals=!!t.zeros,n[1].color=1!=t.negative?"red":"",n[1].left.text+=t.negative<3?"-":"",4==t.negative&&(n[1].left.text+="("),"percent"===e)n[0].right.text=n[1].right.text+="%";else if("price"===e){var i=de.price.values.symbol,o=0==i.indexOf(" ");n[1][o?"right":"left"].text+=i,n[0][o?"right":"left"].text+=i}return 4==t.negative&&(n[1].right.text+=")"),n}function Ie(e,t){for(var n="",i=0;i<e.length;i++){if(e[i].condition&&(n+="["+e[i].condition+"]"),e[i].color&&(n+="["+e[i].color+"]"),e[i].left){if(e[i].left.text)n+=e[i].left.text;if(e[i].left.placeholders){var o=e[i].left.placeholders;n+=t?o.replace(e.groupSign,","):o}}if(e[i].decimals&&(n+=t?".":e.decimalSign),e[i].right
)if(e[i].right.placeholders&&(n+=e[i].right.placeholders),e[i].right.text)n+=e[i].right.text;i!=e.length-1&&(n+=";")}return n}function Re(e){for(var t=e.format.split(";"),n=[],i=0;i<t.length;i++){var o=Oe(t[i]);n[i]={color:o.color,condition:o.condition,left:{},right:{}};var r=o.fmt;n.groupSign=e.values.groupSign,n.decimalSign=e.values.decimalSign,-1<r.indexOf(n.groupSign)&&(n[i].separator=!0);var a=Me(r,n.decimalSign),l=a[0],s=a[1]||"";a[1]&&(n[i].decimals=!0),l=De(l,"left",n.groupSign),s=De(s,"right",n.groupSign),n[i].left={text:l.leftText,placeholders:l.placeholders},n[i].right={text:l.rightText+s.rightText,placeholders:s.placeholders}}return n}function De(e,t,n){var i;"left"==t&&(i=(i=e.match(/[#?0]/))?i.index:Infinity);for(var o="",r="",a="",l=0;l<e.length;l++)if(Fe(e[l]))a+=e[l];else{if(e[l]==n&&Fe(e[l+1])&&Fe(e[l-1])){a+=e[l];continue}if("left"==t&&l<i){o+=e[l];continue}r+=e[l]}return{leftText:o,rightText:r,placeholders:a}}function Oe(e){var t="",n="",i=e.indexOf("[");if(-1!==i&&e[1].match(/[><=]/)){var o=e.indexOf("]");n=e.substr(i+1,o-i-1),e=e.substr(o+1)}if(-1!==(i=e.indexOf("["))){var r=e.indexOf("]");t=e.substr(i+1,r-i-1),e=e.substr(r+1)}return{condition:n,color:t,fmt:e}}function Fe(e){return"0"===e||"#"===e||"?"===e}function Me(e,t){var n=e.match("[#?0][/"+t+"][#?0]");return n?[e.substring(0,n.index+1),e.substring(n.index+2)]:[e]}function Ue(e,t,n){if(e=e&&e.fmt?e.fmt:ge(e)){var i,o=Oe(be(e)[0]).fmt;if(o)for(var r=0;r<o.length;r++)if('"'==o[r]&&(i=!i),!i){if("date"==t&&/[a-zA-Z]/.test(o)){var a=ke(o.substr(r),"date");if(a){if(!n)return!0;if("time"==a.type)return!0}}if("string"==t&&"@"==o[r])return!0}}}function Ne(e,t,n){var i=e.getRow(t);return i&&i.$cellFormat&&i.$cellFormat[n]}function Te(e){return e<-99974430.925||100025569.125<e}function je(e,t){var n=e.$cellFormat[t],i=webix.i18n.spreadsheet.formats,o=Ue(n,"date",!0);return webix.Date.dateToStr(i[o?"parseDateTime":"parseDate"])}var Be=Object.freeze({init:function Jr(e){e.attachEvent("onDataParse",function(e){return function o(e,t){var n,i=t.formats;if(i)for(n=0;n<i.length;n++)me(i[n][1],i[n][0])}(0,e)}),e.attachEvent("onDataSerialize",function(e,t){return function r(e,t){var n=[],i=["percent","int","price","date","string"];for(var o in ce)-1==i.indexOf(o)&&n.push([o,ce[o]]);t.formats=n}(0,e)})},get formatHelpers(){return de},setDefaultFormats:he,getDelimiters:fe,getFormat:ve,getFormatSource:ge,addFormat:we,removeFormat:pe,format2code:xe,changeAreaDecimals:Ee,changeCellDecimals:Ve,isCustom:Ae,formToValues:ze,serializeFormat:Ie,checkFormat:Ue,getFormatName:Ne,isDateInvalid:Te,getDateEditFormat:je});function Pe(e){var t=e.charCodeAt(0);return 65<=t&&t<=122||35==t||36==t}function He(e,t,n){for(var i,o=e.length,r=n,a=!1,l=t;l<o;l++){var s=e[l];if("'"!==s){if(!a)if("!"==s){if("#"==e[t])continue;"'"===(r=e.substr(t,l-t))[0]&&(r=r.substr(1,r.length-2)),t=l+1}else if(!(Pe(s)||(void 0,48<=(i=s.charCodeAt(0))&&i<=57)))return[e.substr(t,l-t),l,t,r]}else a=!a}return[e.substr(t),l,t,r]}var Le=/^[A-Z$]+[0-9]+$/;function We(e){return Le.test(e)}function qe(e){for(var t=0,n=0,i=1,o=1,r=0,a=!1,l=e.length-1;0<=l;l--){var s=e[l].charCodeAt(0);36!==s?s<58?(n+=(s-48)*i,i*=10):(a||(t=n,a=!(n=0),o+=i=1),n+=(s-64)*i,i*=26):r+=o}return[t,n,r]}function Ke(e){return'this.e("'.concat(e,'")')}function Ye(e,t,n,i){var o=t.ranges.getCode(n,i);if(!o)return"";var r=o.indexOf("!");-1!==r&&("'"===(i=o.substr(0,r))[0]&&(i=i.substr(1,i.length-2)),o=o.substr(r+1));var a=k(o.split(":"),2);return Ge(e,a[0],a[1],i)}function Ge(e,t,n,i){var o=k(qe(t),2),r=o[0],a=o[1],l=k(qe(n),2),s=l[0],c=l[1];if(s<r){var u=r;r=s,s=u}if(c<a){var d=a;a=c,c=d}return""===i?(e.push([r,a,s,c,""]),"this.r(".concat(r,",").concat(a,",").concat(s,",").concat(c,")")):(e.push([r,a,s,c,i]),'this.rs("'.concat(i,'",').concat(r,",").concat(a,",").concat(s,",").concat(c,")"))}function Ze(e,t,n){for(var i=[],o=0,r=!1,a=!1,l="="===e[l]?1:0;l<e.length;l++){var s=e[l];if('"'==s)r=!r;else if(!r)if("{"==s&&"{"==e[l+1])a=!0;else if("}"==s&&"}"==e[l+1])a=!1;else if(!a){var c="'"===s;if(c||Pe(s)){var u=k(He(e,l,""),4),d=u[0],h=u[1],
f=u[3],v=h-1;!f||!t&&f?(f&&(l+=f.length+(c?3:1)),"("!==e[v+1]&&(We(d)||n&&n[d])&&(Xe(i,e,l,o,t?d:qe(d)),o=v+1)):t&&(Xe(i,e,l,o,[f,d,c]),o=v+1),l=v}}}return o!=e.length&&i.push(e.substr(o)),i}function Xe(e,t,n,i,o){0!==n&&e.push(t.substr(i,n-i)),e.push(o)}function Qe(e){return{view:"ssheet-suggest",css:"webix_ssheet_suggest",autowidth:!0,template:function(e){var t="";return e.icon&&(t+="<span class='webix_ssheet_button_icon webix_ssheet_icon ssi-"+e.icon+"'></span> "),t+=e.value||webix.i18n.spreadsheet.menus[e.id]||e.id},data:e,on:{onItemClick:function(e){var t=this.config.master;if(t){var n=webix.$$(t).getTopParentView(),i=[this.getItem(e)];if(webix.$$(t).config.area){var o=n.$$("cells").getSelectArea();o&&(i=i.concat([o.start,o.end]))}n.callEvent("onCommand",i)}}}}}webix.protoUI({name:"live-editor",$cssName:"texthighlight",$init:function(e){var n=this;e.suggest={view:"suggest-formula",data:e.suggestData},e.highlight=this.highlight,this._highlightedCells={},this.$view.className+=" webix_ssheet_formula",this.attachEvent("onKeyPress",function(e,t){delete n._update_range,13===e&&(300<new Date-(n._last_value_set||0)&&(n.showActiveSheet(),n.updateCellValue(),webix.delay(function(){n.getTopParentView()._table.moveSelection("down")})),webix.html.preventEvent(t))}),this.attachEvent("onAfterRender",function(){var t=this;webix.eventRemove(this.keydownEv),this.keydownEv=webix.event(this.getInputNode(),"keydown",function(e){t.endEdit(e)})})},highlight:function(e){var t="",n=this.getTopParentView(),i=webix.template.escape;for(var o in this._highlightedCells){var r=this._highlightedCells[o];this.changeCellCss(r[0],r[1],r[2],!0)}if(this._highlightedCells={},e&&"="==e[0])for(var a=n.ranges._ranges,l=Ze(e,!0,a),s=n.getActiveSheet(),c=1,u=0;u<l.length;u++)if(u%2==0)t+=i(l[u]);else{var d=webix.isArray(l[u]),h=d?this.prepareSheet(l[u][0],l[u][2]):"",f=this._activeMath,v=!(d||f&&f!=s),g=qe(d?l[u][1]:l[u]),m=d?h+l[u][1]:l[u],w=/^[A-Za-z]+$/.test(l[u]);if(v||d&&l[u][0]==s){var p=void 0;if(":"==l[u+1]&&l[u+2]||w){var b=void 0,x=void 0;if(w){var _=a[l[u]].split(":");g=qe(_[0]),b=qe(_[1])}else b=qe(d?l[u+2][1]:l[u+2]),x=d?h+l[u+2][1]:l[u+2],u+=2;p=this.setColor(g[0],g[1],b[0],b[1],c),t+='<span class="webix_ssheet_highlight_color_'.concat(p||c,'">').concat(w?l[u]:m+":"+x,"</span>")}else p=this.setColor(g[0],g[1],g[0],g[1],c),t+='<span class="webix_ssheet_highlight_color_'.concat(p||c,'">').concat(m,"</span>");p||(c+=7==c?-6:1)}else t+=m}else t=i(e);return n.$$("cells").refresh(),document.activeElement==this.getInputNode()&&this.paintValue(),t},showActiveSheet:function(){var e=this,t=this.getTopParentView();if(this._activeMath){if(this._activeMath!=t.getActiveSheet()){var n=this.getValue(),i=this.config.activeCell;this.define({activeCell:null}),t.showSheet(this._activeMath),webix.delay(function(){t._table.select(i.row,i.column),e.setValue(n),e.updateCellValue()})}delete this._activeMath}},changeCellCss:function(e,t,n,i){for(var o="webix_ssheet_highlight_background_".concat(n),r=e.start;r<=e.end;r++)for(var a=t.start;a<=t.end;a++)this.getTopParentView().$$("cells")[i?"removeCellCss":"addCellCss"](r,a,o,!0)},endEdit:function(e){var t=e.which||e.keyCode;if(9==t||36<t&&t<41&&"="!==this.getValue().charAt(0)){var n=40==t?"down":39===t?"right":37==t?"left":"up";9===t&&(n="right"),this.updateCellValue(),this.getTopParentView()._table.moveSelection(n)}},paintValue:function(){var e=this.getTopParentView();if(!this._activeMath||this._activeMath==e.getActiveSheet()){var t=this.config.activeCell,n=e._table.getItemNode(t);t&&n&&(n.innerHTML="<div>".concat(webix.template.escape(this.getValue()),"</div>"))}},updateCellValue:function(){var e=this.getValue(),t=this.getTopParentView(),n=this.config.activeCell;n?e!=t.getCellValue(n.row,n.column)&&(this.config.value=e,t.setCellValue(n.row,n.column,e),t.refresh()):this.setValue("");delete t.$handleSelection},$setValueHere:function(e){this.setValueHere(e)},setValueHere:function(e){this._last_value_set=new Date;var t=this.getValue();if(t&&"="===t.charAt(0)){var n=this.getInputNode().selectionStart,i=t.substring(0,n),
o=t.substring(n);i=(/[a-zA-Z]+\(?$/.test(i)?i.replace(/[a-zA-Z]+\(?$/,e):i+e)+("("==o[0]?"":"("),this.setValue(i+o),this.getInputNode().setSelectionRange(i.length,i.length)}},expectRange:function(){var e=this.getValue().trim();return e.substr(e.length-1,1).match(/[(,]/)},expectOperator:function(){var e=this.getValue(),t=this.getInputNode().selectionStart;return"="==e[0]&&e[t-1]&&e[t-1].match(/[+&\-/*%=(:,]/)},setRange:function(e,t){var n,i,o=this.getInputNode().selectionStart,r=this.getValue();t&&(t=this._update_range&&o==this._update_range.pos+this._update_range.len);var a=t?this._update_range.pos:o;n=r.substring(0,a)+e,i=r.substring(o),this._update_range={pos:a,len:e.length},this.setValue(n+i)},prepareSheet:function(e,t){return((webix.isUndefined(t)?-1!=e.indexOf(" "):t)?"'".concat(e,"'"):e)+"!"},prepareArea:function(e,t){return{start:Math.min(e,t),end:Math.max(e,t)}},setColor:function(e,t,n,i,o){var r=this.prepareArea(e,n),a=this.prepareArea(t,i),l=[r.start,r.end,a.start,a.end].join(","),s=this._highlightedCells[l];if(s)return s[2];this._highlightedCells[l]=[r,a,o],this.changeCellCss(r,a,o)}},webix.ui.texthighlight),webix.protoUI({name:"ssheet-separator",defaults:{css:"webix_ssheet_toolbar_spacer",template:" ",width:1,borderless:!0}},webix.ui.view),webix.protoUI({name:"sheets",defaults:{layout:"x",borderless:!0,css:"ssheet_list_sheets",select:!0,drag:"order",dragscroll:"x",scroll:!1}},webix.EditAbility,webix.ui.list),webix.protoUI({$cssName:"toggle",name:"ssheet-toggle",toggle:function(){var e=this.getValue()==this.config.onValue;this.setValue(!e)},$setValue:function(e){e==this.config.offValue?e=!1:e==this.config.onValue&&(e=!0),webix.ui.toggle.prototype.$setValue.call(this,e)},getValue:function(){var e=this.config,t=e.value;return t&&t!=e.offValue?e.onValue||!0:e.offValue||!1},defaults:{template:function(e,t){var n=!0===e.value||e.value==e.onValue?" webix_pressed":"",i=t.$renderInput(e,t);return"<div class='webix_el_box"+n+"' style='width:"+e.awidth+"px; height:"+e.aheight+"px'>"+i+"</div>"}}},webix.ui.toggle),webix.protoUI({name:"ssheet-toggle-silent",$cssName:"toggle",$allowsClear:!1,setValue:function(){this.blockEvent(),webix.ui.toggle.prototype.setValue.apply(this,arguments),this.unblockEvent()}},webix.ui.toggle),webix.protoUI({name:"ssheet-bar-title",defaults:{borderless:!0},$init:function(){this.$view.className+=" webix_ssheet_subbar_title"}},webix.ui.template),webix.protoUI({name:"ssheet-button",$cssName:"button",defaults:{type:"htmlbutton",width:40},$init:function(e){if(this.$view.className+=" webix_ssheet_button"+(e.arrow?" webix_ssheet_button_menu":""),e.label||e.icon){var t=e.icon||e.name,n=e.label||"";e.arrow&&(n+="<span class='webix_ssheet_button_icon webix_ssheet_icon_arrow webix_icon wxi-menu-down'></span>"),e.label="<span class='webix_ssheet_button_icon webix_ssheet_icon ssi-"+t+"'></span> "+n,e.tooltip=webix.i18n.spreadsheet.tooltips[e.name]||""}e.options&&!e.popup&&(e.popup=Qe(e.options))}},webix.ui.button),webix.protoUI({name:"ssheet-button-icon-top",$cssName:"button",defaults:{type:"htmlbutton",width:70,height:70},$init:function(e){if(this.$view.className+=" ssheet_button_icon_top",e.label){var t=e.icon||e.name||"",n=e.label;e.label="<span class='webix_ssheet_button_icon webix_ssheet_icon ssi-"+t+"'></span><br/>",e.label+="<span class='ssheet_button_icon_top_text'>"+n+"</span>",e.arrow&&(e.label+="<br/><span class='ssheet_button_icon_top_arrow webix_icon wxi-menu-down'></span>"),e.tooltip=webix.i18n.spreadsheet.tooltips[e.name]||""}e.options&&!e.popup&&(e.popup=Qe(e.options))}},webix.ui.button),webix.protoUI({name:"multicheckbox",defaults:{padding:0,type:"clean",borderless:!0,elementsConfig:{labelWidth:10}},$init:function(e){e.rows=[{height:1e-6}],this.$ready.push(function(){this._initOnChange()})},_initOnChange:function(){this.attachEvent("onChange",function(e){var t=this.$eventSource.config.name;if(this.blockEvent(),"$all"==t){for(var n in this.elements)this.elements[n].setValue(e);e||this._getCheckboxes()[0].setValue(1)}else{var i=this.getValue().length;this.elements.$all.setValue(
i==this._count?1:0),i||this._getCheckboxes()[0].setValue(1)}this.unblockEvent()})},setValue:function(e){if(this.elements={},this._count=e.length,1<e.length){var t=[],n=[];e.forEach(function(e){n.push({view:"checkbox",labelRight:e.name,name:e.name,value:e.active})});var i=n.length*webix.skin.$active.inputHeight,o=400<i;t.push({view:"scrollview",body:{rows:n},scroll:o,height:o?400:i}),t.push({template:"<div class='ss_sep_line'></div>",height:10}),t.push({view:"checkbox",labelRight:webix.i18n.spreadsheet.labels["export-all-sheets"],name:"$all",value:0}),webix.ui(t,this)}else 1<this.getChildViews().length&&webix.ui([{height:1e-6}],this)},getValue:function(){for(var e=this._getCheckboxes(),t=[],n=0;n<e.length;n++)e[n].getValue()&&t.push(e[n].config.name);return t},_getCheckboxes:function(){var e=this.queryView("scrollview");return e?e.getBody().getChildViews():[]}},webix.ui.form),webix.protoUI({name:"formlist",defaults:{paddingY:5,height:120},$init:function(e){var t=this;e.cols=[{css:"webix_inp_label",template:e.label,width:e.labelWidth,borderless:!0},{view:"list",data:e.data,css:e.css,template:e.template,select:!0,scroll:!1,borderless:!0,on:{onSelectChange:function(){t.getParentView().callEvent("onChange",[])}}}]},setValue:function(e){this.getChildViews()[1].select(e)},getValue:function(){return this.getChildViews()[1].getSelectedId()},refresh:function(){this.getChildViews()[1].refresh()},focus:function(){}},webix.ui.layout),webix.protoUI({name:"ssheet-ui",defaults:{move:!0,css:"webix_shadow_none webix_ssheet_ui",head:!1,resize:!0,toFront:!0,minWidth:50,minHeight:200,escHide:!1,autofit:!1},$init:function(){this.$view.setAttribute("webixignore","1"),this.$ready.push(function(){webix.UIManager.addHotKey("delete",webix.bind(this._removeView,this)),webix.UIManager.addHotKey("backspace",webix.bind(this._removeView,this)),this.getMenu()}),this.attachEvent("onDestruct",function(){webix.eventRemove(this._clickEv),this._menu.destructor()})},move_setter:function(e){return e&&webix.DragControl.addDrag(this.$view,this),e},$dragPos:function(e,t){return this.callEvent("onViewMove",[e,t]),e},$dragCreate:function(e,t){var n=t.target;if(n.getAttribute&&!n.getAttribute("webix_disable_drag")&&!n.getAttribute("webixignore")){this.getMenu().hide();var i=webix.html.offset(e),o=webix.html.pos(t),r=webix.html.offset(e.parentNode),a=webix.$$(this.config.master).getScrollState();return webix.DragControl.top=i.y-o.y-r.y,webix.DragControl.left=i.x-o.x-r.x+a.x,webix.toNode(this.$view)}},$dragDestroy:function(e,t){var n=this.config.left=parseInt(t.style.left,10),i=this.config.top=parseInt(t.style.top,10);webix.DragControl.top=webix.DragControl.left=0,this.callEvent("onViewMoveEnd",[n,i])},getMenu:function(){var t=this,e=webix.i18n.spreadsheet.labels;if(!this._menu){var n=[{value:e["export-view"],submenu:[{id:"pdf",value:e["export-view-pdf"]},{id:"png",value:e["export-view-png"]},{id:"excel",value:e["export-view-excel"]}]}];webix.$$(this.config.master).getTopParentView().config.readonly||(n=[{id:"edit",value:e["edit-view"]}].concat(E(n),[{id:"del",value:e["remove-view"]}])),this._menu=webix.ui({view:"contextmenu",submenuConfig:{externalUI:this.config.id},data:n,on:{onMenuItemClick:function(e){return t._menuActions(e)},onBeforeShow:function(){return t._toggleExcel()}}});var i=webix.html.create("span",{"class":"webix_ssheet_view_menu webix_icon wxi-dots"});this._clickEv=webix.event(i,"click",function(){t._menu.isVisible()?t._menu.hide():t._menu.show(i)}),this.$view.firstChild.appendChild(i)}return this._menu},_menuActions:function(e){switch(e){case"del":this.callEvent("onViewRemove",[]);break;case"edit":this.callEvent("onViewEdit",[]);break;case"pdf":webix.toPDF(this.getBody(),{display:"image"});break;case"png":webix.toPNG(this.getBody());break;case"excel":webix.toExcel(this.getBody(),{header:!1})}},_toggleExcel:function(){var e=this.getBody();e.data&&e.data.pull?this._menu.showItem("excel"):this._menu.hideItem("excel")},_removeView:function(e){e&&e.getTopParentView()==this&&this.callEvent("onViewRemove",[])}},webix.ui.window),webix.protoUI({
name:"ssheet-series",$init:function(e){var t=this;e.rows=[{view:"scrollview",borderless:!0,body:{view:"accordion",css:"webix_ssheet_accordion",margin:webix.skin.$active.layoutMargin.form,multi:!0,type:"clean",rows:[this.getSectionConfig()]},on:{onAfterScroll:function(){webix.callEvent("onClick",[])}}},{view:"button",label:webix.i18n.spreadsheet.labels["add-line"],click:function(){t.addSection()}}]},getSectionConfig:function(e){var t=this,i=this,o=webix.i18n.spreadsheet.labels,r="<span class='webix_icon webix_ssheet_series_icon wxi-trash'></span>",n=webix.skin.$active.dataPadding-2;return{view:"accordionitem",header:"".concat(o["chart-item"]," ").concat(e?e+1:1," ").concat(r),body:{view:"form",padding:n,elementsConfig:{labelWidth:180},on:{onChange:function(){t.callEvent("onChange",[])}},elements:[{view:"text",label:o["chart-range"],name:"range",range:!0,on:{onChange:function(e,t){var n=e.toUpperCase();e!=n&&(this.blockEvent(),this.setValue(n),this.unblockEvent()),i.callEvent("onRangeChange",[n,t])}}},{view:"ssheet-colorpicker",label:o["chart-series-color"],name:"color"},{view:"checkbox",label:o["chart-tooltip"],name:"tooltip"},{view:"richselect",label:o["chart-markers"],value:"square",name:"marker",hidden:!this.markersVisible,suggest:{view:"ssheet-form-suggest",data:[{id:"square",value:o["chart-markers-square"]},{id:"triangle",value:o["chart-markers-triangle"]},{id:"diamond",value:o["chart-markers-diamond"]},{id:"round",value:o["chart-markers-round"]}]}}]},onClick:{"wxi-trash":function(){var e=this.getParentView();e.removeView(this);for(var t=e.getChildViews(),n=0;n<t.length;n++)t[n].define({header:"".concat(o["chart-item"]," ").concat(n+1," ").concat(r)}),t[n].refresh();return i.callEvent("onChange",[]),!1}}}},addSection:function(){var e=this.getLayout(),t=e.getChildViews().length,n=e.addView(this.getSectionConfig(t));webix.$$(n).queryView({name:"range"}).focus()},setValue:function(e){e=e||[];var t=this.getLayout().getChildViews(),n=t.length;if(n>e.length)for(var i=n;i>e.length;i--)this.getLayout().removeView(t[i-1]);else if(e.length>n)for(var o=e.length;n<o;o--)this.addSection();for(var r=0;r<t.length;r++){var a=t[r].getChildViews()[0],l=a.queryView({name:"range"});l.blockEvent(),a.setValues(e[r]),l.unblockEvent()}},setSubValue:function(e,t){e.blockEvent(),e.setValue(t),e.unblockEvent()},getLayout:function(){return this.queryView("scrollview").getBody()},hideMarkers:function(t){this.markersVisible=t,this.queryView("richselect","all").forEach(function(e){t?e.show():e.hide()})},getValue:function(){var t=[];return this.getLayout().getChildViews().forEach(function(e){t.push(e.getChildViews()[0].getValues())}),t}},webix.ui.layout),webix.editors.excel_date=webix.extend({createPopup:function(){var e=webix.editors.excel_date;if(!e.popup){var t=webix.ui({view:"popup",body:{view:"calendar",icons:!0,timepicker:!0,on:{onChange:function(e){e=e[0],this.getParentView()._last_input_target.value=e?o(e):"",webix.callEvent("onEditEnd",[])}}},on:{onEnter:function(){webix.callEvent("onEditEnd",[])}}});e.popup=t.config.id}return e.popup},render:function(){var e=this,t=webix.html.create("div",{"class":"webix_dt_editor"},"<input type='text'>");return this.popup=this.createPopup(),webix.event(t.firstChild,"click",function(){return e.getPopup().show(t)}),t},getPopup:function(){return webix.$$(this.popup)},showPopup:function(){var e=this.getInputNode(),t=this.getPopup();t._last_input_target=e,t.show(e),e.setAttribute("aria-expanded","true")},updateCalendar:function(e){var t=this.getPopup().getBody();t.blockEvent(),t.setValue(e),t.unblockEvent()},afterRender:function(){this.showPopup()},setValue:function(e){e=""===e||isNaN(1*e)?new Date:w(e),this.updateCalendar(e);var t=je(this.config.row,this.config.id);this.getInputNode().value=t(e)},getValue:function(){var e=this.getInputNode().value;return this.getPopup().hide(),e}},webix.editors.text),webix.editors.ss_richselect=webix.extend({getFormat:function(e){var t,n=this.getInputNode();return e&&n.exists(e)&&(t=n.getItem(e)),t&&t.format},popupInit:function(e){webix.editors.richselect.popupInit.apply(
this,arguments),e.getList().define("template",function(e){return e.$value||e.value})}},webix.editors.richselect);var Je={span:function(e){var t=e.$$("cells").getSelectArea();if(t)if(function a(e,t){var n,i,o=t.start,r=t.end;for(n=1*o.row;n<=1*r.row;n++)for(i=1*o.column;i<=1*r.column;i++)if(e.$$("cells").getSpan(n,i))return!0;return!1}(e,t))e.splitCell();else{for(var n=[],i=t.start.row;i<=t.end.row;i++){for(var o=t.start.column;o<=t.end.column;o++){var r=e.getCellValue(i,o);if(r&&n.push(r),1<n.length)break}if(1<n.length)break}1<n.length?e.confirm({text:webix.i18n.spreadsheet.labels["merge-cell-confirm"]}).then(function(){return e.combineCells()}):e.combineCells()}},undo:function(e){e.undo()},redo:function(e){e.redo()},"hide-gridlines":function(e){e.hideGridlines("toggle")},"hide-headers":function(e){e.hideHeaders("toggle")},"freeze-columns":function(e){var t=e.$$("cells").getSelectedId();e.freezeColumns(t&&"rowId"!=t.column?t.column:0)},"freeze-rows":function(e){var t=e.$$("cells").getSelectedId();e.freezeRows(t?t.row:0)},"increase-decimals":function(e){Ee(e,1)},"decrease-decimals":function(e){Ee(e,-1)}};var et=[{id:"Arial",value:"Arial"},{id:"'Roboto', sans-serif",value:"Roboto"},{id:"'PT Sans', Tahoma",value:"PT Sans"},{id:"Tahoma",value:"Tahoma"},{id:"Verdana",value:"Verdana"},{id:"Calibri, Tahoma",value:"Calibri"}];function tt(e){var t=webix.i18n.spreadsheet.menus,n=[{id:"add",group:"column",value:t["insert-column"]},{id:"del",group:"column",value:t["delete-column"]},{id:"show",group:"column",value:t["show-column"]},{id:"hide",group:"column",value:t["hide-column"]}];return 0!=e.config.resizeCell&&n.push({id:"resize",group:"column",value:t["resize-column"]}),n}function nt(e){var t=webix.i18n.spreadsheet.menus,n=[{id:"add",group:"row",value:t["insert-row"]},{id:"del",group:"row",value:t["delete-row"]},{id:"show",group:"row",value:t["show-row"]},{id:"hide",group:"row",value:t["hide-row"]}];return 0!=e.config.resizeCell&&n.push({id:"resize",group:"row",value:t["resize-row"]}),n}function it(){return[{id:"clear-value",value:rt("value")},{id:"clear-style",value:rt("style")},{id:"clear-conditional-formats",value:rt("conditional-formats")},{id:"clear-dropdown-editors",value:rt("dropdown-editors")},{id:"clear-comments",value:rt("comments")},{$template:"Separator"},{id:"clear-all",value:rt("all")}]}var ot=[{id:"no",value:"no"},{id:"left",value:"left"},{id:"top",value:"top"},{id:"right",value:"right"},{id:"bottom",value:"bottom"},{id:"all",value:"all"},{id:"outer",value:"outer"},{id:"top-bottom",value:"top-bottom"}];function rt(e){var t=webix.i18n.spreadsheet.menus;return t.clear+" "+t["clear-"+e].toLowerCase()}var at={"font-weight":"bold","font-style":"italic","text-decoration":"underline"},lt={button:function(e){return{view:"ssheet-toggle",width:e.width||U.width,id:e.name,name:e.name,label:e.label,css:e.css||"",onValue:at[e.name],offValue:"normal",tooltip:webix.i18n.spreadsheet.tooltips[e.name]||""}},colorButton:function(e){return{view:"ssheet-color",css:e.css,name:e.name,width:e.width||U.width+24,title:"<span class='webix_ssheet_button_icon webix_ssheet_color_button_icon webix_ssheet_icon ssi-"+e.name+"' ></span>",tooltip:webix.i18n.spreadsheet.tooltips[e.name]||""}},toggleButton:function(e){return{view:"ssheet-toggle-silent",width:U.width,id:e.name,name:e.name,label:"<span class='webix_ssheet_button_icon webix_ssheet_icon ssi-"+e.name+"'></span>",tooltip:webix.i18n.spreadsheet.tooltips[e.name]||""}},iconButton:function(e){var t=webix.copy(e);return webix.extend(t,{view:"button",width:U.width,id:e.name,label:"<span class='webix_ssheet_button_icon webix_ssheet_icon ssi-"+e.name+"'></span>",css:"",tooltip:webix.i18n.spreadsheet.tooltips[e.name]||webix.i18n.spreadsheet.menus[e.name]||""}),e.onValue&&webix.extend(t,{view:"ssheet-toggle",onValue:e.onValue,offValue:e.offValue},!0),t},segmented:function(e){return{view:"segmented",name:e.name,css:e.css||"",width:e.width||U.width+76,options:e.options}},select:function(e){return webix.extend(e,{view:"richselect",id:e.name,value:N[e.name],suggest:{css:"webix_ssheet_suggest",padding:0,
data:e.options}}),e.tooltip=webix.i18n.spreadsheet.tooltips[e.name]||"",e.popupWidth&&(e.suggest.fitMaster=!1,e.suggest.width=e.popupWidth),e.popupTemplate&&(e.suggest.body={template:e.popupTemplate}),e.popupEvents&&(e.suggest.body=e.suggest.body||{},e.suggest.body.on=e.popupEvents),e},separator:function(){return{view:"ssheet-separator"}},title:function(e){var t=e.title;return 0===t.indexOf("$")&&(t=""),{template:t=webix.i18n.spreadsheet.labels[e.title]||t,view:"ssheet-bar-title",height:U.titleHeight}},borders:function(e){return{view:"ssheet-borders",width:e.width||U.width+24,data:ot,id:e.name,name:e.name,tooltip:webix.i18n.spreadsheet.tooltips[e.name]}},align:function(e){return{view:"ssheet-align",value:N[e.name],width:e.width||U.width+24,data:e.options,name:e.name,tooltip:webix.i18n.spreadsheet.tooltips[e.name]}},condFormat:function(e){return{view:"ssheet-cond-format",width:40,id:e.name,name:e.name}}},st={"font-family":function(){return lt.select({name:"font-family",options:et,width:100})},"font-size":function(){return lt.select({name:"font-size",options:function i(){for(var e=["8","9","10","11","12","14","15","16","18","20","22","24","28","36"],t=[],n=0;n<e.length;n++)t.push({id:e[n]+webix.i18n.spreadsheet.labels.px,value:e[n]});return t}(),width:64})},"font-weight":function(){return lt.button({name:"font-weight",label:"B",css:"webix_ssheet_bold"})},"font-style":function(){return lt.button({name:"font-style",label:"I",css:"webix_ssheet_italic"})},"text-decoration":function(){return lt.button({name:"text-decoration",label:"U",css:"webix_ssheet_underline"})},color:function(){return lt.colorButton({name:"color",icon:"font",css:"webix_ssheet_color"})},background:function(){return lt.colorButton({name:"background",icon:"paint-brush",css:"webix_ssheet_background",width:64})},borders:function(){return lt.borders({name:"borders"})},"text-align":function(){var e=webix.i18n.spreadsheet.tooltips;return lt.align({name:"text-align",css:"webix_ssheet_align",options:[{id:"left",css:"webix_ssheet_icon ssi-left",tooltip:e["align-left"]},{id:"center",css:"webix_ssheet_icon ssi-center",tooltip:e["align-center"]},{id:"right",css:"webix_ssheet_icon ssi-right",tooltip:e["align-right"]}]})},"vertical-align":function(){var e=webix.i18n.spreadsheet.tooltips;return lt.align({name:"vertical-align",css:"webix_ssheet_align",options:[{id:"top",css:"webix_ssheet_icon ssi-top",tooltip:e["align-top"]},{id:"middle",css:"webix_ssheet_icon ssi-middle",tooltip:e["align-middle"]},{id:"bottom",css:"webix_ssheet_icon ssi-bottom",tooltip:e["align-bottom"]}]})},wrap:function(){return lt.iconButton({name:"wrap",onValue:"wrap",offValue:"nowrap"})},format:function(){return lt.select({name:"format",width:106,options:function t(){var e=webix.i18n.spreadsheet.labels;return[{id:"common",value:e.common},{id:"price",value:e.currency,example:"98.20"},{id:"int",value:e.number,example:"2120.02"},{id:"percent",value:e.percent,example:"0.5"},{id:"date",value:e.date,example:"45000"},{id:"string",value:e.string,example:"012345"},{id:"custom",value:e["custom-format"]}]}(),popupWidth:180,popupTemplate:function(e){var t=de[e.id]?de[e.id].getFormat:"",n={css:""},i=t&&e.example?t(e.example,n):"";return e.value+(t?"<span class='webix_ssheet_right"+(n.css?" "+n.css:"")+"'>"+i+"</span>":"")},popupEvents:{onItemClick:function(e){"custom"==e&&this.getTopParentView().callEvent("onCommand",[{id:e}])}}})},column:function(e){return{name:"column",view:"ssheet-button",icon:"column",arrow:!0,area:!0,width:58,options:tt(e)}},row:function(e){return{name:"row",view:"ssheet-button",icon:"row",arrow:!0,area:!0,width:58,options:nt(e)}},clear:function(){return{name:"clear",view:"ssheet-button",icon:"clear-styles",arrow:!0,area:!0,width:58,options:it()}},image:function(){return{name:"image",view:"ssheet-button",icon:"add-image",arrow:!0,options:[{id:"add-image-cell",value:webix.i18n.spreadsheet.labels["add-image-cell"]},{id:"add-image-top",value:webix.i18n.spreadsheet.labels["add-image-top"]}]}},graph:function(){return{name:"graph",view:"ssheet-button",icon:"add-sparkline",arrow:!0,options:[{
id:"add-sparkline",value:webix.i18n.spreadsheet.labels["add-sparkline"]},{id:"add-chart",value:webix.i18n.spreadsheet.labels["add-chart"]}]}},comment:function(){return{name:"comment",view:"ssheet-button",icon:"comments",arrow:!0,area:!0,width:55}},"create-filter":function(){return lt.toggleButton({name:"create-filter"})},"hide-gridlines":function(){return lt.toggleButton({name:"hide-gridlines"})},"hide-headers":function(){return lt.toggleButton({name:"hide-headers"})}};function ct(e){var t=webix.i18n.spreadsheet;return t.menus[e]||t.labels[e]||t.tooltips[e]||e}function ut(){var e=function r(){var e,t,n,i={undo:["undo","redo"],insert:["add-sparkline","add-image","add-comment"]},o={};for(t in i)for(e=o[t]=0;e<i[t].length;e++)n=webix.html.getTextSize(ct(i[t][e]),"webix_ssheet_button_measure").width+7,o[t]=Math.max(n,o[t]);return o}(),t=U.titleHeight;return[{padding:3,margin:0,rows:[{margin:2,cols:[{name:"sheet",view:"ssheet-button-icon-top",label:ct("sheet"),arrow:!0,options:[{id:"new-sheet"},{id:"copy-sheet"},{id:"remove-sheet"}]},{rows:[{$button:"excel-import"},{$button:"excel-export"}]},{rows:[{$button:"print"}]}]},{},{template:ct("file"),view:"ssheet-bar-title",height:t,width:85}]},{view:"ssheet-separator"},{padding:3,rows:[{$button:"undo",view:"ssheet-button",label:ct("undo"),width:e.undo},{$button:"redo",view:"ssheet-button",label:ct("redo"),width:e.undo},{template:ct("undo-redo"),view:"ssheet-bar-title",height:t}]},{view:"ssheet-separator"},{padding:3,rows:[{margin:2,cols:[{margin:2,cols:[{$button:"font-family",width:3*(webix.skin.$active.inputHeight+2)+4},{$button:"font-size"}]},{$button:"borders"}]},{margin:2,cols:[{margin:2,cols:[{$button:"font-weight"},{$button:"font-style"},{$button:"text-decoration"}]},{$button:"background"},{$button:"color"}]},{template:ct("font"),view:"ssheet-bar-title",height:t}]},{view:"ssheet-separator"},{padding:3,rows:[{margin:2,cols:[{$button:"text-align"},{$button:"span"}]},{margin:2,cols:[{$button:"vertical-align"},{$button:"wrap"}]},{template:ct("align"),view:"ssheet-bar-title",height:t}]},{view:"ssheet-separator"},{padding:3,rows:[{$button:"format"},{margin:2,cols:[{$button:"increase-decimals"},{$button:"decrease-decimals"}]},{template:ct("number"),view:"ssheet-bar-title",height:t}]},{view:"ssheet-separator"},{padding:3,rows:[{cols:[{$button:"sort-asc"},{$button:"create-filter"},{$button:"conditional-format"},{$button:"add-link"},{$button:"clear"}]},{cols:[{$button:"sort-desc"},{$button:"add-range"},{$button:"lock-cell"},{$button:"add-dropdown"}]},{template:ct("edit"),view:"ssheet-bar-title",height:t}]},{view:"ssheet-separator"},{padding:3,rows:[{cols:[{$button:"image",view:"ssheet-button",label:ct("image"),width:e.insert},{$button:"add-comment",view:"ssheet-button",label:ct("comment"),width:e.insert}]},{$button:"graph",view:"ssheet-button",label:ct("graph"),width:e.insert},{template:ct("insert"),view:"ssheet-bar-title",height:t}]},{view:"ssheet-separator"},{padding:3,rows:[{cols:[{rows:[{$button:"row"},{$button:"column"}]},{rows:[{$button:"hide-gridlines"},{$button:"hide-headers"}]},{rows:[{$button:"freeze-rows"},{$button:"freeze-columns"}]}]},{template:ct("view"),view:"ssheet-bar-title",height:t}]},{view:"ssheet-separator"},{}]}var dt={"undo-redo":["undo","redo"],font:["font-family","font-size","font-weight","font-style","text-decoration","color","background","borders"],align:["text-align","vertical-align","wrap","span"],format:["format"]};function ht(i){i.attachEvent("onComponentInit",function(){return function e(t){t.attachEvent("onAfterSelect",function(e){return function i(e,t){var n=function c(e,t){for(var n=["font-family","font-size","text-align","vertical-align","format","background","color"],i=t[0],o=ft(e,i),r=1;r<t.length;r++){for(var a=ft(e,t[r]),l=n.length-1;0<=l;l--){var s=n[l];o[s]!=a[s]&&(delete o[s],n.splice(l,1))}if(!n.length)break}return o}(e,t);e.$$("bar").setValues(n)}(t,e)})}(i)}),i.attachEvent("onCommand",function(e){"toolbar-update"==e.id&&function o(e,t,n){var i=e.$$("bar").elements[t];i&&i.setValue(n)}(i,e.name,e.value)});var e=[];if(i.config.toolbar){
var t=i.config.toolbar;"full"==t&&(t=ut(),webix.isUndefined(i.config.bottombar)&&(i.config.bottombar=!0)),e=function a(o,e){var r=function(e){for(var t=0;t<e.length;t++){var n=e[t].$button;if(n){var i=st[n]?st[n](o):lt.iconButton({name:n});webix.extend(e[t],i)}e[t].rows&&r(e[t].rows),e[t].cols&&r(e[t].cols)}};return r(e),e}(i,t)}else e=function s(e,t){var n,i,o,r=[];for(var a in t)r.push((n=e,o=t[i=a],{rows:[{padding:2,cols:[{margin:2,cols:function l(e,t){for(var n=[],i=0;i<t.length;i++){var o=t[i];if("object"==p(o))n.push(o);else{var r=st[o]?st[o](e):lt.iconButton({name:o});n.push(r)}}return n}(n,o)}]},lt.title({title:i})]})),r.push(lt.separator());return r}(i,i.config.buttons||dt);var n={view:"toolbar",css:"webix_ssheet_toolbar webix_layout_toolbar",id:"bar",padding:0,elements:e,on:{onChange:function(){var e=this.$eventSource,t=e.getValue(),n=e.config.name;"format"==n&&"common"==t&&(t=""),"format"==n&&"custom"==t||i.callEvent("onStyleSet",[n,t])},onItemClick:function(e){var t=i.innerId(e);Je[t]?Je[t].call(this,i):i.callEvent("onCommand",[{id:t}])}}};return i.callEvent("onViewInit",["toolbar",n]),n}function ft(e,t){var n=e.$$("cells").getSpan(t.row,t.column);if(n){var i=k(n,2);t.row=i[0],t.column=i[1]}var o=e.getStyle(t.row,t.column),r=o?webix.copy(o.props):{};for(var a in N)r[a]||(r[a]=N[a]);return r.format=Ae(r.format)?"custom":r.format,r}function vt(e,t,n){var i=t.$$("cells").config.columns,o={row:e,column:i["rowId"==i[0].id?1:0].id},r={row:n||e,column:i[i.length-1].id};o.column&&r.column&&_t(o,r,t)}function gt(e){var t=e.$$("cells").data.order,n=e.$$("cells").config.columns,i="rowId"==n[0].id?1:0,o={row:t[0],column:n[i].id},r={row:t[t.length-1],column:n[n.length-1].id};o.column&&r.column&&_t(o,r,e)}function mt(e,t,n){var i=t.$$("cells").data.order;_t({row:i[0],column:e},{row:i[i.length-1],column:n||e},t)}function wt(e,t){var n=t.$$("cells").getSelectArea();return!!(n&&e>=n.start.column&&e<=n.end.column)}function pt(e,t,n){return bt(e,n)&&wt(t,n)}function bt(e,t){var n=t.$$("cells").getSelectArea();return!!(n&&e>=n.start.row&&e<=n.end.row)}function xt(e,t){var n=t.$$("cells").getSelectArea();n?mt(Math.min(n.start.column,n.end.column,e),t,Math.max(n.start.column,n.end.column,e)):mt(e,t)}function _t(e,t,n){n.$$("cells").addSelectArea(e,t)}function yt(a,l){var s=25,c=l._table.getColumnConfig(a).width;l._table.eachRow(function(e){var t=l._table.getSpan(e,a);if(!(t&&1<t[2])){var n=this.getText(e,a),i=l.getStyle(e,a),o=i?i.id:"";if(n.replace(/<\/?[^>]+(>|$)/g,"")){var r=J(l,n,o);(l.getCellEditor(e,a)||l.getCellFilter(e,a))&&(r.width+=20),i&&"wrap"==i.props.wrap&&r.width>c&&(r.width=c),r.width>s&&(s=r.width)}}}),l._table.setColumnWidth(a,s)}function Ct(l,s){var c=25;s._table.eachColumn(function(e){if("rowId"!=e){var t=this.getText(l,e),n=this.getColumnConfig(e).width,i=s._table.getSpan(l,e);i&&(n=s._table.getSpanNode({row:i[0],column:i[1]}).offsetWidth);var o=s.getStyle(l,e),r=o?o.id:"";if(t.replace(/<\/?[^>]+(>|$)/g,"")){var a=J(s,t,r,n);a.height>c&&(c=a.height)}}}),s._table.setRowHeight(l,c)}function $t(e,t,n){if(n._table.config.header){var i="webix_highlight",o=e.row,r=t.row,a=e.column,l=t.column;if(r<o){var s=[r,o];o=s[0],r=s[1]}if(l<a){var c=[l,a];a=c[0],l=c[1]}n._table.eachRow(function(e){e<o||r<e?n._table.removeCellCss(e,"rowId",i):n._table.addCellCss(e,"rowId",i)}),n._table.eachColumn(function(e){var t=n._table.getHeaderNode(e);"rowId"!=e&&t&&(e<a||l<e?webix.html.removeCss(t,i):webix.html.addCss(t,i,!0))})}}var St=Object.freeze({selectRow:vt,selectAll:gt,selectColumn:mt,isColSelected:wt,isCellSelected:pt,isRowSelected:bt,selectColumns:xt,adjustColumn:yt,adjustRow:Ct,highlightColRow:$t});function kt(e,t){e.attachEvent("onComponentInit",function(){return function d(o){var r,n,a=o._table,e=webix.event(document.body,"mousemove",function(e){clearTimeout(t),t=webix.delay(function(e){if(!o.comments._activeComment.editStatus){var t=a.locate(e),n=o.comments.commentsView&&o.comments.commentsView.isVisible();if(t&&o.comments.get(t.row,t.column)){var i=o.comments._activeComment.cell;(!i||i.row==t.row&&i.column==t.column
)&&n||o.callEvent("onCommand",[{id:"add-comment",cell:t,viewonly:!0}])}else n&&!o.comments.commentsView.$view.contains(e.target)&&o.callEvent("onCommentHide",[])}},!0,[e],250)});var t;o.config.math&&(a.config.editMath=!0);function i(){var e=a.getSelectedId(!0);if(e.length){var t=e[0],n=e[e.length-1]?e[e.length-1]:e[0];$t(t,n,o)}else{var i={row:0,column:0};$t(i,i,o)}}a.attachEvent("onBeforeEditStop",function(e,t){e.old===webix.undefined&&""===e.value||(e.value!=e.old&&(o.setCellValue(t.row,t.column,e.value),a.refresh()),e.value=e.old)}),a.attachEvent("onEnter",function(e){a.getEditor()&&webix.delay(function(){a.moveSelection("down")}),webix.html.preventEvent(e)}),o.attachEvent("onBeforeEditStart",function(e,t){return!o.isCellLocked(e,t)}),a.attachEvent("onBeforeEditStart",function(e){return o.callEvent("onBeforeEditStart",[e.row,e.column])}),a.attachEvent("onBeforeSelect",function(e){return"rowId"!=e.column}),a.attachEvent("onBeforeBlockSelect",function(e,t,n){return!n||"rowId"===e.column&&"rowId"===t.column||("rowId"===e.column&&(e.column=1),"rowId"===t.column&&(t.column=1)),("rowId"!==e.column||"rowId"!==t.column)&&($t(e,t,o),!0)}),a.attachEvent("onSelectChange",function(){return i()}),a.attachEvent("onAfterColumnShow",function(){webix.delay(function(){return i()})}),a.attachEvent("onColumnResize",function(){webix.delay(function(){return i()})}),webix.event(a.$view.firstChild,"mousedown",function(e){var t=a.config.resizeColumn,n=a.locate(e);if(n&&n.cind){if(t){var i=a.getColumnConfig(n.column).width,o=webix.html.posRelative(e);if(o.x<t.size||i-o.x<t.size+1)return}r=n.cind}}),webix.event(a.$view.firstChild,"mousemove",function(e){if(r){var t=a.locate(e);t&&(n=t.cind,$t({column:a.columnId(r)},{column:a.columnId(n||1)},o))}});var l=webix.event(document.body,"mouseup",function(){r&&(null!=n&&(mt(a.columnId(r),o,a.columnId(n||1)),n=null),r=null)});a.attachEvent("onItemDblClick",function(e){"rowId"===e.column&&Ct(e.row,o)});var s=0;a.attachEvent("onHeaderClick",function(e,t){if("rowId"!=e.column){var n=new Date,i=n-s<=300;i?yt(e.column,o):(s=n,t.shiftKey?xt(e.column,o):mt(e.column,o))}else gt(o)});var c=null;a.attachEvent("onItemClick",function(e,t){"rowId"===e.column&&(t.shiftKey&&c?vt(c,o,e.row):vt(e.row,o),c=e.row)}),o.attachEvent("onReset",function(){return Vt(o)}),o.attachEvent("onBeforeSheetShow",function(){return a.editStop()}),a.attachEvent("onBlur",function(){webix.delay(function(){var e=document.activeElement;if(!e||"INPUT"!=e.tagName){var t=webix.UIManager.getFocus(),n=t&&t!=a&&t.getTopParentView&&t.getTopParentView()===o;n&&webix.UIManager.setFocus(a)}},this,[],100)}),function u(e){webix.html.addStyle("#"+e._table.$view.id+".webix_dtable .webix_cell { white-space:nowrap;}")}(o),o.attachEvent("onDestruct",function(){webix.eventRemove(e),webix.eventRemove(l)})}(e)});var n={view:"datatable",id:"cells",css:"webix_ssheet_table webix_data_border wss_"+e.$index,headerRowHeight:"contrast"==webix.skin.$name||"flat"==webix.skin.$name?24:20,spans:!0,leftSplit:1,areaselect:!0,minColumnWidth:38,editable:!0,editaction:t.liveEditor?"custom":"dblclick",minRowHeight:1,navigation:!0};return!1!==t.clipboard&&(t.clipboard="custom",t.clipboardDecimalDelimiter&&(t.templateCopy=function(e){return webix.rules.isNumber(e)&&(e=e.toString().replace(".",t.clipboardDecimalDelimiter)),e})),t&&(n=webix.extend(n,t,!0)),n}function Et(e,t,n,i,o,r){var a=o.id,l=t.id,s="",c=""===i||isNaN(i),u=Ne(e,l,a),d=Ue(u,"date")&&Te(i),h="";if(r||(h+=e.comments.get(l,a)?"<div class='ssheet_commented_sign'></div>":"",h+=e.getCellFilter(l,a)?"<div class='ssheet_filter_sign'></div>":""),!d&&(!c||Ue(u,"string")))if(u){var f={css:""},v=ve(u);if(v){var g=v(i,f);g!=webix.i18n.spreadsheet.table["format-error"]?(f.css&&(s='class="'.concat(f.css,'"')),i=g):c||(i*=1)}}else i*=1;return e._print&&!i&&0!==i?"":((webix.isUndefined(i)||null===i)&&(i=""),"<div ".concat(s,">").concat(i,"</div>").concat(e._print?"":h))}function Vt(o){var e=o.$$("cells");e.clearAll();for(var t=o.config.columnCount,n=o.config.rowCount,i=[{id:"rowId",header:"",width:40,css:"sheet_column_0",
template:function(e){return e.id}}],r=1;r<=t;r++)i.push({id:r,editor:"text",header:{text:$[r]},template:function(e,t,n,i){return Et(o,e,0,n,i)}}),o.callEvent("onColumnInit",[i[r]]);e.refreshColumns(i);for(var a=[],l=1;l<=n;l++)a.push({id:l});e.parse(a)}function At(i){var o=i.$$("cells"),e=webix.env.isMac?"command":"ctrl";if(webix.UIManager.addHotKey(e+"-a",function(){o.getEditor()||gt(i)},o),!i.config.readonly){webix.UIManager.addHotKey("any",function(e,t){if(16!=(t.which||t.keyCode)){var n=e.getSelectedId(!0);n.length&&(o.$anyKey=!0,o.edit(n[0]))}},o),webix.UIManager.addHotKey("enter",function(e){var t=e.getSelectedId(!0);t.length&&(e.config.liveEditor?o.callEvent("onBeforeLiveEditor",[t[0]]):o.edit(t[0]))},o),webix.UIManager.addHotKey("backspace",function(){return zt(i)},o),webix.UIManager.addHotKey("delete",function(){return zt(i)},o);var t=webix.env.isMac?"command-shift-z":"ctrl-y";webix.UIManager.addHotKey(t,function(){return i.redo()},o),webix.UIManager.addHotKey(e+"-z",function(){return i.undo()},o),webix.UIManager.addHotKey(e+"-b",function(){return It(i,"font-weight")},o),webix.UIManager.addHotKey(e+"-i",function(){return It(i,"font-style")},o),webix.UIManager.addHotKey(e+"-u",function(e,t){return function n(e,t){return It(e,"text-decoration"),webix.html.preventEvent(t)}(i,t)},o),webix.UIManager.addHotKey(e+"-p",function(e,t){return function n(e,t){return e.callEvent("onCommand",[{id:"print"}]),webix.html.preventEvent(t)}(i,t)},o)}}function zt(t){g.set(function(){t.eachSelectedCell(function(e){return t.setCellValue(e.row,e.column,"")}),t.refresh()})}function It(e,t){var n=e.getSelectedId();if(n){var i=e.getStyle(n.row,n.column),o=at[t],r=i&&i.props[t]===o?"normal":o;e.callEvent("onStyleSet",[t,r])}}var Rt=Object.freeze({SUM:function ea(){for(var e=0,t=a(arguments),n=0;n<t.length;n++){var i=s(t[n]);!1!==i&&(e+=i)}return e},AVERAGE:function ta(){for(var e=0,t=0,n=a(arguments),i=0;i<n.length;i++){var o=s(n[i]);!1!==o&&(e+=o,t++)}return e/t},COUNT:function na(){for(var e=0,t=a(arguments),n=0;n<t.length;n++)!1!==s(t[n])&&e++;return e},COUNTA:function ia(){for(var e=0,t=a(arguments),n=0;n<t.length;n++)t[n]&&1*t[n]!=0&&e++;return e},COUNTBLANK:function oa(){for(var e=0,t=a(arguments),n=0;n<t.length;n++)1*!t[n]&&e++;return e},MAX:function ra(){for(var e="",t=a(arguments),n=0;n<t.length;n++){var i=s(t[n]);!1!==i&&(e<i||""===e)&&(e=i)}return e||0},MIN:function aa(){for(var e="",t=a(arguments),n=0;n<t.length;n++){var i=s(t[n]);!1!==i&&(i<e||""===e)&&(e=i)}return e||0},PRODUCT:function la(){for(var e="",t=a(arguments),n=0;n<t.length;n++){var i=s(t[n]);!1!==i&&(e=""===e?i:e*i)}return e},SUMPRODUCT:function sa(e){var t=e[0].length;for(var n in e)if(e[n].length!==t)return;for(var i=0,o=0;o<e[0].length;o++){var r="";for(var a in e){var l=s(e[a][o]);if(!1===l){r=0;break}r=""===r?l:r*l}webix.isUndefined(r)||(i+=r)}return i},SUMSQ:function ca(){for(var e=0,t=a(arguments),n=0;n<t.length;n++){var i=s(t[n]);"number"==typeof i&&(e+=Math.pow(i,2))}return e},VARP:function ua(){for(var e=a(arguments),t=this.COUNT(e),n=this.AVERAGE(e),i=0,o=0;o<e.length;o++){var r=s(e[o]);!1!==r&&(i+=Math.pow(r-n,2))}return i/t},STDEVP:function da(){var e=a(arguments);return Math.sqrt(this.VARP(e))},POWER:function ha(e,t){var n=s(e),i=s(t);if("number"==typeof n&&"number"==typeof i)return Math.pow(n,i)},QUOTIENT:function fa(e,t){var n=s(e),i=s(t);if("number"==typeof n&&"number"==typeof i)return n/i},SQRT:function va(e){var t=s(e);if(!1!==t&&0<=t)return Math.sqrt(t)},ABS:function ga(e){var t=s(e);if(!1!==t)return Math.abs(t)},RAND:function ma(){return Math.random()},PI:function wa(){return Math.PI},INT:function pa(e){var t=s(e);if(!1!==t)return Math.round(t)},ROUND:function ba(e,t){var n=s(e),i=s(t)||0;if(!1!==n)return parseFloat(n.toFixed(i))},ROUNDDOWN:function xa(e,t){var n=s(e),i=s(t)||0;if(!1!==n)return Math.floor(n*Math.pow(10,i))/Math.pow(10,i)},ROUNDUP:function _a(e,t){var n=s(e),i=s(t)||0;if(!1!==n)return Math.ceil(n*Math.pow(10,i))/Math.pow(10,i)},TRUNC:function ya(e){var t=s(e);if(!1!==t)return parseInt(t)},EVEN:function Ca(e){var t=s(e);if(!1!==t
){var n=Math.round(t);return n%2?n+1:n}},ODD:function $a(e){var t=s(e);if(!1!==t){var n=Math.round(t);return n%2?n:n+1}}});var Dt=Object.freeze({CONCATENATE:function Sa(){var e=Array.prototype.slice.call(arguments);return(e=e.map(function(e){return"object"===p(e)?e.join(""):e})).join("")},LEFT:function ka(e,t){return e?e.substring(0,t):""},MID:function Ea(e,t,n){return e?e.substring(t,t+n):""},RIGHT:function Va(e,t){return e?e.substring(e.length-t):""},LOWER:function Aa(e){return e?e.toLowerCase():""},UPPER:function za(e){return e?e.toUpperCase():""},PROPER:function Ia(e){if(!e)return"";var t=e.toLowerCase().split(" ");for(var n in e="",t)e+=(e?" ":"")+t[n].substring(0,1).toUpperCase()+t[n].substring(1);return e},TRIM:function Ra(e){return e?e.trim():""},LEN:function Da(e){return e||0===e?e.toString().length:0}});var Ot=Object.freeze({DATE:function Oa(e,t,n){return o(new Date(e,t-1,n))},TIME:function Fa(e,t,n){return o(new Date(1900,0,1,e,t,n))},DAY:function Ma(e){return w(e).getDate()},MONTH:function Ua(e){return w(e).getMonth()+1},YEAR:function Na(e){return w(e).getFullYear()},NOW:function Ta(){return o(new Date)},DATEDIF:function ja(e,t,n){switch("D"!=n&&(e=w(e),t=w(t)),n){case"Y":return t.getFullYear()-e.getFullYear();case"M":return 12*(t.getFullYear()-e.getFullYear())+t.getMonth()-e.getMonth();case"D":return Math.floor(t-e);case"MD":var i=t.getDate()-e.getDate();if(i<0){var o=new Date(e.getFullYear(),e.getMonth()+1,0).getDate();return t.getDate()+o-e.getDate()}return i;case"YM":var r=t.getMonth()-e.getMonth();return r<0?12+r:r;case"YD":var a=l(t)-l(e);return a<0?365+a:a}}});var Ft=Object.freeze({IMAGE:function Ba(e){return'<img class="webix_ssheet_cimage" src="'.concat(webix.template.escape(e),'">')},SPARKLINE:function Pa(e,t,n,i){var o,r={type:t,color:n,negativeColor:i},a="pie"==t?60:150;for(o=0;o<e.length;o++)e[o]=e[o]||0;return webix.Sparklines.getTemplate(r)(e,{width:a,height:35})},HYPERLINK:function Ha(e,t){return t=t||e,'<a target="_blank" rel="noopener noreferrer" href="'.concat(webix.template.escape(e),'">').concat(webix.template.escape(t),"</a>")},IF:function La(e,t,n){return e?t:n}}),Mt={};function Ut(e,t,n,i){i=o(i),e.setCellValue(t,n,i)}function Nt(e){var t=e?"number":null;return Ue(e,"string")?t="string":Ue(e,"date")&&(t="date"),t}function Tt(e,t,n){var i=e.getRow(t).$cellType;if(i&&i[n])return i[n]}function jt(e,t,n,i,o,r){e._setType=!0;var a=e.getCellValue(t,n),l="string"==typeof a&&"="==a[0],s=!(r&&"date"!=i||e._loading_data&&"date"!=o),c=l&&!i?function f(e,t){for(var n,i=0,o=e.ranges._ranges,r=Ze(t,!0,o),a=0;a<r.length;a++)if(a%2==0){var l=r[a].match(/(([a-zA-Z]*\()|\))(?=(?:[^"]|"[^"]*")*$)/g);l&&l.forEach(function(e){-1<e.indexOf("(")?(i++,n||/^(SUM|AVERAGE|MAX|MIN|INT|ROUND|ROUNDDOWN|ROUNDUP|TRUNC)?\($/gi.test(e)||(n=i)):--i<n&&(n=null)})}else if(!n){if(webix.isArray(r[a])){if(r[a][0]!=e.getActiveSheet())continue;r[a]=r[a][1]}var s=/^[A-Za-z]+$/.test(r[a])?qe(o[r[a]].split(":")[0]):qe(r[a]),c=Ne(e,s[0],s[1]);if(c)return{fmt:ge(c)}}}(e,a):null,u=Nt(i||c),d=function v(e,t,n,i,o,r,a,l){var s="string";if(!webix.isUndefined(i))if(r)s="number",/^=(now|date|time)\(/i.test(i)?s="date":/^=(sparkline|image)\(/i.test(i)&&(s="string");else if(isNaN(i)){if("string"!=a&&o){var c=webix.Date.strToDate(webix.i18n.spreadsheet.formats.parseDateTime);""==(i=c(i))||isNaN(i)||(l?Ut(e,t,n,i):e.ignoreUndo(function(){return Ut(e,t,n,i)}),s="date")}}else s="number";return s}(e,t,n,a,s,l,u,r);(function g(e,t,n,i,o,r,a){var l=e.getCellValue(t,n),s="string"==typeof l&&"="==l[0],c=e.getCellEditor(t,n);if(a)e.setFormat(t,n,a.fmt);else if("date"==i){if("date"!=r){var u=s&&0==l.toUpperCase().indexOf("=TIME("),d=webix.i18n.spreadsheet.formats,h=u?d.timeFormat:d.dateFormat;e.setFormat(t,n,h)}s||c||e.setCellEditor(t,n,{editor:"excel_date"})}else"string"!=r&&"string"==i&&"string"!=o&&e.setFormat(t,n,"@");("date"!=i||s)&&c&&"excel_date"==c.editor&&e.setCellEditor(t,n,null)})(e,t,n,o=function m(e,t,n,i,o){return e=e||t,"string"==t?e="string":n&&(e=n),"date"==e&&!i&&Te(o)&&(e="number"),e}(o,d,u,l,a),d,u,c);var h=e.getRow(t)
;h.$cellType||(h.$cellType={}),h.$cellType[n]=o,delete e._setType}webix.extend(Mt,Rt),webix.extend(Mt,Dt),webix.extend(Mt,Ot),webix.extend(Mt,Ft);var Bt=Object.freeze({init:function Wa(e){e.attachEvent("onCellChange",function(e,t,n,i){this._setType||jt(this,e,t,Ne(this,e,t),i)}),e.attachEvent("onBeforeFormatChange",function(e,t,n){this._setType||jt(this,e,t,n,null,!0)}),e.attachEvent("onAction",function(e,t){"dropdown"==e&&t.newValue&&"excel_date"==t.newValue.editor&&"date"!=Nt(Ne(this,t.row,t.column))&&this.setFormat(t.row,t.column,webix.i18n.spreadsheet.formats.dateFormat)})},getType:Tt}),Pt=[];for(var Ht in Mt)"__esModule"!=Ht&&Pt.push(Ht);function Lt(t){return t.attachEvent("onComponentInit",function(){return function e(c){var u=c.$$("liveEditor");function n(e,t){var n=u.config.activeCell;n&&n.row==e&&n.column==t&&o({row:e,column:t})}function i(e,t,n){return!(!c.getCellEditor(t.row,t.column)&&o(t,n))||(u.focus(),n||u.paintValue(),!1)}function r(e,t){var n=c.getCellEditor(e,t)||c.isCellLocked(e,t);return n?u.disable():u.enable(),n}function o(e,t){var n=r(e.row,e.column);return u.config.activeCell=e,u.setValue(t?"":function o(e,t){var n=c.getCellValue(e,t);if("date"==Tt(c,e,t)&&"="!=n[0]){var i=je(c.getRow(e),t);n=i(w(n))}return n}(e.row,e.column)),c.$handleSelection=n?null:function(e,t,n,i){return a(n,i,e)},!n}function a(e,t,n){var i=u.getInputNode().selectionStart,o="";if(u._activeMath){var r=c.getActiveSheet();u._activeMath!=r&&(o=u.prepareSheet(r))}var a=e==t?o+e:"".concat(o+e,":").concat(o+t),l=u._update_range;if(l&&l.pos==i-l.len)u.setRange(a,!0),i=u._update_range.pos+a.length;else{if(!u.expectOperator())return function s(e){u.isEnabled()&&(u.showActiveSheet(),u.updateCellValue(),u.setValue(e?c.getCellValue(e.row,e.column):""));return!0}(n);u.setRange(a),i+=a.length}return u.focus(),u.getInputNode().setSelectionRange(i,i),u.paintValue(),!1}function l(){u.define({activeCell:null}),u.setValue(""),u.disable()}c._table.attachEvent("onBeforeEditStart",function(e){var t=c._table.$anyKey;return c._table.$anyKey=!1,i(this,e,t)}),c._table.attachEvent("onBeforeLiveEditor",function(e){return i(this,e,!1)}),c._table.attachEvent("onItemDblClick",function(e){c.getCellEditor(e.row,e.column)&&this.edit(e),u.focus()}),c._table.attachEvent("onAfterScroll",function(){u.$view.contains(document.activeElement)&&u.paintValue()}),c.attachEvent("onCellChange",function(e,t,n){var i=u.config.activeCell;i&&i.row==e&&i.column==t&&u.setValue(n)}),c.attachEvent("onAfterSelect",function(e){if(!c.$handleSelection){var t=e[0];o(t)}}),c.attachEvent("onChange",function(e){if("update"==e&&u.isEnabled()){var t=u.config.activeCell;t&&u.getValue()!=c.getCellValue(t.row,t.column)&&(delete u._update_range,u.showActiveSheet(),u.updateCellValue())}}),c.attachEvent("onBeforeSheetShow",function(t){var e=u.config.activeCell;if(e){var n=u.getInputNode().selectionStart,i=u.getValue();c.getCellValue(e.row,e.column)!=i?(u._activeMath||(u._activeMath=c.getActiveSheet()),webix.delay(function(){if(t==u._activeMath){c.$handleSelection=null;var e=u.config.activeCell;c._table.select(e.row,e.column)}u.setValue(i),u.refresh(),u.focus(),u.getInputNode().setSelectionRange(n,n),u.paintValue(),c.$handleSelection=function(e,t,n,i){return a(n,i,e)}})):l()}}),c.attachEvent("onReset",function(){return c.$handleSelection=null}),c.attachEvent("onAfterLoad",function(){return l()}),c.attachEvent("onAction",function(e,t){var n=u.config.activeCell,i=n&&n.row==t.row&&n.column==t.column;!i||"lock"!=e&&"dropdown"!=e||r(t.row,t.column)}),c.attachEvent("onFormatChange",function(e,t){return n(e,t)}),c.attachEvent("onCellChange",function(e,t){return n(e,t)})}(t)}),{view:"toolbar",css:"webix_ssheet_toolbar",elements:[{view:"label",label:webix.i18n.spreadsheet.liveEditor.edit,width:60},{view:"live-editor",disabled:!0,id:"liveEditor",suggestData:Pt}]}}function Wt(e,t){return e[qt(e,t)]}function qt(e,t){for(var n=-1,i=0;n<0&&i<e.length;i++)t(e[i])&&(n=i);return n}function Kt(e,t,n,i){for(var o=0;o<e.length;o++){var r=e[o];r[0]>n&&(n=r[0]),r[1]>i&&(i=r[1])}if(t)for(var a=0;a<t.length;a++){
var l=t[a][0]+t[a][3]-1,s=t[a][1]+t[a][2]-1;n<l&&(n=l),i<s&&(i=s)}return[1*n,1*i]}var Yt=["rename-sheet","remove-sheet"],Gt={"remove-sheet":function(e){e.confirm({text:webix.i18n.spreadsheet.labels["sheet-remove-confirm"]}).then(function(){tn(e,e._activeSheet)})},"rename-sheet":function(e){en(e,e._activeSheet)},"new-sheet":function(e){Jt(e)},"copy-sheet":function(e){!function t(e){Jt(e,e.serialize())}(e)}};function Zt(t){t.attachEvent("onComponentInit",function(){return function e(t){on(t),t.$$("add-sheet")&&t.$$("add-sheet").attachEvent("onItemClick",function(){Jt(t)});t.attachEvent("onAfterSheetShow",function(e){return function n(e,t){e.$$("sheets")&&(e.$$("sheets").select(t),e.$$("sheets").showItem(t))}(t,e)}),t.attachEvent("onCommand",function(e){Gt[e.id]&&Gt[e.id](this)}),t.$$("sheets")&&(t.$$("sheets").data.attachEvent("onStoreUpdated",function(){return function i(e){var t=e.$$("bottom-toolbar"),n=e.$$("sheets");n.count()<=n.config.width/e.config.sheetTabWidth?t.showBatch("pager",!1):t.showBatch("pager")}(t)}),t.$$("sheets").attachEvent("onAfterScroll",function(){return function o(e){var t=e.$$("sheets"),n=t.getScrollState().x;if(0==n)e.$$("prev-sheet").disable();else{e.$$("prev-sheet").enable();var i=e.config.sheetTabWidth;if(n==(t.count()-t.config.width/i)*i)return void e.$$("next-sheet").disable()}e.$$("next-sheet").enable()}(t)}),t.$$("sheets").attachEvent("onAfterDrop",function(e){return function r(e,t,n){for(var i in e._sheets)if(e._sheets[i].name==t){var o=e._sheets.splice(i,1);e._sheets.splice(n,0,o[0]);break}}(t,e.start,e.index)}),t.$$("sheets").attachEvent("onAfterEditStop",function(e){return nn(t,e.old,e.value)}))}(t)})}function Xt(n){var t=n.config.readonly,e=n.config.sheetTabWidth,i={view:"toolbar",id:"bottom-toolbar",css:"webix_ssheet_bottom_toolbar webix_layout_toolbar",paddingY:0,height:34,elements:[{view:"button",type:"htmlbutton",width:34,id:"add-sheet",label:"<span class='webix_ssheet_icon_add_sheet'></span>",tooltip:webix.i18n.spreadsheet.tooltips["add-sheet"]||"",hidden:t},{id:"sheets",view:"sheets",width:5*e,editable:!t,editaction:"dblclick",editor:"text",editValue:"value",type:{width:e,height:32,template:function(e){return"<div>"+e.value+"</div>"+(t?"":"<div class='webix_input_icon wxi-menu-down webix_ssheet_sheet_arrow'></div>")},css:"ssheet_order_sheets"},onClick:{webix_ssheet_sheet_arrow:function(e,t){!function i(t,e,n){t.$sheetMenu||(t.$sheetMenu=webix.ui(function o(e){for(var t=[],n=0;n<Yt.length;n++)t.push({id:Yt[n],value:webix.i18n.spreadsheet.menus[Yt[n]]||Yt[n]});var i={view:"ssheet-suggest",data:t};return e.callEvent("onViewInit",["sheet-menu",i]),i}(t)),t._destroy_with_me.push(t.$sheetMenu),t.$sheetMenu.attachEvent("onItemClick",function(e){return function n(e,t){e.$sheetMenu.data.getMark(t,"webix_disabled")||Gt[t](e)}(t,e)}));t.$sheetMenu.getItem("remove-sheet")&&(1==t.$$("sheets").count()?t.$sheetMenu.disableItem("remove-sheet"):t.$sheetMenu.enableItem("remove-sheet"));t.callEvent("onBeforeSheetMenu",[n])&&t.$sheetMenu.show(e)}(n,e,t)}},on:{onItemClick:function(e){e!=n._activeSheet&&n.showSheet(e)}}},{view:"button",type:"htmlbutton",width:34,id:"prev-sheet",disabled:!0,hidden:!0,label:"<span class='webix_icon wxi-menu-left'></span>",batch:"pager",click:function(){Qt(n,-1)}},{view:"button",type:"htmlbutton",width:34,id:"next-sheet",hidden:!0,label:"<span class='webix_icon wxi-menu-right'></span>",batch:"pager",click:function(){Qt(n,1)}}]};return n.callEvent("onViewInit",["bottom-toolbar",i]),i}function Qt(e,t){var n=e.$$("sheets");n.scrollTo(n.getScrollState().x+t*e.config.sheetTabWidth,0)}function Jt(t,e){var n,i,o;return o=-1<(n=qt(t._sheets,function(e){return e.name==t._activeSheet}))?n+1:t._sheets.length,i=function r(e){var t=e._sheets.length+1;for(;ln(e,webix.i18n.spreadsheet.labels.sheet+t);)t++;return webix.i18n.spreadsheet.labels.sheet+t}(t),e=e||{data:[]},t._sheets.splice(o,0,{name:i,content:e}),t.$$("sheets").add({id:i,value:i},o),t.showSheet(i),t.callEvent("onSheetAdd",[i]),i}function en(e,t){e.$$("sheets").edit(t)}function tn(e,t){var n,i;1<e._sheets.length&&(n=qt(
e._sheets,function(e){return e.name==t}),e._sheets.splice(n,1),e._sheets[n]||(n=0),i=e._sheets[n],e._activeSheet=null,e.$$("sheets")&&(e.$$("sheets").remove(t),e.$$("sheets").refresh()),e.showSheet(i.name),e.callEvent("onSheetRemove",[t]))}function nn(e,t,n){if(t!=n){for(var i=1;!n||ln(e,n);)n=webix.i18n.spreadsheet.labels.sheet+i,i++;n=n.replace(/[*?:[\]\\/]/g,"").substring(0,31);var o=ln(e,t),r=e.$$("sheets");if(o.name=n,e._activeSheet==t&&(e._activeSheet=n),r)r.getItem(t).value=n,r.data.changeId(t,n),r.refresh(n);e.callEvent("onSheetRename",[t,n])}}function on(e,t){t||(t={data:[]}),t.sheets||(t=rn(t));var n=t.sheets[0].name;e._activeSheet="",e._sheets=t.sheets,function o(e,t){var n=e.$$("sheets");if(n){n.clearAll();var i=[];t.sheets.forEach(function(e){i.push({id:e.name,value:e.name})}),n.parse(i)}}(e,t),an(e,n)}function rn(e){return{sheets:[{name:webix.i18n.spreadsheet.labels.sheet+1,content:e}]}}function an(e,t){t!=e._activeSheet&&(e.callEvent("onBeforeSheetShow",[t])&&(e._activeSheet&&(ln(e,e._activeSheet).content=e.serialize()),e._activeSheet=t,cn(e,ln(e,t).content),e.callEvent("onAfterSheetShow",[t])))}function ln(e,t){return Wt(e._sheets,function(e){return e.name==t})}function sn(e){return e._activeSheet}function cn(e,t){var n=k(Kt(t.data,t.spans,e.config.rowCount,e.config.columnCount),2),i=n[0],o=n[1];e.callEvent("onReset",[]),i==e.config.rowCount&&o==e.config.columnCount||(e.config.rowCount=i,e.config.columnCount=o,e._resetTable()),e._loading_data=!0,e.callEvent("onDataParse",[t]),e._loading_data=!1,e._table.refresh(),e.config.bottombar&&e.$$("sheets").refresh()}var un=function(){function t(e){i(this,t),this.view=e}return c(t,[{key:"$init",value:function(){}},{key:"$show",value:function(){}},{key:"$hide",value:function(){}},{key:"open",value:function(){var e=this;this.$dialog||(this.$dialog=webix.ui(this.$init()),this.view._destroy_with_me.push(this.$dialog),this.$dialog.attachEvent("onHide",function(){e.$hide(),webix.UIManager.setFocus(e.view)}),this.$dialog.attachEvent("onShow",function(){webix.UIManager.setFocus(e.$dialog)}));var t=this.$dialog.getBody();this.$dialog.show(),!1===this.$show(this.$dialog,t)&&this.close()}},{key:"close",value:function(){this.$dialog.hide()}}]),t}();function dn(e){return e?('"'===(e=e.trim())[0]&&(e=e.substr(1)),'"'===e[e.length-1]&&(e=e.substr(0,e.length-1)),e):""}var hn=function(e){function t(){return i(this,t),v(this,h(t).apply(this,arguments))}return d(t,un),c(t,[{key:"$show",value:function(e,t){if(this.cell=this.view.getSelectedId(),!this.cell)return!1;t.elements.preview.setHTML(""),t.elements.url.setValue("");var n=function i(e){if(e&&0===e.indexOf("=IMAGE("))return{url:dn(e.substr(7,e.length-8))}}(this.view.getCellValue(this.cell.row,this.cell.column));n&&n.url&&t.elements.url.setValue(n.url),t.elements.url.focus()}},{key:"$init",value:function(){var t=this,e=this.view.config.save,n=e&&e.images||null;return{view:"ssheet-dialog",head:webix.i18n.spreadsheet.labels["image-title"],move:!0,position:"center",body:{view:"form",elements:[{view:"text",name:"url",placeholder:webix.i18n.spreadsheet.labels["image-url"],on:{onChange:function(e){return t.showPreview(e)}}},{view:"label",label:webix.i18n.spreadsheet.labels["image-or"],align:"center"},{view:"uploader",label:webix.i18n.spreadsheet.labels["image-upload"],upload:n,on:{onBeforeFileAdd:function(e){var t=this;if(!this.config.upload){var n=new FileReader;return n.onload=function(e){return t.getFormView().elements.url.setValue(e.target.result)},n.readAsDataURL(e.file),!1}this.getFormView().elements.preview.setHTML("")},onFileUpload:function(e,t){this.getFormView().elements.url.setValue(t.imageURL)}}},{view:"formlate",name:"preview",borderless:!0,css:"webix_ssheet_preview",template:"",height:50}]},on:{onSaveClick:function(){return t.okClick()},onCancelClick:function(){return t.close()}}}}},{key:"okClick",value:function(){var e=this.cell,t=this.fillUrl(this.$dialog.getBody().elements.url.getValue());this.view.addImage(e.row,e.column,t),this.close()}},{key:"fillUrl",value:function(e){return/^[/]|((https?:\/|data:image)\/)/i.test(e
)||(e="http://"+e),e}},{key:"showPreview",value:function(e){e&&(e=webix.template.escape(this.fillUrl(e)),this.$dialog.queryView("form").elements.preview.setHTML("<img class='webix_ssheet_cimage' src='"+e+"'></img>"))}}]),t}(),fn=Object.freeze({action:"add-image-cell",DialogBox:hn}),vn=function(e){function t(){return i(this,t),v(this,h(t).apply(this,arguments))}return d(t,hn),c(t,[{key:"open",value:function(e){this.config=e.config,this.viewid=e.viewid,this.view.callEvent("onUIEditStart",[this.viewid,"image"]),hn.prototype.open.apply(this,arguments)}},{key:"$hide",value:function(){this.view.callEvent("onUIEditStop",[this.viewid,"image"]),this.config=this.viewid=null}},{key:"$init",value:function(){var n=this;return this.view.attachEvent("onUIEditStart",function(e,t){n.$dialog&&n.$dialog.isVisible()&&"image"!=t&&n.close()}),this.view.attachEvent("onCommand",function(e){"close-ui-editor"==e.id&&n.$dialog&&n.$dialog.isVisible()&&n.close()}),hn.prototype.$init.apply(this,arguments)}},{key:"$show",value:function(e,t){t.elements.preview.setHTML(""),t.elements.url.setValue(""),this.config&&this.config.data&&t.elements.url.setValue(this.config.data),t.elements.url.focus()}},{key:"okClick",value:function(){var e=this.fillUrl(this.$dialog.getBody().elements.url.getValue());if(this.viewid)this.view.views.update(this.viewid,e);else{var t=this.view.views.add(null,null,"image",e);this.view.views.highlight(t)}this.close()}}]),t}(),gn=Object.freeze({action:"add-image-top",DialogBox:vn}),mn={},wn={};function pn(e,t,n){var i=function S(e,t){var n,i,o,r,a,l=2<arguments.length&&arguments[2]!==undefined?arguments[2]:"",s="return ",c=[],u=!1,d="",h="";if("="!=e[0])return!1;for(var f=1;f<e.length;f++){var v=e[f];if('"'==v)u=!u;else{if("{"==v&&"{"==e[f+1]){var g=k(He(e,f+2),2),m=g[0];f=g[1]+1,s+="this.p.".concat(m);continue}if(!u&&("'"==v||Pe(v))){var w=k(He(e,f,l),4),p=w[0],b=w[1],x=w[2],_=w[3],y=p.toUpperCase();if(f=b-1,"#"==y[0]){s+=Ke(y);break}if("("==e[f+1])s+="this.m.".concat(y);else if(We(y))if(":"==e[f+1])d=y,h=_,f++;else if(""!==d)s+=Ge(c,d,y,h),d="";else{var C=(n=c,i=_,o=k(qe(y),2),r=o[0],a=o[1],""!==i?(n.push([r,a,r,a,i]),'this.vs("'.concat(i,'",').concat(r,",").concat(a,")")):(n.push([r,a,r,a,""]),"this.v(".concat(r,",").concat(a,")")));"+"==e[b]?s+="(isNaN(".concat(C," * 1) ? ").concat(C," : ").concat(C," * 1)"):s+=C}else{var $=Ye(c,t,y,_);if(""==$){s+=Ke("#REF!");break}s+=$}y!==p&&(e=e.substr(0,x)+y+e.substr(b));continue}}u?s+=v:"&"===v&&"&"!==e[f+1]?s+='+""+':"<"===v&&">"===e[f+1]?(s+="!=",f++):"="===v&&"<"!==e[f-1]&&">"!==e[f-1]?s+="==":s+=v}return{code:s+";",triggers:c,text:e}}(e,t,n);n&&!wn[n]&&(wn[n]={});var o=n?wn[n]:mn;return i.handler=o[e]=o[e]||function r(e){try{return new Function(e)}catch(t){return xn}}(i.code),i}function bn(e){mn={},e||(wn={})}function xn(){return webix.i18n.spreadsheet.table["math-error"]}function _n(e,t,n){for(var i=Ze(e,!0),o=i.length,r=n?n.start:null,a=n?n.end:null,l=t.count,s=t.id,c=1;c<o;c+=2)if(webix.isArray(i[c])){var u=k(i[c],3),d=u[0],h=u[1],f=u[2]?"'":"";i[c]=f+d+f+"!"+h}else{var v=k(qe(i[c]),3),g=v[0],m=v[1],w=v[2],p=1&w,b=2&w,x=yn(i,c);if("move"==s&&(!t.cut||g>=r.row&&g<=a.row&&m>=r.column&&m<=a.column))m+=b?0:t.column,g+=p?0:t.row;else if("row"==s||"column"==s){var _="row"==s,y=_?g:m;if(l<0&&"start"==x&&t.start<=y&&qe(i[c+2])[_?0:1]<t.start+Math.abs(l)){i[c]=i[c+2]="#REF!",c+=2;continue}if(t.start<=y){var C=void 0;if(l<0&&t.start+Math.abs(l)>y){if(!x){i[c]="#REF!";continue}y=t.start-("end"==x?1:0),C=!0}C||(y+=l),_?g=y:m=y}}i[c]=m<=0||g<=0?"#REF!":(b?"$":"")+$[m]+(p?"$":"")+g}return i.join("")}function yn(e,t){return":"==e[t+1]&&e[t+2]?"start":":"==e[t-1]&&e[t-2]?"end":void 0}function Cn(e,t,n,i){for(var o=Ze(e,!0),r=0;r<o.length;r++)if(webix.isArray(o[r])){var a=o[r][0]===t;!i.multiSheet&&a&&(i.multiSheet=!0);var l=a?n:o[r][0];o[r]="'"+l+"'!"+o[r][1]}return o.join("")}function $n(e,t){var n=e._mathSheetCache;if(!n[t]){var i=t&&t!=sn(e)?function o(c,u){var e=ln(c,u);if(!e)return;var d=e.content,h=[],f=[],v=[];return{init:function(){if(d.ranges)for(var e=0;e<d.ranges.length;e++){
var t=d.ranges[e];v[t[0]]=t[1]}if(d.data)for(var n=0;n<d.data.length;n++){var i=k(d.data[n],3),o=i[0],r=i[1],a=i[2];if(h[o]||(h[o]=[]),"="===(h[o][r]=a)[0]){var l=c._mathSheetHelpers.parse(a,c._mathSheetCore,u);h[o][r]=l.handler;for(var s=0;s<l.triggers.length;s++)if(l.triggers[s][5]){f.push(d.data[n]);break}}}},getRangeCode:function(e){return v[e]},getRow:function(e){return h[e]||[]},getCell:function(e,t){var n=Kt(d.data,d.spans,0,c.config.columnCount),i=k(n,2),o=i[1];if(o<t)throw"Сolumn does not exist";var r=this.getRow(e)[t];return"function"==typeof r?c._mathSheetHelpers.execute(r,c._mathSheetCore):r},getName:function(){return u},getRange:function(e,t,n,i){for(var o=[],r=e;r<=n;r++)for(var a=t;a<=i;a++)o.push(this.getCell(r,a));return o}}}(e,t):function r(s){return{init:function(){},getRangeCode:function(e){return s.ranges.getCode(e)},getRow:function(e){return s.getRow(e)},getCell:function(e,t){if(t>s.config.columnCount)throw"Сolumn does not exist";return s.getRow(e)[t]},getName:function(){return""},getRange:function(e,t,n,i){for(var o=[],r=e;r<=n;r++)for(var a=s.getRow(r),l=t;l<=i;l++)o.push(a[l]);return o}}}(e);if(!i)return;(n[t]=function a(s){return{init:function(){s.init()},getRangeCode:function(e){return s.getRangeCode(e)},getItem:function(e){return s.getRow(e)},getValue:function(e,t){var n=s.getCell(e,t),i=1*n;return isNaN(i)||""===n?n||"":i},getRangeValue:function(e){var t=this.getRangeCode(e)||e;if(-1==t.indexOf(":"))return[];var n=V(t);return this.getRange.apply(this,n)},getRange:function(e,t,n,i){for(var o=s.getRange(e,t,n,i),r=o.length-1;0<=r;r--){var a=o[r],l=""!==a?1*a:"";o[r]=isNaN(l)?a||"":l}return o},getName:function(){return s.getName()},getRangeCols:function(){return function f(e,t,n,i,o){o=o||0;for(var r=[],a={},l=e,s=0;l<=n;l++,s++){r[s]={};for(var c=this.getRow(l),u=t,d=o;u<=i;u++,d++){if(l==n){var h=this.getName();a["".concat(h?h+"!":"").concat($[u]).concat(e,":").concat($[u]).concat(n)]="data".concat(d),o++}r[s]["data".concat(d)]=c[u]}}return[r,a,o]}.apply(s,arguments)},getRangeRows:function(){return function f(e,t,n,i,o){o=o||0;for(var r=[],a={},l=t,s=0;l<=i;l++,s++){r[s]={};for(var c=e,u=o;c<=n;c++,u++){var d=this.getRow(c);if(l==i){var h=this.getName();a["".concat(h?h+"!":"").concat($[t]).concat(c,":").concat($[i]).concat(c)]="data".concat(u),o++}r[s]["data".concat(u)]=d[l]}}return[r,a,o]}.apply(s,arguments)}}}(i)).init()}return n[t]}function Sn(r,e,t){var n=[];if("string"==typeof e){var i=V(e,r);if(i){var o=$n(r,i[4]);n=o?function h(e,t,n,i,o,r){for(var a=[],l=t;l<=i;l++)for(var s=this.getItem(l),c=n;c<=o;c++){var u=s[c]||0===s[c]?s[c]:"";u={id:u,value:u},r&&r!=e._activeSheet||(u.$value=Et(e,s,0,s[c],{id:c},!0),u.format=s.$cellFormat&&s.$cellFormat[c]),a.push(u)}return a}.apply(o,[r].concat(E(i))):[]}}else if(webix.isArray(e))for(var a=0;a<e.length;a++){var l=e[a]||0===e[a]?e[a]:"";l="object"===p(l)?webix.copy(l):{id:l,value:l},n.push(l)}if(t){if(t.unique)for(var s={},c=n.length-1;0<=c;c--)s[n[c].id]?n.splice(c,1):s[n[c].id]=!0;for(var u=!1,d=n.length-1;0<=d;d--)n[d].value=String(n[d].value),""===n[d].value&&(n.splice(d,1),u=!0);t.order&&n.sort(function(e,t){var n=r.$$("cells").data.sorting.as,i=e.value,o=t.value;return webix.rules.isNumber(i)&&webix.rules.isNumber(o)?n["int"](i,o):n.string(i,o)}),u&&t.filter&&n.unshift(function f(){return{id:"$empty",value:"",$value:"<span class='webix_ssheet_empty'>"+webix.i18n.spreadsheet.labels["dropdown-empty"]+"</span>"}}()),t.empty&&n.unshift({id:"$empty",$empty:!0,value:""})}return n}var kn=function(){function t(e){i(this,t),this._master=e,this._ranges={}}return c(t,[{key:"clear",value:function(){this._ranges={}}},{key:"add",value:function(e,t){this._master.callEvent("onAfterRangeSet",[e,t]),this._ranges[e]=t,bn(!0),this._master.callEvent("onMathRefresh",[])}},{key:"getCode",value:function(e,t){if(t){var n=$n(this._master,t);return n?n.getRangeCode(e):null}return this._ranges[e]}},{key:"remove",value:function(e){delete this._ranges[e],bn(!0),this._master.callEvent("onMathRefresh",[])}},{key:"getRanges",value:function(){var e=[];for(
var t in this._ranges)e.push({name:t,range:this._ranges[t]});return e}},{key:"parse",value:function(e){if(e)for(var t=e.length;t--;){var n=e[t];this._ranges[n[0]]=n[1]}}},{key:"serialize",value:function(){var e,t=[];for(e in this._ranges)t.push([e,this._ranges[e]]);return t}}]),t}(),En=webix.i18n.spreadsheet.labels;var Vn=function(e){function t(){return i(this,t),v(this,h(t).apply(this,arguments))}return d(t,un),c(t,[{key:"$show",value:function(e,t){if(this.cell=this.view.getSelectedId(),!this.cell)return!1;var o=t.elements;this.view.$handleSelection=function(e,t,n,i){return o.range.setValue(n+":"+i),!1},o.range.setValue("");var n=function i(e){if(e&&0===e.indexOf("=SPARKLINE(")){var t=e.substr(11,e.length-12).split(",");return{range:t[0],type:dn(t[1]),color:dn(t[2]),negativeColor:dn(t[3])}}}(this.view.getCellValue(this.cell.row,this.cell.column));n&&(t.blockEvent(),o.type.setValue(n.type),o.range.setValue(n.range),n.color&&(o.color_def.setValue(n.color),o.color_pos.setValue(n.color)),n.negativeColor&&o.color_neg.setValue(n.negativeColor),t.unblockEvent(),this.renderPreview()),o.range.focus()}},{key:"$hide",value:function(){this.view.$handleSelection=null}},{key:"$init",value:function(){var e=this;return{view:"ssheet-dialog",head:En["sparkline-title"],move:!0,position:"center",body:{view:"form",visibleBatch:1,on:{onChange:function(){return e.renderPreview()}},elements:[{view:"richselect",name:"type",label:En["sparkline-type"],value:"line",labelPosition:"left",suggest:{view:"ssheet-form-suggest",data:function t(){return[{id:"line",value:En["line-chart"]},{id:"spline",value:En["spline-chart"]},{id:"splineArea",value:En["splinearea-chart"]},{id:"area",value:En["area-chart"]},{id:"bar",value:En["bar-chart"]},{id:"pie",value:En["pie-chart"]}]}()},on:{onChange:function(e){var t=this.getFormView();switch(e){case"pie":t.showBatch(3);break;case"bar":t.showBatch(2);break;default:t.showBatch(1)}}}},{view:"text",label:En["sparkline-range"],name:"range"},{view:"ssheet-colorpicker",label:En["sparkline-color"],name:"color_def",id:"add_sparkline_color",value:"#6666FF",batch:"1"},{view:"ssheet-colorpicker",label:En["sparkline-positive"],name:"color_pos",value:"#6666FF",batch:"2"},{view:"ssheet-colorpicker",label:En["sparkline-negative"],name:"color_neg",value:"#FF6666",batch:"2"},{view:"formlate",name:"preview",borderless:!0,css:"webix_ssheet_preview",height:50}]},on:{onSaveClick:function(){return e.okClick()},onCancelClick:function(){return e.close()}}}}},{key:"checkRange",value:function(e){if(e&&V(e,this.view))return!0;this.view.alert({text:En["error-range"]})}},{key:"okClick",value:function(){var e=this.$dialog.getBody().getValues();if(e.range=e.range.toUpperCase(),e.range&&this.checkRange(e.range)){var t=this.sparkConfig(e);this.view.addSparkline(this.cell.row,this.cell.column,t),this.close()}}},{key:"renderPreview",value:function(){var e=this.$dialog.getBody(),t=e.getValues();if(t.range=t.range.toUpperCase(),t.range&&this.checkRange(t.range)){var n,i=function r(e,t){var n=[];if("string"==typeof t){var i=V(t,e);if(i){var o=$n(e,i[4]);n=o?o.getRange.apply(o,i):[]}}else n=webix.copy(t);return n}(this.view,t.range),o=this.sparkConfig();for(n=0;n<i.length;n++)i[n]=i[n]||0;e.elements.preview.setValue(webix.Sparklines.getTemplate(o)(i,{width:200,height:40}))}else e.elements.preview.setValue("")}},{key:"sparkConfig",value:function(e){var t=this.$dialog.getBody(),n=t.getValues();return e=e||{type:n.type},"bar"===n.type?(e.color=n.color_pos,e.negativeColor=n.color_neg):t.elements.color_def.isVisible()&&(e.color=n.color_def),e}}]),t}(),An=Object.freeze({action:"add-sparkline",DialogBox:Vn}),zn=function(e){function t(){return i(this,t),v(this,h(t).apply(this,arguments))}return d(t,un),c(t,[{key:"$show",value:function(e){var t=e.$$("table"),r=e.$$("form");r.clear(),r.clearValidation(),r.elements.name.focus(),r.elements.range.setValue(this.view.getSelectedRange()),t.clearAll(),t.parse(this.view.ranges.getRanges()),this.view.$handleSelection=function(e,t,n,i){return r.elements.range.setValue(function o(e,t,n){return(n?z(n)+"!":"")+e+":"+t}(n,i,"")
),!1}}},{key:"$hide",value:function(){this.view.$handleSelection=null}},{key:"saveClick",value:function(){var e=this.$dialog.$$("form"),t=e.getValues(),n=t.range.indexOf("!");if(t.range=t.range.substr(0,n+1)+t.range.substr(n+1).toUpperCase(),t.name=t.name.toUpperCase(),e.setValues(t),e.validate()){var i=this.$dialog.$$("table");t.id&&i.exists(t.id)?i.updateItem(t.id,t):i.add(t),this.view.ranges.add(t.name,t.range),e.clear()}}},{key:"removeRange",value:function(t){var n=this;this.view.confirm({text:webix.i18n.spreadsheet.labels["range-remove-confirm"]}).then(function(){var e=n.$dialog.$$("table");n.view.ranges.remove(e.getItem(t).name),e.remove(t)})}},{key:"editRange",value:function(e){var t=this.$dialog.$$("form");t.clearValidation(),t.setValues(this.$dialog.$$("table").getItem(e))}},{key:"$init",value:function(){var r=this,e={padding:0,type:"clean",cols:[{view:"ssheet-dialog-table",id:"table",borderless:!0,columns:[{id:"name",header:webix.i18n.spreadsheet.labels["range-name"],width:120},{id:"range",header:webix.i18n.spreadsheet.labels["range-cells"],width:120},{template:"<div class='webix_icon wxi-pencil'></div>",width:44},{template:"<div class='webix_icon wxi-trash'></div>",width:44}],autowidth:!0,height:150,onClick:{"wxi-trash":function(e,t){return r.removeRange(t)},"wxi-pencil":function(e,t){return r.editRange(t)}}},{width:250,view:"form",id:"form",rules:{name:function(n){var e=/^[A-Za-z]+$/.test(n),t=r.$dialog.$$("table"),i=r.$dialog.$$("form").getValues(),o=!0;return t.eachRow(function(e){var t=this.getItem(e);t.name==n&&t.id!=i.id&&(o=!1)}),e&&o},range:F},elementsConfig:{labelWidth:70},elements:[{view:"text",name:"name",gravity:1,label:webix.i18n.spreadsheet.labels["range-name"]},{view:"text",name:"range",gravity:1,label:webix.i18n.spreadsheet.labels["range-cells"]}]}]};return{view:"ssheet-dialog",move:!0,head:webix.i18n.spreadsheet.labels["range-title"],autoheight:!0,width:610,position:"center",body:e,on:{onSaveClick:function(){return r.saveClick()},onCancelClick:function(){return r.close()}}}}}]),t}(),In=Object.freeze({action:"add-range",DialogBox:zn}),Rn=function(e){function t(){return i(this,t),v(this,h(t).apply(this,arguments))}return d(t,un),c(t,[{key:"$show",value:function(){var o=this.$dialog.$$("form");if(this.cell=this.view.getSelectedId(!0),!this.cell.length)return!1;o.clear();var e=this.view.getCellEditor(this.cell[0].row,this.cell[0].column);e&&e.options&&o.elements.range.setValue(e.options),this.view.$handleSelection=function(e,t,n,i){return o.elements.range.setValue(n+":"+i),!1},o.elements.range.focus()}},{key:"$hide",value:function(){this.view.$handleSelection=null}},{key:"$init",value:function(){var e=this;return{view:"ssheet-dialog",position:"center",head:webix.i18n.spreadsheet.labels["dropdown-title"],move:!0,body:{padding:0,view:"form",id:"form",rows:[{view:"text",label:webix.i18n.spreadsheet.labels["dropdown-range"],name:"range"}]},on:{onSaveClick:function(){return e.okClick()},onCancelClick:function(){return e.close()}}}}},{key:"okClick",value:function(){var t=this.$dialog.$$("form").elements.range.getValue();t?V(t,this.view)?(g.set(function(){for(var e=0;e<this.cell.length;e++)this.view.setCellEditor(this.cell[e].row,this.cell[e].column,{editor:"ss_richselect",options:t})},this),this.close()):this.view.alert({text:webix.i18n.spreadsheet.labels["error-range"]}):this.close()}}]),t}(),Dn=Object.freeze({action:"add-dropdown",DialogBox:Rn}),On="webix_lock";function Fn(n,e,t,i,o){var r=n.$$("cells");"object"===p(e)&&"object"===p(t)?g.set(function(){!function a(e,t,n,i){for(var o=e.row;o<=t.row;o++)for(var r=e.column;r<=t.column;r++)n.call(i||this,o,r)}(e,t,function(e,t){Fn(n,e,t,i,!0)})}):(i=!1!==i,((n._locks[e]=n._locks[e]||{})[t]=i)?r.addCellCss(e,t,On,!0):r.removeCellCss(e,t,On,!0),n.callEvent("onAction",["lock",{row:e,column:t,value:!i,newValue:i}]));o||r.refresh()}function Mn(e,t,n){return!!e._locks[t]&&e._locks[t][n]}var Un=Object.freeze({lockCss:On,init:function qa(o){o._locks={},o.attachEvent("onReset",function(){return function t(e){e._locks={}}(o)}),o.attachEvent("onUndo",function(e,t,n,
i){"lock"===e&&Fn(o,t,n,!!i,!0)}),o.attachEvent("onCommand",function(e){"lock-cell"===e.id&&function i(e){var t=e.$$("cells").getSelectArea();if(t){var n=e.isCellLocked(t.start.row,t.start.column);e.lockCell(t.start,t.end,!n)}}(o)}),o.attachEvent("onAction",function(e,t){"before-grid-change"==e&&function c(e,t,n,i){var o=n.locked,r=o.length;if(t)for(;r--;){var a=k(o[r],2),l=a[0],s=a[1];(l&&"row"==e&&l>=i.row||s&&"column"==e&&s>=i.column)&&("row"==e?l<i.row-t?o.splice(r,1):o[r][0]=1*l+t:"column"==e&&(s<i.column-t?o.splice(r,1):o[r][1]=1*s+t))}}(t.name,t.inc,t.data,t.start)})},lockCell:Fn,isCellLocked:Mn,serialize:function Ka(e,t){var n,i,o=[];for(n in e._locks)for(i in e._locks[n])e._locks[n][i]&&o.push([n,i]);t.locked=o},load:function Ya(e,t){var n,i=t.locked;if(i)for(n=0;n<i.length;n++)Fn(e,i[n][0],i[n][1],!0,!0)}});function Nn(e,t,n){var i=e.$$("cells").getSpan()[t];if(i)return i[n]}function Tn(e,t,n,i,o){if(!(n<2&&i<2)&&(o||e.callEvent("onBeforeSpan",[t.row,t.column,[n,i]]))){var r=e.getRow(t.row),a=r.$cellCss&&r.$cellCss[t.column]||"",l=Hn(e,t.row,t.column);l&&(a+=" "+l),function u(e,t,n,i){var o,r,a,l=1*t.row,s=1*t.column,c=!e.getCellValue(l,s);for(o=l;o<l+i;o++)for(r=s;r<s+n;r++)""===(a=e.getCellValue(o,r))||r==s&&o==l||(c&&(c=!1,e.setCellValue(l,s,a)),e.setCellValue(o,r,""))}(e,t,n,i),e.$$("cells").addSpan(t.row,t.column,n,i,null,a),o||(e.callEvent("onAfterSpan",[t.row,t.column,[n,i]]),m(e,"spans",{row:t.row,column:t.column,x:n,y:i}))}}function jn(e,t){var n=e.$$("cells").getSpan(t.row,t.column);n&&e.callEvent("onBeforeSplit",[t.row,t.column,[n[2],n[3]]])&&(e.$$("cells").removeSpan(t.row,t.column),e.callEvent("onAfterSplit",[t.row,t.column,[n[2],n[3]]]),m(e,"spans",{row:t.row,column:t.column,x:0,y:0}))}function Bn(e){var t,n,i,o;i=o=0,t=n=Infinity;for(var r=0;r<e.length;r++){var a=1*e[r].column,l=1*e[r].row;t=Math.min(a,t),i=Math.max(a,i),n=Math.min(l,n),o=Math.max(l,o)}return{cell:{row:n,column:t},x:i-t+1,y:o-n+1}}function Pn(e,t,n,i,o){var r=Nn(e,t,n);r&&(o?-1==r[3].indexOf(i)&&(r[3]+=" "+i):r[3]=r[3].replace(" "+i,""))}function Hn(e,t,n){return e.getCellEditor(t,n)?"ss_editor":e.getCellFilter(t,n)?"ss_filter":""}var Ln={"border-right":function(e,t,n,i){return i.end.column==t+n[0]-1},"border-bottom":function(e,t,n,i){return i.end.row==e+n[1]-1}};function Wn(t,e,n,i,o){var r="row"==e.group?t[3]:t[2],a="row"==e.group?[1*t[0],1*t[0]+t[3]-1]:[1*t[1],1*t[1]+t[2]-1],l="row"==e.group?[n.row,i.row]:[n.column,i.column],s=l[1]-l[0]+1;l[0]=Math.max(l[0],a[0]),l[1]=Math.min(l[1],a[1]);var c=l[0]==a[0];if(l[0]<=l[1]){if("del"==e.id&&(s=-1*(l[1]-l[0]+1)),"del"==e.id&&c&&-1*s<r){var u=Wt(o,function(e){return e[0]==t[0]&&e[1]==t[1]});u[0]="row"==e.group?u[0]-s:u[0],u[1]="column"==e.group?u[1]-s:u[1];var d=qt(o,function(e){return e[0]==u[0]&&e[1]==u[1]&&(e[2]!=u[2]||e[3]!=u[3])});-1<d&&o.splice(d,1)}c&&"add"==e.id||(t[2]="column"==e.group?t[2]+s:t[2],t[3]="row"==e.group?t[3]+s:t[3])}return t}function qn(i,e,t,n,o,r){var a=i._table.getSpan(t,n);if(e&&e.span){var l=e.span;t==1*l[0]+r.row&&n==1*l[1]+r.column&&(i._table.mapCells(t,n,l[3],l[2],function(e,t,n){(a=i._table.getSpan(t,n))&&jn(i,{row:a[0],column:a[1]})},!0),Tn(i,{row:t,column:n},l[2],l[3]),1===o&&jn(i,{row:e.row,column:e.col}))}else a&&jn(i,{row:a[0],column:a[1]})}var Kn=Object.freeze({init:function Ga(l){l.attachEvent("onStyleChange",function(e,t,n){var i=Nn(l,e,t);if(i){var o=Hn(l,e,t);i[3]=(n?n.id:"")+(o?" "+o:"")}}),l.attachEvent("onDataParse",function(e){if(e.spans)for(var t=0;t<e.spans.length;t++){var n=e.spans[t];Tn(l,{row:n[0],column:n[1]},1*n[2],1*n[3],!0)}}),l.attachEvent("onDataSerialize",function(e){var t=[],n=l.$$("cells").getSpan();if(n){for(var i in n){var o=n[i];for(var r in o){var a=o[r];t.push([1*i,1*r,a[0],a[1]])}}e.spans=t}}),l.attachEvent("onUndo",function(e,t,n,i,o){"span"!=e&&"split"!=e||("span"==e&&(o=!o),function r(e,t,n,i,o){o?jn(e,{row:t,column:n}):Tn(e,{row:t,column:n},i[0],i[1])}(l,t,n,i,o))}),l.attachEvent("onAction",function(e,t){if("lock"==e)Pn(l,t.row,t.column,On,t.newValue);else if("before-grid-change"==e)!function c(e,t,n,i){
var o=n.spans;if(t)for(var r=o.length-1;0<=r;r--){var a=k(o[r],2),l=a[0],s=a[1];t<0&&("row"==e&&l<=i.row-t-1?t=i.row-o[r][0]:"column"==e&&s<=i.column-t-1&&(t=i.column-o[r][1])),("row"==e&&l>=i.row||"column"==e&&s>=i.column)&&(o[r][0]="row"==e?1*l+t:l,o[r][1]="column"==e?1*s+t:s)}}(t.name,t.inc,t.data,t.start);else if("check-borders"==e)return function a(e,t,n,i,o){var r=Nn(e,t,n);return!(!r||!Ln[o])&&Ln[o](t,n,r,i)}(l,t.row,t.column,t.area,t.mode)})},addSpan:Tn,removeSpan:jn,getRange:Bn,setSpanCss:Pn,adjustSpan:Wn,pasteSpan:qn});function Yn(e){e._table._ssFilters={},ei(e)}function Gn(e){var t=e._ssFilters,n=[];for(var i in t)for(var o in t[i])n.push(t[i][o]);return n}function Zn(e,t){var i=!1;D(t,e,function(e,t){var n=e._table._ssFilters[t.row];n&&n[t.column]&&(i=!0,delete n[t.column],e._table.removeCellCss(t.row,t.column,"ss_filter"),e._table.removeCellCss(t.row,t.column,"ss_filter_active"),Pn(e,t.row,t.column,"ss_filter",!1),Pn(e,t.row,t.column,"ss_filter_active",!1))}),i&&e.filterSpreadSheet()}function Xn(e,t,n,i){(i||(i={end:{row:t}}),i.end)&&(i=function o(e,t,n,i){if(t===i)for(i=t;i<e.config.rowCount&&e.getCellValue(i+1,n);i++);return I(t+1,n,i,n)}(e,t,n,i.end.row));return i}function Qn(e){return!!(e.includes||e.condition&&e.condition.filter)}function Jn(e){var t=e._table._ssFilters;for(var n in t)for(var i in t[n])if(t[n][i])return!0;return!1}function ei(e){var t=Jn(e);e.callEvent("onCommand",[{id:"toolbar-update",name:"create-filter",value:t}])}function ti(e,t,n){for(var i=t;i<e.config.rowCount;i++){var o=e.getRow(i+1),r=o["$"+n]||o[n];if(r||0===r){var a=Tt(e,i+1,n);return"number"==a||"date"==a?a:"text"}if(""!==r)break}return"text"}function ni(e,t,n,i,o,r){var a=t.filter;a.options=M(a.options,"row",r.row,{column:t.col,row:t.row}),a.options=M(a.options,"column",r.column,{column:t.col,row:t.row}),delete a.value,delete a.handler,e.setCellFilter(n,i,a)}function ii(e,t){for(var n=li[e],i=0;i<n.length;i++)if(n[i].id==t)return n[i]}function oi(e){return webix.copy(li[e])}function ri(e,t){var n=t.includes,i=t.condition,o=ii(e,i.type),r=o?o.handler:function(){return!0};if(n)for(var a=0;a<n.length;a++)n[a]=String(n[a]);return function(e){return n?-1!==n.indexOf(e):""===i.filter||r(e,i.filter)}}function ai(e){return e&&!isNaN(e)&&!Te(e)}var li={number:[{id:"greater",batch:"text",handler:function(e,t){return""!==e&&1*t<1*e}},{id:"less",batch:"text",handler:function(e,t){return""!==e&&1*e<1*t}},{id:"greaterOrEqual",batch:"text",handler:function(e,t){return""!==e&&1*t<=1*e}},{id:"lessOrEqual",batch:"text",handler:function(e,t){return""!==e&&1*e<=1*t}},{id:"equal",batch:"text",handler:function(e,t){return e==t}},{id:"notEqual",batch:"text",handler:function(e,t){return e!=t}},{id:"contains",batch:"text",handler:function(e,t){return-1!==e.toLowerCase().indexOf(t.toLowerCase())}},{id:"notContains",batch:"text",handler:function(e,t){return-1===e.toLowerCase().indexOf(t.toLowerCase())}}],text:[{id:"contains",batch:"text",handler:function(e,t){return-1!==e.toLowerCase().indexOf(t.toLowerCase())}},{id:"notContains",batch:"text",handler:function(e,t){return-1===e.toLowerCase().indexOf(t.toLowerCase())}},{id:"equal",batch:"text",handler:function(e,t){return e.toLowerCase()===t.toLowerCase()}},{id:"notEqual",batch:"text",handler:function(e,t){return e.toLowerCase()!==t.toLowerCase()}},{id:"beginsWith",batch:"text",handler:function(e,t){return 0===e.toLowerCase().lastIndexOf(t.toLowerCase(),0)}},{id:"notBeginsWith",batch:"text",handler:function(e,t){return 0!==e.toLowerCase().lastIndexOf(t.toLowerCase(),0)}},{id:"endsWith",batch:"text",handler:function(e,t){return-1!==e.toLowerCase().indexOf(t.toLowerCase(),e.length-t.length)}},{id:"notEndsWith",batch:"text",handler:function(e,t){return-1===e.toLowerCase().indexOf(t.toLowerCase(),e.length-t.length)}}],date:[{id:"greater",batch:"datepicker",handler:function(e,t){return ai(e)&&t<e}},{id:"less",batch:"datepicker",handler:function(e,t){return ai(e)&&e<t}},{id:"greaterOrEqual",batch:"datepicker",handler:function(e,t){return ai(e)&&t<=e}},{id:"lessOrEqual",batch:"datepicker",handler:function(e,t
){return ai(e)&&e<=t}},{id:"equal",batch:"datepicker",handler:function(e,t){return ai(e)&&e==t}},{id:"notEqual",batch:"datepicker",handler:function(e,t){return!ai(e)||e!=t}},{id:"between",batch:"daterangepicker",handler:function(e,t){return!!ai(e)&&((!t.start||e>t.start)&&(!t.end||e<t.end))}},{id:"notBetween",batch:"daterangepicker",handler:function(e,t){return!!ai(e)&&(!t.start||e<=t.start||!t.end||e>=t.end)}}]},si=Object.freeze({init:function Za(l){var s=l._table;l.attachEvent("onReset",function(){return Yn(l)}),Yn(l),s.on_click.ssheet_filter_sign=function(e,t){var n=s._ssFilters[t.row][t.column],i=n.mode||ti(l,t.row,t.column),o=[];n.options&&("string"==typeof n.options?o=Sn(l,n.options,{unique:!0,order:!0,filter:!0}):webix.isArray(n.options)&&(o=Sn(l,n.options,{filter:!0}))),l.callEvent("onCommand",[{id:"start-filter",cell:t,mode:i,options:o,filter:n}])},s.on_dblclick.ssheet_filter_sign=function(){return!1},l.attachEvent("onCommand",function(e){"create-filter"===e.id&&function t(n){var i=n._table.getSelectArea();Jn(n)?(g.set(function(){n.removeFilters()}),i&&n._table.addSelectArea(i.start,i.end)):i&&g.set(function(){for(var e=i.start.row,t=i.start.column;t<=i.end.column;t++)n.setCellFilter(e,t,{options:i})}),ei(n)}(l)});var c=!1;l.attachEvent("onUndo",function(e,t,n,i){if("filter"==e)i="object"==p(i)?i:null,l.setCellFilter(t,n,i),c=!0;else if("apply-filter"==e){var o=l.getCellFilter(t,n);if(o.value=i,delete o.handler,i&&i.condition){var r=o.mode||ti(l,t,n);o.handler=ri(r,o.value)}c=!0;var a=i&&Qn(i);s[a?"addCellCss":"removeCellCss"](t,n,"ss_filter_active"),Pn(l,t,n,"ss_filter_active",a)}}),l.attachEvent("onAfterUndo",function(){c&&(l.filterSpreadSheet(),c=!1)}),l.attachEvent("onAction",function(e,t){"filter"==e?(Pn(l,t.row,t.column,"ss_filter",t.newValue),Pn(l,t.row,t.column,"ss_filter_active",t.newValue&&t.newValue.value&&Qn(t.newValue.value)),ei(l)):"before-grid-change"==e&&function u(e,t,n,i){var o=n.filters;if(t)for(var r=o.length-1;0<=r;r--){var a=k(o[r],3),l=a[0],s=a[1],c=a[2];if("row"==e&&l>=i.row||"column"==e&&s>=i.column){if("row"==e){if(l<i.row-t){o.splice(r,1);continue}o[r][0]=1*l+t}else if("column"==e){if(s<i.column-t){o.splice(r,1);continue}o[r][1]=1*s+t}c.options=M(c.options,e,t,i)}}}(t.name,t.inc,t.data,t.start)})},getFilters:Gn,serialize:function Xa(e,t){for(var n=Gn(e._table),i=t.filters=[],o=0;o<n.length;o++){var r=n[o],a=r.row,l=r.column,s=r.options,c=r.mode,u=r.value;u=u&&webix.copy(u),i.push([a,l,{value:u,options:s,mode:c}])}},load:function Qa(e,t){var n=t.filters;if(n){for(var i=0;i<n.length;i++)e.setCellFilter(n[i][0],n[i][1],n[i][2]||{options:""});e.filterSpreadSheet()}},clearFilters:Zn,isFilter:function Ja(e,t,n){var i=e._table._ssFilters;return i[t]&&!!i[t][n]},calibrateRange:Xn,isValueActive:Qn,getFilterMode:ti,pasteFilter:ni,getSingleOption:ii,getConditions:oi,getFilterFunction:ri}),ci=function(e){function t(){return i(this,t),v(this,h(t).apply(this,arguments))}return d(t,un),c(t,[{key:"open",value:function(e){var t=this;if(this.cell=e.cell,this.$mode=e.mode,this.$filter=e.filter,!this.cell||this.view.isCellLocked(this.cell.row,this.cell.column))return!1;if(!this.$dialog){this.$dialog=webix.ui(this.$init()),this.view._destroy_with_me.push(this.$dialog),this.$dialog.attachEvent("onHide",function(){return t.$hide()});var n=this.view.$$("cells");n.attachEvent("onScrollY",function(){return t.syncScroll()}),n.attachEvent("onScrollX",function(){return t.syncScroll()})}if(!1===this.$show(this.$filter.value,e.options))return this.close();this.$dialog.show(this._getTargetNode())}},{key:"_getTargetNode",value:function(){var e=this.view.$$("cells");return e.getSpan(this.cell.row,this.cell.column)?e.getSpanNode(this.cell):e.getItemNode(this.cell)}},{key:"$show",value:function(e,t){var n=this.getList(),i=this.getFilter();i.config.mode!==this.$mode&&(i.define("conditions",this.getConditions(this.$mode)),i.define("mode",this.$mode));var o=e&&e.conditions&&e.conditions.type;o&&!ii(this.$mode,o)&&(e=""),n.clearAll(),n.data.importData(t),i.config.value="",i.setValue(webix.copy(e||{}))}},{key:"$init",
value:function(){var e=this,t=webix.i18n.spreadsheet.labels;return{view:"popup",css:"ssheet_filter",padding:7,relative:"right",body:{margin:4,rows:[{view:"filter",field:"value",mode:"text",conditions:this.getConditions("text"),inputs:["text",{view:"ssheet-datepicker",timepicker:!0,batch:"datepicker",on:{onChange:function(){return e.getFilter().applyFilter()}}},{view:"ssheet-daterangepicker",timepicker:!0,batch:"daterangepicker",on:{onChange:function(){return e.getFilter().applyFilter()}}}],template:function(e){return e.$value||e.value}},{cols:[{},{view:"button",label:t.cancel,autowidth:!0,css:"webix_transparent",on:{onItemClick:function(){return e.close()}}},{view:"button",label:t.apply,autowidth:!0,css:"webix_secondary",on:{onItemClick:function(){return e.applyFilter()}}}]}]}}}},{key:"applyFilter",value:function(){var e=this.getFilter(),t=this.$filter.value,n=this.$filter.value=e.getValue();this.$filter.handler=ri(this.$mode,n),this.view.filterSpreadSheet(),this.view.callEvent("onAction",["apply-filter",{row:this.cell.row,column:this.cell.column,value:t,newValue:n}]),this.setCellStyle(this.cell.row,this.cell.column,"ss_filter_active",Qn(n)),this.close()}},{key:"setCellStyle",value:function(e,t,n,i){var o=this.view.$$("cells"),r=this.getSpan(o,e,t);r&&(i?-1==r[3].indexOf(n)&&(r[3]+=" "+n):r[3]=r[3].replace(" "+n,"")),o[i?"addCellCss":"removeCellCss"](e,t,n)}},{key:"getSpan",value:function(e,t,n){var i=e.getSpan()[t];if(i)return i[n]}},{key:"getList",value:function(){return this.getFilter().getChildViews()[2]}},{key:"getFilter",value:function(){return this.$dialog.getBody().getChildViews()[0]}},{key:"syncScroll",value:function(){if(this.$dialog.isVisible()){var e=this._getTargetNode(),t=this.view.$$("cells"),n=!1;if(e){var i=webix.html.offset(e),o=webix.html.offset(t.$view.getElementsByClassName("webix_ss_body")[0]),r=i.y-o.y,a=i.x-o.x+i.width;n=r<0||r+i.height>o.height||a<0||a-i.width>o.width-webix.env.scrollSize}!e||n?this.$dialog.show({x:-9999,y:-9999}):this.$dialog.show(e)}}},{key:"getConditions",value:function(e){for(var t=webix.i18n.filter,n=oi(e),i=0;i<n.length;i++)n[i].id&&(n[i].value=t[n[i].id]);return n}}]),t}(),ui=Object.freeze({action:"start-filter",DialogBox:ci}),di=function(e){function t(){return i(this,t),v(this,h(t).apply(this,arguments))}return d(t,un),c(t,[{key:"$show",value:function(){if(this.form=this.$dialog.$$("form"),this.list=this.$dialog.$$("list"),this.preview=this.$dialog.$$("preview"),this.cell=this.view.getSelectedId(!0),!this.cell.length)return!1;this.fillForm(this.view),this.view.$handleSelection=function(){return!1}}},{key:"$hide",value:function(){this.view.$handleSelection=null}},{key:"$init",value:function(){var o=this,t=webix.i18n.spreadsheet,e=t.labels,n=t.formats,i=fe("int"),r=[{name:"zeros",view:"counter",css:"webix_ssheet_counter",label:e["decimal-places"],value:0,batch:"common"},{name:"separator",view:"checkbox",label:e.separator,batch:"common"},{view:"formlist",label:e.negative,height:160,name:"negative",batch:"common",css:"webix_ssheet_format_negative",template:function(e){if(o.list){var t=o.getFormat(e.id),n={css:""},i=(t=xe(t.fmt,t.delimiters))(-1234.56789,n);return"<span class='"+n.css+"'>"+i+"</span>"}},data:[{id:1},{id:2},{id:3},{id:4}]}],a=[{view:"text",label:e["format-pattern"],name:"format",labelPosition:"top",batch:"custom",placeholder:"[>100]0"+i.groupSign+"000"+i.decimalSign+"00;[>0]None"},{id:"docs",template:"<a href='https://webix-guides.gitbook.io/spreadsheet-user-guide/formatting_numbers#custom-number-format' target='_blank' class = 'docs'>"+e["format-docs"]+"</a>",borderless:!0,batch:"custom"}],l=[{name:"date",batch:"date",view:"formlist",labelWidth:90,height:160,label:e["date-format"],css:"webix_ssheet_format_date",template:function(e){return xe(e.value,i)(45e3)},data:[n.dateFormat,n.timeFormat,n.fullDateFormat,n.longDateFormat]}];return{view:"ssheet-dialog",position:"center",width:460,head:e["format-title"],move:!0,body:{padding:0,cols:[{view:"list",id:"list",css:"webix_ssheet_format_type",width:120,scroll:!1,data:this.getFormats(),select:!0,on:{
onSelectChange:function(e){switch(o.updateForm(),e[0]){case"custom":case"date":o.form.showBatch(e[0]);break;default:o.form.showBatch("common"),o.form.elements.separator.show(),"percent"==e[0]&&o.form.elements.separator.hide()}}}},{view:"form",id:"form",height:280,paddingY:0,paddingX:20,elements:[{id:"preview",template:function(e){return e.value==t.table["format-error"]?e.value:"<span class ='"+e.css+"'>"+e.value+"</span>"},css:"webix_ssheet_format_preview",autoheight:!0,borderless:!0}].concat(r,a,l),elementsConfig:{labelWidth:140},on:{onChange:function(){return o.updateForm()}}}]},on:{onSaveClick:function(){return o.okClick()},onCancelClick:function(){return o.closeWin()}}}}},{key:"okClick",value:function(){var t=this,e=this.list.getSelectedId(),n="custom"==e?{format:this.form.getValues().format}:this.form.getValues();n.type=e,g.set(function(){for(var e=0;e<t.cell.length;e++)we(t.view,t.cell[e].row,t.cell[e].column,n.format,n)}),this.view.$$("cells").refresh(),this.closeWin()}},{key:"closeWin",value:function(){var e=this.view.getStyle(this.cell[0].row,this.cell[0].column),t=e&&e.props.format?e.props.format:"common";Ae(t)||this.view.callEvent("onCommand",[{id:"toolbar-update",name:"format",value:t}]),this.close()}},{key:"getFormat",value:function(e){var t=this.list.getSelectedId(),n=this.form.getValues();return n.negative=e||n.negative,"custom"!=t?("date"!=t&&(n.date=""),{fmt:Ie(n=ze(t,n)),delimiters:fe(t)}):{fmt:n.format,delimiters:fe(t)}}},{key:"fillForm",value:function(e){var t,n=webix.i18n.spreadsheet,i=e.getStyle(this.cell[0].row,this.cell[0].column),o={zeros:0,separator:0,negative:1,date:n.formats.dateFormat,format:""},r=i&&i.props.format?i.props.format:"";o.format=ge(r||"price"),"custom"!=(t=r?"string"==r?r="custom":de[r].values.type:r="price")&&webix.extend(o,de[r].values,!0);var a=this.view.$$("cells").getItem(this.cell[0].row),l=this.cell[0].column;this.value=webix.isUndefined(a[l])?"":a[l],this.form.setValues(o),this.list.select(t),this.updateForm()}},{key:"updateForm",value:function(){var e=this.form.elements,t=this.getFormat(),n=this.value,i=""===n||isNaN(n);Ue(t,"date")&&(i||Te(n))?n=45e3:i&&!Ue(t,"string")&&(n=1234.56789);var o={css:""};n=xe(t.fmt,t.delimiters)(n,o),this.preview.parse({value:n,css:o.css}),e.negative.refresh(),e.date.refresh(),e.format.setValue(t.fmt)}},{key:"getFormats",value:function(){var e=webix.i18n.spreadsheet.labels;return[{id:"price",value:e.currency},{id:"int",value:e.number},{id:"percent",value:e.percent},{id:"date",value:e.date},{id:"custom",value:e["custom-format"]}]}}]),t}(),hi=Object.freeze({action:"custom",DialogBox:di}),fi=[{id:">",value:">"},{id:"<",value:"<"},{id:"=",value:"="},{id:"!=",value:webix.i18n.spreadsheet.labels["conditional-not-equal"]},{id:"<>",value:webix.i18n.spreadsheet.labels["conditional-between"]}];var vi=function(e){function t(){return i(this,t),v(this,h(t).apply(this,arguments))}return d(t,un),c(t,[{key:"_getCondition",value:function(){var o=this,e=this.view,t=this.$dialog.getBody().getChildViews()[0].getChildViews(),r=[];t.forEach(function(e){if(e.getValues){var t=e.getValues(),n=[];n.push(t.condition),"<>"!==t.condition?n.push(o._normalizeValue(t.value)):n.push([o._normalizeValue(t.value),o._normalizeValue(t.value2)]),n.push(t.style);for(var i=0;i<n.length;i++)if(""===n[i])return!1;r.push(n)}}),e.callEvent("onConditionSet",[r])}},{key:"_safeInt",value:function(e){var t=parseFloat(e);return t==e?t:e}},{key:"_setCondition",value:function(){var i=this,e=this.view.conditions.get(this.cell.row,this.cell.column);if(e){var o=this.$dialog.getBody().getChildViews()[0].getChildViews();e.forEach(function(e,t){var n={};n.condition=e[0],webix.isArray(e[1])?(n.value=i._formatValue(e[1][0]),n.value2=i._formatValue(e[1][1])):n.value=i._formatValue(e[1]),n.style=e[2],o[t+1].setValues(n)})}}},{key:"_formatValue",value:function(e){return this.editFormat&&""!==e&&"="!=e[0]?(e=w(e),this.editFormat(e)):e.toString()}},{key:"_normalizeValue",value:function(e){this.editFormat?isNaN(e)?"="!=e[0]&&(e=webix.Date.strToDate(webix.i18n.spreadsheet.formats.parseDateTime)(e),e=isNaN(e
)?"":o(e)):e=Te(e)?"":e:e=this._safeInt(e,10);return e}},{key:"okClick",value:function(){this._getCondition(),this.close()}},{key:"_clean",value:function(){this.$dialog.getBody().getChildViews()[0].getChildViews().forEach(function(e){e.setValues&&e.setValues({condition:"",value:"",value2:"",style:""})})}},{key:"$show",value:function(){var o=this;if(this.cell=this.view.getSelectedId(),!this.cell)return!1;var e=this.view.getRow(this.cell.row),t=e.$cellType;t&&(t=t[this.cell.column]),"date"==t&&(this.editFormat=je(e,this.cell.column)),this.$dialog.queryView("text","all").forEach(function(e){e.define({placeholder:"date"==t?o._formatValue(45e3):""}),e.refresh()}),this.view.$handleSelection=function(e,t,n,i){return o.activeValue&&n==i&&o.activeValue.setValue("="+n),!1},this._setCondition()}},{key:"$hide",value:function(){this.view.$handleSelection=null,delete this.editFormat,this._clean()}},{key:"getRows",value:function(e,t){for(var n=this,i=[{height:36,padding:{left:12},cols:[{view:"label",width:131,label:webix.i18n.spreadsheet.labels.display},{view:"label",width:116,label:webix.i18n.spreadsheet.labels.condition},{view:"label",label:webix.i18n.spreadsheet.labels.value}]}],o={view:"form",padding:0,borderless:!0,css:"webix_ssheet_cformats",elements:[{margin:10,cols:[{view:"richselect",name:"style",width:120,placeholder:webix.i18n.spreadsheet.labels["conditional-style"],css:"webix_ssheet_cformat_select",suggest:{padding:0,borderless:!0,css:"webix_ssheet_cformat_list",body:{template:function(e){var t="webix_ssheet_cformat "+e.css;return'<div class="'.concat(t,'">').concat(e.name,"</div>")},data:e}}},{view:"richselect",width:105,name:"condition",placeholder:webix.i18n.spreadsheet.labels["conditional-operator"],on:{onChange:function(e){"<>"===e?this.getFormView().elements.value2.show():this.getFormView().elements.value2.hide()}},suggest:{view:"ssheet-form-suggest",body:{data:fi}}},{cols:[{view:"text",on:{onFocus:function(e){n.activeValue=e},onBlur:function(e){var t=e.getValue();""!==t&&(t=n._normalizeValue(t),e.setValue(n._formatValue(t)))}},name:"value"},{view:"text",name:"value2",on:{onFocus:function(e){n.activeValue=e},onBlur:function(e){var t=e.getValue();""!==t&&(t=n._normalizeValue(t),e.setValue(n._formatValue(t)))}},hidden:!0}]},{view:"icon",css:"webix_ssheet_cformat_clear",icon:"wxi-trash",click:function(){this.getFormView().clear()}}]}]};t--;)i.push(o);return i}},{key:"$init",value:function(){var e=this,t=webix.skin.$active.layoutMargin.form;return{view:"ssheet-dialog",head:webix.i18n.spreadsheet.labels["conditional-format"],position:"center",width:670,move:!0,margin:t,body:{view:"form",padding:0,borderless:!0,rows:this.getRows(function n(e){return e.map(function(e){return e.id=e.css,e})}(this.view.config.conditionStyle),3)},on:{onSaveClick:function(){return e.okClick()},onCancelClick:function(){return e.close()}}}}}]),t}(),gi=Object.freeze({action:"conditional-format",DialogBox:vi}),mi=function(e){function t(){return i(this,t),v(this,h(t).apply(this,arguments))}return d(t,un),c(t,[{key:"$show",value:function(e,t){this.view.$handleSelection=function(){return!1},t.elements.sheets.setValue(this.getSheets()),t.elements.filename.setValue("Data"),t.elements.filename.getInputNode().select()}},{key:"$hide",value:function(){this.view.$handleSelection=null}},{key:"$init",value:function(){var e=this;return{view:"ssheet-dialog",head:webix.i18n.spreadsheet.labels["export-title"],move:!0,position:"center",body:{view:"form",elements:[{view:"text",name:"filename",placeholder:webix.i18n.spreadsheet.labels["export-name"]},{view:"multicheckbox",name:"sheets"}]},on:{onSaveClick:function(){return e.okClick()},onCancelClick:function(){return e.close()}}}}},{key:"getSheets",value:function(){for(var e=this.view,t=e._sheets,n=[],i=0;i<t.length;i++)n.push({name:t[i].name,active:e._activeSheet===t[i].name?1:0});return n}},{key:"okClick",value:function(){var e=this.$dialog.getBody().getValues();webix.toExcel(this.view,e),this.close()}}]),t}(),wi=Object.freeze({action:"excel-export",DialogBox:mi}),pi=function(e){function t(){return i(this,t),v(this,
h(t).apply(this,arguments))}return d(t,un),c(t,[{key:"$show",value:function(e,t){if(!this.view.getSelectedId())return!1;this.restoreValue(t)||t.clear(),t.elements.name.focus()}},{key:"restoreValue",value:function(e){var t=this.view.getSelectedId();if(t){var n=this.view.getRow(t.row),i=n["$"+t.column]||n[t.column];if(i&&0===i.indexOf("=HYPERLINK")){var o=i.split('"');return e.setValues({name:o[3]||"",url:o[1]||""}),!0}}return!1}},{key:"$init",value:function(){var e=this;return{view:"ssheet-dialog",head:webix.i18n.spreadsheet.labels["link-title"],move:!0,position:"center",body:{view:"form",elements:[{view:"text",name:"name",placeholder:webix.i18n.spreadsheet.labels["link-name"]},{view:"text",name:"url",placeholder:webix.i18n.spreadsheet.labels["link-url"]}]},on:{onSaveClick:function(){return e.okClick()},onCancelClick:function(){return e.close()}}}}},{key:"okClick",value:function(){var e=this.view.getSelectedId(),t=this.$dialog.getBody().getValues(),n="";t.url&&(t.name=t.name||t.url,/^https?:\/\//i.test(t.url)||(t.url="http://"+t.url),n='=HYPERLINK("'.concat(t.url,'","').concat(t.name,'")')),this.view.setCellValue(e.row,e.column,n),this.view.refresh(),this.close()}}]),t}(),bi=Object.freeze({action:"add-link",DialogBox:pi}),xi=function(e){function t(){return i(this,t),v(this,h(t).apply(this,arguments))}return d(t,un),c(t,[{key:"$show",value:function(e,t){t.setValues({data:"current",paper:"A4",fit:"page",mode:"landscape",sheetnames:1,margin:0})}},{key:"$init",value:function(){var e=this;return{view:"ssheet-dialog",head:webix.i18n.spreadsheet.labels["print-title"],move:!0,modal:!0,width:530,height:520,position:"center",buttons:!1,body:{view:"form",elements:[{type:"section",template:webix.i18n.spreadsheet.labels["print-settings"]},{cols:[{view:"radio",name:"data",vertical:!0,options:[{id:"current",value:webix.i18n.spreadsheet.labels["current-sheet"]},{id:"all",value:webix.i18n.spreadsheet.labels["all-sheets"]},{id:"selection",value:webix.i18n.spreadsheet.labels.selection}],on:{onChange:function(e){"all"==e&&this.getFormView().elements.sheetnames.setValue(1)}}},{rows:[{view:"checkbox",name:"sheetnames",labelRight:webix.i18n.spreadsheet.labels["sheet-names"]},{view:"checkbox",name:"borderless",labelRight:webix.i18n.spreadsheet.labels.borderless},{view:"checkbox",name:"skiprows",labelRight:webix.i18n.spreadsheet.labels["skip-rows"]},{view:"checkbox",name:"margin",labelRight:webix.i18n.spreadsheet.labels.margin}]}]},{type:"section",template:webix.i18n.spreadsheet.labels["print-paper"]},{view:"radio",name:"paper",options:[{id:"letter",value:webix.i18n.spreadsheet.labels["page-letter"]},{id:"A4",value:webix.i18n.spreadsheet.labels["page-a4"]},{id:"A3",value:webix.i18n.spreadsheet.labels["page-a3"]}]},{type:"section",template:webix.i18n.spreadsheet.labels["print-layout"]},{cols:[{view:"radio",name:"fit",options:[{id:"page",value:webix.i18n.spreadsheet.labels["page-width"]},{id:"data",value:webix.i18n.spreadsheet.labels["page-actual"]}]},{width:25},{view:"radio",width:220,name:"mode",options:[{id:"portrait",value:webix.i18n.spreadsheet.labels["page-portrait"]},{id:"landscape",value:webix.i18n.spreadsheet.labels["page-landscape"]}]}]},{cols:[{},{view:"button",css:"ssheet_cancel_button",hotkey:"esc",value:webix.i18n.spreadsheet.labels.cancel,autowidth:!0,click:function(){return e.close()}},{view:"button",value:webix.i18n.spreadsheet.labels.print,hotkey:"enter",autowidth:!0,click:function(){return e.okClick()}}]}]}}}},{key:"okClick",value:function(){var e=this.$dialog.getBody().getValues();e.margin=e.margin?0:{},this.close(),webix.print(this.view,e)}}]),t}(),_i=Object.freeze({action:"print",DialogBox:xi}),yi=function(e){function t(){return i(this,t),v(this,h(t).apply(this,arguments))}return d(t,un),c(t,[{key:"open",value:function(e){var t=this;if(this.cell=e.cell?e.cell:this.view.getSelectedId(),!this.cell||this.view.isCellLocked(this.cell.row,this.cell.column)&&!e.viewonly||!this.view.callEvent("onBeforeCommentShow",[this.cell.row,this.cell.column,!e.viewonly]))return!1;this.view.comments._activeComment={editStatus:!e.viewonly,
cell:this.cell},this.$dialog||(this.$dialog=webix.ui(this.$init()),this.view._destroy_with_me.push(this.$dialog),this.view.comments.commentsView=this.$dialog,this.$dialog.attachEvent("onHide",function(){return t.$hide()}),this.view.attachEvent("onCommentHide",function(){return t.$dialog.hide()}));var n=this.$dialog.getBody(),i=this.view.$$("cells").getSpan(this.cell.row,this.cell.column),o=i?{row:this.cell.row,column:1*i[1]+i[2]-1}:this.cell;webix.delay(function(){t.$dialog.show(t.view.$$("cells").getItemNode(o)),t._setComment()}),!1===this.$show(this.$dialog,n)&&this.close()}},{key:"$show",value:function(){this.textarea=this.$dialog.queryView({view:"textarea"}),this.template=this.$dialog.queryView({view:"template"})}},{key:"$init",value:function(){var e=this;return{view:"popup",css:"ssheet_comments",minWidth:250,minHeight:150,relative:"right",resize:!0,on:{onViewResize:function(){e.$dialog.hide(),e.$dialog.show(),e.textarea.isVisible()&&e.textarea.focus()}},body:{animate:!1,cells:[{view:"template",css:"ssheet_comment_view",borderless:!0,scroll:"auto",onClick:{ssheet_comment_view:function(){e.view.config.readonly||e.view.isCellLocked(e.cell.row,e.cell.column)||e.showInput(e.view.comments.get(e.cell.row,e.cell.column))}}},{view:"textarea",on:{onChange:function(){e.addComment()},onFocus:function(){e.view.comments._activeComment={editStatus:!0,cell:e.cell}},onBlur:function(){e.view.comments._activeComment={},e.$dialog.hide()}}}]}}}},{key:"_setComment",value:function(){var e=this.view.comments.get(this.cell.row,this.cell.column);this.view.comments._activeComment.editStatus?this.showInput(e):this.showTemplate(e)}},{key:"showTemplate",value:function(e){this.template.show(),this.template.setHTML(e)}},{key:"showInput",value:function(e){var t=this;this.view.$$("cells").select(this.cell.row,this.cell.column),webix.delay(function(){t.changeTextarea(e),t.textarea.show(),t.textarea.focus()})}},{key:"addComment",value:function(){this.view.comments.add(this.cell.row,this.cell.column,this.textarea.getValue())}},{key:"changeTextarea",value:function(e){this.textarea.blockEvent(),this.textarea.setValue(e||""),this.textarea.unblockEvent()}}]),t}(),Ci=Object.freeze({action:"add-comment",DialogBox:yi}),$i=function(e){function t(){return i(this,t),v(this,h(t).apply(this,arguments))}return d(t,un),c(t,[{key:"open",value:function(e){this.group=e.group,this.header=e.value,un.prototype.open.apply(this,arguments)}},{key:"$show",value:function(){var e=this.view.getSelectedId();if(!e)return!1;this.view.$handleSelection=function(){return!1};var t=this.$dialog.getBody().elements;this.type=t.type,this.size=t.size,this.$dialog.getHead().getChildViews()[0].setHTML(this.header);var n,i=this.view.$$("cells");n="row"==this.group?i.getItem(e.row).$height||i.config.rowHeight:i.getColumnConfig(e.column).width||i.config.columnWidth,this.type.getOption(1).value=webix.i18n.spreadsheet.labels["row"==this.group?"height":"width"],this.type.setValue(1),this.type.refresh(),this.size.setValue(n),this.size.focus()}},{key:"$hide",value:function(){this.view.$handleSelection=null}},{key:"okClick",value:function(){var e=this.type.getValue(),t="auto";1==e?t=1*this.size.getValue():3==e&&(t=this.view.$$("cells").config["row"==this.group?"rowHeight":"columnWidth"]),"row"==this.group?this.view.setRowHeight(null,t):this.view.setColumnWidth(null,t),this.close()}},{key:"$init",value:function(){var t=this,e=webix.i18n.spreadsheet.labels;return{view:"ssheet-dialog",position:"center",width:300,move:!0,body:{padding:0,cols:[{view:"radio",name:"type",vertical:!0,optionHeight:40,on:{onChange:function(e){1==e?t.size.enable():t.size.disable()}},options:[{id:1,value:""},{id:2,value:e["fit-content"]},{id:3,value:e["default-size"]}]},{rows:[{view:"text",name:"size",width:120}]}]},on:{onSaveClick:function(){return t.okClick()},onCancelClick:function(){return t.close()}}}}}]),t}(),Si=[gn,fn,An,In,Dn,ui,hi,gi,wi,bi,_i,Ci,Object.freeze({action:"resize",DialogBox:$i})];var ki=!1;function Ei(e){Di(e,-1)}function Vi(e){Di(e,1)}function Ai(e){ki||(e._ssUndoHistory=[],e._ssUndoCursor=-1)}function zi(e,
t){e.$skipHistory||(e._ssUndoHistory.splice(e._ssUndoCursor+1),e._ssUndoHistory.push(t),e._ssUndoCursor++)}function Ii(e,t){t.$skipHistory++;try{e.call(t)}finally{t.$skipHistory--}}function Ri(e){ki=!0,e(),ki=!1}function Di(e,t){var n=e._ssUndoHistory[0<t?e._ssUndoCursor+t:e._ssUndoCursor];if(n){var i=0<t?n.newValue:n.value,o=0<t,r=[n.action,n.row,n.column,i,o];e._ssUndoCursor+=t;var a=n.group,l=e._ssUndoHistory[0<t?e._ssUndoCursor+t:e._ssUndoCursor];Ii(function(){e.callEvent("onUndo",r),a&&l&&a==l.group||(e.refresh(),e.callEvent("onAfterUndo",[]))},e),l&&a&&a==l.group&&Di(e,t)}}var Oi,Fi=Object.freeze({init:function el(o){Ai(o),function e(o){o.attachEvent("onUndo",function(e,t,n,i){switch(e){case"freeze-row":o.freezeRows(i);break;case"freeze-column":o.freezeColumns(i)}})}(o),o.attachEvent("onHardReset",function(){return Ai(o)}),o.attachEvent("onAfterSheetShow",function(){return Ai(o)}),o.attachEvent("onBeforeStyleChange",function(e,t,n,i){if(Mn(o,e,t))return!1;zi(o,{action:"style",row:e,column:t,value:i,newValue:n,group:g.value})}),o.attachEvent("onBeforeValueChange",function(e,t,n,i){if(Mn(o,e,t))return!1;zi(o,{action:"value",row:e,column:t,value:i,newValue:n,group:g.value})}),o.attachEvent("onBeforeSpan",function(e,t,n){if(Mn(o,e,t))return!1;zi(o,{action:"span",row:e,column:t,value:n,newValue:n,group:g.value})}),o.attachEvent("onBeforeSplit",function(e,t,n){if(Mn(o,e,t))return!1;zi(o,{action:"split",row:e,column:t,value:n,newValue:n,group:g.value})}),o.attachEvent("onAction",function(e,t){return zi(o,{action:e,row:t.row||null,column:t.column||null,value:t.value||null,newValue:t.newValue||null,group:g.value})}),o.$$("cells").attachEvent("onColumnResize",function(e,t,n){return zi(o,{action:"c-resize",row:0,column:e,value:n,newValue:t,group:g.value})}),o.attachEvent("onColumnOperation",function(e,t,n){"add"!==e.id&&"del"!==e.id&&zi(o,{action:e,row:0,column:{start:t,end:n}})}),o.attachEvent("onRowOperation",function(e,t,n){"add"!==e.id&&"del"!==e.id&&zi(o,{action:e,row:{start:t,end:n},column:0})}),o.$$("cells").attachEvent("onRowResize",function(e,t,n){return zi(o,{action:"r-resize",row:e,column:0,value:n,newValue:t,group:g.value})}),o.attachEvent("onBeforeConditionSet",function(e,t,n,i){if(Mn(o,e,t))return!1;n=n?webix.copy(n):null,zi(o,{action:"condition",row:e,column:t,value:n,newValue:i,group:g.value})}),o.$skipHistory=0},undo:Ei,redo:Vi,reset:Ai,ignoreUndo:Ii,ignoreReset:Ri});function Mi(i){clearTimeout(Oi),Oi=webix.delay(function(){var e=i.views;for(var t in e._pull){var n=e._types[e._pull[t].type].track;n&&Ui(i,e.get(t),n,e._pull[t])}})}function Ui(e,t,n,i){n(t,Pi(e,i,!0))}function Ni(e,t){for(var n in webix.callEvent("onClick",[]),e.views._pull){var i=webix.$$(n),o=e.views._pull[n];t&&(o.x=ji(e,i,o.x,"x"),o.y=ji(e,i,o.y,"y")),Ti(e,i,o)}}function Ti(e,t,n){var i=e._table.getScrollState();t.show({x:n.x,y:n.y-i.y})}function ji(e,t,n,i){if(n||0===n){var o="x"==i?function r(e){var t=0;return e._table.eachColumn(function(e){"rowId"!==e&&(t+=this.getColumnConfig(e).width)}),t}(e)-t.$width:function a(e){var t=0;return e._table.data.each(function(e){t+=e.$height||webix.skin.$active.rowHeight}),t}(e)-t.$height;n=Math.min(Math.max(n,0),o)}else n=e._table.getScrollState()[i]+50;return n}function Bi(e){return"string"==typeof e&&-1===e.indexOf("data:image")}function Pi(e,t,n){var i=t.data;if(/^(http|data:image|\/)/i.test(i))return i;var o=[];if(i){var r=t.config,a="rows"==r.dataSeries,l=0;i=Li(i);for(var s=0;s<i.length;s++){var c=Bi(i[s])?V(i[s],e):null;if(c){var u=$n(e,c[4]);c[4]=l;var d=u?u[a?"getRangeRows":"getRangeCols"].apply(u,c):null;if(d){l+=d[2];for(var h=0;h<d[0].length;h++)o[h]||(o[h]={}),webix.extend(o[h],d[0][h])}}}if(n&&r&&!Wi(r.type)){"object"!=p(r.legend)&&(r.legend={fromData:!!r.legend});var f=r.legend;if(f.fromData)o.shift();else if(f.range)for(var v=Hi(e,t),g=Ki(f.range,a,v),m=0;m<g.length;m++){var w=g[m];delete o[0][w]}}}return o}function Hi(e,t){var n=t.data;if(!/^(http|data:image|\/)/i.test(n)){var i={};if(n){var o=t.config,r=0;n=Li(n);for(var a=0;a<n.length;a++){var l=Bi(n[a])?V(n[a],e):null;if(l){
var s=$n(e,l[4]);l[4]=r;var c=s?s["rows"==o.dataSeries?"getRangeRows":"getRangeCols"].apply(s,l):null;c&&(r+=c[2],webix.extend(i,c[1]))}}}return i}}function Li(e){return e.replace(/\s/g,"").split(",")}function Wi(e){return/pie|donut/.test(e)}function qi(s,e,t,n,c){var u="rows"==t,d=[];if(e){var h=[],f=[],v=[];n&&(n.legend&&(f=Ki(n.legend,u)),n.xAxis&&(h=Ki(n.xAxis,u)),n.series&&(v=n.series.filter(function(e){return-1==f.indexOf(e.range)&&-1==h.indexOf(e.range)}))),e=Li(e);var g=0,m=1;e.forEach(function(o){var r=V(o,s);if(r){for(var a,l=u?r[0]:r[1],e=u?r[2]:r[3],t=function(e){var t=u?I(e,r[1],e,r[3],r[4]):I(r[0],e,r[2],e,r[4]);v.filter(function(e){return e.range==t&&e.active==o}).length&&(a=1)},n=l;n<=e;n++)t(n);var i=function(e){var t=u?I(e,r[1],e,r[3],r[4]):I(r[0],e,r[2],e,r[4]);if(-1!=f.indexOf(t)||-1!=h.indexOf(t))return"continue";var n=v.filter(function(e){return e.range==t&&e.active==o})[0];if(a&&!n&&(!c||!m||e!=l))return"continue";d.push(n||{active:o,range:t,marker:"square",tooltip:1,color:function i(e){var t=["#e06666","#6aa84f","#3c78d8","#e69138","#783f04","#134f5c","#674ea7","#c27ba0"];return t[e%t.length]}(g)}),g++};for(n=l;n<=e;n++)i(n);m=0}})}return d}function Ki(e,r,a){var l=[];return(e=Li(e)).forEach(function(e){e=V(e);for(var t=r?e[0]:e[1],n=r?e[2]:e[3],i=t;i<=n;i++){var o=r?I(i,e[1],i,e[3],e[4]):I(e[0],i,e[2],i,e[4]);l.push(a?a[o]:o)}}),l}function Yi(e){return"object"!=p(e.xAxis)&&(e.xAxis={fromData:!!e.xAxis}),"object"!=p(e.legend)&&(e.legend={fromData:!!e.legend}),e.legend=webix.extend(e.legend,{layout:"x",align:"center",valign:"bottom"}),e.scale||(e.scale={lines:1}),e}var Gi=Object.freeze({init:function tl(w){var o,u=w._table.$view.querySelector(".webix_ss_center");w.views={register:function(e,t,n){this._types[e]||(this._types[e]={render:t,track:n})},move:function(e,t,n){var i=webix.$$(e),o=webix.copy(this._pull[e]);this._pull[e].x=ji(w,i,t,"x"),this._pull[e].y=ji(w,i,n,"y"),w.callEvent("onAction",["move-view",{row:e,newValue:webix.copy(this._pull[e]),value:o}]),Ti(w,i,this._pull[e])},add:function(e,t,n,i,o,r){var a=this;o=o||{},"chart"==n&&(o=webix.extend(o,{type:"line",dataSeries:"columns"}));var l=o.height||300,s=o.width||500,c=webix.ui({id:r||"$ssheet-ui"+webix.uid(),view:"ssheet-ui",container:u,master:w._table.config.id,width:s,height:l});return c.attachEvent("onViewMoveEnd",function(e,t){var n=w._table.getScrollState();a.move(r,e,t+n.y)}),c.attachEvent("onViewResize",function(){var e=a._pull[r],t=webix.copy(e);e.config.height=c.$height,e.config.width=c.$width,w.callEvent("onAction",["resize-view",{row:r,newValue:webix.copy(e),value:t}])}),c.attachEvent("onViewEdit",function(){var e=a._pull[r],t=a._commands[e.type]||e.type;w.callEvent("onCommand",[{id:t,viewid:r,config:e}])}),c.attachEvent("onViewRemove",function(){return a.remove(r)}),r=c.config.id,e=ji(w,c,e,"x"),t=ji(w,c,t,"y"),this._pull[r]={x:e,y:t,type:n,data:i,config:o},this.update(r,i,o,!0),Ti(w,c,this._pull[r]),r},remove:function(e){var t=this._pull[e];webix.$$(e).close(),delete this._pull[e],w.callEvent("onAction",["add-view",{row:e,newValue:null,value:t}])},get:function(e){return webix.$$(e).getBody()},getConfig:function(e){return this._pull[e]},update:function(e,t,n,i){var o=i?null:webix.copy(this._pull[e]),r=this._pull[e],a=this._types[r.type];if(t=t||n.data||"",delete(n=n||{}).data,"chart"==r.type){var l=n.type;if(l&&!Wi(l)&&!n.series){var s=n.xAxis&&n.xAxis.range,c=n.legend&&n.legend.range,u=o&&o.config&&o.config.xAxis&&o.config.xAxis.fromData;n.series=qi(w,t,n.dataSeries,{xAxis:s,legend:c},u)}}var d=webix.$$(e),h=n.height||300,f=n.width||500;d.$width!=f&&d.$height!=h&&(d.define({width:f,height:h}),d.resize()),r.data=t,r.config=n;var v=this.get(e);if(t=Pi(w,r),a.render){var g=webix.copy(r);g.config.width=g.config.height=0,function m(e){var t=function(e){return"datatable"==e.name||"treetable"==e.name},n=e.queryView(t,"self");(n=n?[n]:e.queryView(t,"all")).forEach(function(e){return e.disable()})}(v=a.render(v,g,t))}a.track&&Ui(w,v,a.track,r),w.callEvent("onAction",["add-view",{row:e,newValue:webix.copy(this._pull[e]),value:o}])},
highlight:function(e){var t=webix.$$(e),n="webix_ssheet_ui_focused",i=webix.$$(this._activeWin);i&&!i.$destructed&&webix.html.removeCss(i.$view,n),t?(this._activeWin=e,webix.html.addCss(t.$view,n)):delete this._activeWin},_commands:{image:"add-image-top",chart:"add-chart"},_types:{},_pull:{}},w._table.attachEvent("onResize",function(){return Ni(w)}),w._table.attachEvent("onScrollY",function(){return Ni(w)}),w._table.attachEvent("onScrollX",function(){return Ni(w)}),w.attachEvent("onReset",function(){return function e(t){Ii(function(){for(var e in t.views._pull)t.views.remove(e)},t)}(w)}),w.attachEvent("onUndo",function(e,t,n,i){var o="move-view"===e;(o||"resize-view"==e||"add-view"===e)&&function u(e,t,n,i){if(i){var o=i.x,r=i.y,a=i.type,l=i.data,s=i.config;e.views._pull[n]?t?e.views.move(n,o,r):e.views.update(n,l,s):e.views.add(o,r,a,l,s,n);var c=e.$$("chartEditor");c&&c.viewId==n&&c.queryView("form").setValues(s)}else e.views.remove(n)}(w,o,t,i)}),w.attachEvent("onAction",function(e,t){"header-hide"==e?Ni(w):"before-grid-change"==e&&function u(e,t,n,i,o){for(var r=i.views,a=0;a<r.length;a++)if(Bi(r[a][3])){var l=r[a][4].series;l&&l.forEach(function(e){e.range=M(e.range,t,n,o)});var s=r[a][4].legend&&r[a][4].legend.range;s&&(r[a][4].legend.range=Li(s).map(function(e){return M(e,t,n,o)}).join(","));var c=r[a][4].xAxis&&r[a][4].xAxis.range;c&&(r[a][4].xAxis.range=M(c,t,n,o)),r[a][3]=Li(r[a][3]).map(function(e){return M(e,t,n,o)}).join(",")}}(0,t.name,t.inc,t.data,t.start)}),w.attachEvent("onColumnOperation",function(){return Ni(w,!0)}),w.attachEvent("onRowOperation",function(){return Ni(w,!0)}),w.attachEvent("onDataParse",function(e){return function i(t,e){var n=e.views;n&&Ii(function(){n.forEach(function(e){return t.views.add.apply(t.views,e)})},t)}(w,e)}),w.attachEvent("onDataSerialize",function(e,t){return function a(e,t,n){for(var i in t.views=[],e.views._pull){var o=e.views._pull[i],r=[o.x,o.y,o.type,o.data,o.config];n&&n.viewIds&&r.push(i),t.views.push(r)}}(w,e,t)}),w.attachEvent("onCellChange",function(){return Mi(w)}),w.attachEvent("onMathRefresh",function(){return Mi(w)}),w.attachEvent("onDestruct",function(){for(var e in w.views._pull)webix.$$(e).destructor()}),webix.attachEvent("onClick",function(e){var t=webix.$$(e);t&&t.config.externalUI&&(t=webix.$$(t.config.externalUI));var n=t&&(t.queryView("ssheet-ui","self")||t.queryView("ssheet-ui","parent"));if(n){w.views.highlight(n);var i=n.config.id;o&&(w.views.getConfig(i).type==o?n.callEvent("onViewEdit",[]):w.callEvent("onCommand",[{id:"close-ui-editor"}]))}else o||w.views.highlight()}),w.attachEvent("onUIEditStart",function(e,t){w.views.highlight(e),o=t}),w.attachEvent("onUIEditStop",function(e,t){o==t&&webix.delay(function(){o=null})}),w.views.register("chart",function(e,t,n){var i=function _(e,t,n){var i=/<[^>]*>/gi,o=webix.copy(e.config),r=(o=Yi(o)).scale.lines,a=o.scale.color||undefined,l=o.type;Wi(l)&&delete o.series;var s=o.legend,c=!s.fromData&&s.range;if(c){var u="rows"==o.dataSeries;c=Ki(s.range,u,n)}var d={align:s.align||"center",valign:s.valign||"bottom"};if(d.layout="middle"==d.valign?"y":"x",Wi(l))!function x(e,t,n,i){var o=/<[^>]*>/gi;for(var r in e[0]){t.legend.fromData?(n.template=function(e){var t=e[r];return t||0===t?(t+"").replace(o,""):""},t.value="#".concat(r.replace("0","1"),"#")):(t.legend.range&&(n.template=function(e){var t=e[i[0]];return t||0===t?(t+"").replace(o,""):""}),t.value="#".concat(r,"#"));break}n.template?t.legend=n:delete t.legend,t.pieInnerText&&(t.pieInnerText=t.value)}(t,o,d,c);else if(o.series){d.values=[];var h=o.series;o.series=[];var f=o.xAxis;f.fromData?f.range=c?Object.keys(t[0]).filter(function(e){return-1==c.indexOf(e)})[0]:"data0":f.range&&(f.range=n[f.range]);for(var v=0;v<h.length;v++){var g=h[v].color,m=n[h[v].range];if(m!=f.range){var w={value:"#".concat(m,"#"),tooltip:{template:h[v].tooltip?"#".concat(m,"#"):""}};if("radar"==l||"line"==l||"spline"==l?(w.line={color:g},w.item={borderColor:g,type:h[v].marker}):w.color=g,"area"!=l&&"splineArea"!=l||(w.alpha=.7),t[0]&&(c||s.fromData)){var p=c?t[0][c[v]]:t[0][m],
b=p||0===p?(p+"").replace(i,""):"";d.values.push({text:b,color:g})}o.series.push(w)}}f.range?o.xAxis={template:function(e){var t=e[f.range];return t||0===t?(t+"").replace(i,""):""},title:o.xAxis.title,lineColor:a,color:a,lines:r}:delete o.xAxis,d.values.length?o.legend=d:delete o.legend}return o.yAxis=webix.extend(o.yAxis||{},{lineColor:a,color:a,lines:r,lineShape:o.scale.circle?"arc":"default"}),webix.extend({view:"chart"},o,!0)}(t,n,Hi(w,t));return webix.ui(i,e)},function(e,t){e.clearAll(),e.parse(t)}),w.views.register("image",function(e,t,n){var i=webix.extend({css:"webix_ssheet_bgimage",template:'<img src="'.concat(n,'"/>')},t.config||{},!0);return webix.ui(i,e)})},_getDataParts:Li,_isPie:Wi,_getSeries:qi,_getParts:Ki,_normalizeConfig:Yi}),Zi=webix.i18n.spreadsheet.labels;function Xi(t){t.attachEvent("onComponentInit",function(){return function e(l){var s=l.$$("chartEditor"),a=s.queryView("form"),c=a.elements;function u(){if(c["legend.fromData"].getValue()){var e=Wi(c.type.getValue())?v:i;f(c["legend.range"],e())}}function d(e){if(e){var t=c["legend.range"].getValue();g("",t)}var n=Wi(c.type.getValue())?v:i;e=e?n():"",f(c["legend.range"],e)}function h(e){if(e){var t=c["xAxis.range"].getValue();g("",t)}e=e?v():"",f(c["xAxis.range"],e)}function f(e,t){e.blockEvent(),e.setValue(t),e.unblockEvent()}function v(){var e=c.range.getValue(),t=c.dataSeries.getValue(),n=c["legend.range"].getValue(),i="",o=qi(l,e,t,{legend:n||""});return o.length&&(i=o[0].range),i}function i(){var i=Li(c.range.getValue()),o="rows"==c.dataSeries.getValue(),r=Li(c["xAxis.range"].getValue()),a=[];return i.forEach(function(e){if(-1==r.indexOf(e)){var t=V(e,l);if(t){var n=o?I(t[0],t[1],t[2],t[1],t[4]):I(t[0],t[1],t[0],t[3],t[4]);-1==i.indexOf(n)&&a.push(n)}}}),a.join(",")}function g(e,t){var n=c.range.getValue(),i=c["legend.range"].getValue(),o=c["xAxis.range"].getValue(),r=c.dataSeries.getValue(),a=qi(l,n,r,{legend:i,xAxis:o});t=Li(t),n=Li(n).filter(function(e){return-1==t.indexOf(e)}),e&&(e=Li(e)).forEach(function(t){var e=a.filter(function(e){return e.range==t});e.length||n.push(t)}),f(c.range,n.join(","))}function m(e){var t=c["legend.align"],n=t.getList();"middle"==e?n.exists("center")&&n.remove("center"):n.exists("center")||n.add({id:"center",value:Zi["chart-legend-center"]},1)}function w(e){var t=c["legend.valign"],n=t.getList();"center"==e?n.exists("middle")&&n.remove("middle"):n.exists("middle")||n.add({id:"middle",value:Zi["chart-legend-middle"]},1)}function p(e){var t=l.$$("chartTabs").getTabbar();x(),u(),c.series.hideMarkers("radar"==e||"line"==e||"spline"==e),"area"==e||"bar"==e?c.stacked.show():n(c.stacked),"radar"==e?c["scale.circle"].show():n(c["scale.circle"]),"pie"==e?c["3D"].show():n(c["3D"]),Wi(e)?(o("axis"),c.pieInnerText.show(),t.hideOption("advanced")):(o("axis",!0),n(c.pieInnerText),t.showOption("advanced")),Wi(e)||"radar"==e?o("axisTitle"):o("axisTitle",!0)}function b(e){var t=c.range.getValue(),n=c.series.getValue(),i=c["legend.range"].getValue(),o=c["xAxis.range"].getValue(),r=c.dataSeries.getValue();n=qi(l,t,r,{series:n,legend:i,xAxis:o},e),c.series.setValue(n)}function x(){var e="rows"==c.dataSeries.getValue(),t=Wi(c.type.getValue());!t&&e||!e&&t?(c["legend.fromData"].define("label",Zi["chart-col-legend"]),c["xAxis.fromData"].define("label",Zi["chart-row-xAxis"])):(c["legend.fromData"].define("label",Zi["chart-row-legend"]),c["xAxis.fromData"].define("label",Zi["chart-col-xAxis"])),c["legend.fromData"].refresh(),c["xAxis.fromData"].refresh()}function n(e){e.setValue&&f(e),e.hide()}function o(e,t){a.queryView({batch:e},"all").forEach(function(e){t?e.show():n(e)})}l.attachEvent("onCommand",function(e){if("add-chart"==e.id){var t=e.config,n=t&&t.config||{};s.show(),l.$handleSelection=function(e,t,n,i){var o=webix.UIManager.getFocus();if(s.queryView(function(e){return e==o}))if(o==c.range||o==c["legend.range"]){var r=o.getValue(),a=r.lastIndexOf(",");r=-1==a?"":r.substring(0,a+1),o.setValue(r+n+":"+i)}else o.config.range&&o.setValue(n+":"+i);return!1},a.clear(),l.$$("chartTabs").setValue("common"),(n=Yi(n)
).range=t?t.data:l.getSelectedRange(),s.viewId=e.viewid?e.viewid:l.views.add(null,null,"chart",n.range,n),l.callEvent("onUIEditStart",[s.viewId,"chart"]),w(n.legend.align),m(n.legend.valign),p(n.type),a.setValues(function i(e){/stacked|3D/.test(e.type)&&(e.type=e.type.replace(/stacked|3D/,"").toLowerCase());return e}(n)),n.legend.fromData&&d(n.legend.fromData),n.xAxis.fromData&&h(n.xAxis.fromData),b(),a.queryView("accordionitem","all").forEach(function(e){return e.expand()}),c.range.focus()}}),l.attachEvent("onUIEditStart",function(e,t){s.isVisible()&&"chart"!=t&&Qi(l)}),l.attachEvent("onCommand",function(e){"close-ui-editor"==e.id&&s.isVisible()&&Qi(l)}),l.attachEvent("onAction",function(e,t){"add-view"!=e||t.newValue||s.isVisible()&&s.viewId==t.row&&Qi(l)}),a.attachEvent("onChange",function(e,t){var n=this.$eventSource;if(n===c.range||n===c["xAxis.range"]||n===c["legend.range"]){var i=e.toUpperCase();e!=i&&f(n,e=i)}switch(n){case c.type:p(e);break;case c.range:case c.dataSeries:this.$eventSource==c.dataSeries&&x(),c["legend.fromData"].getValue()&&u(),c["xAxis.fromData"].getValue()&&f(c["xAxis.range"],v()),b();break;case c["xAxis.fromData"]:h(e),b(t);break;case c["legend.fromData"]:d(e),b();break;case c["legend.align"]:w(e);break;case c["legend.valign"]:m(e);break;case c["xAxis.range"]:c["xAxis.fromData"].getValue()&&f(c["xAxis.fromData"]),g(e,t);break;case c["legend.range"]:c["legend.fromData"].getValue()&&f(c["legend.fromData"]),g(e,t)}var o=function r(e){e.stacked?e.type="stacked"+e.type.charAt(0).toUpperCase()+e.type.substr(1):e["3D"]&&(e.type+="3D");return e}(a.getValues());l.views.update(s.viewId,o.range,o)}),c.series.attachEvent("onRangeChange",g)}(t)});var e=webix.skin.$active,n=e.dataPadding-2,i=e.layoutMargin.form;return{width:420,hidden:!0,id:"chartEditor",css:"ssheet_chart",rows:[{height:e.barHeight,css:"ssheet_chart_wizard_head",padding:{left:2},cols:[{view:"icon",hotkey:"esc",icon:"webix_ssheet_icon ssi-arrow-left",click:function(){return Qi(t)}},{type:"header",borderless:!0,template:Zi["chart-edit"]}]},{view:"form",complexData:!0,borderless:!0,padding:{top:0},elementsConfig:{labelWidth:180},elements:[{view:"tabview",id:"chartTabs",cells:[{id:"common",borderless:!0,type:"form",paddingX:0,header:Zi["chart-common"],rows:[{view:"scrollview",body:{margin:i,rows:[Ji("type","chart-type",function o(){return[{id:"line",value:Zi["line-chart"]},{id:"spline",value:Zi["spline-chart"]},{id:"splineArea",value:Zi["splinearea-chart"]},{id:"area",value:Zi["area-chart"]},{id:"bar",value:Zi["bar-chart"]},{id:"radar",value:Zi["radar-chart"]},{id:"pie",value:Zi["pie-chart"]},{id:"donut",value:Zi["donut-chart"]}]}()),{view:"checkbox",label:Zi["stacked-chart"],name:"stacked",hidden:!0},{view:"checkbox",label:Zi["chart-pie-3d"],name:"3D",hidden:!0},{view:"text",label:Zi["chart-range"],name:"range"},{view:"checkbox",label:Zi["chart-col-xAxis"],name:"xAxis.fromData",batch:"axis"},{view:"checkbox",label:Zi["chart-pie-text"],name:"pieInnerText",hidden:!0},{view:"checkbox",label:Zi["chart-row-legend"],name:"legend.fromData"},{view:"radio",label:Zi["chart-data-from"],name:"dataSeries",vertical:!0,options:[{id:"columns",value:Zi["chart-columns"]},{id:"rows",value:Zi["chart-rows"]}]},{}]}}]},{id:"advanced",borderless:!0,type:"form",paddingX:0,padding:{bottom:0},header:Zi["chart-series"],rows:[{view:"ssheet-series",name:"series"}]},{id:"extras",borderless:!0,type:"form",paddingX:0,header:Zi["chart-extras"],rows:[{view:"scrollview",body:{view:"accordion",margin:webix.skin.$active.layoutMargin.form,css:"webix_ssheet_accordion",multi:!0,type:"clean",rows:[{header:Zi["chart-legend"],body:{margin:i,padding:n,rows:[{view:"text",label:Zi["chart-legend-range"],name:"legend.range"},Ji("legend.align","chart-legend-align",function r(){return[{id:"left",value:Zi["chart-legend-left"]},{id:"center",value:Zi["chart-legend-center"]},{id:"right",value:Zi["chart-legend-right"]}]}()),Ji("legend.valign","chart-legend-valign",function a(){return[{id:"top",value:Zi["chart-legend-top"]},{id:"middle",value:Zi["chart-legend-middle"]},{id:"bottom",
value:Zi["chart-legend-bottom"]}]}())]}},{header:Zi["chart-axis"],body:{margin:i,padding:n,rows:[{view:"text",label:Zi["chart-xAxis-range"],name:"xAxis.range",range:!0,batch:"axis"},{view:"text",label:Zi["chart-xAxis-title"],name:"xAxis.title",batch:"axisTitle"},{view:"text",label:Zi["chart-yAxis-title"],name:"yAxis.title",batch:"axisTitle"},{view:"checkbox",label:Zi["chart-scale"],name:"scale.lines",batch:"axis"},{view:"checkbox",label:Zi["chart-radar-circle"],name:"scale.circle",hidden:!0},{view:"ssheet-colorpicker",label:Zi["chart-scale-color"],name:"scale.color",batch:"axis"}]}},{}]}}]}]}]}]}}function Qi(e){var t=e.$$("chartEditor");e.callEvent("onUIEditStop",[t.viewId,"chart"]),t.viewId=null,e.$handleSelection=null,t.hide()}function Ji(e,t,n){return{view:"richselect",name:e,label:Zi[t],suggest:{view:"ssheet-form-suggest",data:n}}}function eo(e,t,n,i,o,r){var a,l,s,c,u,d=0,h=0,f=i._table.getSelectArea(),v=i._table.getScrollState();s=i.serialize({math:!0,viewIds:!0}),c=webix.copy(s);var g=s.spans;for(var m in g){var w=g[m];((w=Wn(w,e,t,n,s.data))[2]<=0||w[3]<=0)&&g.splice(m,1)}u=function x(e,t,n){var i=e.group,o="add"==e.id?1:"del"==e.id?-1:0;o&&("row"==i&&(o+=o*(n.row-t.row)),"column"==i&&(o+=o*(n.column-t.column)));return{name:i,inc:o}}(e,t,n),i.$handleSelection=null,o||Ii(function(){i.callEvent("onAction",["before-grid-change",{name:u.name,inc:u.inc,data:s,start:t}])},i),a=s.data,"column"==e.group?(d=n.column-t.column+1,h=t.column,"add"==e.id?function _(e,t,n,i,o,r,a){var l=a.length,s=n.column-t.column+1;i.config.columnCount+=s,i.reset();for(;l--;)a[l][1]>=t.column&&(a[l][1]+=s);o?a.push.apply(a,E(r)):i.callEvent("onColumnOperation",[e,t,n,null])}(e,t,n,i,o,r,a):"del"==e.id&&(!function y(e,t,n,i,o,r,a){var l=a.length,s=n.column-t.column+1;if(i.config.columnCount===s){if(t.column==n.column)return;n.column--,s--}i.config.columnCount-=s,i.reset();var c=[];for(;l--;)a[l][1]>=t.column&&a[l][1]<=n.column?c.push(a.splice(l,1)[0]):a[l][1]>n.column&&(a[l][1]-=s);o||i.callEvent("onColumnOperation",[e,t,n,c])}(e,t,n,i,o,0,a),d=-d)):"row"==e.group&&(d=n.row-t.row+1,h=t.row,"add"==e.id?function C(e,t,n,i,o,r,a){var l=a.length,s=n.row-t.row+1;i.config.rowCount+=s,i.reset();for(;l--;)a[l][0]>=t.row&&(a[l][0]+=s);o?a.push.apply(a,E(r)):i.callEvent("onRowOperation",[e,t,n,null])}(e,t,n,i,o,r,a):"del"==e.id&&(!function $(e,t,n,i,o,r,a){var l=a.length,s=n.row-t.row+1;if(i.config.rowCount===s){if(t.row==n.row)return;n.row--,s--}i.config.rowCount-=s,i.reset();var c=[];for(;l--;)a[l][0]>=t.row&&a[l][0]<=n.row?c.push(a.splice(l,1)[0]):a[l][0]>n.row&&(a[l][0]-=s);o||i.callEvent("onRowOperation",[e,t,n,c])}(e,t,n,i,o,0,a),d=-d));var p={id:e.group,start:h,count:d};for(l=a.length;l--;)a[l][2]&&"string"==typeof a[l][2]&&"="==a[l][2].substr(0,1)&&(a[l][2]=_n(a[l][2],p));if(i.callEvent("onAction",["grid-change",{value:c,newValue:s}]),Ii(function(){to(i,s),i._table.scrollTo(v.x,v.y)},i),f){var b=i.$$("cells");(f=function S(e,t){var n=t.count(),i=t.config.columns.length;return 1*e.start.row>n?null:1*e.end.row>n?null:1*e.start.column>i?null:1*e.end.column>i?null:e}(f,b))&&b.addSelectArea(f.start,f.end)}}function to(e,t){Ri(function(){e.$handleSelection=null,e.parse(t)})}var no=Object.freeze({init:function nl(o){o.attachEvent("onCommand",function(e,t,n){if("add"==e.id||"del"==e.id){var i=o._table.getSelectArea();!i||t&&n||(t=i.start,n=i.end),t&&n&&g.set(function(){eo(e,t,n,o)})}}),o.attachEvent("onUndo",function(e,t,n,i){"grid-change"==e&&(bn(!0),to(o,i))})},process:eo});function io(e,t){var n=ro(e);return t=oo(pn(t,n,"").handler,n)}function oo(e,t){var n,i=webix.i18n.spreadsheet.table["math-error"];try{n=e.call(t)}catch(o){return i}return"number"==typeof n?isFinite(n)?Math.round(1e5*n)/1e5:i:"string"!=typeof n?n?n.toString():i:n}function ro(r){var e=$n(r);return{rs:function(e,t,n,i,o){return $n(r,e).getRange(t,n,i,o)},r:e.getRange,vs:function(e,t,n){return $n(r,e).getValue(t,n)},v:e.getValue,m:Mt,p:{},e:function(e){throw e}}}var ao=Object.freeze({init:function il(l){var c=[],a=[],s=!1;l._mathSheetCache={};var d,h,v=ro(l);function u(e,t,n){
var i=l.getRow(e),o=oo(n,v);i[t]=o;var r=1e8*t+e,a=h[r]=(h[r]||0)+1;d[r]===o||1e3<a||(d[r]=o,g(e,t))}function g(e,t){var n=c[e];if(n){var i=n[t];if(i)for(var o=0;o<i.length;o++){var r=i[o],a=r.row,l=r.column,s=r.handler;a==e&&l==t||u(a,l,s)}}}function t(){c=[],a=[];var e=l.$$("cells"),t=e.getState(),r=t.ids.concat(t.hidden);e.eachRow(function(e){for(var t=this.getItem(e),n=1;n<r.length;n++){var i=r[n],o=t["$"+i];o&&f(e,i,o)}},!0)}function f(e,t,n){if(s&&n&&"string"==typeof n&&0===n.indexOf("="))l.getRow(e)["$"+t]=n;else{var i=a[e];if(i&&i[t]&&function u(e,t,n,i){var o=t[i][n];t[i][n]=null;for(var r=o.length-1;0<=r;r--)for(var a=o[r],l=e[a[0]][a[1]],s=l.length-1;0<=s;s--){var c=l[s];c.row==i&&c.column==n&&l.splice(s,1)}}(c,a,t,e),n&&1<(n=n.toString()).length&&0===n.indexOf("=")){var o=pn(n,v,""),r=l.getRow(e);r[t]=oo(o.handler,v),r["$"+t]=o.text,o.triggers.length&&function f(e,t,n,i,o){for(var r=[],a=0;a<n.length;a++){var l=n[a];if(""===l[4]||l[4]===o)for(var s=l[0];s<=l[2];s++){var c=e[s];c||(c=e[s]=[]);for(var u=l[1];u<=l[3];u++){var d=c[u];d||(d=c[u]=[]),r.push([s,u]),d.push(i)}}}!function h(e,t,n,i){var o=e[t];o||(o=e[t]=[]),o[n]=i}(t,i.row,i.column,r)}(c,a,o.triggers,{row:e,column:t,handler:o.handler},l.getActiveSheet())}d={},h={},g(e,t)}}l.ranges=v.ranges=new kn(l),v.p=function e(i){var o={};return i.setPlaceholder=function(e,t){if("object"===p(e))for(var n in e)o[n.toLowerCase()]=e[n];else o[e.toString().toLowerCase()]=t;i.callEvent("onMathRefresh",[])},o}(l),l.attachEvent("onReset",function(){c=[],a=[],s=!0,l.ranges.clear()}),l.attachEvent("onCellChange",function n(e,t){f(e,t,l.getCellValue(e,t))}),l.attachEvent("onMathRefresh",function(){t(),l.$$("cells").refresh()}),l.attachEvent("onDataSerialize",function(e){return function n(e,t){t.ranges=e.ranges.serialize()}(l,e)}),l.attachEvent("onDataParse",function(e){l.ranges.parse(e.ranges),s=!1,t()}),l.attachEvent("onAction",function(e,t){"before-grid-change"==e&&(bn(!0),function a(e,t,n,i){for(var o=n.ranges,r=0;r<o.length;r++)o[r][1]=M(o[r][1],e,t,i)}(t.name,t.inc,t.data,t.start))}),function i(t,e,n){t.attachEvent("onBeforeSheetShow",function(){delete t._mathSheetCache[sn(t)]}),t.attachEvent("onSheetRename",function(a,l){t._sheets.forEach(function(e){var r={multiSheet:!1};["data","editors","conditions","ranges"].forEach(function(o){e.content[o]&&e.content[o].forEach(function(e){switch(o){case"data":"="===e[2][0]&&(e[2]=Cn(e[2],a,l,r));break;case"editors":var t=e[2].options;if(t)if("string"==typeof t)e[2].options=Cn(t,a,l,r);else for(var n=0;n<t.length;n++){var i="string"==typeof t[n]?t[n]:t[n].value;t[n]=Cn(i,a,l,r)}break;case"conditions":"="===e[3][0]&&(e[3]=Cn(e[3],a,l,r));break;case"ranges":e[1]=Cn(e[1],a,l,r)}})}),!0===r.multiSheet&&(delete t._mathSheetCache[e.name],$n(t,e.name),bn())}),delete t._mathSheetCache[a]}),t.attachEvent("onSheetRemove",function(e){delete t._mathSheetCache[e]}),t._mathSheetCore=e,t._mathSheetHelpers=n}(l,v,{parse:pn,execute:oo})},calculate:io});function lo(e,t){return isNaN(1*t)?"="==t.charAt(0)&&(t=io(e,t)):t*=1,t}function so(e,t,n){if(e.conditions._empty)return"";var i,o;if(!(i=e.conditions.get(t,n)))return"";for(o=i.length;o--;){var r=e.conditions.handlers[i[o][0]],a=e.getRow(t)[n];if(r&&r(a,i[o][1]))return i[o][2]}return""}function co(e,t,n,i){return i._empty=!1,e[t]||(e[t]={}),e[t][n]||(e[t][n]=[]),e[t][n]}function uo(e){if(this._empty=!0,e)for(var t=e.length;t--;){var n=e[t];co(this._pull,n[0],n[1],this).push([n[2],n[3],n[4]])}}function ho(){this._pull={}}function fo(e,t,n){this.get(e,t)||co(this._pull,e,t,this),this._pull[e][t]=n}function vo(e,t){return e?t?this._pull[e]?this._pull[e][t]:null:this._pull[e]:this._pull}function go(e,t,n,i,o){co(this._pull,e,t,this).push([n,i,o])}function mo(e,t){this.get(e,t)&&delete this._pull[e][t]}function wo(){var e,t,n,i,o=[];for(i in this._pull)for(e in this._pull[i])for(n=0;n<this._pull[i][e].length;n++)t=this._pull[i][e][n],o.push([i,e,t[0],t[1],t[2]]);return o}function po(e,t){g.set(function(){D(t,e,function(e,t){var n=e.conditions.get(t.row,t.column);n&&xo("remove",t.row,t.column,n,null,e)
}),e.refresh()})}function bo(e,t,n,i,o){var r=t.condition;xo("update",n,i,e.conditions.get(n,i)||null,r,e),1===o&&xo("remove",t.row,t.col,r,null,e)}function xo(e,t,n,i,o,r){r.callEvent("onBeforeConditionSet",[t,n,i,o])&&(r.conditions[e].apply(r.conditions,[t,n,o]),r.callEvent("onAfterConditionSet",[t,n,i,o]))}var _o=Object.freeze({init:function ol(r){r.conditions={_empty:!0,_pull:{},handlers:{">":function(e,t){return e>lo(r,t)},"<":function(e,t){return e<lo(r,t)},"=":function(e,t){return e===lo(r,t)},"!=":function(e,t){return e!==lo(r,t)},"<>":function(e,t){var n=t[0],i=t[1];return webix.isArray(t)&&e<lo(r,i)&&e>lo(r,n)}},add:go,remove:mo,update:fo,get:vo,parse:uo,serialize:wo,clear:ho},r.attachEvent("onConditionSet",function(e){return function t(n,i){g.set(function(){n.eachSelectedCell(function(e){var t=n.conditions.get(e.row,e.column);xo("update",e.row,e.column,t||null,i,n)})}),n.refresh()}(r,e)}),r.attachEvent("onUndo",function(e,t,n,i){"condition"==e&&function o(e,t,n,i){e.conditions.get(t,n)&&e.conditions.remove(t,n),i&&e.conditions.update(t,n,i)}(r,t,n,i)}),r.attachEvent("onDataSerialize",function(e){return function n(e,t){t.conditions=e.conditions.serialize()}(r,e)}),r.attachEvent("onDataParse",function(e){return function n(e,t){e.conditions.parse(t.conditions)}(r,e)}),r.attachEvent("onColumnInit",function(e){return function t(o,e){e.cssFormat=function(e,t,n,i){return so(o,n,i)}}(r,e)}),r.attachEvent("onReset",function(){return r.conditions.clear()}),r.attachEvent("onAction",function(e,t){"before-grid-change"==e&&function c(e,t,n,i){var o=n.conditions,r=o.length;if(t)for(;r--;){var a=k(o[r],2),l=a[0],s=a[1];("row"==e&&l>=i.row||"column"==e&&s>=i.column)&&("row"==e?l<i.row-t?o.splice(r,1):o[r][0]=1*l+t:"column"==e&&(s<i.column-t?o.splice(r,1):o[r][1]=1*s+t))}}(t.name,t.inc,t.data,t.start)}),function t(e){e.conditions.clear()}(r)},getConditionCss:so,clearConditionalFormats:po,pasteCondition:bo,_changeCondition:xo});function yo(e){e._table._ssEditors={}}function Co(e,t){e._table.editStop(),D(t,e,function(e,t){var n=e._table._ssEditors[t.row];n&&n[t.column]&&(delete n[t.column],e._table.removeCellCss(t.row,t.column,"ss_editor"),Pn(e,t.row,t.column,"ss_editor",!1))})}function $o(e,t,n,i,o){var r=t.dropdown;e.setCellEditor(n,i,r),1===o&&e.setCellEditor(t.row,t.col,{})}var So,ko,Eo,Vo,Ao,zo=Object.freeze({init:function rl(a){var e=a._table;a.attachEvent("onReset",function(){return yo(a)}),yo(a),e.attachEvent("onBeforeEditStart",function(e){var t=this.getColumnConfig(e.column);if(this._ssEditors[e.row]){var n=this._ssEditors[e.row][e.column];n&&(webix.extend(t,n,!0),webix.extend(t,{row:a.getRow(e.row)},!0),n.options&&("string"==typeof n.options?t.options=Sn(a,n.options,{unique:!0,order:!0,empty:!0}):webix.isArray(n.options)&&(t.options=Sn(a,n.options,{empty:!0}))))}}),e.attachEvent("onBeforeEditStop",function(e,t,n){if(!n&&t.getFormat){var i=t.getValue(),o=t.getFormat(i);g.set(function(){a.setCellValue(t.row,t.column,i),o?we(a,t.row,t.column,ge(o)):pe(a,t.row,t.column)});var r=a.getSelectedId();r&&r.row==t.row&&r.column==t.column&&(o=Ae(o=o||"common")?"custom":o,a.callEvent("onCommand",[{id:"toolbar-update",name:"format",value:o}]))}}),e.attachEvent("onAfterEditStop",function(e,t){var n=this.getColumnConfig(t.column);n.editor="text",delete n.popup,delete n.$popup,delete n.row}),a.attachEvent("onUndo",function(e,t,n,i){"dropdown"==e&&a.setCellEditor(t,n,i)}),a.attachEvent("onAction",function(e,t){"dropdown"==e?Pn(a,t.row,t.column,"ss_editor",t.newValue):"before-grid-change"==e&&function u(e,t,n,i){var o=n.editors;if(t)for(var r=o.length-1;0<=r;r--){var a=k(o[r],3),l=a[0],s=a[1],c=a[2];if("row"==e&&l>=i.row||"column"==e&&s>=i.column){if("row"==e){if(l<i.row-t){o.splice(r,1);continue}o[r][0]=1*l+t}else if("column"==e){if(s<i.column-t){o.splice(r,1);continue}o[r][1]=1*s+t}c.options=M(c.options,e,t,i)}}}(t.name,t.inc,t.data,t.start)})},serialize:function al(e,t){var n,i,o=e._table._ssEditors,r=[];for(n in o)for(i in o[n])r.push([n,i,o[n][i]]);t.editors=r},load:function ll(e,t){var n=t.editors;if(n)for(var i=0;i<n.length;i++
)e.setCellEditor.apply(e,n[i])},clearEditors:Co,isEditor:function sl(e,t,n){var i=e._table._ssEditors;return i[t]&&!!i[t][n]},pasteDropdown:$o});function Io(e,t,n,i,o,r){var a=i;if("object"===p(i)){if(a=i.math?_n(i.math,r,Eo):i.text,i.style&&i.style.props){var l=e.addStyle(i.style.props);e.setStyle(t,n,l)}var s=i.extra;s&&(s.condition&&bo(e,s,t,n,Vo),s.dropdown&&$o(e,s,t,n,Vo),s.filter&&Ao&&ni(e,s,t,n,0,r)),qn(e,s,t,n,Vo,r)}e.setCellValue(t,n,a)}var Ro=Object.freeze({init:function cl(i){var o=i.$$("cells");o.attachEvent("onKeyPress",function(e,t){67!==e&&88!==e||!t.ctrlKey&&!t.metaKey||!o.getSelectedId()||(So=function n(c,u){var d,h,f=[];return u.mapSelection(function(e,t,n){t!=h&&(d=[],f.push(d),h=t);var i={text:e,math:u.getItem(t)["$"+n],style:c.getStyle(t,n)},o=c.conditions.get(t,n),r=c.getCellEditor(t,n),a=c.getCellFilter(t,n),l=c._table.getSpan(t,n);if(r||a||o||l){var s={row:t,col:n};o&&(s.condition=o),r&&(s.dropdown=r),a&&(s.filter=a),l&&(s.span=l),i.extra=s}return d.push(i),e}),f}(i,o),ko=document.getElementsByClassName("webix_clipbuffer")[0].value,Eo=o.getSelectArea(),(Vo=1*(88===e))&&0!==Object.keys(i._table._ssFilters).length&&(Ao=function u(e,t,n){for(var i=Object.keys(e),o=Math.min.apply(null,i),r=Math.max.apply(null,i),a=n,l=1,s=o;s<=r;s++)if(e[s]){var c=Object.keys(e[s]);a=Math.min(a,Math.min.apply(null,c)),l=Math.max(l,Math.max.apply(null,c))}return t.start.row<=o&&t.end.row>=r&&t.start.column<=a&&t.end.column>=l}(i._table._ssFilters,Eo,i.config.columnCount)))}),i.config.readonly||o.attachEvent("onPaste",function(e){!function a(l,n,e){var t=n.getSelectArea();if(t){var i=t.start,o=e===ko,s=o?So:webix.csv.parse(e,n.config.delimiter);!o&&l.config.clipboardDecimalDelimiter&&(s=function r(e,t){for(var n=0;n<e.length;n++)for(var i=0;i<e[n].length;i++){var o=e[n][i].toString().replace(t,".");webix.rules.isNumber(o)&&(e[n][i]=o)}return e}(s,l.config.clipboardDecimalDelimiter));var c={id:"move",column:0,row:0,cut:Vo};o?(c.column=i.column-Eo.start.column,c.row=i.row-Eo.start.row):Vo=0,g.set(function(){if(Ao&&l.removeFilters(),function a(e,t,n){var i=t.row+n.length-1,o=t.column+n[0].length-1;if(i>e.config.rowCount||o>e.config.columnCount){var r={id:"add"};i>e.config.rowCount&&(r.group="row",e.callEvent("onCommand",[r,{row:e.config.rowCount+1},{row:i}])),o>e.config.columnCount&&(r.group="column",e.callEvent("onCommand",[r,{column:e.config.columnCount+1},{column:o}]))}}(l,i,s),1===Vo)for(var e=Eo.start.row;e<=Eo.end.row;e++)for(var t=Eo.start.column;t<=Eo.end.column;t++)l.setCellValue(e,t,null),l.setStyle(e,t,null);1!=s.length||1!=s[0].length||Ao?n.mapCells(i.row,i.column,s.length,null,function(e,t,n,i,o){if(s[i]&&s[i].length>o){var r=s[i][o];Io(l,t,n,r,0,c)}},!0):l.eachSelectedCell(function(e){var t={id:"move",column:c.column+1*e.column-i.column,row:c.row+1*e.row-i.row,cut:Vo};Io(l,e.row,e.column,s[0][0],0,t)}),1===Vo&&(Ao=!(Vo=2))}),l.refresh()}}(i,o,e)})}});var Do=Object.freeze({init:function ul(r){r.attachEvent("onDataParse",function(e){return function d(e,t){var n=e.$$("cells"),i=t.table||{frozenColumns:0,frozenRows:0};e._frozenColumns=e._frozenRows=0,i&&(webix.isUndefined(i.frozenColumns)||e.freezeColumns(i.frozenColumns),webix.isUndefined(i.frozenRows)||e.freezeRows(i.frozenRows)),t.sizes&&n.define("fixedRowHeight",!1);for(var o=0;o<t.data.length;o++){var r=k(t.data[o],5),a=r[0],l=r[1],s=r[2],c=r[4];"string"==typeof s&&(s=s.replace(/^=link\(/i,"=HYPERLINK("));var u=n.getItem(a);u[l]=s,e.ignoreUndo(function(){e.callEvent("onCellChange",[a,l,s,c])})}}(r,e)}),r.attachEvent("onDataSerialize",function(e,t){return function o(s,e,t){var c=!t||!1!==t.math,u=[],n=s.$$("cells"),i=n.getState(),d=i.ids.concat(i.hidden);d.splice(d.indexOf("rowId"),1),n.eachRow(function(e){for(var t=this.getItem(e),n=0;n<d.length;n++){var i=d[n],o=t[i],r=t.$cellCss&&t.$cellCss[i]||"";c&&t["$"+i]&&(o=t["$"+i]);var a=o||0===o;if(a||r){var l=Tt(s,e,i);u.push([1*e,1*i,a?o:"",r,l])}}},!0),e.table={frozenColumns:s._frozenColumns||0,frozenRows:s._frozenRows||0},e.data=u}(r,e,t)}),r.attachEvent("onUndo",function(e,t,n,i){"value"==e&&function o(e,t,n,
i){e.setCellValue(t,n,i)}(r,t,n,i)})}});function Oo(e,t){t?e["_hidden_"+t+"_hash"]={}:(e._hidden_cols_hash={},e._hidden_rows_hash={},e.filterSpreadSheet())}function Fo(e,t){return!e._hidden_cols_hash[t]}function Mo(e,t,n,i){if(t){var o=function c(e){return webix.isArray(e)?e:[e,e]}(t),r="row"==i?e._hidden_rows_hash:e._hidden_cols_hash;if(r[o[0]]||!webix.isUndefined(n)&&!n){if(r[o[0]]&&(webix.isUndefined(n)||!n)){var a=1<o[0]?1:-1;("row"==i?jo:To)({id:"hide",group:i},u({},i,o[0]+a),u({},i,o[1]+a),e)}}else("row"==i?Po:Bo)({id:"hide",group:i},u({},i,o[0]),u({},i,o[1]),e)}else{var l=e.getSelectedId(!0),s={id:!1===n?"show":"hide",group:i};l.length&&e.callEvent("onCommand",[s,l[0],l[l.length-1]])}}function Uo(e,t){return!e._hidden_rows_hash[t]}function No(e){"column"==e.group?"show"==e.id?To.apply(this,arguments):"hide"==e.id&&Bo.apply(this,arguments):"row"==e.group&&("show"==e.id?jo.apply(this,arguments):"hide"==e.id&&Po.apply(this,arguments))}function To(e,t,n,i,o){for(var r=n.column,a=i.$$("cells");r>=t.column;){var l=r;if(o||(l=i._hidden_cols_hash[1*r-1]||i._hidden_cols_hash[1*r+1]||!1),!1!==l){delete i._hidden_cols_hash[l];var s=a.getColumnConfig(l-1||"rowId").header[0];s.css=s.css.replace("webix_ssheet_hide_column",""),a.showColumn(l),t.column=t.column<l?t.column:l,n.column=n.column>l?n.column:l,o||i.callEvent("onColumnOperation",[e,{column:l},{column:l},null])}r--}var c=i._frozenColumns;c&&c>=t.column&&c<=n.column&&(i.freezeColumns(0),i.freezeColumns(c))}function jo(e,t,n,i,o){var r=n.row,a=i.$$("cells"),l=i._frozenRows;for(l&&i.freezeRows(0);r>=t.row;){var s=r;if(o||(s=i._hidden_rows_hash[1*r-1]||i._hidden_rows_hash[1*r+1]||!1),!1!==s){if(delete i._hidden_rows_hash[s],s-1==0){var c=a.getColumnConfig("rowId").header[0];c.css=c.css.replace("webix_ssheet_hide_row",""),a.refreshColumns()}else a.removeCellCss(s-1,"rowId","webix_ssheet_hide_row");o||i.callEvent("onRowOperation",[e,{row:s},{row:s},null])}r--}i.filterSpreadSheet(),l&&i.freezeRows(l)}function Bo(e,t,n,i,o){var r=i.$$("cells"),a=n.column;if(i.$handleSelection=null,r.unselect(),n.column<1||t.column<1)delete i._hidden_cols_hash[t.column];else{for(;a>=t.column;){if(-1!=r.getColumnIndex(a)){i._hidden_cols_hash[a]=a;var l=r.getColumnConfig(a-1||"rowId").header[0];l.css=(l.css||"")+" webix_ssheet_hide_column",r.hideColumn(a)}a--}o||i.callEvent("onColumnOperation",[e,t,n,null])}}function Po(e,t,n,i,o){if(n.row<1||t.row<1)delete i._hidden_rows_hash[t.row];else{var r=i._frozenRows;r&&i.freezeRows(0);for(var a=i.$$("cells"),l=n.row;l>=t.row;){if((i._hidden_rows_hash[l]=l)-1==0){var s=a.getColumnConfig("rowId").header[0];s.css=(s.css||"")+" webix_ssheet_hide_row",a.refreshColumns()}else a.addCellCss(l-1,"rowId","webix_ssheet_hide_row");l--}i.filterSpreadSheet(),r&&i.freezeRows(r),o||i.callEvent("onRowOperation",[e,t,n,null])}}var Ho=Object.freeze({init:function dl(l){l.attachEvent("onCommand",function(e){if("show"==e.id||"hide"==e.id){var t=l._table.getSelectArea();t&&No(e,webix.copy(t.start),webix.copy(t.end),l)}}),Oo(l),l.attachEvent("onUndo",function(e,t,n,i,o){if(!("hide"!=e.id&&"show"!=e.id||"column"!=e.group&&"row"!=e.group)){var r=e.id;o||(r="hide"==r?"show":"hide");var a=t||n;No({id:r,group:e.group},a.start,a.end,l,!0)}}),l.attachEvent("onHardReset",function(){return Oo(l)}),l.attachEvent("onAction",function(e,t){"before-grid-change"==e&&function u(e,t,n,i,o){if(i.table&&i.table.hidden&&i.table.hidden[t]&&i.table.hidden[t].length){"column"===t&&Oo(e,"cols"),"row"===t&&Oo(e,"rows");var r=o[t],a=r+n;if(a<r){var l=[a,r];r=l[0],a=l[1]}for(var s=r;s<a;s++)for(var c=0;c<i.table.hidden[t].length;c++)i.table.hidden[t][c]>=s&&(i.table.hidden[t][c]=1*i.table.hidden[t][c]+(0<n?1:-1))}}(l,t.name,t.inc,t.data,t.start)})},reset:Oo,isColumnVisible:Fo,setState:Mo,isRowVisible:Uo,serialize:function hl(e,t){var n=[],i=[];for(var o in e._hidden_rows_hash)n.push(o);for(var r in e._hidden_cols_hash)i.push(r);(n.length||i.length)&&(t.table.hidden={}),n.length&&(t.table.hidden.row=n),i.length&&(t.table.hidden.column=i)},load:function fl(e,t){if(Oo(e),!webix.isUndefined(t.table
)&&!webix.isUndefined(t.table.hidden)){var n=t.table.hidden;if(n.row&&n.row.length)for(var i=0;i<n.row.length;i++)Po({id:"hide",group:"row"},{row:n.row[i]},{row:n.row[i]},e,!0);if(n.column&&n.column.length)for(var o=0;o<n.column.length;o++)Bo({id:"hide",group:"column"},{column:n.column[o]},{column:n.column[o]},e,!0)}}});function Lo(a,e){var l=this,t=q(l,{row:a,column:e});if(t&&t.props.wrap){var n=l._table.getItem(a),s=n.$height||l._table.config.rowHeight;l._table.eachColumn(function(e,t){var n=q(l,{row:a,column:e});if(n&&n.props&&"wrap"===n.props.wrap){var i=this.getText(a,e),o=t.width,r=l._table.getSpan(a,e);r&&(o=l._table.getSpanNode({row:r[0],column:r[1]}).offsetWidth),(l.getCellEditor(a,e)||l.getCellFilter(a,e))&&(o+=20),s=Math.max(s,J(l,i,n.id,o).height)}}),n.$height=s}}var Wo=Object.freeze({init:function vl(d){if(d.config.resizeCell){var e=d.$$("cells");e.define("resizeRow",{headerOnly:!0,size:10}),e.define("resizeColumn",{headerOnly:!0,size:10}),e.define("fixedRowHeight",!1),e.attachEvent("onRowResize",function(e){d.$$("cells").refreshSelectArea(),m(d,"sizes",{row:e,column:0,size:d.getRow(e).$height})}),e.attachEvent("onColumnResize",function(e){d.$$("cells").refreshSelectArea(),m(d,"sizes",{row:0,column:e,size:d.getColumn(e).width})}),d.attachEvent("onUndo",function(e,t,n,i){"c-resize"!=e&&"r-resize"!=e||function o(e,t,n,i){t?(e.$$("cells").getItem(t).$height=i,m(e,"sizes",{row:t,column:0,size:i})):e._table.setColumnWidth(n,i),e._table.refreshSelectArea()}(d,t,n,i)})}d.attachEvent("onDataParse",function(e){if(e.sizes){for(var t=0;t<e.sizes.length;t++){var n=e.sizes[t];if(1*n[0]!=0){var i=d.getRow(n[0]);i&&(i.$height=1*n[2])}else{var o=d.getColumn(n[1]);o&&(o.width=1*n[2])}}e.sizes.length&&d.refresh(!0)}}),d.attachEvent("onDataSerialize",function(e){for(var t=[],n=d.$$("cells"),i=n.getState().order,o=n.data.order,r=n.config.columnWidth,a=n.config.rowHeight,l=1;l<i.length;l++){var s=n.getColumnConfig(i[l]).width;s&&s!=r&&t.push([0,l,s])}for(var c=0;c<o.length;c++){var u=n.getItem(o[c]).$height;u&&u!=a&&t.push([1*o[c],0,u])}e.sizes=t}),d.attachEvent("onAction",function(e,t){"before-grid-change"==e&&function d(e,t,n,i){var o,r=n.sizes,a=[];if(t){for(o=r.length-1;0<=o;o--){var l=k(r[o],3),s=l[0],c=l[1],u=l[2];s&&"row"==e&&s>=i.row||c&&"column"==e&&c>=i.column?(s="row"==e?1*s+t:s,c="column"==e?1*c+t:c,("row"==e&&0<s||"column"==e&&0<c)&&a.push([s,c,u])):a.push(r[o])}n.sizes=a}}(t.name,t.inc,t.data,t.start)}),d.attachEvent("onBeforeStyleChange",function(e,t,n,i){!i||"wrap"!==i.props.wrap||n&&n.props.wrap==i.props.wrap||delete d._table.getItem(e).$height}),d.attachEvent("onStyleChange",Lo),d.attachEvent("onCellChange",Lo)}});var qo=Object.freeze({init:function gl(r){var a=r._table,e=0;a.attachEvent("onAreaDrag",function(){return e=new Date}),a.attachEvent("onBeforeAreaRemove",function(){if(r.$handleSelection&&new Date-e<500)return!1}),a.attachEvent("onBeforeAreaAdd",function(e){if("rowId"==e.start.column)return!1;var t=a.getEditor();if(!t||t.row==e.start.row&&t.column==e.start.column&&t.row==e.start.row&&t.column==e.start.column||a.editStop(),!r.$handleSelection)return!0;var n=$[e.start.column]+e.start.row,i=$[e.end.column]+e.end.row,o=r.$handleSelection(e.start,e.end,n,i);return!1!==o&&(r.$handleSelection=null,a.removeSelectArea()),o}),webix.event(a.$view,"mousedown",function(e){if(r.$handleSelection)return webix.html.preventEvent(e)})}});function Ko(e,t,n){var i=n.getItem(e)[t];return i!==undefined&&""!==i}var Yo={"int":function(o,r){return function(e,t){var n=parseFloat(e[r])||-Infinity,i=parseFloat(t[r])||-Infinity;return(i<n?1:n==i?0:-1)*o}},str:function(o,r){return function(e,t){var n=(e[r]||"").toString().toLowerCase(),i=(t[r]||"").toString().toLowerCase();return(i<n?1:n==i?0:-1)*o}}};function Go(e,t,n,i){if(t=t||e._table.getSelectArea()){var o=t=R(t,e);t.start.row===t.end.row&&(o=function v(e,t){for(var n=t.config.rowCount,i=t.config.columnCount,o=t._table,r=e.start.row,a=e.end.row,l=e.start.column,s=e.end.column,c=r-1;0<c&&Ko(c,e.start.column,o);c--)r=c;for(var u=a+1;u<n&&Ko(u,e.end.column,o);u++)a=u;for(
var d=l-1;0<d&&Ko(e.start.row,d,o);d--)l=d;for(var h=s+1;h<i&&Ko(e.end.row,h,o);h++)s=h;var f={start:{row:r,column:l},end:{row:a,column:s}};return r==e.start.row&&a==e.end.row&&l==e.start.column&&s==e.end.column||t._table.addSelectArea(f.start,f.end),f}(t,e));var r=e.getRow(t.start.row)[t.start.column];i=i||(isNaN(parseFloat(r))?"str":"int"),n=n&&"asc"!==n?-1:1,g.set(function(){return function w(e,t,n,i,o){for(var r=e.start.column;r<=e.end.column;r++){for(var a=[],l=e.start.row;l<=e.end.row;l++)if(o.isRowVisible(l)){var s=o.getRow(l),c=s[r],u=o.getStyle(l,r),d=s["$"+r],h=o.conditions.get(l,r);h&&xo("remove",l,r,h,null,o),a.push({value:c,style:u,math:d,row:l,conditions:h})}a.sort(Yo[n](i,"value"));for(var f=e.start.row;f<=e.end.row;f++)if(o.isRowVisible(f)){var v=a.shift();if(o.setStyle(f,r,v.style||null),v.conditions&&xo("update",f,r,null,v.conditions,o),v.math){var g={id:"move",row:f-v.row,column:0},m=_n(v.math,g);o.setCellValue(f,r,m)}else o.setCellValue(f,r,v.value)}}o.refresh()}(o,t.start.column,i,n,e)})}}var Zo=Object.freeze({init:function ml(t){t.attachEvent("onCommand",function(e){"sort-asc"!==e.id&&"sort-desc"!==e.id||Go(t,null,e.id.replace("sort-",""))})},sortRange:Go});function Xo(e){var t=!(1<arguments.length&&arguments[1]!==undefined)||arguments[1],n=e.$$("cells"),i=-1!=n.$view.className.indexOf("webix_borderless");"toggle"===t&&(t=!i),!i&&t?(webix.html.addCss(n.$view,"webix_borderless",!0),e.callEvent("onCommand",[{id:"toolbar-update",name:"hide-gridlines",value:!0}]),e.callEvent("onAction",["gridlines-hide",{newValue:!0,value:!1}])):i&&!t&&(webix.html.removeCss(n.$view,"webix_borderless"),e.callEvent("onCommand",[{id:"toolbar-update",name:"hide-gridlines",value:!1}]),e.callEvent("onAction",["gridlines-hide",{newValue:!1,value:!0}]))}var Qo=Object.freeze({init:function wl(o){o.attachEvent("onUndo",function(e,t,n,i){"gridlines-hide"==e&&Xo(o,i)})},hideGridlines:Xo,serialize:function pl(e,t){t.table.gridlines=-1!=e.$$("cells").$view.className.indexOf("webix_borderless")?0:1},load:function bl(e,t){var n=!1;webix.isUndefined(t.table)||webix.isUndefined(t.table.gridlines)||(n=!t.table.gridlines),Xo(e,n)}});function Jo(e){var t=!(1<arguments.length&&arguments[1]!==undefined)||arguments[1],n=e.$$("cells");"toggle"===t&&(t=n.config.header),n.config.header&&t?(n.config.header=!1,n.isColumnVisible("rowId")&&n.hideColumn("rowId",{},!0,!0),n.refreshColumns(),e.callEvent("onCommand",[{id:"toolbar-update",name:"hide-headers",value:!0}]),e.callEvent("onAction",["header-hide",{newValue:!0,value:!1}])):n.config.header||t||(n.config.header=!0,n.isColumnVisible("rowId")||n.showColumn("rowId",{},!0),n.refreshColumns(),e.callEvent("onCommand",[{id:"toolbar-update",name:"hide-headers",value:!1}]),e.callEvent("onAction",["header-hide",{newValue:!1,value:!0}]))}var er=Object.freeze({init:function xl(o){o.attachEvent("onUndo",function(e,t,n,i){"header-hide"==e&&Jo(o,i)})},hideHeaders:Jo,serialize:function _l(e,t){t.table.headers=e.$$("cells").config.header?1:0},load:function yl(e,t){var n=!1;t.table&&!webix.isUndefined(t.table.headers)&&(n=!t.table.headers),Jo(e,n)}});function tr(e,t,n,i){or(e,t,n)&&(i||e.callEvent("onAction",["comment",{row:t,column:n,newValue:null,value:e.comments._pull[t][n]}]),delete e.comments._pull[t][n]),e.$$("cells").updateItem(t,n)}function nr(e,t){g.set(function(){D(t,e,function(e,t){or(e,t.row,t.column)&&tr(e,t.row,t.column)}),e.$$("cells").refresh()})}function ir(e,t,n,i,o){var r=or(e,t,n)?e.comments._pull[t][n]:null,a=e.$$("cells");"string"==typeof i&&(i=i.trim()?i:""),e.comments._pull[t]=e.comments._pull[t]?e.comments._pull[t]:{},e.comments._pull[t][n]=i,a.addCellCss(t,n,"ssheet_commented_cell"),o||e.callEvent("onAction",["comment",{row:t,column:n,newValue:i,value:r}])}function or(e,t,n){return e.comments._pull[t]&&e.comments._pull[t][n]?e.comments._pull[t][n]:""}var rr=Object.freeze({init:function Cl(r){r.comments={get:function(e,t){return or(r,e,t)},add:function(e,t,n){ir(r,e,t,n)},remove:function(e,t){tr(r,e,t)},_activeComment:{},_pull:{}},r.attachEvent("onReset",function(){return function t(e){
e.comments._pull={}}(r)}),r.attachEvent("onUndo",function(e,t,n,i){"comment"===e&&function o(e,t,n,i){or(e,t,n)&&tr(e,t,n,!0),i&&ir(e,t,n,i,!0)}(r,t,n,i)}),r.attachEvent("onAction",function(e,t){"before-grid-change"==e&&function c(e,t,n,i){var o=n.comments,r=o.length;if(t)for(;r--;){var a=k(o[r],2),l=a[0],s=a[1];(l&&"row"==e&&l>=i.row||s&&"column"==e&&s>=i.column)&&("row"==e?l<i.row-t?o.splice(r,1):o[r][0]=1*l+t:"column"==e&&(s<i.column-t?o.splice(r,1):o[r][1]=1*s+t))}}(t.name,t.inc,t.data,t.start)})},removeCommentsRange:nr,serialize:function $l(e,t){var n,i,o=[];for(n in e.comments._pull)for(i in e.comments._pull[n])e.comments._pull[n][i]&&o.push([n,i,e.comments._pull[n][i]]);t.comments=o},load:function Sl(e,t){var n,i=t.comments;if(i)for(n=0;n<i.length;n++)ir(e,i[n][0],i[n][1],i[n][2],!0)}});var ar=Object.freeze({init:function kl(n){var i=[Qo,er,Un,zo,si,Ho,rr];n.attachEvent("onDataSerialize",function(e){for(var t=0;t<i.length;t++)i[t].serialize&&i[t].serialize(n,e)}),n.attachEvent("onDataParse",function(e){for(var t=0;t<i.length;t++)i[t].load&&i[t].load(n,e)})}}),lr=[".xls",".xlt",".xla",".xlsx",".xlsm",".xltx",".xltm",".xlam",".xlsb"];var sr=Object.freeze({init:function El(t){var i;window.XMLHttpRequest&&(new XMLHttpRequest).upload&&((i=webix.ui({view:"uploader",apiOnly:!0,accept:lr.join()})).attachEvent("onBeforeFileAdd",webix.bind(function(e){return-1<lr.indexOf("."+e.type.toLowerCase())&&(t.reset(),t.parse(e.file,"excel")),!1},this)),t._destroy_with_me.push(i)),t.attachEvent("onCommand",function(e){"excel-import"===e.id&&function n(e,t){t?webix.delay(function(){return t.fileDialog()}):e.alert(webix.i18n.spreadsheet.labels["import-not-support"])}(t,i)})}});function cr(e,t){var n=e._activeSheet,i=function o(a,l,s){var c=webix.html.create("div",{"class":"webix_ssheet_print"});l.xCorrection=1,l.header=l.header||!1,l.trim=!!webix.isUndefined(l.trim)||l.trim,l.sheetnames=!!webix.isUndefined(l.sheetnames)||l.sheetnames;var u=a.$index;return a._sheets.forEach(function(e,t){if(a.$index=u+"_"+t,"all"===l.data||"all"!==l.data&&e.name===s){a.showSheet(e.name);var n="wss_"+a.$index;if(l.sheetnames){var i=webix.html.create("div",{"class":"webix_view webix_ssheet_sheetname"},e.name+":");c.appendChild(i)}a._print=!0;var o=a._table.$customPrint(l,!0);if(delete a._print,o.firstChild&&(o.firstChild.className+=" "+n),c.appendChild(o),"all"==l.data&&t+1<a._sheets.length){var r=webix.html.create("DIV",{"class":"webix_print_pagebreak"});c.appendChild(r)}}}),a.$index=u,c}(e,t,n);webix.html.insertBefore(i,t.docFooter,document.body),window.print(),function r(n,e){webix.html.remove(e),n._sheets.forEach(function(e,t){webix.html.removeStyle(".wss_"+n.$index+"_"+t)})}(e,i),e.showSheet(n)}var ur=Object.freeze({print:cr,init:function Vl(t){t.$customPrint=function(e){cr(t,e)}}});function dr(e){return 3===(e=e.substring(1)).length&&(e+=e),e}function hr(e,t){var n=e.split(";"),i={};t&&(i={font:{},alignment:{},border:{}});for(var o=0;o<n.length;o++)n[o]&&(t?vr(i,n,o):gr(i,n,o));return i}function fr(e,t,n,i){var o=so(e,t,n);if(o){if(i[o])return i[o];var r=webix.html.create("div",{"class":o});document.body.appendChild(r);var a=window.getComputedStyle(r),l=a.backgroundColor,s=a.color;return document.body.removeChild(r),i[o]=[l,s],i[o]}}function vr(e,t,n){switch(T[n]){case"color":e.font.color={rgb:dr(t[n])};break;case"background":var i=dr(t[n]);i&&"ffffff"!==i.toLowerCase()&&(e.fill={fgColor:{rgb:i}});break;case"text-align":e.alignment.horizontal=t[n];break;case"font-family":e.font.name=t[n].replace(/'|,.*$/g,"");break;case"font-size":e.font.sz=.75*t[n].replace("px","");break;case"font-style":e.font.italic="italic"==t[n];break;case"text-decoration":e.font.underline="underline"==t[n];break;case"font-weight":e.font.bold="bold"==t[n];break;case"vertical-align":e.alignment.vertical="middle"==t[n]?"center":t[n];break;case"wrap":e.alignment.wrapText="wrap"==t[n];break;case"borders":break;case"format":e.format=ge(t[n],!0)||"";break;case"border-right":case"border-bottom":case"border-left":case"border-top":e.border[T[n].split("-")[1]]=mr(t[n],!0)}}function gr(e,
t,n){switch(T[n]){case"color":e.color=dr(t[n]);break;case"background":e.backgroundColor=dr(t[n]);break;case"text-align":e.textAlign=t[n];break;case"font-family":break;case"font-size":e.fontSize=.75*t[n].replace("px","");break;case"font-style":e.italic="italic"==t[n];break;case"text-decoration":e.underline="underline"==t[n];break;case"font-weight":e.bold="bold"==t[n];break;case"vertical-align":e.vertAlign=t[n];break;case"wrap":e.whiteSpace="nowrap"!=t[n];break;case"borders":case"format":break;case"border-right":case"border-bottom":case"border-left":case"border-top":var i=T[n].split("-")[1];e["border".concat(i[0].toUpperCase()+i.substring(1),"Color")]=mr(t[n])}}function mr(e,t){var n=k(e.split(","),2),i=n[0],o=n[1];return t?{color:{rgb:dr(i)},style:o}:dr(i)}function wr(e){if(!e)return{};for(var t=[],n=0;n<T.length;n++)t.push(e[T[n]]||"");return hr(t.join(";"))}var pr=Object.freeze({init:function Al(o){o.$exportView=function(e){var t="pdf"==e.export_mode,n={header:!1,footer:!1,heights:!0,rawValues:!0,spans:!0,styles:!0,math:!t,xCorrection:1,ignore:{rowId:!0},conditions:!0};return webix.extend(e,n),"excel"==e.export_mode||t?function i(w,b){var x=this,_=arguments,y="excel"==b.export_mode;!0===b.sheets?b.sheets=w._sheets.map(function(e){return e.name}):b.sheets&&b.sheets.length?"string"==typeof b.sheets&&(b.sheets=[b.sheets]):b.sheets=[w._activeSheet],b.dataOnly=!0;for(var $=[],S=w._activeSheet,e=function(e){var t=b.sheets[e],n=t.id||t;w.showSheet(n),b.xCorrection=w.$$("cells").config.header?1:0;var i=t.options?webix.extend(t.options,b):webix.copy(b);n!=S&&(i._hidden=!0),i.name||(i.name=n);var o=!y&&"image"!=i.display,r=w.serialize(),a=Kt(r.data,r.spans,0,0),l=k(a,2),s=l[0],c=l[1];if(!y&&(webix.isUndefined(i.textBefore)&&(i.textBefore=i.name),o)){i.ignore=i.ignore||{};for(var u=c+1;u<=w.config.columnCount;u++)i.ignore[u]=!0;var d=i.filter||function(){return!0};i.filter=function(e){return e.id<=s&&d.apply(x,_)}}var h=webix[y?"toExcel":"toPDF"](w._table,i);if(o&&0==h[0].scheme.length)return"continue";if((y||o)&&i.styles){var f=h[0].styles=function C(h,f,v,g,m){h.compactStyles();var w=[],p={},b={},x=function n(e){var t=N;return"excel"==e.export_mode?{font:{sz:.75*t["font-size"].replace("px",""),name:t["font-family"].replace(/'|,.*$/g,"")},alignment:{horizontal:t["text-align"],vertical:"center",wrapText:"nowrap"!=t["white-space"]}}:{fontSize:.75*t["font-size"].replace("px",""),textAlign:t["text-align"],whiteSpace:"nowrap"!=t["white-space"]}}(f);f.docHeader&&(w=w.concat([{0:wr(f.docHeader.css)},{}])),f.header&&w.push({});var e=w.length,t=h.$$("cells"),_=t.config.columns,y=e;return t.eachRow(function(e){if(!(g<e)){for(var t=f.xCorrection;t<_.length&&t<=m;t++){var n=h.getStyle(e,_[t].id),i=t-f.xCorrection;w[y]=w[y]||{};var o=void 0;if(n)if(p[n.id])o=webix.copy(p[n.id]);else{for(var r in o=hr(n.text,v),x)v?webix.extend(o[r],x[r]):o[r]||(o[r]=x[r]);p[n.id]=webix.copy(o)}else o=webix.copy(x);if(f.conditions){var a=fr(h,e,t,b);a&&(l=o,s=v,void 0,c=k(a.map(function(e){return webix.color.rgbToHex(e)}),2),u=c[0],d=c[1],s?(l.fill={fgColor:{rgb:u}},l.font.color={rgb:d}):(l.backgroundColor=u,l.color=d))}w[y][i]=o,w[y][i].type=Tt(h,e,_[t].id)}y++}var l,s,c,u,d}),f.docFooter&&(w=w.concat([{},{0:wr(f.docFooter.css)}])),w}(w,i,y,s,c);o&&function p(e,t,n,i,o){if(n.spans)for(var r in o.spans)if(1<o.spans[r][2]){var a=o.spans[r][0]-1,l=o.spans[r][1]-1,s=o.spans[r][2];if(e[a]&&e[a][l]){e[a][l].colspan=s,t[0].exportData[a]&&t[0].exportData[a].splice(l+1,s-1);var c=Object.values(e[a]);c.splice(l+1,s-1),e[a]=c}}for(var u=t[0].exportData,d=0;d<u.length;d++)for(var h=0;h<u[d].length;h++){var f=i.$$("cells").config.rowHeight;if(n.heights&&o.sizes.length)for(var v=0;v<o.sizes.length;v++){var g=o.sizes[v][0];if(g&&g==d+1){f=o.sizes[v][2];break}}var m=e[d][h].vertAlign,w=.75*f-e[d][h].fontSize;e[d][h].paddingTop="top"==m?0:"bottom"==m?w:w/2,e[d][h].paddingBottom="bottom"==m?0:"top"==m?w:w/2}}(f,h,i,w,r)}if($=$.concat(h),y){$[e].ranges=[];for(var v=w.ranges.getRanges(),g=0;g<v.length;g++)$[e].ranges.push({Sheet:e,Name:v[g].name,
Ref:i.name+"!"+v[g].range.replace(/(\w)/gi,function(e){return"$"+e})})}else b.autowidth&&function m(e,t){var n,i=t.orientation&&"landscape"==t.orientation?"height":"width";n=e.$width?e.$width:e[i],t[i]=Math.max(t[i]||0,n||0)}(i,b)},t=0;t<b.sheets.length;t++)e(t);return w.showSheet(S),delete b.dataOnly,$}(o,e):o._table}}});function br(e,t,n){for(var i=webix.copy(e.data),o=[],r=0;r<i.length;r++)for(var a=0;a<i[0].length;a++){var l=r+1,s=a+1;o.push([l,s,i[r][a]])}if(e.data=o,e.spans)for(var c=0;c<e.spans.length;c++)e.spans[c][0]++,e.spans[c][1]++;if(t)for(var u=0;u<t.length;u++)t[u].Sheet===n&&(e.ranges=e.ranges||[],e.ranges.push([t[u].Name.toUpperCase(),t[u].Ref.substring(t[u].Ref.indexOf("!")+1).replace(/\$/g,"")]));if(e.styles&&function h(e){for(var t={},n=[],i=1,o=0;o<e.styles.length;o++){for(var r=[],a=e.styles[o][2],l=void 0,s=0;s<T.length;s++)switch(T[s]){case"color":r[s]=a.font&&a.font.color&&xr(a.font.color.rgb)||"";break;case"background":r[s]=a.fill&&a.fill.fgColor&&xr(a.fill.fgColor.rgb)||"";break;case"text-align":r[s]=(a.alignment?a.alignment.horizontal:"")||N["text-align"];break;case"font-family":r[s]=a.font&&a.font.name?_r(a.font.name):"";break;case"font-size":r[s]=a.font&&a.font.sz&&a.font.sz/.75+"px"||"";break;case"font-style":r[s]=a.font&&a.font.italic?"italic":"";break;case"text-decoration":r[s]=a.font&&a.font.underline?"underline":"";break;case"font-weight":r[s]=a.font&&a.font.bold?"bold":"";break;case"vertical-align":var c=a.alignment&&a.alignment.vertical||"";r[s]=("center"==c?"middle":c)||N["vertical-align"];break;case"wrap":r[s]=a.alignment&&a.alignment.wrapText?"wrap":"nowrap";break;case"borders":case"format":r[s]="";break;case"border-right":case"border-bottom":case"border-left":case"border-top":r[s]=yr(T[s],a)}r=r.join(";"),l=t[r]||"wss"+i;for(var u=0;u<e.data.length;u++)if(e.data[u][0]===e.styles[o][0]+1&&e.data[u][1]===e.styles[o][1]+1){e.data[u][3]=l;break}t[r]||(n.push([l,r]),t[r]=l,i++)}e.styles=n}(e),e.types&&function f(n){n.types.forEach(function(e){for(var t=0;t<n.data.length;t++)if(n.data[t][0]===e[0]+1&&n.data[t][1]===e[1]+1){n.data[t][4]=e[2];break}})}(e),e.sizes)for(var d=0;d<e.sizes.length;d++)"column"==e.sizes[d][0]?e.sizes[d]=[0,e.sizes[d][1]+1,e.sizes[d][2]]:e.sizes[d]=[e.sizes[d][1]+1,0,e.sizes[d][2]];return e}function xr(e){return 8===(e=e||"000000").length&&(e=e.substring(2)),"#"+e}function _r(e){for(var t=N["font-family"],n=0;n<et.length;n++)if(et[n].value==e){t=et[n].id;break}return t}function yr(e,t){if(e=e.replace("border-",""),t.border&&t.border[e]){var n=t.border[e],i=xr(n.color.rgb)||"",o=n.style||"";return"".concat(i,",").concat(o)}return""}var Cr=Object.freeze({init:function zl(r){r._parseExcel=function(e,t){var n=e.options||{};n.math=r.config.math;for(var i={sheets:[]},o=0;o<e.names.length;o++)n.name=e.names[o],i.sheets.push({name:n.name,content:br(t.getSheet(e,n),e.ranges,o)});return i},r._parseCsv=function(e,t){e=t.getRecords(e);for(var n=webix.copy(e),i=[],o=0;o<n.length;o++)for(var r=n[o].split(t.cell),a=0;a<r.length;a++){var l=o+1,s=a+1;i.push([l,s,r[a]])}return{data:i}}}});var $r=Object.freeze({init:function Il(t){t.attachEvent("onCommand",function(e){switch(e.id){case"clear-value":t.clearRange(null,{values:!0});break;case"clear-style":t.clearRange(null,{styles:!0});break;case"clear-conditional-formats":t.clearRange(null,{conditions:!0});break;case"clear-dropdown-editors":t.clearRange(null,{editors:!0});break;case"clear-all":g.set(function(){t.clearRange(null,null)});break;case"clear-comments":t.clearRange(null,{comments:!0})}})}});function Sr(e,t,n){if(t)webix.isArray(t)||(t=[t,t]);else{var i=e.$$("cells").getSelectArea();i&&(t=[i.start[n],i.end[n]])}return t}function kr(e,t,n,i){var o={},r={};(i=Sr(e,i,n))&&(o[n]=i[0],r[n]=i[1],e.callEvent("onCommand",[{id:t,group:n},o,r]))}function Er(t,n,i,o){(i=Sr(t,i,n))&&g.set(function(){for(var e=i[0];e<=i[1];e++)"auto"!=o?t.$$("cells")["row"==n?"setRowHeight":"setColumnWidth"](e,o):("row"==n?Ct:yt)(e,t)})}var Vr=Object.freeze({insertRow:function Rl(e){kr(this,"add","row",e)},deleteRow:function Dl(e){kr(this,"del","row",e)
},setRowHeight:function Ol(e,t){Er(this,"row",e,t)},insertColumn:function Fl(e){kr(this,"add","column",e)},deleteColumn:function Ml(e){kr(this,"del","column",e)},setColumnWidth:function Ul(e,t){Er(this,"column",e,t)}});var Ar=Object.freeze({lockCell:function Nl(e,t,n){Fn(this,e,t,n)},isCellLocked:function Tl(e,t){return Mn(this,e,t)}});function zr(e,t,n){var i=e.$$("cells");if("row"==t)for(var o=e.config.columnCount,r=1;r<=o;r++){var a=i.getSpan(n,r);if(a){var l=1*a[0]+a[3]-1;n<l&&Ir(e,a,a[2],a[3]-(l-n))}}else for(var s=i.data.order[0],c=i.data.order.length,u=s;u<=c;u++){var d=i.getSpan(u,n);if(d){var h=1*d[1]+d[2]-1;n<h&&Ir(e,d,d[2]-(h-n),d[3])}}}function Ir(e,t,n,i){e.splitCell(t[0],t[1]),e.combineCells({cell:{row:t[0],column:t[1]},x:n,y:i})}var Rr=Object.freeze({freezeColumns:function jl(e){var t=this.$$("cells");if(webix.isUndefined(e)){var n=this.getSelectedId(!0);e=n.length?n[0].column:0}var i="rowId"==t.config.columns[0].id?1:0,o=i;if(e&&e!=this._frozenColumns){for(var r=e;0<r&&!(o=t.getColumnIndex(r)+1);r--);o||(o=i)}g.set(function(){zr(this,"column",e),t.unselect(),t.define("leftSplit",o),t.refreshColumns(),this.callEvent("onAction",["freeze-column",{value:this._frozenColumns||0,newValue:e}]),this._frozenColumns=e||0},this)},freezeRows:function Bl(e){var t=this.$$("cells");if(webix.isUndefined(e)){var n=this.getSelectedId(!0);e=n.length?n[0].row:0}var i=0;if(e&&e!=this._frozenRows)for(var o=e;0<o&&!(i=t.getIndexById(o)+1);o--);g.set(function(){zr(this,"row",e),t.unselect(),t.define("topSplit",i),t.refreshColumns(),this.callEvent("onAction",["freeze-row",{value:this._frozenRows,newValue:e}]),this._frozenRows=e||0},this)}});var Dr=Object.freeze({hideGridlines:function Pl(e){Xo(this,e)}});var Or=Object.freeze({hideHeaders:function Hl(e){Jo(this,e)}});var Fr=Object.freeze({hideColumn:function Ll(e,t){Mo(this,e,t,"column")},isColumnVisible:function Wl(e){return Fo(this,e)},hideRow:function ql(e,t){Mo(this,e,t,"row")},isRowVisible:function Kl(e){return Uo(this,e)}});var Mr=Object.freeze({addImage:function Yl(e,t,n){this.setCellValue(e,t,function i(e){return'=IMAGE("'.concat(e,'")')}(n)),this.refresh()},addSparkline:function Gl(e,t,n){var i=function o(e){var t="=SPARKLINE(".concat(e.range,',"').concat(e.type,'"');return"bar"===e.type?t+=',"'.concat(e.color,'","').concat(e.negativeColor,'"'):e.color&&(t+=',"'.concat(e.color,'"')),t+")"}(n);this.setCellValue(e,t,i),this.refresh()},getSheetData:function Zl(e){return $n(this,e)},recalculate:function Xl(){this.callEvent("onMathRefresh",[])},registerMathMethod:function Ql(e,t){if(function o(e,t){Mt[e]=t}(e=e.toUpperCase(),t),this.$$("liveEditor")){var n=this.$$("liveEditor").config.suggest,i=webix.$$(n).getList();i.exists(e)||i.add({id:e,value:e})}}});var Ur=Object.freeze({combineCells:function Jl(e){var t=this;if(!e){var n=this.getSelectedId(!0);1<n.length&&(e=Bn(n))}g.set(function(){e&&Tn(t,e.cell,e.x,e.y)}),this.refresh()},splitCell:function es(e,t){e&&t?jn(this,{row:e,column:t}):g.set(function(){this.eachSelectedCell(function(e){jn(this,e)})},this),this.refresh()},addStyle:function ts(e,t){return K(this,e,t)},getStyle:function ns(e,t){return q(this,{row:e,column:t})},setStyle:function is(e,t,n){return X(this,{row:e,column:t},n)},setRangeStyle:function os(e,t){g.set(function(){Q(this,e,t)},this)},clearRange:function rs(e,t){(e||(e=this._table.getSelectArea()))&&(t||(t={styles:!0,values:!0,editors:!0,conditions:!0,comments:!0}),t.styles&&oe(this,e),t.conditions&&po(this,e),t.values&&this.setRangeValue(e,null),t.editors&&(Co(this,e),Zn(this,e)),t.comments&&nr(this,e),this.refresh())},compactStyles:function as(){return re(this)},serialize:function ls(e){var t={};return this.callEvent("onDataSerialize",[t,e]),e&&e.sheets?function n(e,t){return ln(e,e._activeSheet).content=t,e._sheets}(this,t):t},showSheet:function ss(e){an(this,e)},getActiveSheet:function cs(){return this._activeSheet},addSheet:function us(e){Jt(this,e)},clearSheet:function ds(){this.reset()},renameSheet:function hs(e,t){nn(this,e,t)},editSheet:function fs(e){en(this,e)},removeSheet:function vs(e){tn(this,e)
},undo:function gs(){Ei(this)},redo:function ms(){Vi(this)},sortRange:function ws(e,t){Go(this,e,t)}});var Nr=Object.freeze({refresh:function ps(e){e?this._table.refreshColumns():this._table.refresh()},eachSelectedCell:function bs(e){for(var t=this.getSelectedId(!0),n=0;n<t.length;n++)e.call(this,t[n])},getSelectedRange:function xs(e){var t=this._table.getSelectArea();return t?(e&&(e=this.getActiveSheet()),I(t.start.row,t.start.column,t.end.row,t.end.column,e)):""},getSelectedId:function _s(e){var t=this._table.getSelectArea();if(!e)return t&&t.start.row?t.start:null;var n=[];if(t)for(var i=t.start,o=t.end,r=i.row;r<=o.row;r++)for(var a=i.column;a<=o.column;a++)n.push({row:r,column:a});return n},getCellValue:function ys(e,t){var n=this.getRow(e),i=n["$"+t]||n[t];return void 0===i?"":i},setCellValue:function Cs(e,t,n){var i=this;if(this.getCellValue(e,t)!==n){var o=this.getRow(e),r=o["$"+t]||o[t];g.set(function(){i.callEvent("onBeforeValueChange",[e,t,n,r])&&(o[t]=n,delete o["$"+t],i.callEvent("onCellChange",[e,t,n]),i.saveCell(e,t))})}},setRangeValue:function $s(i,o){g.set(function(){for(var e=R(i,this),t=e.start.row;t<=e.end.row;t++)for(var n=e.start.column;n<=e.end.column;n++)this.setCellValue(t,n,o)},this)},getRow:function Ss(e){return this._table.getItem(e)},getColumn:function ks(e){return this._table.getColumnConfig(e)},reset:function Es(e){var t={data:[]};e&&e.sheets&&(t=rn(t)),this.parse(t)},_resetTable:function Vs(){Vt(this)}});var Tr=Object.freeze({saveCell:function As(e,t){var n=this.getStyle(e,t);m(this,"data",{row:e,column:t,value:this.getCellValue(e,t),style:n?n.id:""})}});var jr=Object.freeze({getRow:function zs(e){return this._table.getItem(e)},setCellEditor:function Is(e,t,n){var i=this._table._ssEditors[e]=this._table._ssEditors[e]||{},o=i[t]||this.getRow(e)[t];(i[t]=n)&&n.editor?(this.getCellFilter(e,t)&&this.setCellFilter(e,t,null),this._table.addCellCss(e,t,"ss_editor")):(delete this._table._ssEditors[e][t],this._table.removeCellCss(e,t,"ss_editor")),this.callEvent("onAction",["dropdown",{row:e,column:t,value:o,newValue:n}])},getCellEditor:function Rs(e,t){return(this._table._ssEditors[e]||{})[t]||null}});var Br=Object.freeze({setCellFilter:function Ds(e,t,n){var i=this._table._ssFilters[e]=this._table._ssFilters[e]||{},o=i[t]||this.getRow(e)[t];if(n&&(webix.isArray(n)||"string"==typeof n)&&(n={options:n}),(i[t]=n)&&"object"==p(n)){if(this.getCellEditor(e,t)&&this.setCellEditor(e,t,null),this._table.addCellCss(e,t,"ss_filter"),n.value&&Qn(n.value)&&this._table.addCellCss(e,t,"ss_filter_active"),webix.extend(n,{row:e,column:t},!0),n.options=Xn(this,e,t,n.options),!n.handler&&n.value&&n.value.condition){var r=n.mode||ti(this,e,t);n.handler=ri(r,n.value)}}else delete this._table._ssFilters[e][t],this._table.removeCellCss(e,t,"ss_filter"),this._table.removeCellCss(e,t,"ss_filter_active");this.callEvent("onAction",["filter",{row:e,column:t,value:o,newValue:n}])},getCellFilter:function Os(e,t){return(this._table._ssFilters[e]||{})[t]||null},removeFilters:function Fs(){for(var t=this,e=Gn(this._table),n=0;n<e.length;n++){var i=e[n],o=i.row,r=i.column;this.setCellFilter(o,r,null)}this._table._ssFilters={},this._table.data.filter(function(e){return t.isRowVisible(e.id)})},filterSpreadSheet:function Ms(){this._table.data.silent(function(){var a=this,l=Gn(this._table);this._table.data.filter(function(e){return a.isRowVisible(e.id)});for(var e=function(e){var t=l[e],n=t.row,i=t.column,o=t.handler,r=!1;a._table.data.filter(function(e){return!!(r||1*e.id<=1*n)||(e[i]||""===e[i]?"function"!=typeof o||o(String(e[i])):r=!0)},1,!0)},t=0;t<l.length;t++)e(t)},this),this._table.callEvent("onAfterFilter",[]),this._table.refresh()}});var Pr=Object.freeze({confirm:function Us(e){return webix.confirm({css:"webix_ssheet_confirm",text:e.text,ok:webix.i18n.spreadsheet.labels.ok,cancel:webix.i18n.spreadsheet.labels.cancel})},alert:function Ns(e){return webix.alert({css:"webix_ssheet_alert",text:e.text,ok:webix.i18n.spreadsheet.labels.ok})}});var Hr=Object.freeze({resetUndo:function Ts(){Ai(this)},groupUndo:function js(e){g.set(e,
this)},ignoreUndo:function Bs(e){Ii(e,this)}});var Lr=Object.freeze({setFormat:function Ps(e,t,n){we(this,e,t,n)},changeDecimals:function Hs(e,t,n){Ee(this,n,e,t)}});var Wr=[{id:"file",submenu:[{id:"sheet",submenu:[{id:"new-sheet"},{id:"copy-sheet"},{id:"remove-sheet"}]},{id:"excel-import"},{id:"excel-export"}]},{id:"edit",submenu:[{id:"add-range"},{id:"add-dropdown"},{id:"add-link"},{id:"lock-cell"},{id:"conditional-format"},{id:"clear",submenu:[{id:"clear-value"},{id:"clear-style"},{id:"clear-conditional-formats"},{id:"clear-dropdown-editors"},{id:"clear-comments"},{$template:"Separator"},{id:"clear-all"}]}]},{id:"insert",submenu:[{id:"image",submenu:[{id:"add-image-cell"},{id:"add-image-top"}]},{id:"graph",submenu:[{id:"add-sparkline"},{id:"add-chart"}]},{id:"add-comment"}]},{id:"data",submenu:[{id:"sort",submenu:[{id:"sort-asc"},{id:"sort-desc"}]},{id:"create-filter"}]},{id:"view",submenu:[{id:"columns",submenu:[{id:"insert-column"},{id:"delete-column"},{id:"show-column"},{id:"hide-column"},{id:"resize-column"}]},{id:"rows",submenu:[{id:"insert-row"},{id:"delete-row"},{id:"show-row"},{id:"hide-row"},{id:"resize-row"}]},{$template:"Separator"},{id:"freeze-columns"},{id:"freeze-rows"},{id:"hide-gridlines"},{id:"hide-headers"}]}],qr={getMenuData:function(e,t){var n;for(n=0;n<e.length;n++)"string"==typeof e[n]&&(e[n]={id:e[n]}),"resize-column"!=e[n].id&&"resize-row"!=e[n].id||t.resizeCell?(e[n].value||(e[n].value=webix.i18n.spreadsheet.menus[e[n].id]),e[n].submenu&&(e[n].submenu=this.getMenuData(e[n].submenu,t))):(e.splice(n,1),n--);return e}};function Kr(t){t.attachEvent("onComponentInit",function(){return function e(t){t.$$("menu")&&t.$$("menu").attachEvent("onMenuItemClick",function(e){return function n(e,t){e.callEvent("onMenuItemClick",[t])&&(Yr[t]?Yr[t](e):e.callEvent("onCommand",[{id:t}]))}(t,e)})}(t)});var e=t.config,n={view:"menu",borderless:!0,css:"webix_ssheet_menu",id:"menu",autowidth:!0,type:{height:40},data:qr.getMenuData(webix.isArray(e.menu)?e.menu:webix.copy(Wr),t.config)};return t.callEvent("onViewInit",["menu",n]),n}var Yr={undo:function(e){e.undo()},redo:function(e){e.redo()},"insert-column":function(e){e.insertColumn()},"delete-column":function(e){e.deleteColumn()},"show-column":function(e){e.hideColumn(null,!1)},"hide-column":function(e){e.hideColumn(null,!0)},"resize-column":function(e){e.callEvent("onCommand",[{id:"resize",group:"column",value:webix.i18n.spreadsheet.menus["resize-column"]}])},"insert-row":function(e){e.insertRow()},"delete-row":function(e){e.deleteRow()},"show-row":function(e){e.hideRow(null,!1)},"hide-row":function(e){e.hideRow(null,!0)},"resize-row":function(e){e.callEvent("onCommand",[{id:"resize",group:"row",value:webix.i18n.spreadsheet.menus["resize-row"]}])},"freeze-columns":function(e){e.freezeColumns()},"hide-gridlines":function(e){e.hideGridlines("toggle")},"hide-headers":function(e){e.hideHeaders("toggle")}};function Gr(e){return webix.i18n.spreadsheet.labels[e]||e}var Zr={name:"spreadsheet",_base_index:{count:1},defaults:{spans:!0,rowCount:50,math:!0,columnCount:20,resizeCell:!0,sheetTabWidth:90,conditionStyle:function Ls(){return[{name:Gr("normal"),css:"webix_ssheet_condition_regular"},{name:Gr("neutral"),css:"webix_ssheet_condition_neutral"},{name:Gr("bad"),css:"webix_ssheet_condition_bad"},{name:Gr("good"),css:"webix_ssheet_condition_good"}]}()},$init:function(){var e=this;this.$index=this._base_index.count++,this.$view.className+=" webix_ssheet",this.$ready.unshift(this._sub_init),this.$ready.unshift(he),this.$ready.push(this._set_handlers),this._destroy_with_me=[],this.attachEvent("onDestruct",function(){e._destroy_with_me.forEach(function(e){return e.destructor()})})},$skin:function(){!function n(){var e=webix.skin.$name,t="material"==e||"mini"==e;U.width=webix.skin.$active.inputHeight+2,U.titleHeight="mini"==webix.skin.$name?18:20,N["font-family"]=t?"'Roboto', sans-serif":"'PT Sans', Tahoma","contrast"==e&&(N.background="#393939",N.color="#ffffff")}()},_sub_init:function(){var e=this.config,t=[];!e.readonly&&e.menu&&t.push(Kr(this)),
e.readonly||!1===e.toolbar||t.push(ht(this)),e.subbar&&t.push(e.subbar),!e.readonly&&e.liveEditor&&t.push(Lt(this));var n={editable:!e.readonly,clipboard:e.clipboard,liveEditor:e.liveEditor,clipboardDecimalDelimiter:e.clipboardDecimalDelimiter};e.rowHeight&&(n.rowHeight=e.rowHeight),e.columnWidth&&(n.columnWidth=e.columnWidth),e.readonly?t.push(kt(this,n)):t.push({cols:[kt(this,n),Xi(this)]});var i=!0===e.bottombar?Xt(this):e.bottombar;i&&t.push(i),Zt(this),e.readonly||function o(r){r.attachEvent("onComponentInit",function(){return r.$$("context").attachTo(r._table.$view)});var e=webix.i18n.spreadsheet.menus,a={data:[{id:"clear",value:e.clear,submenu:it()},{id:"lock-cell",value:e["lock-cell"]},{$template:"Separator"},{id:"sort",value:e.sort,submenu:[{id:"sort-asc",value:e["sort-asc"]},{id:"sort-desc",value:e["sort-desc"]}]},{id:"create-filter",value:e["create-filter"]},{$template:"Separator"},{id:"add-range",value:e["add-range"]},{id:"add-link",value:e["add-link"]},{id:"add-comment",value:e["add-comment"]}],column:tt(r),row:nt(r)},t={view:"contextmenu",id:"context",padding:0,submenuConfig:{padding:0,on:{onBeforeShow:function(){this.sizeToContent()}}},data:[],on:{onMenuItemClick:function(e){r.callEvent("onCommand",[this.getMenuItem(e)])},onBeforeShow:function(e){var t,n;if(webix.callEvent("onClick",[]),!(n=r._table.locate(e)))return!1;if(t="",n.header&&"rowId"!==n.column?(wt(n.column,r)||mt(n.column,r),t="column"):n.row&&(t="rowId"===n.column?(bt(n.row,r)||vt(n.row,r),"row"):(pt(n.row,n.column,r)||r._table.addSelectArea(n,n),"data")),t){var i=function o(e,t,n){var i={area:t,data:n};return e.callEvent("onContextMenuConfig",[i])?i.data:null}(r,t,a[t]);if(i)return this.clearAll(),this.parse(i),this.sizeToContent(),webix.html.preventEvent(e),!0}return!1}}};r.callEvent("onViewInit",["context",t]);var n=r.ui(t);r._destroy_with_me.push(n)}(this),function r(e){for(var i={},t=e.config.readonly?[Ci]:Si,n=0;n<t.length;n++)i[t[n].action]=new t[n].DialogBox(e);e.attachEvent("onCommand",function(e){var t=i[e.id];t&&t.open(e)}),e.attachEvent("onAction",function(e,t){if("add-view"==e&&!t.newValue){var n=i["add-image-top"];n&&n.viewid==t.row&&n.close()}})}(this),this.rows_setter(t)},_set_handlers:function(){var e=this;this._table||(this._table=this.$$("cells"),function i(e){for(var t=[no,_o,ae,Ro,Be,qo,Zo,Fi,St,Ho,Un,Kn,Wo,Be,Do,ao,zo,ar,Bt,sr,si,ur,pr,Cr,$r,rr,b,er,Qo,Gi],n=0;n<t.length;n++)t[n].init&&t[n].init(e)}(this),Vt(this,this.config.columnCount,this.config.rowCount),At(this),this._table.attachEvent("onAfterAreaAdd",function(){return e.callEvent("onAfterSelect",[e.getSelectedId(!0)])}),this.callEvent("onComponentInit",[]))},$onLoad:function(e,t){this._set_handlers(),e.excel?e=this._parseExcel(e,t):e.data||"string"!=typeof e||!t.cell&&!t.row||(e=this._parseCsv(e,t)),function n(e,t){!(t=webix.isArray(t)?{sheets:t}:t).excel&&t.sheets||!e._activeSheet?on(e,t):cn(e,ln(e,e._activeSheet).content=t)}(this,e)}};!function Ws(e){for(var t=[Vr,Ar,Rr,Dr,Or,Fr,Mr,Ur,Nr,Tr,jr,Br,Pr,Hr,Lr],n=0;n<t.length;n++)webix.extend(e,t[n])}(Zr),webix.protoUI(Zr,webix.AtomDataLoader,webix.IdSpace,webix.ui.layout)});
//# sourceMappingURL=spreadsheet.js.map
