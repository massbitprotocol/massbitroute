/*
@license
Webix <%= pkg.productName %> v.<%= pkg.version %>
This software is covered by Webix Trial License.
Usage without proper license is prohibited.
(c) XB Software Ltd.
*/
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t=t||self).docManager={})}(this,(function(t){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation. All rights reserved.
    Licensed under the Apache License, Version 2.0 (the "License"); you may not use
    this file except in compliance with the License. You may obtain a copy of the
    License at http://www.apache.org/licenses/LICENSE-2.0

    THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
    WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
    MERCHANTABLITY OR NON-INFRINGEMENT.

    See the Apache Version 2.0 License for specific language governing permissions
    and limitations under the License.
    ***************************************************************************** */var e=function(t,i){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,i)};function i(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}var r=function(){return(r=Object.assign||function(t){for(var e,i=1,r=arguments.length;i<r;i++)for(var n in e=arguments[i])Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t}).apply(this,arguments)};"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;var n,o=function(t,e){return t(e={exports:{}},e.exports),e.exports}((function(t,e){!function(t){var e=function(t,i){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,i)};function i(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}var r=function(){return(r=Object.assign||function(t){for(var e,i=1,r=arguments.length;i<r;i++)for(var n in e=arguments[i])Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t}).apply(this,arguments)},n=function(){},o=function(){function t(t,e){this.webixJet=!0,this.webix=t,this._events=[],this._subs={},this._data={},e&&e.params&&t.extend(this._data,e.params)}return t.prototype.getRoot=function(){return this._root},t.prototype.destructor=function(){this._detachEvents(),this._destroySubs(),this._events=this._container=this.app=this._parent=this._root=null},t.prototype.setParam=function(t,e,i){if(this._data[t]!==e&&(this._data[t]=e,this._segment.update(t,e,0),i))return this.show(null)},t.prototype.getParam=function(t,e){var i=this._data[t];if(void 0!==i||!e)return i;var r=this.getParentView();return r?r.getParam(t,e):void 0},t.prototype.getUrl=function(){return this._segment.suburl()},t.prototype.getUrlString=function(){return this._segment.toString()},t.prototype.getParentView=function(){return this._parent},t.prototype.$$=function(t){if("string"==typeof t){var e=this.getRoot();return e.queryView((function(i){return(i.config.id===t||i.config.localId===t)&&i.$scope===e.$scope}),"self")}return t},t.prototype.on=function(t,e,i){var r=t.attachEvent(e,i);return this._events.push({obj:t,id:r}),r},t.prototype.contains=function(t){for(var e in this._subs){var i=this._subs[e].view;if(i===t||i.contains(t))return!0}return!1},t.prototype.getSubView=function(t){var e=this.getSubViewInfo(t);if(e)return e.subview.view},t.prototype.getSubViewInfo=function(t){var e=this._subs[t||"default"];return e?{subview:e,parent:this}:"_top"===t?(this._subs[t]={url:"",id:null,popup:!0},this.getSubViewInfo(t)):this._parent?this._parent.getSubViewInfo(t):null},t.prototype._detachEvents=function(){for(var t=this._events,e=t.length-1;e>=0;e--)t[e].obj.detachEvent(t[e].id)},t.prototype._destroySubs=function(){for(var t in this._subs){var e=this._subs[t].view;e&&e.destructor()}this._subs={}},t.prototype._init_url_data=function(){var t=this._segment.current();this._data={},this.webix.extend(this._data,t.params,!0)},t.prototype._getDefaultSub=function(){if(this._subs.default)return this._subs.default;for(var t in this._subs){var e=this._subs[t];if(!e.branch&&e.view&&"_top"!==t){var i=e.view._getDefaultSub();if(i)return i}}},t.prototype._routed_view=function(){var t=this.getParentView();if(!t)return!0;var e=t._getDefaultSub();return!(!e&&e!==this)&&t._routed_view()},t}();function a(t){"/"===t[0]&&(t=t.substr(1));for(var e=t.split("/"),i=[],r=0;r<e.length;r++){var n=e[r],o={},a=n.indexOf(":");if(-1===a&&(a=n.indexOf("?")),-1!==a)for(var s=0,c=n.substr(a+1).split(/[\:\?\&]/g);s<c.length;s++){var l=c[s].split("=");o[l[0]]=decodeURIComponent(l[1])}i[r]={page:a>-1?n.substr(0,a):n,params:o,isNew:!0}}return i}function s(t){for(var e=[],i=0,r=t;i<r.length;i++){var n=r[i];e.push("/"+n.page);var o=c(n.params);o&&e.push("?"+o)}return e.join("")}function c(t){var e=[];for(var i in t)"object"!=typeof t[i]&&(e.length&&e.push("&"),e.push(i+"="+encodeURIComponent(t[i])));return e.join("")}var l=function(){function t(t,e){this._next=1,this.route="string"==typeof t?{url:a(t),path:t}:t,this.index=e}return t.prototype.current=function(){return this.route.url[this.index]},t.prototype.next=function(){return this.route.url[this.index+this._next]},t.prototype.suburl=function(){return this.route.url.slice(this.index)},t.prototype.shift=function(e){var i=new t(this.route,this.index+this._next);return i.setParams(i.route.url,e,i.index),i},t.prototype.setParams=function(t,e,i){if(e){var r=t[i].params;for(var n in e)r[n]=e[n]}},t.prototype.refresh=function(){for(var t=this.route.url,e=this.index+1;e<t.length;e++)t[e].isNew=!0},t.prototype.toString=function(){var t=s(this.suburl());return t?t.substr(1):""},t.prototype._join=function(t,e){var i=this.route.url;if(null===t)return i;var r=this.route.url,n=!0;if(i=r.slice(0,this.index+(e?this._next:0)),t){i=i.concat(a(t));for(var o=0;o<i.length;o++)r[o]&&(i[o].view=r[o].view),n&&r[o]&&i[o].page===r[o].page?i[o].isNew=!1:i[o].isNew&&(n=!1)}return i},t.prototype.append=function(t){var e=this._join(t,!0);return this.route.path=s(e),this.route.url=e,this.route.path},t.prototype.show=function(t,e,i){var r=this,o=this._join(t.url,i);return this.setParams(o,t.params,this.index+(i?this._next:0)),new Promise((function(t,i){var a=s(o),c={url:o,redirect:a,confirm:Promise.resolve()},l=e?e.app:null;!l||l.callEvent("app:guard",[c.redirect,e,c])?c.confirm.catch((function(t){return i(t)})).then((function(){if(null!==c.redirect){if(c.redirect!==a)return l.show(c.redirect),void i(new n);r.route.path=a,r.route.url=o,t()}else i(new n)})):i(new n)}))},t.prototype.size=function(t){this._next=t},t.prototype.split=function(){var e={url:this.route.url.slice(this.index+1),path:""};return e.url.length&&(e.path=s(e.url)),new t(e,0)},t.prototype.update=function(t,e,i){var r=this.route.url[this.index+(i||0)];if(!r)return this.route.url.push({page:"",params:{}}),this.update(t,e,i);""===t?r.page=e:r.params[t]=e,this.route.path=s(this.route.url)},t}(),u=function(t){function e(e,i){var r=t.call(this,e.webix)||this;return r.app=e,r._children=[],r}return i(e,t),e.prototype.ui=function(t,e){var i=(e=e||{}).container||t.container,r=this.app.createView(t);return this._children.push(r),r.render(i,this._segment,this),"object"!=typeof t||t instanceof o?r:r.getRoot()},e.prototype.show=function(t,e){if(e=e||{},"object"==typeof t){for(var i in t)this.setParam(i,t[i]);t=null}else{if("/"===t.substr(0,1))return this.app.show(t,e);if(0===t.indexOf("./")&&(t=t.substr(2)),0===t.indexOf("../")){var r=this.getParentView();return r?r.show(t.substr(3),e):this.app.show("/"+t.substr(3))}var n=this.getSubViewInfo(e.target);if(n){if(n.parent!==this)return n.parent.show(t,e);if(e.target&&"default"!==e.target)return this._renderFrameLock(e.target,n.subview,{url:t,params:e.params})}else if(t)return this.app.show("/"+t,e)}return this._show(this._segment,{url:t,params:e.params},this)},e.prototype._show=function(t,e,i){var r=this;return t.show(e,i,!0).then((function(){return r._init_url_data(),r._urlChange()})).then((function(){t.route.linkRouter&&(r.app.getRouter().set(t.route.path,{silent:!0}),r.app.callEvent("app:route",[t.route.path]))}))},e.prototype.init=function(t,e){},e.prototype.ready=function(t,e){},e.prototype.config=function(){this.app.webix.message("View:Config is not implemented")},e.prototype.urlChange=function(t,e){},e.prototype.destroy=function(){},e.prototype.destructor=function(){this.destroy(),this._destroyKids(),this._root&&(this._root.destructor(),t.prototype.destructor.call(this))},e.prototype.use=function(t,e){t(this.app,this,e)},e.prototype.refresh=function(){return this.getUrl(),this.destroy(),this._destroyKids(),this._destroySubs(),this._detachEvents(),this._container.tagName&&this._root.destructor(),this._segment.refresh(),this._render(this._segment)},e.prototype.render=function(t,e,i){var r=this;"string"==typeof e&&(e=new l(e,0)),this._segment=e,this._parent=i,this._init_url_data();var n="string"==typeof(t=t||document.body)?this.webix.toNode(t):t;return this._container!==n?(this._container=n,this._render(e)):this._urlChange().then((function(){return r.getRoot()}))},e.prototype._render=function(t){var e=this,i=this.config();return i.then?i.then((function(i){return e._render_final(i,t)})):this._render_final(i,t)},e.prototype._render_final=function(t,e){var i,r=this,n=null,o=null,a=!1;if(this._container.tagName?o=this._container:(n=this._container).popup?(o=document.body,a=!0):o=this.webix.$$(n.id),!this.app||!o)return Promise.reject(null);var s=this._segment.current(),c={ui:{}};this.app.copyConfig(t,c.ui,this._subs),this.app.callEvent("app:render",[this,e,c]),c.ui.$scope=this,!n&&s.isNew&&s.view&&s.view.destructor();try{if(n&&!a){var l=o,u=l.getParentView();u&&"multiview"===u.name&&!c.ui.id&&(c.ui.id=l.config.id)}this._root=this.app.webix.ui(c.ui,o);var p=this._root;a&&p.setPosition&&!p.isVisible()&&p.show(),n&&(n.view&&n.view!==this&&n.view!==this.app&&n.view.destructor(),n.id=this._root.config.id,this.getParentView()||!this.app.app?n.view=this:n.view=this.app),s.isNew&&(s.view=this,s.isNew=!1),i=Promise.resolve(this._init(this._root,e)).then((function(){return r._urlChange().then((function(){return r._initUrl=null,r.ready(r._root,e.suburl())}))}))}catch(t){i=Promise.reject(t)}return i.catch((function(t){return r._initError(r,t)}))},e.prototype._init=function(t,e){return this.init(t,e.suburl())},e.prototype._urlChange=function(){var t=this;this.app.callEvent("app:urlchange",[this,this._segment]);var e=[];for(var i in this._subs){var r=this._subs[i],n=this._renderFrameLock(i,r,null);n&&e.push(n)}return Promise.all(e).then((function(){return t.urlChange(t._root,t._segment.suburl())}))},e.prototype._renderFrameLock=function(t,e,i){if(!e.lock){var r=this._renderFrame(t,e,i);r&&(e.lock=r.then((function(){return e.lock=null}),(function(){return e.lock=null})))}return e.lock},e.prototype._renderFrame=function(t,e,i){var r=this;if("default"===t){if(this._segment.next()){var n=i?i.params:null;return e.params&&(n=this.webix.extend(n||{},e.params)),this._createSubView(e,this._segment.shift(n))}e.view&&e.popup&&(e.view.destructor(),e.view=null)}if(null!==i&&(e.url=i.url,e.params&&(i.params=this.webix.extend(i.params||{},e.params))),e.route){if(null!==i)return e.route.show(i,e.view).then((function(){return r._createSubView(e,e.route)}));if(e.branch)return}var o=e.view;if(!o&&e.url){if("string"==typeof e.url)return e.route=new l(e.url,0),i&&e.route.setParams(e.route.route.url,i.params,0),e.params&&e.route.setParams(e.route.route.url,e.params,0),this._createSubView(e,e.route);"function"!=typeof e.url||o instanceof e.url||(o=new(this.app._override(e.url))(this.app,"")),o||(o=e.url)}if(o)return o.render(e,e.route||this._segment,this)},e.prototype._initError=function(t,e){return this.app&&this.app.error("app:error:initview",[e,t]),!0},e.prototype._createSubView=function(t,e){var i=this;return this.app.createFromURL(e.current()).then((function(r){return r.render(t,e,i)}))},e.prototype._destroyKids=function(){for(var t=this._children,e=t.length-1;e>=0;e--)t[e]&&t[e].destructor&&t[e].destructor();this._children=[]},e}(o),p=function(t){function e(e,i){var r=t.call(this,e,i)||this;return r._ui=i.ui,r}return i(e,t),e.prototype.config=function(){return this._ui},e}(u),h=function(){function t(t,e,i){this.path="",this.app=i}return t.prototype.set=function(t,e){this.path=t;var i=this.app;i.app.getRouter().set(i._segment.append(this.path),{silent:!0})},t.prototype.get=function(){return this.path},t}(),f=!0,d=function(t){function e(e){var i=this,r=(e||{}).webix||window.webix;return e=r.extend({name:"App",version:"1.0",start:"/home"},e,!0),(i=t.call(this,r,e)||this).config=e,i.app=i.config.app,i.ready=Promise.resolve(),i._services={},i.webix.extend(i,i.webix.EventSystem),i}return i(e,t),e.prototype.getUrl=function(){return this._subSegment.suburl()},e.prototype.getUrlString=function(){return this._subSegment.toString()},e.prototype.getService=function(t){var e=this._services[t];return"function"==typeof e&&(e=this._services[t]=e(this)),e},e.prototype.setService=function(t,e){this._services[t]=e},e.prototype.destructor=function(){this.getSubView().destructor(),t.prototype.destructor.call(this)},e.prototype.copyConfig=function(t,e,i){if((t instanceof o||"function"==typeof t&&t.prototype instanceof o)&&(t={$subview:t}),void 0!==t.$subview)return this.addSubView(t,e,i);var r=t instanceof Array;for(var n in e=e||(r?[]:{}),t){var a=t[n];if("function"==typeof a&&a.prototype instanceof o&&(a={$subview:a}),!a||"object"!=typeof a||a instanceof this.webix.DataCollection||a instanceof RegExp||a instanceof Map)e[n]=a;else if(a instanceof Date)e[n]=new Date(a);else{var s=this.copyConfig(a,a instanceof Array?[]:{},i);null!==s&&(r?e.push(s):e[n]=s)}}return e},e.prototype.getRouter=function(){return this.$router},e.prototype.clickHandler=function(t,e){if(t&&(e=e||t.target||t.srcElement)&&e.getAttribute){var i=e.getAttribute("trigger");if(i)return this._forView(e,(function(t){return t.app.trigger(i)})),t.cancelBubble=!0,t.preventDefault();var r=e.getAttribute("route");if(r)return this._forView(e,(function(t){return t.show(r)})),t.cancelBubble=!0,t.preventDefault()}var n=e.parentNode;n&&this.clickHandler(t,n)},e.prototype.getRoot=function(){return this.getSubView().getRoot()},e.prototype.refresh=function(){var t=this;return this._subSegment?this.getSubView().refresh().then((function(e){return t.callEvent("app:route",[t.getUrl()]),e})):Promise.resolve(null)},e.prototype.loadView=function(t){var e=this,i=this.config.views,r=null;if(""===t)return Promise.resolve(this._loadError("",new Error("Webix Jet: Empty url segment")));try{i&&"string"==typeof(r="function"==typeof i?i(t):i[t])&&(t=r,r=null),r||("_hidden"===t?r={hidden:!0}:"_blank"===t?r={}:(t=t.replace(/\./g,"/"),r=this.require("jet-views",t)))}catch(e){r=this._loadError(t,e)}return r.then||(r=Promise.resolve(r)),r=r.then((function(t){return t.__esModule?t.default:t})).catch((function(i){return e._loadError(t,i)}))},e.prototype._forView=function(t,e){var i=this.webix.$$(t);i&&e(i.$scope)},e.prototype._loadViewDynamic=function(t){return null},e.prototype.createFromURL=function(t){var e=this;return t.isNew||!t.view?this.loadView(t.page).then((function(i){return e.createView(i,name,t.params)})):Promise.resolve(t.view)},e.prototype._override=function(t){var e=this.config.override;if(e){for(var i=void 0;t;)i=t,t=e.get(t);return i}return t},e.prototype.createView=function(t,i,r){if("function"==typeof(t=this._override(t))){if(t.prototype instanceof e)return new t({app:this,name:i,params:r,router:h});if(t.prototype instanceof o)return new t(this,{name:i,params:r});t=t(this)}return t instanceof o?t:new p(this,{name:i,ui:t})},e.prototype.show=function(t,e){return t&&this.app&&0==t.indexOf("//")?this.app.show(t.substr(1),e):this.render(this._container,t||this.config.start,e)},e.prototype.trigger=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];this.apply(t,e)},e.prototype.apply=function(t,e){this.callEvent(t,e)},e.prototype.action=function(t){return this.webix.bind((function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];this.apply(t,e)}),this)},e.prototype.on=function(t,e){this.attachEvent(t,e)},e.prototype.use=function(t,e){t(this,null,e)},e.prototype.error=function(t,e){if(this.callEvent(t,e),this.callEvent("app:error",e),this.config.debug)for(var i=0;i<e.length;i++)if(console.error(e[i]),e[i]instanceof Error){var r=e[i].message;0===r.indexOf("Module build failed")?(r=r.replace(/\x1b\[[0-9;]*m/g,""),document.body.innerHTML="<pre style='font-size:16px; background-color: #ec6873; color: #000; padding:10px;'>"+r+"</pre>"):(r+="<br><br>Check console for more details",this.webix.message({type:"error",text:r,expire:-1}))}},e.prototype.render=function(t,e,i){var r=this;this._container="string"==typeof t?this.webix.toNode(t):t||document.body;var n=null;this.$router?n="string"==typeof e?e:this.app?e.split().route.path||this.config.start:e.toString():(f&&"tagName"in this._container&&(this.webix.event(document.body,"click",(function(t){return r.clickHandler(t)})),f=!1),"string"==typeof e&&(e=new l(e,0)),this._subSegment=this._first_start(e),this._subSegment.route.linkRouter=!0);var o=i?i.params:this.config.params||null,a=this.getSubView(),s=this._subSegment,c=s.show({url:n,params:o},a).then((function(){return r.createFromURL(s.current())})).then((function(e){return e.render(t,s)})).then((function(t){return r.$router.set(s.route.path,{silent:!0}),r.callEvent("app:route",[r.getUrl()]),t}));return this.ready=this.ready.then((function(){return c})),c},e.prototype.getSubView=function(){if(this._subSegment){var t=this._subSegment.current().view;if(t)return t}return new u(this,{})},e.prototype.require=function(t,e){return null},e.prototype._first_start=function(t){var e=this;if(this._segment=t,this.$router=new this.config.router((function(t){return setTimeout((function(){e.show(t).catch((function(t){if(!(t instanceof n))throw t}))}),1)}),this.config,this),this._container===document.body&&!1!==this.config.animation){var i=this._container;this.webix.html.addCss(i,"webixappstart"),setTimeout((function(){e.webix.html.removeCss(i,"webixappstart"),e.webix.html.addCss(i,"webixapp")}),10)}if(t){if(this.app){var r=t.current().view;t.current().view=this,t.next()?(t.refresh(),t=t.split()):t=new l(this.config.start,0),t.current().view=r}}else{var o=this.$router.get();o||(o=this.config.start,this.$router.set(o,{silent:!0})),t=new l(o,0)}return t},e.prototype._loadError=function(t,e){return this.error("app:error:resolve",[e,t]),{template:" "}},e.prototype.addSubView=function(t,e,i){var r=!0!==t.$subview?t.$subview:null,n=t.name||(r?this.webix.uid():"default");return e.id=t.id||"s"+this.webix.uid(),(i[n]={id:e.id,url:r,branch:t.branch,popup:t.popup,params:t.params}).popup?null:e},e}(o),v=function(){function t(t,e){var i=this;this.config=e||{},this._detectPrefix(),this.cb=t,window.onpopstate=function(){return i.cb(i.get())}}return t.prototype.set=function(t,e){var i=this;if(this.config.routes){var r=t.split("?",2);for(var n in this.config.routes)if(this.config.routes[n]===r[0]){t=n+(r.length>1?"?"+r[1]:"");break}}this.get()!==t&&window.history.pushState(null,null,this.prefix+this.sufix+t),e&&e.silent||setTimeout((function(){return i.cb(t)}),1)},t.prototype.get=function(){var t=this._getRaw().replace(this.prefix,"").replace(this.sufix,"");if(t="/"!==t&&"#"!==t?t:"",this.config.routes){var e=t.split("?",2),i=this.config.routes[e[0]];i&&(t=i+(e.length>1?"?"+e[1]:""))}return t},t.prototype._detectPrefix=function(){var t=this.config.routerPrefix;this.sufix="#"+(void 0===t?"!":t),this.prefix=document.location.href.split("#",2)[0]},t.prototype._getRaw=function(){return document.location.href},t}(),g=!1;function m(t){if(!g&&t){g=!0;var e=window;e.Promise||(e.Promise=t.promise);var i=t.version.split(".");10*i[0]+1*i[1]<53&&(t.ui.freeze=function(e){var i=e();return i&&i.then?i.then((function(e){return t.ui.$freeze=!1,t.ui.resize(),e})):(t.ui.$freeze=!1,t.ui.resize()),i});var r=t.ui.baselayout.prototype.addView,n=t.ui.baselayout.prototype.removeView,o={addView:function(t,e){if(this.$scope&&this.$scope.webixJet&&!t.queryView){var i=this.$scope,n={};t=i.app.copyConfig(t,{},n),r.apply(this,[t,e]);var o=function(t){i._renderFrame(t,n[t],null).then((function(){i._subs[t]=n[t]}))};for(var a in n)o(a);return t.id}return r.apply(this,arguments)},removeView:function(){if(n.apply(this,arguments),this.$scope&&this.$scope.webixJet){var e=this.$scope._subs;for(var i in e){var r=e[i];t.$$(r.id)||(r.view.destructor(),delete e[i])}}}};t.extend(t.ui.layout.prototype,o,!0),t.extend(t.ui.baselayout.prototype,o,!0),t.protoUI({name:"jetapp",$init:function(e){this.$app=new this.app(e);var i=t.uid().toString();e.body={id:i},this.$ready.push((function(){this.callEvent("onInit",[this.$app]),this.$app.render({id:i})}))}},t.ui.proxy,t.EventSystem)}}var w=function(t){function e(e){var i;return e.router=e.router||v,m((i=t.call(this,e)||this).webix),i}return i(e,t),e.prototype.require=function(t,e){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}()},e}(d),y=(function(t){function e(){return null!==t&&t.apply(this,arguments)||this}i(e,t),e.prototype._detectPrefix=function(){this.prefix="",this.sufix=this.config.routerPrefix||""},e.prototype._getRaw=function(){return document.location.pathname+(document.location.search||"")}}(v),function(){function t(t,e){this.path="",this.cb=t}return t.prototype.set=function(t,e){var i=this;this.path=t,e&&e.silent||setTimeout((function(){return i.cb(t)}),1)},t.prototype.get=function(){return this.path},t}());function b(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function _(t,e,i){for(var r in t)b(t,r)&&e.call(i||t,t[r],r,t)}function x(t){t="Warning: "+t,"undefined"!=typeof console&&console.error(t);try{throw new Error(t)}catch(t){}}var S=String.prototype.replace,k=String.prototype.split,$=function(t){var e=t%10;return 11!==t&&1===e?0:2<=e&&e<=4&&!(t>=12&&t<=14)?1:2},T={arabic:function(t){if(t<3)return t;var e=t%100;return e>=3&&e<=10?3:e>=11?4:5},bosnian_serbian:$,chinese:function(){return 0},croatian:$,french:function(t){return t>1?1:0},german:function(t){return 1!==t?1:0},russian:$,lithuanian:function(t){return t%10==1&&t%100!=11?0:t%10>=2&&t%10<=9&&(t%100<11||t%100>19)?1:2},czech:function(t){return 1===t?0:t>=2&&t<=4?1:2},polish:function(t){if(1===t)return 0;var e=t%10;return 2<=e&&e<=4&&(t%100<10||t%100>=20)?1:2},icelandic:function(t){return t%10!=1||t%100==11?1:0},slovenian:function(t){var e=t%100;return 1===e?0:2===e?1:3===e||4===e?2:3}},C={arabic:["ar"],bosnian_serbian:["bs-Latn-BA","bs-Cyrl-BA","srl-RS","sr-RS"],chinese:["id","id-ID","ja","ko","ko-KR","lo","ms","th","th-TH","zh"],croatian:["hr","hr-HR"],german:["fa","da","de","en","es","fi","el","he","hi-IN","hu","hu-HU","it","nl","no","pt","sv","tr"],french:["fr","tl","pt-br"],russian:["ru","ru-RU"],lithuanian:["lt"],czech:["cs","cs-CZ","sk"],polish:["pl"],icelandic:["is"],slovenian:["sl-SL"]};function I(t){var e,i=(e={},_(C,(function(t,i){_(t,(function(t){e[t]=i}))})),e);return i[t]||i[k.call(t,/-/,1)[0]]||i.en}function F(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}var P=/\$/g,E=/%\{(.*?)\}/g;function D(t,e,i,r){if("string"!=typeof t)throw new TypeError("Polyglot.transformPhrase expects argument #1 to be string");if(null==e)return t;var n=t,o=r||E,a="number"==typeof e?{smart_count:e}:e;if(null!=a.smart_count&&n){var s=k.call(n,"||||");n=(s[function(t,e){return T[I(t)](e)}(i||"en",a.smart_count)]||s[0]).replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}return n=S.call(n,o,(function(t,e){return b(a,e)&&null!=a[e]?S.call(a[e],P,"$$"):t}))}function j(t){var e=t||{};this.phrases={},this.extend(e.phrases||{}),this.currentLocale=e.locale||"en";var i=e.allowMissing?D:null;this.onMissingKey="function"==typeof e.onMissingKey?e.onMissingKey:i,this.warn=e.warn||x,this.tokenRegex=function(t){var e=t&&t.prefix||"%{",i=t&&t.suffix||"}";if("||||"===e||"||||"===i)throw new RangeError('"||||" token is reserved for pluralization');return new RegExp(F(e)+"(.*?)"+F(i),"g")}(e.interpolation)}j.prototype.locale=function(t){return t&&(this.currentLocale=t),this.currentLocale},j.prototype.extend=function(t,e){_(t,(function(t,i){var r=e?e+"."+i:i;"object"==typeof t?this.extend(t,r):this.phrases[r]=t}),this)},j.prototype.unset=function(t,e){"string"==typeof t?delete this.phrases[t]:_(t,(function(t,i){var r=e?e+"."+i:i;"object"==typeof t?this.unset(t,r):delete this.phrases[r]}),this)},j.prototype.clear=function(){this.phrases={}},j.prototype.replace=function(t){this.clear(),this.extend(t)},j.prototype.t=function(t,e){var i,r,n=null==e?{}:e;return"string"==typeof this.phrases[t]?i=this.phrases[t]:"string"==typeof n._?i=n._:this.onMissingKey?r=(0,this.onMissingKey)(t,n,this.currentLocale,this.tokenRegex):(this.warn('Missing translation for key: "'+t+'"'),r=t),"string"==typeof i&&(r=D(i,n,this.currentLocale,this.tokenRegex)),r},j.prototype.has=function(t){return b(this.phrases,t)},j.transformPhrase=function(t,e,i){return D(t,e,i)};var A=j,R=window.webix;R&&m(R);var V=function(t,e,i){var r=(i=i||{}).storage,n=r?r.get("lang")||"en":i.lang||"en";function o(e,o,a){o.__esModule&&(o=o.default);var c={phrases:o};i.polyglot&&t.webix.extend(c,i.polyglot);var l=s.polyglot=new A(c);if(l.locale(e),s._=t.webix.bind(l.t,l),n=e,r&&r.put("lang",n),i.webix){var u=i.webix[e];u&&t.webix.i18n.setLocale(u)}return a?Promise.resolve():t.refresh()}function a(e,r){if(!1!==i.path){var n=(i.path?i.path+"/":"")+e;o(e,t.require("jet-locales",n),r)}}var s={getLang:function(){return n},setLang:a,setLangData:o,_:null,polyglot:null};t.setService("locale",s),a(n,!0)},L=window;L.Promise||(L.Promise=L.webix.promise);var M=1;function O(t,e,i){Object.defineProperty(e,i,{get:function(){return t[i]},set:function(e){return t[i]=e}})}function U(t,e){e=e||{};var i={},r={},n=function(t,e){var n=M++;return i[n]={mask:t,handler:e},e("*"===t?r:r[t],void 0,t),n},o=[],a=!1,s=function(t,e,r,n){if(a)o.push([t,e,r,n]);else for(var s=Object.keys(i),c=0;c<s.length;c++){var l=i[s[c]];l&&("*"!==l.mask&&l.mask!==t||l.handler(r,e,t,n))}};for(var c in t)if(t.hasOwnProperty(c)){var l=t[c];e.nested&&"object"==typeof l&&l?r[c]=U(l,e):B(r,l,c,s)}return Object.defineProperty(r,"$changes",{value:{attachEvent:n,detachEvent:function(t){delete i[t]}},enumerable:!1,configurable:!1}),Object.defineProperty(r,"$observe",{value:n,enumerable:!1,configurable:!1}),Object.defineProperty(r,"$batch",{value:function(t){if("function"!=typeof t){var e=t;t=function(){for(var t in e)r[t]=e[t]}}for(a=!0,t(r),a=!1;o.length;){var i=o.shift();s.apply(this,i)}},enumerable:!1,configurable:!1}),r}function B(t,e,i,r){Object.defineProperty(t,i,{get:function(){return e},set:function(t){if(null===e||null===t?e!==t:e.valueOf()!=t.valueOf()){var n=e;e=t,r(i,n,t,null)}},enumerable:!0,configurable:!1})}function H(t){return{attachEvent:function(e,i){return webix.UIManager.addHotKey(e,i,t),{key:e,handler:i}},detachEvent:function(e){var i=e.key,r=e.handler;return webix.UIManager.removeHotKey(i,r,t)}}}var W="<span class='webix_icon wxi-folder'></span>",z="<span class='webix_icon wxi-dots webix_fmanager_menu_icon'></span>",N=function(t){function e(e,i,r){var n=t.call(this,e,i)||this;return n.compact=!!r.compact,n.tree=!!r.tree,n}return i(e,t),e.prototype.config=function(){var t=this,e=this.app.getService("locale")._,i=[{id:"download",value:e("Download"),icon:"wxi-download",show:32,hotkey:"Ctrl+D"},{$template:"Separator",show:32},{id:"toggle-preview",value:e("Preview"),icon:"wxi-eye",show:17},{id:"locate",value:e("Open item location"),icon:"wxi-folder",hotkey:"Ctrl+Alt+O",show:65},{id:"open",value:e("Open"),icon:"wxi-folder-open",hotkey:"Ctrl+O",show:8},{$template:"Separator",show:8},{id:"copy",value:e("Copy"),hotkey:"Ctrl+C",icon:"fmi-content-copy",show:35},{id:"cut",value:e("Cut"),hotkey:"Ctrl+X",icon:"fmi-content-cut",show:35},{id:"paste",value:e("Paste"),hotkey:"Ctrl+V",icon:"fmi-content-paste",show:33},{$template:"Separator",show:35},{id:"rename",value:e("Rename"),icon:"fmi-rename-box",hotkey:"Ctrl+R",show:1},{id:"delete",value:e("Delete"),icon:"wxi-close",hotkey:"Del / &#8592;",show:3}];return this.app.config.editor&&i.splice(5,0,{id:"edit",value:e("Edit"),icon:"wxi-pencil",hotkey:"Ctrl+E",show:4}),{view:"menu",css:"webix_fmanager_menu",layout:"y",autoheight:!0,data:i,template:function(t){return(t.icon?'<span class="webix_list_icon webix_icon '+t.icon+'"></span>':"")+t.value+(t.hotkey?'<span class="webix_fmanager_context-menu-hotkey">'+t.hotkey+"</span>":"")},on:{onMenuItemClick:function(e){t.app.callEvent("app:action",[e,t.Files]),t.app.callEvent("app:filemenu:click")}}}},e.prototype.FilterOptions=function(t){var e=this;this.Files=t;var i=t[0],r=t.length>1,n=["image","audio","video","code","pdf"].find((function(t){return t===i.type||t===i.$ext})),o=this.app.getState().search;this.getRoot().define("width",o&&!r?270:200),this.getRoot().filter((function(t){return!(r&&!(2&t.show)||"folder"===i.type&&!(1&t.show)||4&t.show&&"code"!==i.type||8&t.show&&!n||16&t.show&&!e.compact||32&t.show&&e.tree||64&t.show&&!o)}))},e}(u),G=function(t){function e(e,i,r){var n=t.call(this,e,i)||this;return n._config=r,n}return i(e,t),e.prototype.config=function(){var t=this;return{view:"context",body:{$subview:new(this.app.dynamic(N))(this.app,"",r({},this._config)),name:"options"},on:{onBeforeShow:function(e){var i=t._Locate(e);if(!i)return!1;t.getSubView("options").FilterOptions(i)}}}},e.prototype.init=function(){var t=this;this.on(this.app,"app:filemenu:click",(function(){return t.getRoot().hide()}))},e.prototype.AttachTo=function(t,e){this._Locate=e,this.getRoot().attachTo(t)},e.prototype.Show=function(t){this.getRoot().show(t,{x:-t.offsetX,y:t.target.offsetHeight-t.offsetY})},e}(u),q=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.init=function(){var t=this;this.State=this.getParam("state"),this._Track=!0,this.WTable.attachEvent("onAfterSelect",(function(){return t.ShiftFocus()})),this.WTable.attachEvent("onSelectChange",(function(){if(t._Track){var e=[].concat(t.WTable.getSelectedId(!0).map((function(e){return t.WTable.getItem(e)}))).filter((function(t){return".."!==t.value}));(e.length||t.State.selectedItem.length)&&(e.length||(e.$noSelect=!0),t.State.selectedItem=e)}})),this.on(this.State.$changes,"path",(function(e,i){t.State.search?i&&t.State.$batch({search:"",searchStats:null}):(e="files"===t.State.source?e:t.State.source,i?t.app.getService("local").folders().then((function(r){t.State.selectedItem=t.GetPrevLocation(r,e,i),t.LoadData(e)})):t.LoadData(e))})),this.on(this.WTable.data,"onStoreUpdated",(function(e,i,r){!r&&t.WTable.count()&&t.State.selectedItem.length&&t.SelectActive()})),this.AddHotkeys();var e=this.getParam("compact",!0);this.Menu=this.ui(new(this.app.dynamic(G))(this.app,"",{compact:e,state:this.State})),this.Menu.AttachTo(this.WTable,(function(e){var i=t.WTable.locate(e);if(!i)return!1;var r=t.WTable.getItem(i);if(".."==r.value)return!1;t.WTable.isSelected(i)||t.WTable.select(i);var n=t.WTable.getSelectedId(!0);return 1===n.length?[r]:n.map((function(e){return t.WTable.getItem(e)}))})),this.on(this.WTable,"onAfterScroll",(function(){return webix.callEvent("onClick")}))},e.prototype.ShiftFocus=function(){this.getParam("trackActive",!0)&&(this.State.isActive=!0)},e.prototype.Activate=function(t){t&&("folder"===t.type?this.ShowSubFolder(".."===t.value?t.value:t.id):"code"===t.type&&this.app.config.editor?this.app.callEvent("app:action",["edit",[t]]):this.app.callEvent("app:action",["open",[t]]))},e.prototype.ShowSubFolder=function(t){var e;if(".."==t){var i=this.State.path.split("/");e="/"+i.slice(1,i.length-1).join("/")}else e=t;this.State.path=e},e.prototype.GetPrevLocation=function(t,e,i){if("/"===i||!t.exists(i))return[];var r;for("/"===e&&(e="../files");i;)if(r=i,(i=t.getParentId(i))===e){var n=t.getItem(r);return[{id:n.id,value:n.value,type:"folder",date:new Date(n.date)}]}return[]},e.prototype.GetTargetFolder=function(t){var e=t?this.WTable.getItem(t):null;return e&&"folder"===e.type&&".."!==e.value?e.id:this.State.path},e.prototype.SelectActive=function(){var t=this.WTable;if(!1!==this.State.isActive&&!t.getSelectedId()){for(var e=this.State.selectedItem,i=0;i<e.length;i++)t.exists(e[i].id)&&t.select(e[i].id,!0);if(!e.$noSelect&&!t.getSelectedId()){var r=t.getFirstId();r&&(t.select(r),e.$noSelect=!1)}webix.delay((function(){return webix.UIManager.setFocus(t)}))}},e.prototype.GetSelection=function(){return this.WTable.getItem(this.WTable.getSelectedId())},e.prototype.LoadData=function(t,e){var i=this;this._Track=!1;var r=this.WTable;e?(r.clearAll(),this.app.getService("backend").search(t,e).then((function(t){for(var e=0;e<t.length;++e)"number"==typeof t[e].date&&(t[e].date=new Date(1e3*t[e].date));r.parse(t),i.GetSearchStats(t)}))):r.data.url!==t&&(r.clearAll(),this.app.getService("local").files(t).then((function(t){i.RenderData(t),i.SelectActive()}))),this._Track=!0},e.prototype.MoveFiles=function(t,e){return this.app.getService("operations").move(t,this.GetTargetFolder(e)),!1},e.prototype.Icon=function(t){return'<img class="webix_fmanager_file-type-icon" src="'+this.app.getService("backend").icon(t)+'" />'},e.prototype.DragMarker=function(t){var e=this.WTable,i=e.find((function(t){return".."===t.value}),!0);if(i){var r=t.source.indexOf(i.id);-1!==r&&t.source.splice(r,1)}var n=t.source.length;if(!n)return!1;1===n&&e.select(t.source[0]);var o=e.getItem(t.source[0]),a="<div class='webix_fmanager_grid_drag_zone_list'>";if(a+='<div class="webix_fmanager_inner_drag_zone_list">'+("folder"===o.type?W:this.Icon(o))+o.value+"</div>",a+="</div>",n>1){a="<div class='webix_drag_main'>"+a+"</div>";var s="<div class='webix_drag_multiple'></div>";n>2&&(s="<div class='webix_drag_multiple_last'></div>"+s),a=s+(a+="<div class='webix_badge'>"+n+"</div>")}t.html=a},e.prototype.AddHotkeys=function(){var t=this,e=webix.env.isMac?"COMMAND":"CTRL",i=[{key:"DELETE",oper:"delete"},{key:"BACKSPACE",oper:"delete"},{key:e+"+C",oper:"copy"},{key:e+"+X",oper:"cut"},{key:e+"+V",oper:"paste"},{key:e+"+R",oper:"rename"},{key:e+"+O",oper:"open"},{key:e+"+D",oper:"download"},{key:e+"+Alt+O",oper:"locate"}];this.app.config.editor&&i.push({key:e+"+E",oper:"edit"});for(var r=function(e){n.on(H(n.getRoot()),i[e].key,(function(r,n){var o=[i[e].oper];t.app.callEvent("app:action",o),webix.html.preventEvent(n)}))},n=this,o=0;o<i.length;++o)r(o);this.on(H(this.getRoot()),e+"+A",(function(e,i){t.WTable.selectAll(),webix.html.preventEvent(i)}))},e.prototype.GetSearchStats=function(t){var e=t.length,i=t.filter((function(t){return"folder"===t.type}));this.State.searchStats={folders:i?i.length:0,files:e-i.length}},e.prototype.EmptyClick=function(){!1!==this.State.isActive?this.WTable.unselectAll():this.ShiftFocus()},e}(u),K=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.config=function(){var t=this,e=this.getParam("compact",!0),i="mini"===webix.skin.$name||"compact"===webix.skin.$name;return{view:"dataview",localId:"cards",drag:!e,select:!0,multiselect:!0,css:"webix_noselect webix_fmanager_cards",template:function(e){return t.CardTemplate(e)},type:r(r({},i?{height:149,width:181,padding:16}:{height:197,width:236,padding:20}),{type:"tiles"}),on:{onItemDblClick:function(){return t.Activate(t.GetSelection())},onEnter:function(){return t.Activate(t.GetSelection())},onBeforeDrag:function(e){return t.DragMarker(e)},onBeforeDrop:function(e){return t.MoveFiles(e.source,e.target)}},onClick:{webix_fmanager_menu_icon:function(e){t.Menu.Show(e)},webix_dataview:function(e,i){i||t.EmptyClick()}},onContext:{}}},e.prototype.init=function(){this.WTable=this.$$("cards"),t.prototype.init.call(this)},e.prototype.RenderData=function(t){var e=this;this.WTable.sync(t,(function(){return e.WTable.filter((function(t){return".."!==t.value}))}))},e.prototype.CardTemplate=function(t){var e,i,r=this.app.getService("locale")._;if("folder"===t.type)e="<div class=\"webix_fmanager_card_preview\"><span class='webix_icon wxi-folder webix_fmanager_folder_icon'></span></div>",i='<div class="webix_fmanager_card_panel">\n\t\t<span class="webix_fmanager_card_label">'+r("Folder")+'</span>\n\t\t<span class="webix_fmanager_card_name folder">'+this.SearchTemplate(t.value)+"</span>"+z+"\n\t\t</div>";else{var n=webix.skin.$active.listItemHeight<29?[163,92]:[214,124],o=this.app.getService("backend").previewURL(t,n[0],n[1]);e='<div class="webix_fmanager_card_preview file"><img height="'+n[1]+'" width="'+n[0]+'" src="'+o+'" onerror=\'this.style.display="none"\'/></div>',i='<div class="webix_fmanager_card_panel file">\n\t\t<span class="webix_fmanager_card_name">'+this.Icon(t)+'<span class="file_name_text">'+this.SearchTemplate(t.value)+"</span></span>"+z+"\n\t\t</div>"}return e+i},e.prototype.SearchTemplate=function(t){if(this.State.search){var e=new RegExp("("+this.State.search+")","gi");return t.replace(e,"<span class='webix_fmanager_search_mark'>$1</span>")}return t},e}(q);webix.protoUI({name:"codemirror-editor",defaults:{mode:"javascript",lineNumbers:!0,matchBrackets:!0,theme:"default"},$init:function(t){this.$view.innerHTML="<textarea style='width:100%;height:100%;'></textarea>",this._textarea=this.$view.firstChild,this._waitEditor=webix.promise.defer(),this.$ready.push(this._render_cm_editor)},complex_types:{php:{mode:["xml","javascript","css","htmlmixed","clike"]},htmlembedded:{mode:["xml","javascript","css","htmlmixed"],addon:["mode/multiplex"]},htmlmixed:{mode:["xml","javascript","css"]},dockerfile:{addon:["mode/simple"]}},_render_cm_editor:function(){if(!1!==this.config.cdn){var t=this.config.cdn||"https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.48.4/",e=[t+"/codemirror.css",t+"/codemirror.js"],i=this.config.mode?this.config.mode:"javascript",r=this.complex_types[i];r&&(r.mode&&r.mode.forEach((function(i){var r="/mode/"+i+"/"+i+".js";e.push(t+r)})),r.addon&&r.addon.forEach((function(i){var r="/addon/"+i+".js";e.push(t+r)}))),e.push(t+"/mode/"+i+"/"+i+".js"),this.config.theme&&"default"!==this.config.theme&&e.push(t+"/theme/"+this.config.theme+".css"),this.config.matchBrackets&&e.push(t+"/addon/edit/matchbrackets.js"),webix.require(e).then(webix.bind(this._render_when_ready,this)).catch((function(t){console.log(t)}))}else this._render_when_ready},_render_when_ready:function(){this._editor=CodeMirror.fromTextArea(this._textarea,{mode:this.config.mode,lineNumbers:this.config.lineNumbers,matchBrackets:this.config.matchBrackets,theme:this.config.theme}),this._waitEditor.resolve(this._editor),this.setValue(this.config.value),this._focus_await&&this.focus()},_set_inner_size:function(){this._editor&&this.$width&&(this._updateScrollSize(),this._editor.scrollTo(0,0))},_updateScrollSize:function(){var t=this._editor.getWrapperElement(),e=(this.$height||0)+"px";t.style.height=e,t.style.width=(this.$width||0)+"px";var i=this._editor.getScrollerElement();i.style.height!=e&&(i.style.height=e,this._editor.refresh())},$setSize:function(t,e){webix.ui.view.prototype.$setSize.call(this,t,e)&&this._set_inner_size()},setValue:function(t){t||0===t||(t=""),this.config.value=t,this._editor&&(this._editor.setValue(t),this.config.preserveUndoHistory||this._editor.clearHistory(),this._updateScrollSize())},getValue:function(){return this._editor?this._editor.getValue():this.config.value},focus:function(){this._focus_await=!0,this._editor&&this._editor.focus()},getEditor:function(t){return t?this._waitEditor:this._editor},undo:function(){this._editor.undo()},redo:function(){this._editor.redo()},undoLength:function(){return this._editor.historySize().undo}},webix.ui.view);var J={css:["css","less"],go:["go"],htmlmixed:["html","xml","svg"],javascript:["js","mjs","json","ts","coffee"],markdown:["md"],php:["php","phtml","php3","php4","php5","php7","php-s","pht","phar"],python:["py","pyc","pyd","pyo","pyw","pyz"],sql:["sql","sqlite3","sqlite","db"],yaml:["yaml","yml"],shell:["sh"]},Y=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.config=function(){var t=this,e=this.app.getService("locale")._;this.File=this.getParam("file");var i=this.GetFileType(this.File);return{type:"wide",rows:[{view:"toolbar",padding:{left:28,right:4},cols:[{view:"button",localId:"saveBtn",type:"icon",label:e("Save"),icon:"wxi-check",css:"webix_primary webix_fmanager_editor_save",width:90,hotkey:"Ctrl+S",click:function(){return t.Save()}},{width:10},{view:"label",label:" ",localId:"name",css:"webix_fmanager_editor_name"},{gravity:.3},{view:"icon",icon:"wxi-close",hotkey:"esc",click:function(){return t.Confirm()}}]},{view:"codemirror-editor",localId:"editor",mode:i,theme:"contrast"===webix.skin.$name?"monokai":"default"}]}},e.prototype.init=function(){var t=this;this.$$("name").setValue('<div class="filename">'+this.ClipName(this.File.id)+'</div><span class="extension">.'+this.File.$ext+"</span>");var e=this.$$("editor");webix.extend(e,webix.ProgressBar),e.showProgress({type:"top"}),this.app.getService("operations").read(this.File.id).then((function(i){t._oldValue=i,e.getEditor(!0).then((function(){e.setValue(i)}))})).finally((function(){e.hideProgress()})),e.getEditor(!0).then((function(i){i.on("changes",(function(){return t.TextChanged(e)}))}))},e.prototype.Back=function(){this.show("/top",{params:{state:this.getParam("state")}})},e.prototype.Confirm=function(){var t=this,e=this.app.getService("locale")._;this._changed?webix.confirm({text:e("Are you sure you want to exit without saving?")}).then((function(){return t.Back()})):this.Back()},e.prototype.Save=function(){var t=this.$$("editor").getValue();this.app.getService("operations").write(this.File.id,t),this._oldValue=t,this.ChangeTextState(!1)},e.prototype.GetFileType=function(t){if("Dockerfile"===t.value)return"dockerfile";if(t.$ext)for(var e in J)if(-1!==J[e].indexOf(t.$ext))return e;return"htmlmixed"},e.prototype.TextChanged=function(t){var e=t.getValue()==this._oldValue;this.ChangeTextState(!e)},e.prototype.ChangeTextState=function(t){if(t!==!!this._changed){this._changed=t;var e=this.$$("saveBtn");e.config.icon=t?"webix_fmanager_icon fmi-circle":"wxi-check",e.refresh()}},e.prototype.ClipName=function(t){if(!t)return"";var e=t.split(".");return e.slice(0,e.length-1).join(".")},e}(u);function X(t){var e=t.value.lastIndexOf(".");e>-1?t.setSelectionRange(0,e):t.select()}function Z(t){return t>=1e9?(t/1e9).toFixed(1)+" Gb":t>=1e6?(t/1e6).toFixed(1)+" Mb":t>=1e3?(t/1e3).toFixed(1)+" kb":t+" b"}function Q(t){return t.length?t[t.length-1]:{type:"empty",value:"Nothing is selected"}}function tt(t){for(t=t.replace(/[/\\:*?"<>|]/g,"").trim();"."===t[0];)t=t.substr(1).trim();return t}function et(t){return t?t.charAt(0).toUpperCase()+t.slice(1):""}function it(t){var e=new webix.promise.defer,i=webix.ui({view:"window",css:"webix_fmanager_prompt",modal:!0,move:!0,head:{view:"toolbar",padding:{left:12,right:4},borderless:!0,elements:[{view:"label",label:t.text},{view:"icon",icon:"wxi-close",hotkey:"esc",click:function(){e.reject("prompt cancelled"),i.close()}}]},position:t.master?"":"center",body:{view:"form",padding:{top:0,left:12,right:12,bottom:12},rows:[{margin:10,cols:[{view:"text",name:"name",value:t.value,width:230,validate:tt,css:"webix_fmanager_prompt_input"},{view:"button",value:t.button,css:"webix_primary",width:100,hotkey:"enter",click:function(){var t=this.getTopParentView(),i=t.getBody();if(i.validate()){var r=i.getValues().name;e.resolve(r),t.close()}else webix.UIManager.setFocus(i)}}]}]},on:{onShow:function(){var e=this.getBody().elements.name.getInputNode();e.focus(),t.selectMask?t.selectMask(e):e.select()}}}),r=t.master?{x:50}:null;return webix.delay((function(){return i.show(t.master,r)})),e}var rt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.config=function(){var t=this,e=this.app.getService("locale")._;return{view:"popup",width:198,body:{view:"menu",autoheight:!0,layout:"y",css:"webix_fmanager_add_new_menu",data:[{id:"makefile",value:e("Add new file"),icon:"webix_fmanager_icon fmi-file-plus-outline"},{id:"makedir",value:e("Add new folder"),icon:"webix_fmanager_icon fmi-folder-plus-outline"},{id:"upload",value:e("Upload file"),icon:"webix_fmanager_icon fmi-file-upload-outline"}],on:{onMenuItemClick:function(e){if("makefile"===e||"makedir"===e){var i=t.app.getService("locale")._;it({text:i("Enter a new name"),button:i("Add"),selectMask:X,value:"New "+("makefile"===e?"file.txt":"folder")}).then((function(i){t.app.callEvent("app:action",[e,tt(i)])}))}else t.app.callEvent("app:action",[e]);t.getRoot().hide()}}}}},e.prototype.Show=function(t){this.getRoot().show(t,{x:20})},e}(u),nt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.config=function(){var t=this,e=this.app.getService("locale")._;return{view:"proxy",body:{rows:[{view:"button",value:e("Add New"),inputWidth:210,css:"webix_primary",align:"center",click:function(){this.$scope.Menu.Show(this.$view)}},{view:"tree",localId:"tree",css:"webix_fmanager_tree",select:!0,drag:"target",type:{template:function(t,i){return""+i.icon(t)+i.folder(t)+" <span>"+(1===t.$level?e(t.value):t.value)+"</span>"},folder:function(t){return"<div class='webix_icon wxi-"+(t.icon||"folder")+"'></div>"}},borderless:!0,on:{onBeforeDrop:function(e){return t.MoveFiles(e.source,e.target)},onBeforeContextMenu:function(e){if(".."===e.substr(0,2))return!1;t.Tree.select(e)}}},{localId:"fs:stats",borderless:!0,height:68,css:"webix_fmanager_fsstats",template:function(t){return'<svg width="100%" height="20px">\n<rect y="1" rx="4" width="100%" height="8" style="fill:#DFE2E6;" />\n<rect y="1" rx="4" width="'+(Math.floor(t.used/t.total*100)||0)+'%" height="8" style="fill:'+webix.skin.$active.timelineColor+';" /></svg><div class="webix_fmanager_fsstats_label">'+Z(t.used||0)+" "+e("of")+" "+Z(t.total||0)+" "+e("used")+"</div>"}}],padding:{top:8,bottom:4}}}},e.prototype.init=function(){var t=this;this.State=this.getParam("state"),this.Tree=this.$$("tree"),this.Ready=this.app.getService("local").folders().then((function(e){t.Tree.sync(e),t.Subscribe(),t.GetFsStats()})),this.Menu=this.ui(rt),this.ContextMenu=this.ui(new(this.app.dynamic(G))(this.app,"",{compact:!1,tree:!0})),this.ContextMenu.AttachTo(this.Tree,(function(e){var i=t.Tree.locate(e);return i?[t.Tree.getItem(i)]:null})),this.on(this.app,"reload:fs:stats",(function(){return t.GetFsStats(!0)}))},e.prototype.Subscribe=function(){var t=this;this.Tree.attachEvent("onAfterSelect",(function(){var e=t.Tree.getSelectedId();".."==e.substr(0,2)?t.State.$batch({source:e.slice(3),path:"/"}):t.State.$batch({source:t.GetRootId(e).slice(3),path:e})})),this.on(this.State.$changes,"path",(function(e){if(t.State.path=e,t.Tree.exists(e)){t.Tree.select(e);var i=t.Tree.getParentId(e);i&&t.Tree.open(i),t.Tree.showItem(e)}else t.Tree.select("../"+t.State.source)}))},e.prototype.GetFsStats=function(t){var e=this;this.app.getService("backend").getInfo(t).then((function(t){e.$$("fs:stats").setValues(t.stats)}))},e.prototype.MoveFiles=function(t,e){return"../files"===e&&(e="/"),this.app.getService("operations").move(t,e),!1},e.prototype.GetRootId=function(t){for(var e;t;)e=t,t=this.Tree.getParentId(t);return e},e}(u),ot=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.config=function(){var t=this,e=this.app.getService("locale")._,i=this.getParam("compact",!0),r={view:"datatable",localId:"table",css:"webix_noselect webix_header_border webix_fmanager_filelist",select:"row",multiselect:!0,drag:!0,resizeColumn:{headerOnly:!0},sort:"multi",type:{backIcon:function(){return"<span class='webix_icon wxi-angle-double-left webix_fmanager_back_icon'></span>"},backLabel:function(){return e("back to parent folder")}},on:{onItemDblClick:function(){return t.Activate(t.GetSelection())},onEnter:function(){return t.Activate(t.GetSelection())},onBeforeDrag:function(e){return t.DragMarker(e)},onBeforeDrop:function(e){return t.MoveFiles(e.source,e.target)},"data->onStoreLoad":function(){t.WTable.markSorting()}},onClick:{webix_ss_center_scroll:function(){return t.EmptyClick()},webix_column:function(){return!1}},columns:[{id:"value",header:"",template:function(e){return t.NameTemplate(e)},sort:at("value"),fillspace:!0},{id:"size",header:e("Size"),template:function(t){return"folder"!==t.type?Z(t.size):""},sort:at("size")},{id:"date",header:e("Date"),sort:at("date"),format:function(t){return t instanceof Date&&!isNaN(t)?webix.i18n.longDateFormatStr(t):""},width:150}]};return i&&r.columns.splice(1,2),r},e.prototype.init=function(){var e=this;this.WTable=this.$$("table"),t.prototype.init.call(this),this.on(this.State.$changes,"isActive",(function(t){t?(e.SelectActive(),webix.delay((function(){return webix.UIManager.setFocus(e.WTable)}))):(e._Track=!1,e.WTable.unselect(),e._Track=!0)})),this.on(H(this.getRoot()),"TAB",(function(){e.getParam("trackActive",!0)&&(e.State.isActive=!1)}))},e.prototype.RenderData=function(t){this.WTable.sync(t)},e.prototype.NameTemplate=function(t){return"folder"===t.type?W+t.value:this.Icon(t)+'<span class="file-name">'+t.value+"</span>"},e}(q);function at(t){return function(e,i){return".."===e.value||".."===i.value||"folder"===e.type&&"folder"!==i.type||"folder"===i.type&&"folder"!==e.type?0:"value"===t?e.value.localeCompare(i.value,void 0,{ignorePunctuation:!0,numeric:!0}):e[t]<i[t]?-1:e[t]>i[t]?1:0}}var st=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.config=function(){return{view:"window",head:!1,fullscreen:!0,body:{$subview:!0,branch:!0,name:"preview"}}},e.prototype.IsVisible=function(){return this.getRoot().isVisible()},e.prototype.Show=function(t){this.show("preview",{target:"preview",params:{state:t.state,compact:!0}}),this.getRoot().show()},e.prototype.Hide=function(){this.show("_blank",{target:"preview"}),this.getRoot().hide()},e}(u),ct=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.config=function(){return{view:"sidemenu",width:300,state:function(t){var e=webix.skin.$active.toolbarHeight+14;t.top=e,t.height-=e},body:nt}},e.prototype.IsVisible=function(){return this.getRoot().isVisible()},e.prototype.Show=function(){this.getRoot().show()},e}(u),lt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.config=function(){return{type:"wide",cols:[{$subview:!0,branch:!0,name:"left"},{view:"resizer"},{$subview:!0,branch:!0,name:"right"}]}},e.prototype.init=function(){this.State=this.getParam("state");var t=U({selectedItem:[].concat(this.State.selectedItem),path:this.State.path,source:this.GetSource("left"),mode:"list",isActive:!0});t.selectedItem.$noSelect=this.State.selectedItem.$noSelect;var e=U({selectedItem:[],path:this.State.path,source:this.GetSource("right"),mode:"list",isActive:!1});this._TrackChanges(t,e),this._TrackChanges(e,t),this.show("panel/list",{target:"left",params:{trackActive:!0,state:t}}),this.show("panel/list",{target:"right",params:{trackActive:!0,state:e}})},e.prototype._TrackChanges=function(t,e){var i=this;this.on(t.$changes,"path",(function(e){t.isActive&&(i.State.path=e)})),this.on(t.$changes,"source",(function(t){return i.State.source=t})),this.on(t.$changes,"selectedItem",(function(e){t.isActive&&(i.State.selectedItem=e)})),this.on(t.$changes,"isActive",(function(r){r&&i.State.$batch({path:t.path,source:t.source}),e.isActive=!r})),this.on(this.app,"pathChanged",(function(e,i){t.isActive||t.path!==e&&0!==t.path.indexOf(e+"/")||(t.path=t.path.replace(e,i))}))},e.prototype.GetSource=function(){return this.State.source},e}(u),ut=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.config=function(){var t=this;this.State=this.getParam("state");var e=this.app.getService("locale")._;return{rows:[{view:"toolbar",cols:[{view:"icon",icon:"wxi-angle-left",click:function(){t.State.$batch({search:"",searchStats:null})}},{localId:"header",type:"header",borderless:!0,css:"webix_fmanager_path",template:function(i){var r=e("Search results in"),n=t.app.getService("backend").getRootName(),o="";return i&&i.path&&"/"!==i.path&&(o=webix.template.escape(i.path)),r+" "+n+o}},{}]},{$subview:!0,params:{state:this.State}}]}},e.prototype.init=function(){this.$$("header").setValues({path:this.State.path})},e.prototype.ready=function(){var t=this;this.on(this.State.$changes,"search",(function(e){(e=e.trim())&&(t.State.selectedItem=[],t.getSubView().LoadData(t.State.path,e))}))},e}(u),pt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.config=function(){var t=this;return{rows:[{view:"toolbar",paddingX:4,cols:[{view:"icon",icon:"wxi-sync",css:"webix_fmanager_spec_icon",tooltip:"Refresh",click:function(){t.app.getService("local").refresh(t.State.path)}},{view:"template",localId:"path",type:"header",borderless:!0,css:"webix_fmanager_path",template:function(e){return t.RenderPath(e)},onClick:{webix_fmanager_path_chunk:function(e){return t.ChangePath(e)}}}]},{$subview:!0,params:{state:this.getParam("state")}}]}},e.prototype.init=function(){var t=this;this.State=this.getParam("state"),this.on(this.State.$changes,"path",(function(e){return t.ProcessPath(e)}));var e=this.app.getService("upload").getUploader();e.addDropZone(this.getRoot().$view),this.on(e,"onBeforeFileDrop",(function(i,r){t.getRoot().$view.contains(r.target)&&(e.config.tempUrlData={id:t.State.path})}))},e.prototype.ProcessPath=function(t){var e=this;this.app.getService("local").folders().then((function(i){var r=["/"];if("/"!==t)for(var n=t.split("/"),o=1,a="";o<n.length;++o)a+="/"+n[o],r.push(i.getItem(a).value);e.$$("path").setValues({path:r})}))},e.prototype.RenderPath=function(t){if(t.path&&t.path.length){var e=this.app.getService("backend").getRootName(),i="";return t.path.forEach((function(r,n){i+='<span class="webix_fmanager_path_chunk" data-path="'+n+'">'+(n?r:e)+"</span>",n<t.path.length-1&&(i+="<span class='webix_icon wxi-angle-right'></span>")})),i}return""},e.prototype.ChangePath=function(t){var e=1*t.target.getAttribute("data-path"),i=this.State.path.split("/");i.splice(e+1,i.length-1);var r=i.join("/")||"/";this.State.path=r},e}(u),ht=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.config=function(){var t=this,e=this.app.getService("locale")._,i=webix.Date.dateToStr("%M %j, %Y&nbsp;&nbsp;&nbsp;&nbsp;%H:%i:%s"),r={css:"webix_fmanager_preview_info",localId:"info",borderless:!0,autoheight:!0,template:function(e){if(!e.id)return"";var r=t.app.getService("locale")._;return"<div><div class='key_col'>"+("folder"===e.type?["Type","Date"]:["Type","Size","Date"]).map((function(t){return"<div class='key_value_cell''>"+r(t)+"</div>"})).join("")+'</div><div class="value_col">'+("folder"===e.type?[et(r(e.type)),i(e.date)]:[et(r(e.type)),Z(e.size),i(e.date)]).map((function(t){return"<div class='key_value_cell'>"+t+"</div>"})).join("")+"</div></div>"}},n={css:"webix_fmanager_preview_info extra",localId:"extra:info",hidden:!0,autoheight:!0,template:function(t){for(var e=Object.keys(t),i="<div class='key_col'>",r=0;r<e.length;++r)i+="<div class='key_value_cell key'>"+e[r]+"</div>";i+="</div>";var n="<div class='value_col'>";for(var o in t){var a=t[o].trim();n+="<div class='key_value_cell'>"+(a&&"0"!=a?a:"<span class='webix_fmanager_id3tags-unknown'>Unknown</span>")+"</div>"}return'<div><div class="webix_fmanager_info_header">\n<span class="webix_fmanager_icon fmi-information-outline"></span>\n<span class="webix_fmanager_info_title">Extra info</span>\n</div>'+i+(n+="</div>")+"</div>"}},o={localId:"search:counter",css:"webix_fmanager_preview_info",height:104,borderless:!0,template:function(t){return"<div><div class='key_col search'>"+[e("Folders"),e("Files")].map((function(t){return"<div class='key_value_cell''>"+e(t)+"</div>"})).join("")+'</div><div class="value_col search">'+[t.folders,t.files].map((function(t){return"<div class='key_value_cell'>"+t+"</div>"})).join("")+"</div></div>"}};return{localId:"info:tabs",view:"tabview",css:"webix_fmanager_info_tab",cells:[{header:e("Information"),body:{padding:14,margin:14,rows:[r,n,{}]}},{header:e("Search results"),body:{padding:14,margin:14,rows:[o,{}]}}]}},e.prototype.init=function(){var t=this;this.Tabview=this.$$("info:tabs"),this.State=this.getParam("state"),this.on(this.State.$changes,"selectedItem",(function(e){t.ShowInfo(Q(e))})),this.on(this.State.$changes,"searchStats",(function(e){e?t.$$("search:counter").setValues(e):t.State.selectedItem.length||t.Tabview.hide()}))},e.prototype.ShowInfo=function(t){var e=this,i=this.Tabview.getTabbar(),r=i.config.options[0].id,n=i.config.options[1].id;if("empty"!==t.type){this.SetInfo(this.$$("info"),t),this.SwitchTabs(i,n,r);var o=this.$$("extra:info"),a=this.app.getService("backend").getMeta(t);a?a.then((function(t){return e.SetExtraInfo(o,t)})).fail((function(){return o.hide()})):o.hide()}else this.State.search?this.SwitchTabs(i,r,n):this.Tabview.hide()},e.prototype.SetExtraInfo=function(t,e){!function t(e){for(var i in e){if("object"==typeof e[i])return t(e[i]);if(e[i]&&"0"!==e[i])return!1}return!0}(e)?this.SetInfo(t,e):t.hide()},e.prototype.SetInfo=function(t,e){t.setValues(e),t.show()},e.prototype.SwitchTabs=function(t,e,i){t.hideOption(e),t.setValue(i),t.showOption(i),this.Tabview.show()},e}(u),ft=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.config=function(){var t=this,e=this.app.getService("locale")._,i=this.getParam("compact");return{margin:.1,rows:[{view:"toolbar",localId:"toolbar",height:webix.skin.$active.toolbarHeight+2,padding:{right:6},elements:[{view:"label",localId:"filename:label",css:"webix_fmanager_preview_name"},{view:"icon",icon:"wxi-download",css:"webix_fmanager_spec_icon",localId:"download",tooltip:e("Download file"),click:function(){t.app.callEvent("app:action",["download",[t.FileInfo]])}},{view:"icon",icon:"wxi-close",hidden:!i,click:function(){return t.app.callEvent("app:action",["toggle-preview"])}}]},{view:"scrollview",borderless:!0,body:{type:"wide",margin:10,rows:[{view:"proxy",minHeight:413,borderless:!0,body:{$subview:!0,name:"preview"}},ht]}}]}},e.prototype.init=function(){var t=this;this.on(this.getParam("state").$changes,"selectedItem",(function(e){var i=Q(e);t.ShowInfo(i),t.FileInfo=i;var r=t.$$("download");"folder"===i.type?r.hide():r.show()}))},e.prototype.ShowInfo=function(t){var e="preview.template";!this.app.config.player||"audio"!==t.type&&"video"!==t.type||(e="preview.media"),"empty"!==t.type?(this.$$("filename:label").setValue(t.value),this.$$("toolbar").show()):this.$$("toolbar").hide(),this.show(e,{target:"preview",params:{info:t}})},e}(u);webix.protoUI({name:"plyr-player",defaults:{config:{},source:{}},$init:function(){this.$view.innerHTML='<div class="webix_player_parent"><audio></audio></div>',this._container=this.$view.firstChild.firstChild,this.$view.style.overflow="visible",this._waitView=webix.promise.defer(),this.$ready.push(this.render)},getPlayer:function(t){return t?this._waitView:this._player},render:function(){if(!1===this.config.cdn||window.Plyr)this._initPlyr();else{var t=this.config.cdn?this.config.cdn:"https://cdn.plyr.io/3.5.10";webix.require([t+"/plyr.js",t+"/plyr.css"]).then(webix.bind(this._initPlyr,this)).catch((function(t){console.log(t)}))}},_initPlyr:function(){if(this.$view){var t=webix.extend({},this.config.config);this._player=new Plyr(this._container,t),this._player.elements.container.setAttribute("tabindex","-1"),this.attachEvent("onDestroy",(function(){this._player&&this._player.destroy()})),this._waitView.resolve(this._player),this._player.on("canplay",webix.bind((function(){this._player.media&&(this._player.media.setAttribute("tabindex","-1"),this._normalizeRatio())}),this)),this._player.on("ready",webix.bind((function(){this.$view&&(this.$view.querySelector(".plyr--full-ui").style["min-width"]="0px",this._normalizeRatio())}),this))}},$setSize:function(t,e){this.$view.firstChild.style.width=t+"px",this.$view.firstChild.style.height=e-2+"px",this._player&&this._normalizeRatio(t,e)},source_setter:function(t){this._waitView.then((function(e){t&&(e.source=t)}))},getPlyr:function(t){return t?this._waitView:this._player},_gcdRatio:function(t,e){for(t=Math.abs(t),e=Math.abs(e);e;){var i=e;e=t%e,t=i}return t},_normalizeRatio:function(t,e){if(this.$view){t=t||this.$view.clientWidth,e=e||this.$view.clientHeight;var i=this._gcdRatio(t,e),r=(t/i).toString()+":"+(e/i).toString();this._player.ratio=r}}},webix.ui.view,webix.EventSystem);var dt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.config=function(){return{rows:[{localId:"albumArt",hidden:!0,css:"webix_fmanager_preview",template:'<img class="webix_fmanager_preview_icon" src="'+this.app.getService("backend").icon({type:"audio"},"big")+'" />'},{view:"plyr-player",css:"webix_fmanager_player",localId:"player",config:{controls:["play-large","play","progress","current-time","mute","volume"]}}]}},e.prototype.init=function(){var t=this,e=this.$$("albumArt").$view;webix.event(e,"dblclick",(function(){var e=t.getParam("info");t.app.callEvent("app:action",["open",[e]])}))},e.prototype.urlChange=function(){var t=this.getParam("info");this.ShowPreview(t)},e.prototype.ShowPreview=function(t){if(t){var e=this.app.getService("backend").directLink(t.id);this.SetMedia(e,t.type,t.$ext);var i=this.$$("albumArt"),r=this.$$("player");"audio"===t.type?(r.config.height=52,i.show()):(r.config.height=0,i.hide())}},e.prototype.SetMedia=function(t,e,i){this.$$("player").define({source:{type:e,sources:[{src:t,type:e+"/"+i}]}})},e}(u),vt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.config=function(){return{view:"template",localId:"preview",css:"webix_fmanager_preview"}},e.prototype.init=function(){var t=this,e=this.getRoot().$view;webix.event(e,"dblclick",(function(){var e=t.getParam("info");"code"===e.type&&t.app.config.editor?t.app.callEvent("app:action",["edit",[e]]):"folder"!==e.type&&"empty"!==e.type&&t.app.callEvent("app:action",["open",[e]])}))},e.prototype.urlChange=function(){var t=this.getParam("info");this.ShowPreview(t)},e.prototype.ShowPreview=function(t){var e=this.$$("preview");if("folder"===t.type)e.setHTML('<img class="webix_fmanager_preview_icon" src="'+this.app.getService("backend").icon({type:"folder"},"big")+'" />');else if("empty"===t.type)e.setHTML('<img class="webix_fmanager_preview_icon" src="'+this.app.getService("backend").icon({type:"none"},"big")+'" />');else{var i=this.app.getService("backend").previewURL(t,464,407);e.setHTML("<img style='width:100%; height:100%;' src='"+i+"' onerror='this.style.display=\"none\"'>")}},e}(u),gt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.config=function(){var t=this;return this.Config=this.getParam("config"),{view:"window",position:"center",modal:!0,css:"webix_fmanager_progress",head:{template:this.Config.head,css:"webix_fmanager_progress_head",height:54},body:{padding:{top:0,bottom:20,left:20,right:20},margin:10,rows:[{template:function(t){return'<div class="webix_fmanager_progress_bar">\n<div class="webix_fmanager_progress_counter">'+t.done+" of "+t.total+' items</div>\n<div class="webix_fmanager_progress_name">'+t.file+"</div></div>"},localId:"counter",borderless:!0,height:59},{view:"button",value:"Stop",css:"webix_fmanager_progress_cancel",click:function(){t.State.cancel=!0,t.getRoot().disable()}}]}}},e.prototype.init=function(){var t=this;this.WaitClose=webix.promise.defer(),this.Counter=this.$$("counter"),this.Counter.setValues({done:0,total:this.Config.files.length,file:this.Config.files[0]}),webix.extend(this.Counter,webix.ProgressBar),this.State=U({i:0,cancel:!1}),function t(e,i,r){if(!((r=r||{i:0,cancel:!1}).i>=e.length))return i(e[r.i],r.i).then((function(){if(r.i+=1,!r.cancel)return t(e,i,r)}))}(this.Config.files,this.Config.code,this.State).finally((function(){return t.Close()})),this.on(this.State.$changes,"i",(function(e){return t.Step(e+1)}))},e.prototype.Close=function(){this.Counter.showProgress({type:"bottom",position:1,delay:100}),this.show("_blank",{target:"popup"}),this.WaitClose.resolve()},e.prototype.Step=function(t){var e=this.Counter.getValues().done;this.Counter.setValues({done:t,file:this.Config.files[t-1]},!0),e=(e+1)/this.Config.files.length,this.Counter.showProgress({type:"bottom",position:Math.min(1,e),delay:100})},e}(u);webix.protoUI({name:"r-layout",sizeTrigger:function(t,e,i){this._compactValue=i,this._compactWidth=t,this._compactHandler=e,this._checkTrigger(this.$view.width,i)},_checkTrigger:function(t,e){return!this._compactWidth||!(t<=this._compactWidth&&!e||t>this._compactWidth&&e)||(this._compactWidth=null,this._compactHandler(!e),!1)},$setSize:function(t,e){if(this._checkTrigger(t,this._compactValue))return webix.ui.layout.prototype.$setSize.call(this,t,e)}},webix.ui.layout);var mt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.config=function(){var t=this,e=this.getParam("compact"),i=webix.skin.$active,r=this.app.getService("locale")._;return{view:"toolbar",height:i.toolbarHeight+12,margin:20,paddingY:9,paddingX:12,cols:[{view:"icon",icon:"webix_fmanager_icon fmi-file-tree",click:function(){return t.app.callEvent("app:action",["toggle-folders"])},hidden:!e},{view:"label",label:r("Files"),autowidth:!0,hidden:e},{view:"search",width:e?0:300,localId:"search",placeholder:r("Search files and folders")},{hidden:e},{view:"toggle",css:"webix_fmanager_preview_toggle",type:"icon",icon:"wxi-eye",tooltip:r("Preview"),width:i.toolbarHeight<37?48:60,localId:"previewMode",click:function(){return t.app.callEvent("app:action",["toggle-preview"])},hidden:e},{view:"segmented",width:124,optionWidth:40,localId:"modes",tooltip:function(t){switch(t.id){case"grid":return r("Table");case"cards":return r("Cards");case"double":return r("Total");default:return et(t.id+"")}},options:[{value:"<span class='webix_fmanager_icon fmi-view-list webix_fmanager_mode_icon'></span>",id:"grid"},{value:"<span class='webix_fmanager_icon fmi-view-grid webix_fmanager_mode_icon'></span>",id:"cards"},{value:"<span class='webix_fmanager_icon fmi-view-array webix_fmanager_mode_icon'></span>",id:"double"}]}]}},e.prototype.init=function(){var t=this.getParam("state"),e=this.$$("modes");e.attachEvent("onChange",(function(e){e&&t.$batch({mode:e,search:""})})),this.on(t.$changes,"mode",(function(t){e.getOption(t)?e.setValue(t):e.setValue()}));var i=this.$$("search");i.attachEvent("onTimedKeyPress",(function(){t.search=i.getValue().trim()})),this.on(t.$changes,"search",(function(t){t=t.trim(),i.setValue(t)})),this.on(H(),(webix.env.isMac?"COMMAND":"CTRL")+" + F",(function(t,e){i.focus(),webix.html.preventEvent(e)}))},e}(u),wt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.config=function(){var t=this.getParam("forceCompact");void 0!==t&&this.setParam("compact",t),this.Compact=this.getParam("compact");var e={view:"proxy",localId:"tree",width:240,minWidth:240,maxWidth:400,hidden:!0,borderless:!0,body:nt},i={type:"wide",cols:[{$subview:!0,name:"center",branch:!0},{view:"proxy",borderless:!0,width:470,hidden:!0,localId:"r-side",body:{$subview:"",branch:!0,name:"r-side"}}]};return this.Compact||i.cols.unshift(e,{view:"resizer"}),{view:void 0===t?"r-layout":"layout",type:"wide",rows:[mt,i,{$subview:!0,popup:!0,name:"popup"}]}},e.prototype.init=function(){var t=this,e=this.getRoot();e.sizeTrigger&&e.sizeTrigger(this.app.config.compactWidth,(function(e){return t.SetCompactMode(e)}),!!this.Compact);var i=this.getParam("state");this.State=i,this.Compact?(this.Tree={show:yt,hide:yt},this.SideTree=this.ui(ct),this.PreviewPopup=this.ui(st)):this.Tree=this.$$("tree"),this.on(this.app,"app:action",(function(e){switch(e){case"toggle-preview":t.TogglePreview();break;case"toggle-folders":t.ToggleFolders()}})),this.on(i.$changes,"mode",(function(e,i){return t.ShowMode(e,i)})),this.on(i.$changes,"search",(function(e){return t.ShowSearch(e)})),this.app.getService("progress").handle(this.getRoot(),this.ShowProgress.bind(this))},e.prototype.ShowMode=function(t,e){var i={state:this.getParam("state"),compact:this.Compact};"grid"===t?(this.Tree.show(),this.show("panel/list",{target:"center",params:i})):"cards"===t?(this.Tree.show(),this.show("panel/cards",{target:"center",params:i})):"double"===t?(this.Tree.hide(),this.show("panel-double",{target:"center",params:i})):"search"===t&&(this.Tree.hide(),this.PrevMode=this.PrevMode||e,this.show("panel-search/cards",{target:"center",params:i}))},e.prototype.ShowProgress=function(t){var e=this;return this.show("./progress",{target:"popup",params:t}).then((function(){return e.getSubView("popup")}))},e.prototype.TogglePreview=function(){if(this.Compact)this.PreviewPopup.IsVisible()?this.PreviewPopup.Hide():this.PreviewPopup.Show({state:this.State});else{var t=this.$$("r-side");t.isVisible()?(this.show("_blank",{target:"r-side"}),t.hide()):(this.show("preview",{target:"r-side",params:{state:this.State}}),t.show())}},e.prototype.ToggleFolders=function(){this.SideTree.IsVisible()||this.SideTree.Show()},e.prototype.ShowSearch=function(t){t?this.State.mode="search":("search"===this.State.mode&&(this.State.mode=this.PrevMode||"grid"),this.PrevMode="")},e.prototype.SetCompactMode=function(t){this.setParam("compact",t),this.refresh()},e}(u);function yt(){}var bt={JetView:u};bt.cards=K,bt.editor=Y,bt.folders=nt,bt.list=ot,bt["menus/addnewmenu"]=rt,bt["menus/contextmenu"]=G,bt["menus/menubody"]=N,bt["mobile/previewpopup"]=st,bt["mobile/sidetree"]=ct,bt["panel-double"]=lt,bt["panel-search"]=ut,bt.panel=pt,bt.preview=ft,bt["preview/info"]=ht,bt["preview/media"]=dt,bt["preview/template"]=vt,bt.progress=gt,bt["sections/dataview"]=q,bt.top=wt,bt.topbar=mt;var _t=function(){function t(t,e){this.app=t,this._url=e,this._features={preview:{},meta:{}}}return t.prototype.url=function(t){return this._url+t},t.prototype.search=function(t,e){return t=t||"/",this._files(this.url("files"),{id:t,search:e})},t.prototype.files=function(t){return t=t||"/",this._files(this.url("files"),{id:t})},t.prototype._files=function(t,e){var i=webix.ajax(t,e).then((function(t){return t.json()}));return this.getInfo().then((function(){return i}))},t.prototype.folders=function(t){return t=t||"/",webix.ajax(this.url("folders"),{id:t}).then((function(t){return t.json()}))},t.prototype.icon=function(t,e){return this.url("icons/"+(e||"small")+"/"+t.type+"/"+t.$ext+".svg")},t.prototype.upload=function(){return this.url("upload")},t.prototype.readText=function(t){return webix.ajax(this.url("text"),{id:t}).then((function(t){return t.text()}))},t.prototype.writeText=function(t,e){return webix.ajax().post(this.url("text"),{id:t,content:e}).then((function(t){return t.json()}))},t.prototype.directLink=function(t,e){return this.url("direct?id="+encodeURIComponent(t)+(e?"&download=true":""))},t.prototype.previewURL=function(t,e,i){return this._features.preview[t.type]?this.url("preview?width="+e+"&height="+i+"&id="+encodeURIComponent(t.id)):this.icon(t,"big")},t.prototype.remove=function(t){return webix.ajax().post(this.url("delete"),{id:t}).then((function(t){return t.json()}))},t.prototype.makedir=function(t,e){return webix.ajax().post(this.url("makedir"),{id:t,name:e}).then((function(t){return t.json()}))},t.prototype.makefile=function(t,e){return webix.ajax().post(this.url("makefile"),{id:t,name:e}).then((function(t){return t.json()}))},t.prototype.copy=function(t,e){return webix.ajax().post(this.url("copy"),{id:t,to:e}).then((function(t){return t.json()}))},t.prototype.move=function(t,e){return webix.ajax().post(this.url("move"),{id:t,to:e}).then((function(t){return t.json()}))},t.prototype.rename=function(t,e){return webix.ajax().post(this.url("rename"),{id:t,name:e}).then((function(t){return t.json()}))},t.prototype.getRootName=function(){return(0,this.app.getService("locale")._)("My Files")},t.prototype.getMeta=function(t){return!!this._features.meta[t.type]&&webix.ajax(this.url("meta"),{id:t.id}).then((function(t){return t.json()}))},t.prototype.getInfo=function(t){var e=this;return this._info&&!t?this._info:this._info=webix.ajax(this.url("info")).then((function(t){return t=t.json(),e._features=t.features,t}))},t}(),xt=function(){function t(t){this._store=new Map,this._limit=t,this._i=1}return t.prototype.each=function(t){this._store.forEach((function(e){return t(e.obj)}))},t.prototype.set=function(t,e){this._store.size>=this._limit&&this.prune(),this._store.set(t,{obj:e,key:t,t:this._i++})},t.prototype.get=function(t){var e=this._store.get(t);return e?(e.t=this._i++,e.obj):null},t.prototype.prune=function(){var t=[];this._store.forEach((function(e){return t.push(e)})),t=t.sort((function(t,e){return t.t>e.t?-1:1}));for(var e=Math.floor(this._limit/2);e<t.length;e++)this._store.delete(t[e].key)},t.prototype.delete=function(t){this._store.has(t)&&this._store.delete(t)},t.prototype.clear=function(){this._store.clear()},t}(),St=function(){function t(t,e){this.app=t,this.fscache=new xt(e),this.hierarchy=new webix.TreeCollection,this.folders_ready=null}return t.prototype.defaultDir=function(t){var e=[];return"/"!==t&&e.push({type:"folder",value:"..",$row:function(t,e){return e.backIcon()+"<span class='webix_fmanager_back'>"+e.backLabel()+"</span>"}}),e},t.prototype.files=function(t,e){var i=this.fscache.get(t);return e?i:i?Promise.resolve(i):(i=new webix.DataCollection({scheme:{$change:this.prepareData,$serialize:this.serializeData}}),this.fscache.set(t,i),this.reload(i,t))},t.prototype.serializeData=function(t){if(".."==t.value)return!1;var e={};for(var i in t)0!==i.indexOf("$")&&(e[i]=t[i]);return e},t.prototype.prepareData=function(t){"number"==typeof t.date&&(t.date=new Date(1e3*t.date)),"folder"===t.type?t.$css=t.type:t.$ext=function(t){if(!t)return"";var e=t.split(".");return e.length<2?"":e[e.length-1]}(t.value)},t.prototype.reload=function(t,e){var i=this;return this.app.getService("backend").files(e).then((function(r){return t.clearAll(),t.parse(i.defaultDir(e).concat(r)),t}))},t.prototype.refresh=function(t){var e=this.fscache.get(t);if(e)return this.reload(e,t)},t.prototype.addFile=function(t,e){var i=this.fscache.get(t);i&&(i.exists(e.id)||i.add(e,this.getFsPosition(i,e))),"folder"===e.type&&("/"===t&&(t="../files"),this.hierarchy.add(e,null,t))},t.prototype.getFsPosition=function(t,e){if("folder"!==e.type)return-1;var i=t.data;return i.order.findIndex((function(t){return"folder"!==i.getItem(t).type}))},t.prototype.deleteFile=function(t){var e=this.fscache,i=this.hierarchy;e.each((function(e){e&&e.exists(t)&&e.remove(t)})),e.delete(t),i.exists(t)&&i.remove(t)},t.prototype.updateFile=function(t,e,i){var r=this.hierarchy;this.fscache.each((function(r){r&&r.exists(t)&&(r.updateItem(t,e),i&&t!=i&&r.data.changeId(t,i))})),r.exists(t)&&(r.updateItem(t,e),i&&t!=i&&r.data.changeId(t,i))},t.prototype.defaultTree=function(){return[{value:"My Files",id:"../files",open:!0}]},t.prototype.folders=function(t){var e=this,i=this.hierarchy;return!t&&this.folders_ready||(this.folders_ready=this.app.getService("backend").folders().then((function(t){return i.clearAll(),i.parse(e.defaultTree()),i.parse({parent:"../files",data:t}),i}))),this.folders_ready},t}(),kt=function(){function t(t,e){this.initUploader(t),this.initEvents(t,e)}return t.prototype.initEvents=function(t,e){t.attachEvent("app:action",(function(i,r){"upload"==i&&(r=r||e.path||"/",t.getService("upload").fileDialog(r))}))},t.prototype.initUploader=function(t){this.uploader=webix.ui({view:"uploader",apiOnly:!0,upload:t.getService("backend").upload(),on:{onAfterFileAdd:function(t){t.urlData=this.config.tempUrlData},onFileUpload:function(e,i){t.getService("local").addFile(e.urlData.id,i)},onUploadComplete:function(){t.getService("progress").end(),t.callEvent("reload:fs:stats",[])}}}),this.uploader.$updateProgress=function(e,i){t.getService("progress").start(i/100)}},t.prototype.getUploader=function(){return this.uploader},t.prototype.fileDialog=function(t){this.uploader.config.tempUrlData={id:t},this.uploader.fileDialog()},t}(),$t=function(){function t(){this.view=null,this.popup=null}return t.prototype.handle=function(t,e){this.view=t,webix.extend(t,webix.ProgressBar),this.popup=e},t.prototype.start=function(t){var e=this.view;e&&!e.$destructed&&e.showProgress({type:"top",delay:3e3,hide:!0,progress:t||0})},t.prototype.end=function(){var t=this.view;t&&!t.$destructed&&t.hideProgress()},t.prototype.files=function(t,e,i){var r=this;if(e.length)return 1==e.length?(this.start(),i(e[0],0).finally((function(){return r.end()}))):this.popup?this.popup({config:{head:t,files:e,code:i}}).then((function(t){return t.WaitClose})):void 0},t}(),Tt=function(){function t(t,e){this.app=t,this.state=e,this.initEvents()}return t.prototype.backend=function(){return this.app.getService("backend")},t.prototype.local=function(){return this.app.getService("local")},t.prototype.initEvents=function(){var t=this;this.app.attachEvent("app:action",(function(e,i){switch(e){case"open":t.open(i);break;case"download":t.download(i);break;case"edit":t.edit(i);break;case"delete":t.remove(i);break;case"makefile":t.makeFile(i);break;case"makedir":t.makeFolder(i);break;case"rename":t.rename(i);break;case"copy":case"cut":t.addToClipboard(e);break;case"paste":t.paste();break;case"locate":t.goUp(i)}}))},t.prototype.write=function(t,e){var i=this;return this.backend().writeText(t,e).then((function(e){return i.local().updateFile(t,{size:e.size,date:e.date})}))},t.prototype.read=function(t){return this.backend().readText(t)},t.prototype.makeFile=function(t){var e=this,i=this.state.path||"/";this.backend().makefile(i,t).then((function(t){t.invalid||e.local().addFile(i,t)}))},t.prototype.makeFolder=function(t){var e=this,i=this.state.path||"/";this.backend().makedir(i,t).then((function(t){t.invalid||e.local().addFile(i,t)}))},t.prototype.edit=function(t){var e=this.state;t||(t=e.selectedItem);var i=t[0];t.length&&"code"===i.type&&this.app.show("/editor",{params:{file:i,state:e}})},t.prototype.open=function(t){t||(t=this.state.selectedItem);for(var e=0;e<t.length;++e)"folder"!=t[e].type&&window.open(this.backend().directLink(t[e].id),"_blank")},t.prototype.download=function(t){t||(t=this.state.selectedItem),window.open(this.backend().directLink(t[0].id,!0),"_self")},t.prototype.remove=function(t){var e=this,i=this.state;if((t=this.extractIds(t||i.selectedItem)).length){var r=this.app.getService("locale")._;return webix.confirm({title:r("Delete files"),text:this.removeConfirmMessage(i.selectedItem),css:"webix_fmanager_confirm"}).then((function(){return e.app.getService("progress").files(r("Deleting..."),t,(function(t){return e.backend().remove(t).then((function(r){r.invalid||(e.local().deleteFile(t),i.path===t&&(i.path="/"),e.app.callEvent("pathChanged",[t,"/"]),e.app.callEvent("reload:fs:stats",[]))}))}))})).then((function(){i.search&&(i.search=i.search+" ")}))}},t.prototype.removeConfirmMessage=function(t){for(var e=this.app.getService("locale")._,i='<div class="question">'+e("Are you sure you want to delete")+" "+(t.length>1?e("these items:"):e("this item:"))+"</div>",r=0,n="&#9679;&nbsp;",o=t.length<6?t.length:5;r<o;++r)i+='<div class="item">'+n+t[r].value+"</div>";return r<t.length&&(i+="<div>"+n+e("and")+" "+(t.length-r)+" "+e("more file(s)")+"</div>"),i},t.prototype.rename=function(t){var e=this,i=this.state,r=t?t[0]:i.selectedItem[0];if(r){var n=this.app.getService("locale")._,o=r.id;it({text:n("Enter a new name"),button:n("Rename"),value:r.value,selectMask:"folder"!==r.type?X:null}).then((function(t){(t=tt(t))&&t!==r.value&&e.backend().rename(o,t).then((function(t){e.local().updateFile(o,{value:t.id.split("/").pop()},t.id),"folder"===r.type&&e.reloadBranch(t.id).then((function(){i.path===o&&(i.path=t.id),e.app.callEvent("pathChanged",[o,t.id])})),i.search&&(i.search=i.search+" ")}))}))}},t.prototype.reloadBranch=function(t){var e=this.local().hierarchy;return this.app.getService("backend").folders(t).then((function(i){var r=[];e.data.eachChild(t,(function(t){return r.push(t.id)})),e.parse({parent:t,data:i}),e.remove(r)}))},t.prototype.copy=function(t,e){var i=this;if(t.length){var r=this.local(),n=this.app.getService("locale")._;return this.app.getService("progress").files(n("Copying..."),t,(function(t){return i.backend().copy(t,e).then((function(t){t.invalid||r.addFile(e,t)}))}))}},t.prototype.move=function(t,e){var i=this;if(t.length&&e){var r=this.local(),n=r.files(e,!0);if(n&&(t=t.filter((function(t){return!n.exists(t)}))),(t=t.filter((function(t){return t!=e}))).length){var o=this.app.getService("locale")._;return this.app.getService("progress").files(o("Moving..."),t,(function(t){return i.backend().move(t,e).then((function(n){n.invalid||(r.deleteFile(t),r.addFile(e,n),i.state.path===t&&(i.state.path=n.id),i.app.callEvent("pathChanged",[t,n.id]))}))}))}}},t.prototype.extractIds=function(t){if(!t.length||"string"==typeof t[0])return t;for(var e=[],i=0;i<t.length;++i)".."!==t[i].value&&e.push(t[i].id);return e},t.prototype.addToClipboard=function(t){var e=this.extractIds(this.state.selectedItem);e.length&&(this.state.clipboard={files:e,mode:t})},t.prototype.clearClipboard=function(){this.state.clipboard=null},t.prototype.paste=function(){var t=this.state;t.clipboard&&("copy"===t.clipboard.mode?this.copy(t.clipboard.files,t.path):"cut"===t.clipboard.mode&&this.move(t.clipboard.files,t.path),this.clearClipboard())},t.prototype.goUp=function(t){var e=this.state;if(e.search){var i=t?t[0]:e.selectedItem[0];if(!i)return;var r=i.id.split("/"),n="/"+r.slice(1,r.length-1).join("/");e.$batch({search:"",searchStats:null,path:n})}},t}(),Ct=function(t){function e(e){var i=this,n=U({mode:e.mode||"grid",selectedItem:[],search:"",searchStats:null,path:e.path||"/",source:e.source||"files",clipboard:null}),o={router:y,version:"8.0.5",debug:!0,start:"/top",params:{state:n,forceCompact:e.compact},editor:!0,player:!0,compactWidth:640};return(i=t.call(this,r(r({},o),e))||this).setService("backend",new(i.dynamic(_t))(i,i.config.url)),i.setService("local",new(i.dynamic(St))(i,10)),i.setService("progress",new(i.dynamic($t))(i)),i.setService("upload",new(i.dynamic(kt))(i,n)),i.setService("operations",new(i.dynamic(Tt))(i,n)),i.use(V,i.config.locale||{lang:"en",webix:{en:"en-US",zh:"zh-CN"}}),i}return i(e,t),e.prototype.dynamic=function(t){return this.config.override&&this.config.override.get(t)||t},e.prototype.require=function(t,e){return"jet-views"===t?bt[e]:"jet-locales"===t?Ft[e]:null},e.prototype.getState=function(){return this.config.params.state},e}(w);webix.protoUI({name:"filemanager",app:Ct,getState:function(){return this.$app.getState()},getService:function(t){return this.$app.getService(t)},$init:function(){var t=this.$app.getState();for(var e in t)O(t,this.config,e)}},webix.ui.jetapp);var It={Backend:_t,LocalData:St,Upload:kt,Progress:$t,Operations:Tt},Ft={en:{Save:"Save",Rename:"Rename",Open:"Open",Edit:"Edit",Delete:"Delete",Folder:"Folder","Add New":"Add New","My Files":"My Files",Size:"Size",Date:"Date","back to parent folder":"back to parent folder",Download:"Download",Type:"Type",Information:"Information",Files:"Files",Table:"Table",Cards:"Cards",Total:"Total","Are you sure ?":"Are you sure ?",Details:"Details","Enter a new name":"Enter a new name",Add:"Add","Select something":"Select something","Download file":"Download file",Preview:"Preview",Refresh:"Refresh","Are you sure you want to exit without saving?":"Are you sure you want to exit without saving?",Copy:"Copy",Cut:"Cut",Paste:"Paste","Deleting...":"Deleting...","Copying...":"Copying...","Moving...":"Moving...",Folders:"Folders","Search results":"Search results","Search results in":"Search results in","Search files and folders":"Search files and folders","Add new file":"Add new file","Add new folder":"Add new folder","Upload file":"Upload file",folder:"folder",file:"file",archive:"archive",audio:"audio",image:"image",video:"video",code:"code",document:"document",of:"of",used:"used","Open item location":"Open item location","Are you sure you want to delete":"Are you sure you want to delete","these items:":"these items:","this item:":"this item:","Delete files":"Delete files",and:"and","more file(s)":"more file(s)"}};t.App=Ct,t.locales=Ft,t.services=It,t.views=bt,Object.defineProperty(t,"__esModule",{value:!0})}(e)}));(n=o)&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")&&n.default;var a=o.views,s=o.services,c=o.locales,l=o.App,u=1;function p(t,e,i){Object.defineProperty(e,i,{get:function(){return t[i]},set:function(e){return t[i]=e}})}function h(t,e){e=e||{};var i={},r={},n=function(t,e){var n=u++;return i[n]={mask:t,handler:e},e("*"===t?r:r[t],void 0,t),n},o=[],a=!1,s=function(t,e,r,n){if(a)o.push([t,e,r,n]);else for(var s=Object.keys(i),c=0;c<s.length;c++){var l=i[s[c]];l&&("*"!==l.mask&&l.mask!==t||l.handler(r,e,t,n))}};for(var c in t)if(t.hasOwnProperty(c)){var l=t[c];e.nested&&"object"==typeof l&&l?r[c]=h(l,e):f(r,l,c,s)}return Object.defineProperty(r,"$changes",{value:{attachEvent:n,detachEvent:function(t){delete i[t]}},enumerable:!1,configurable:!1}),Object.defineProperty(r,"$observe",{value:n,enumerable:!1,configurable:!1}),Object.defineProperty(r,"$batch",{value:function(t){if("function"!=typeof t){var e=t;t=function(){for(var t in e)r[t]=e[t]}}for(a=!0,t(r),a=!1;o.length;){var i=o.shift();s.apply(this,i)}},enumerable:!1,configurable:!1}),r}function f(t,e,i,r){Object.defineProperty(t,i,{get:function(){return e},set:function(t){if(null===e||null===t?e!==t:e.valueOf()!=t.valueOf()){var n=e;e=t,r(i,n,t,null)}},enumerable:!0,configurable:!1})}var d="<span class='webix_icon wxi-dots webix_fmanager_menu_icon'></span>";function v(t){return{attachEvent:function(e,i){return webix.UIManager.addHotKey(e,i,t),{key:e,handler:i}},detachEvent:function(e){var i=e.key,r=e.handler;return webix.UIManager.removeHotKey(i,r,t)}}}function g(t,e){return"files"===this.State.source?this.app.getService("operations").move(t,this.GetTargetFolder(e)):"trash"===this.State.source&&this.app.callEvent("app:action",["delete",t]),!1}function m(){for(var t=this,e=webix.env.isMac?"COMMAND":"CTRL",i=[{key:"DELETE",oper:"delete",trash:"remove"},{key:"BACKSPACE",oper:"delete",trash:"remove"},{key:e+"+C",oper:"copy"},{key:e+"+X",oper:"cut",trash:"trashed"},{key:e+"+V",oper:"paste",trash:"paste"},{key:e+"+R",oper:"rename"},{key:e+"+O",oper:"open"},{key:e+"+E",oper:"edit"},{key:e+"+D",oper:"download"}],r=function(e){n.on(v(n.getRoot()),i[e].key,(function(r,n){var o="trash"!==t.State.source?i[e].oper:i[e].trash;o&&t.app.callEvent("app:action",[o]),webix.html.preventEvent(n)}))},n=this,o=0;o<i.length;++o)r(o)}function w(){var t=this;this.on(this.State.$changes,"source",(function(e,i){i&&("files"!==t.State.source?(t.State.selectedItem=[],t.LoadData(t.State.path,"",e)):t.LoadData(t.State.path))}))}function y(t){var e=this.State.source;return("files"===e||"trash"===e)&&(t.stateSource=e,this.__proto__.DragMarker.call(this,t))}function b(t){return"trash"!==t.stateSource?this.MoveFiles(t.source,t.target):"trash"!==this.State.source&&void this.app.callEvent("app:action",["restore",t.source,this.GetTargetFolder(t.target)])}function _(t,e,i){var r=this;if(i){this._Track=!1;var n=this.WTable;n.data.url!==t&&(n.clearAll(),this.app.getService("local").files(t,!1,i).then((function(t){r.RenderData(t),r.SelectActive()}))),this._Track=!0}else this.__proto__.LoadData.call(this,t,e)}function x(t){if("trash"!==this.State.source||"/"===t.id){if(!t)return;"folder"===t.type?this.ShowSubFolder(".."===t.value?t.value:t.id):"code"===t.type||"xls"===t.$ext||"xlsx"===t.$ext?this.app.callEvent("app:action",["edit",[t]]):this.app.callEvent("app:action",["open",[t]])}}function S(t){this.State.source="files",this.__proto__.ShowSubFolder.call(this,t)}function k(){var t=this;webix.extend(this.WTable,{$dragMark:function(e){t.WTable._marked&&t.WTable._marked!=e.target&&t.WTable.removeCss(t.WTable._marked,"webix_drag_over"),e.target&&"trash"!==t.State.source?(t.WTable.addCss(e.target,"webix_drag_over"),t.WTable._marked=e.target):"trash"==t.State.source&&e.stateSource&&"trash"!==e.stateSource&&webix.html.addCss(t.WTable.$view,"webix_drag_over")},$dragOut:function(e,i,r){"trash"==t.State.source&&i!==r&&webix.html.removeCss(t.WTable.$view,"webix_drag_over")}},!0)}function $(t){t.MoveFiles=g,t.AddHotkeys=m,t.SourceHandlers=w,t.ShowSubFolder=S,t.Activate=x,t.LoadData=_,t.HandleDrag=y,t.HandleDrop=b,t.DragMark=k}var T=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.config=function(){var e=this;return $(this),this.app.getService("localusers").users().then((function(i){e.Users=i;var r=t.prototype.config.call(e);return r.on.onBeforeDrag=function(t){return e.HandleDrag(t)},r.on.onBeforeDrop=function(t){return e.HandleDrop(t)},r}))},e.prototype.init=function(){t.prototype.init.call(this),this.SourceHandlers(),this.DragMark(),webix.TooltipControl.addTooltip(this.WTable.$view)},e.prototype.RenderData=function(t){var e=this;this.WTable.sync(t,(function(){return e.WTable.filter((function(t){return t.value&&".."!==t.value}))}))},e.prototype.CardTemplate=function(t){var e="";if(t.users&&t.users.length){e="<div class='webix_fmanager_card_shared'>";for(var i=[],r=t.users.length>4?1:0,n=0;n<t.users.length&&(n<3||3===n&&n-t.users.length==-1);++n){var o=this.Users.getItem(t.users[n]);i.push('<img class="shared_user_name user_'+(r+n)+'" webix_tooltip="'+o.name+"<br>("+o.email+')" src="'+this.app.getService("users").avatarUrl(o.id,o.avatar)+'" />')}r&&i.unshift('<span class="shared_user_name user_plus">+'+(t.users.length-3)+"</span>"),e+=i.reverse().join(""),e+="</div>"}var a,s,c=this.app.getService("locale")._,l=t.star&&"trash"!==this.State.source?"<div class='webix_fmanager_star'><span class='webix_docmanager_icon dmi-star'></span></div>":"";if("folder"===t.type)a='<div class="webix_fmanager_card_preview">'+l+"<span class='webix_icon wxi-folder webix_fmanager_folder_icon'></span></div>",s='<div class="webix_fmanager_card_panel">\n\t\t<span class="webix_fmanager_card_label">'+c("Folder")+'</span>\n\t\t<span class="webix_fmanager_card_name folder">'+this.SearchTemplate(t.value)+"</span>"+d+"\n\t\t</div>";else{var u=webix.skin.$active.listItemHeight<29?[163,92]:[214,124],p=this.app.getService("backend").previewURL(t,u[0],u[1]);a='<div class="webix_fmanager_card_preview file">'+l+('<img height="'+u[1]+'" width="'+u[0]+'" src="'+p+'" onerror=\'this.style.display="none"\'/>')+e+"</div>",s='<div class="webix_fmanager_card_panel file">\n\t\t<span class="webix_fmanager_card_name">'+this.Icon(t)+'<span class="file_name_text">'+this.SearchTemplate(t.value)+"</span></span>"+d+"\n\t\t</div>"}return'<div class="webix_fmanager_card_outer"><div class="webix_fmanager_card" webix_l_id="'+t.id+'">'+(a+s)+"</div></div>"},e.prototype.SearchTemplate=function(t){var e=this.State.search;if(e=e.replace(/(#\w+\b)/g,"").trim()){var i=new RegExp("("+e.replace(/ +/g,")|(")+")","gi");return t.replace(i,"<span class='webix_fmanager_search_mark'>$&</span>")}return t},e}(a.cards),C=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.config=function(){var e=this,i=this.app.getService("locale")._,r=t.prototype.config.call(this),n=r.rows[0];n.visibleBatch="editor",n.cols[0].batch="editor",n.cols[n.cols.length-1].batch="editor",n.cols.splice(n.cols.length-1,0,{localId:"versionsBtn",view:"button",type:"icon",icon:"wxi-clock",css:"webix_transparent webix_fmanager_versions",autowidth:!0,tooltip:i("Show version history"),batch:"editor",hidden:!0,click:function(){return e.ConfirmHistory()}},{view:"button",localId:"restoreBtn",hidden:!0,value:"Restore this version",css:"webix_primary",width:296,inputWidth:200,click:function(){return e.RestoreVersion()}});var o={type:"wide",cols:[r.rows[1],{view:"proxy",borderless:!0,hidden:!0,localId:"r-side",body:{$subview:!0,name:"r-side"}}]};return r.rows[1]=o,r},e.prototype.init=function(){t.prototype.init.call(this),this.OnInit()},e.prototype.OnInit=function(){var t=this;this.Editor=this.$$("editor"),this.State=h({version:0,current:!0,date:null,diff:!0}),this.on(this.State.$changes,"current",(function(e){e?t.$$("restoreBtn").hide():t.$$("restoreBtn").show()})),this.on(this.State.$changes,"date",(function(e){if(e){var i=t.$$("name"),r=i.getValue().split(", ");r[1]='<span class="date">'+t.DateFormat(e).date+"</span>",i.setValue(r.join(", "))}})),this.on(this.app,"history:close",(function(){t.refresh()}))},e.prototype.DateFormat=function(t){t||(t=this.File.date);var e="",i="on",r=webix.Date.datePart(new Date),n=webix.Date.datePart(t,!0);return webix.Date.equal(r,n)?(e="%H:%i:%s",i="at"):e=n.getYear()===r.getYear()?"%F %j":"%F %j, %Y",{prep:i,date:webix.Date.dateToStr(e)(t)}},e.prototype.SetVersionsButton=function(){var t=this.$$("versionsBtn");if(!this.State.version){t.isVisible()||t.show();var e=this.app.getService("locale")._,i=this.DateFormat();t.config.label=e("Last edited "+i.prep)+" "+i.date,t.resize(),t.refresh()}},e.prototype.ConfirmHistory=function(){var t=this,e=this.app.getService("locale")._;this._changed?webix.confirm(e("Unsaved changes will be lost. Are you sure?")).then((function(){return t.ShowHistory()})):this.ShowHistory()},e.prototype.ShowHistory=function(){this.show("history",{target:"r-side",params:{file:this.File,state:this.State}}),this.$$("r-side").show(),this.SetBatch("history")},e.prototype.SetBatch=function(t){this.getRoot().queryView("toolbar").showBatch(t),this.Editor.hide()},e.prototype.RestoreVersion=function(){var t=this,e=this.app.getService("locale")._;webix.confirm(e("Are you sure ?")).then((function(){t.app.getService("versions").restore(t.File.id,1*t.State.version).then((function(e){t.File.date=new Date(1e3*e.date),t.setParam("file",t.File),t.refresh()}))}))},e.prototype.ChangeTextState=function(e){t.prototype.ChangeTextState.call(this,e),e||this.SetVersionsButton()},e.prototype.Save=function(){var t=this,e=this.$$("editor").getValue();this._changed&&this.app.getService("operations").write(this.File.id,e).then((function(){t._oldValue=e,t.ChangeTextState(!1)}))},e}(a.editor),I=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.config=function(){var e=t.prototype.config.call(this);return e.rows[1].cols[0]={view:"excelviewer",editable:!0,editaction:"dblclick",css:"webix_data_border",areaselect:!0,header:!1,localId:"editor"},e},e.prototype.init=function(){var t=this;this.OnInit(),this.$$("name").setValue('<div class="filename">'+this.ClipName(this.File.id)+'</div><span class="extension">.'+this.File.$ext+"</span>"),webix.extend(this.Editor,webix.ProgressBar),this.Editor.showProgress({type:"top"});var e=this.app.getService("backend").directLink(this.File.id);this.Editor.load("binary->"+e,"excel").then((function(){t.Editor.hideProgress(),t.SetVersionsButton()})),this.on(this.Editor,"onAfterEditStop",(function(e){e.value!=e.old&&t.ChangeTextState(!0)})),this.on(v(this.Editor),"any",(function(){var e=t.Editor.getSelectedId();e&&t.Editor.edit(e)})),this.on(this.State.$changes,"version",(function(e){return t.ParseVersion(e,t.State.diff)})),this.on(this.State.$changes,"diff",(function(e){return t.ResetDiffStyle(t.State.version,e)}))},e.prototype.ResetDiffStyle=function(t,e){if(t){var i=this.getSubView("r-side").GetPrevVersion(t);i&&this.StyleDiffCells(e),this.ResetTotalDiff(!i&&e)}},e.prototype.ParseVersion=function(t,e){var i=this;if(t){this.Editor.showProgress({type:"top"}),this.Editor.clearAll();var r=this.app.getService("versions").directLink(t),n=this.getSubView("r-side").GetPrevVersion(t);if(this.ResetTotalDiff(!n&&e),e&&n){var o=this.app.getService("versions").directLink(n);webix.promise.all([this.ParseExcel(o),this.ParseExcel(r)]).then((function(t){var e=t[0],r=t[1];i.Diffs=i.CollectDiffs(e.data,r.data),i.Editor.parse(r),i.StyleDiffCells(!0)}))}else this.Editor.load("binary->"+r,"excel").then((function(){i.Editor.hideProgress()}))}},e.prototype.ResetTotalDiff=function(t){var e=t?"addCss":"removeCss";webix.html[e](this.Editor.$view,"webix_fmanager_diff_all")},e.prototype.ParseExcel=function(t){var e=this;return webix.ajax().response("arraybuffer").get(t).then((function(t){return webix.DataDriver.excel.toObject({data:t,options:{ext:e.File.$ext}})}))},e.prototype.CollectDiffs=function(t,e){for(var i=[],r=0;r<e.length;++r)for(var n=0;n<e[r].length;++n)e[r][n]!=t[r][n]&&i.push([r,n]);return i},e.prototype.StyleDiffCells=function(t){var e=this;this.Editor.showProgress({type:"top"});var i=t?"addCellCss":"removeCellCss";this.Diffs.forEach((function(t){var r=e.Editor.columnId(t[1]);e.Editor[i](e.Editor.getIdByIndex(t[0]),r,"webix_docmanager_diff_excel",!0)})),this.Editor.render(),this.Editor.hideProgress()},e.prototype.Save=function(){var t=this;if(this.Editor.editStop(),this._changed)return webix.toExcel(this.Editor,{download:!1,styles:!0,spans:!0,heights:!0,header:!1}).then((function(e){return t.app.getService("operations").writeBinary(t.File.id,t.File.value,e).then((function(){t.ChangeTextState(!1)}))}))},e.prototype.SetBatch=function(t){this.getRoot().queryView("toolbar").showBatch(t),this.Editor.define("editable",!1)},e}(C),F=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.config=function(){var e=this,i=t.prototype.config.call(this),r=i.body.rows[1];return r.type.folder=function(t){return"<div class='"+("dmi"===(t.icon?t.icon.slice(0,3):"")?"webix_docmanager_icon":"webix_icon")+" "+(t.icon||"wxi-folder")+"'></div>"},r.on.onBeforeDrop=function(t){return e.HandleDrop(t)},i},e.prototype.init=function(){t.prototype.init.call(this),this.DragMark()},e.prototype.DragMark=function(){var t=this;webix.extend(this.Tree,{$dragMark:function(e){if(t.Tree._marked&&t.Tree._marked!=e.target&&t.Tree.removeCss(t.Tree._marked,"webix_drag_over"),e.target){var i="../trash"===e.target&&"trash"!==e.stateSource;0===e.target.indexOf("..")&&"../files"!==e.target&&!i||(t.Tree.addCss(e.target,"webix_drag_over"),t.Tree._marked=e.target)}}},!0)},e.prototype.HandleDrop=function(t){if(!t.target)return!1;"../files"===t.target&&(t.target="/");var e="trash"===t.stateSource;return 0===t.target.indexOf("..")?"../trash"!==t.target||e||this.app.callEvent("app:action",["delete",t.source]):e?this.app.callEvent("app:action",["restore",t.source,t.target]):this.app.getService("operations").move(t.source,t.target),!1},e.prototype.Subscribe=function(){var e=this;t.prototype.Subscribe.call(this),this.on(this.State.$changes,"source",(function(t){"/"===e.State.path&&e.Tree.select("../"+t);var i=e.getRoot().queryView("button");"files"!==t?i.disable():i.enable()}))},e}(a.folders),P=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.config=function(){var t=this;this.File=this.getParam("file"),this.State=this.getParam("state");var e=this.app.getService("locale")._;return this.app.getService("localusers").users().then((function(i){var r={view:"toolbar",elements:[{view:"icon",css:"webix_fmanager_history_back",icon:"dmi-arrow-left",tooltip:e("Back to editor"),click:function(){t.app.callEvent("history:close",[])}},{view:"label",label:e("Version history"),align:"center",css:"webix_fmanager_history_bar"}]},n={view:"checkbox",localId:"diffCheck",labelWidth:12,labelRight:e("Show changes"),value:t.State.diff,on:{onChange:function(e){return t.State.diff=!!e}}},o={type:"form",margin:0,padding:0,rows:[r,{view:"list",localId:"list",width:300,select:!0,borderless:!0,scheme:{$init:t.PrepareDates},type:{height:"auto"},template:function(e){return t.ListTemplate(e,i)},on:{onAfterSelect:function(e){return t.SetVersion(e)}}},n,{height:12}]};return{type:"wide",cols:[{localId:"diff",scroll:"auto",hidden:"code"!==t.File.type,view:"template",css:"webix_docmanager_editor_diff"},o]}}))},e.prototype.init=function(){var t=this;this.List=this.$$("list"),this.Diff=this.$$("diffCheck"),this.dateFormat=webix.Date.dateToStr("%F %j, %Y %H:%i:%s"),this.on(this.State.$changes,"version",(function(e){return t.GetVersion(e,t.State.diff)})),this.on(this.State.$changes,"diff",(function(e){return t.GetVersion(t.List.getSelectedId(),e)})),this.LoadData()},e.prototype.LoadData=function(){var t=this;this.app.getService("versions").versions(this.File.id).then((function(e){t.List.clearAll(),t.List.parse(e),t.List.select(t.List.getFirstId())}))},e.prototype.PrepareDates=function(t){t&&"string"==typeof t.date&&(t.date=new Date(t.date)),t&&"string"==typeof t.origin&&(t.origin=new Date(t.origin))},e.prototype.ListTemplate=function(t,e){var i=this.app.getService("locale")._,r='<div class="webix_fmanager_version_date">'+this.dateFormat(t.date)+"</div>";t.origin&&(r+='<div class="webix_fmanager_restore_date">'+i("Restored from")+" "+this.dateFormat(t.origin)+"</div>");var n=e.getItem(t.user);return'<div class="webix_fmanager_version">'+r+('<div class="webix_fmanager_version_author">'+('<img class="webix_fmanager_version_face" webix_tooltip="'+n.name+"<br>("+n.email+')" src="'+this.app.getService("users").avatarUrl(n.id,n.avatar)+'" />')+'<span class="webix_fmanager_version_name">'+n.name+"</span></div>")+"</div>"},e.prototype.SetVersion=function(t){var e=this.List.getItem(t);this.State.$batch({version:t,current:webix.Date.equal(this.File.date,e.date),date:e.date})},e.prototype.GetVersion=function(t,e){var i=this;t&&"code"===this.File.type&&this.app.getService("versions").readText(t,e).then((function(r){t==i.List.getLastId()&&e&&(r='<span class="webix_docmanager_diff_insert">'+r+"</span>"),i.$$("diff").setHTML(r)}))},e.prototype.GetPrevVersion=function(t){return this.List.getNextId(t)},e}(a.JetView),E=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.config=function(){var e=this;$(this);var i=t.prototype.config.call(this),r=this.app.getService("locale")._;return i.type.backToFiles=function(){return r("back to ")+e.app.getService("backend").getRootName()},i.on.onBeforeDrag=function(t){return e.HandleDrag(t)},i.on.onBeforeDrop=function(t){return e.HandleDrop(t)},i},e.prototype.NameTemplate=function(t){return(t.star&&"trash"!==this.State.source?"<div class='webix_fmanager_star'><span class='webix_docmanager_icon dmi-star'></span></div>":"")+("folder"===t.type?"<span class='webix_icon wxi-folder'></span>"+t.value:this.Icon(t)+'<span class="file-name">'+t.value+"</span>")},e.prototype.init=function(){t.prototype.init.call(this),this.SourceHandlers(),this.DragMark()},e}(a.list),D=function(t){function e(e,i,r){var n=t.call(this,e,i,r)||this;return n.state=r.state,n}return i(e,t),e.prototype.config=function(){var e,i=this.app.getService("locale")._,r=t.prototype.config.call(this),n=[{$template:"Separator",show:32},{id:"favorite",show:161,value:i("Add to favorites"),icon:"dmi-star-outline"},{id:"unfavorite",show:161,value:i("Remove from favorites"),icon:"dmi-star"},{id:"share",value:i("Share"),show:32,icon:"dmi-share"}];return(e=r.data).splice.apply(e,function(){for(var t=0,e=0,i=arguments.length;e<i;e++)t+=arguments[e].length;var r=Array(t),n=0;for(e=0;e<i;e++)for(var o=arguments[e],a=0,s=o.length;a<s;a++,n++)r[n]=o[a];return r}([10,0],n)),r.data=r.data.concat([{id:"restore",value:i("Restore"),show:127,icon:"dmi-delete-restore"},{id:"remove",value:i("Delete from trash"),show:127,icon:"dmi-delete-empty",hotkey:"Del / &#8592;"}]),r.template=function(t){return(t.icon?'<span class="webix_list_icon webix_icon '+t.icon+'"></span>':"")+t.value+(t.hotkey?'<span class="webix_fmanager_context-menu-hotkey">'+t.hotkey+"</span>":"")},r},e.prototype.FilterOptions=function(t){var e=this,i=this.state?this.state.source:null,r=this.getRoot();if(this.Files=t,"trash"!==i){var n=t[0],o=t.length>1,a=["image","audio","video","code","pdf"].find((function(t){return t===n.type||t===n.$ext})),s="code"===n.type||"xls"===n.$ext||"xlsx"===n.$ext,c=this.app.getState().search;this.getRoot().define("width",c&&!o?270:200),this.getRoot().filter((function(t){return!(o&&!(2&t.show)||"folder"===n.type&&!(1&t.show)||4&t.show&&!s||8&t.show&&!a||16&t.show&&!e.compact||32&t.show&&e.tree||64&t.show&&!c||(128&t.show&&n.star?"favorite"===t.id:"unfavorite"===t.id))})),this.FilterCopyPaste(i,r)}else r.define("width",250),r.filter((function(t){return"remove"===t.id||"restore"===t.id}))},e.prototype.FilterCopyPaste=function(t,e){"files"!==t&&e.filter((function(t){return 35^t.show&&33^t.show}),null,!0)},e}(a["menus/menubody"]),j=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.config=function(){var t=this,e=this.app.getService("locale")._,i=this.getParam("compact"),r=e(this.getParam("label")),n={view:"window",css:"webix_fmanager_popup",position:"center",head:{view:"toolbar",padding:{left:12,right:4},borderless:!0,cols:[{template:function(){return r},height:36,borderless:!0,css:"webix_fmanager_shared_title"},{view:"icon",icon:"wxi-close",css:"webix_fmanager_shared_close",hotkey:"esc",click:function(){return t.Hide()}}]},modal:!0,body:{$subview:!0}};if(i)n.fullscreen=!0;else{var o="mini"==webix.skin.$name||"compact"==webix.skin.$name;n.width=o?400:540}return n},e.prototype.Hide=function(){this.show("_blank",{target:"popup"})},e}(a.JetView);var A=[{bg:"#2EADC2",c:"#FFFFFF"},{bg:"#3B3ABB",c:"#FFFFFF"},{bg:"#813EBB",c:"#FFFFFF"},{bg:"#B442A8",c:"#FFFFFF"},{bg:"#B43D64",c:"#FFFFFF"},{bg:"#D25640",c:"#FFFFFF"},{bg:"#DBA10D",c:"#FFFFFF"},{bg:"#7BBD48",c:"#FFFFFF"},{bg:"#5EBD90",c:"#FFFFFF"}],R=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.config=function(){var t=this,e=this.app.getService("locale")._,i=this.getParam("compact",!0),r={localId:"users",view:"text",placeholder:e("Invite someone..."),suggest:{template:"#email#",body:{css:"webix_fmanager_user_list",data:[],template:function(e){return t.InputListTemplate(e)}}}},n={localId:"counter",borderless:!0,template:function(t){return t?t.users?e("Available to")+" "+t.users+" "+e("user(s)"):e("No users"):"&nbsp;"},autoheight:!0},o={view:"list",localId:"list",css:"webix_fmanager_shared_list",template:function(e){return t.ListTemplate(e)},type:{height:webix.skin.$active.rowHeight},autoheight:!0,yCount:i?0:4,onClick:{webix_fmanager_remove_user:function(e,i){return t.RemoveUser(1*i)}}};return{borderless:!0,padding:12,margin:4,rows:[r,{view:"button",label:e("Invite"),inputWidth:140,css:"webix_primary",click:function(){return t.Done()}},n,o]}},e.prototype.init=function(){var t=this;this.List=this.$$("list"),this.Input=this.$$("users"),this.File=this.getParam("info",!0)[0],this.app.getService("localusers").users().then((function(e){t.Data=e;var i=webix.$$(t.Input.config.suggest).getList();i.clearAll(),i.sync(e);var r=t.File.users;r&&r.length&&t.List.parse(r.map((function(t){return e.getItem(t)}))),t.UpdateCounter(r)})),this.Input.focus(),webix.TooltipControl.addTooltip(this.List.$view)},e.prototype.RemoveUser=function(t){var e=this,i=this.app.getService("locale")._;webix.confirm(i("Are you sure ?")).then((function(){return e.app.getService("operations").removeUser(e.File,t).then((function(){e.List.remove(t),e.UpdateCounter(e.File.users)}))}))},e.prototype.ClearInput=function(){this.Input.setValue("")},e.prototype.Done=function(){var t=this,e=this.Input.getValue();if(e){var i=this.Data.find((function(t){return t.email===e}),!0);if(i&&!this.List.find((function(t){return t.id===i.id}),!0))return this.app.getService("operations").share(this.File,i.id).then((function(){t.List.add(i),t.List.showItem(i.id),t.ClearInput(),t.UpdateCounter(t.File.users)}));this.ClearInput()}},e.prototype.ListTemplate=function(t){return(t.avatar?'<img class="avatar_img" webix_tooltip="'+t.email+'" src="'+this.app.getService("users").avatarUrl(t.id,t.avatar)+'">':function(t){var e="",i=A[Math.floor(Math.random()*A.length)];"string"!=typeof t&&(t=""),t=t.split(" ");for(var r=0;r<t.length&&e.length<2;r++)t[r]&&(e+=t[r].charAt(0));return'<div class="default_avatar" style="background:'+i.bg+"; color:"+i.c+';">'+(e||"no")+"</div>"}(t.name))+'<span webix_tooltip="'+t.email+'">'+t.name+"</span><span class='webix_fmanager_remove_user webix_icon wxi-trash'></span>"},e.prototype.InputListTemplate=function(t){return t.name+'&nbsp;<span class="webix_fmanager_user_email">'+t.email+"</span>"},e.prototype.UpdateCounter=function(t){this.$$("counter").setValues({users:t?t.length:0}),t&&t.length?webix.html.removeCss(this.List.$view,"no-border"):webix.html.addCss(this.List.$view,"no-border")},e}(a.JetView);function V(){return L[Math.floor(4*Math.random())][Math.floor(4*Math.random())]}var L=[["#00a037","#13a1aa","#df282f","#fd772c"],["#6d4bce","#b26bd3","#c87095","#90564d"],["#eb2f89","#ea77c0","#777676","#a9a8a8"],["#9bb402","#e7a90b","#0bbed7","#038cd9"]],M=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.config=function(){var t=this,e=this.app.getService("locale")._,i=this.getParam("compact",!0),r={margin:4,cols:[{view:"search",localId:"search",placeholder:e("Type to search a tag"),on:{onTimedKeyPress:function(){return t.FilterTags()},onChange:function(e){return!e&&t.FilterTags()}}},{view:"button",value:e("Add"),css:"webix_primary",width:90,click:function(){t.AddTag()}}]},n=webix.skin.$active.propertyItemHeight+1;return{borderless:!0,padding:12,margin:0,type:"clean",rows:[r,{localId:"tags",view:"datatable",editable:!0,header:!1,yCount:i?0:4,columns:[{id:"name",editor:"text",fillspace:!0,template:function(e){return t.SearchTemplate(e.name)}},{id:"color",editor:"color",width:50,template:function(e){return t.TaglistTemplate(e)},suggest:{css:"webix_fmanager_palette",type:"colorboard",padding:3,body:{view:"colorboard",palette:L,width:4*n,height:4*n}}},{width:50,template:"<span class='webix_fmanager_remove_tag webix_icon wxi-trash'></span>"}],on:{onBeforeEditStop:function(e,i){if(e.value!==e.old){var r=t.$$("tags").getItem(i.row);return r[i.column]=e.value,t.UpdateTag(i.row,{name:r.name,color:r.color}),!1}},"data->onSyncApply":function(){t.FilterTags()}},onClick:{webix_fmanager_remove_tag:function(e,i){t.RemoveTag(i.row)}}}]}},e.prototype.init=function(){var t=this;this.List=this.$$("tags"),this.Search=this.$$("search"),this.SetTaglistOverlay(),this.app.getService("localtags").tags().then((function(e){t.List.parse(e),t.Search.focus()}))},e.prototype.FilterTags=function(){var t=this;this._Input=this.Search.getValue().trim().toLowerCase(),this.List.filter((function(e){return-1!==e.name.toLowerCase().indexOf(t._Input)}))},e.prototype.AddTag=function(){var t=this,e={name:"New",color:V()};this.app.getService("operations").addTag(e).then((function(e){t.Search.setValue(""),t.List.editCell(e,"name",!1,!0)}))},e.prototype.UpdateTag=function(t,e){var i=this;this.app.getService("operations").updateTag(t,e).then((function(){i.List.blockEvent(),i.List.editStop(),i.List.unblockEvent()}))},e.prototype.RemoveTag=function(t){this.app.getService("operations").removeTag(t)},e.prototype.SetTaglistOverlay=function(){var t=this;webix.extend(this.List,webix.OverlayBox),this.on(this.List.data,"onAfterFilter",(function(){return t.ToggleOverlay()})),this.on(this.List.data,"onStoreUpdated",(function(){return t.ToggleOverlay()}))},e.prototype.ToggleOverlay=function(){var t=this.app.getService("locale")._;this.List.count()?this.List.hideOverlay():this.List.showOverlay(t("Click Add to create a new tag"))},e.prototype.TaglistTemplate=function(t){return'<span class="webix_fmanager_tag_color" style="background-color: '+t.color+';">&nbsp;</span>'},e.prototype.SearchTemplate=function(t){if(this._Input){var e=new RegExp("("+this._Input+")","gi");return t.replace(e,"<span class='webix_fmanager_search_mark'>$1</span>")}return t},e}(a.JetView),O=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.GetSource=function(t){return"left"===t?this.State.source:"files"},e}(a["panel-double"]),U=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.config=function(){var e=this,i=t.prototype.config.call(this);return i.rows[0].cols[0].click=function(){var t="files"!==e.State.source?e.State.source:"";e.app.getService("local").refresh(e.State.path,t)},i},e.prototype.init=function(){var e=this;t.prototype.init.call(this);var i=this.app.getService("upload").getUploader();this.on(i,"onBeforeFileDrop",(function(t,i){if(e.getRoot().$view.contains(i.target)&&"files"!==e.State.source)return!1})),this.on(this.State.$changes,"source",(function(t){return e.ProcessSource(t)}))},e.prototype.ProcessPath=function(e){"/"!==this.State.path&&t.prototype.ProcessPath.call(this,e)},e.prototype.ProcessSource=function(t){var e=this,i=this.app.getService("locale")._;this.app.getService("local").folders().then((function(r){var n=i(r.getItem("../"+t).value);e.$$("path").setValues({source:n})}))},e.prototype.RenderPath=function(e){return e.path?t.prototype.RenderPath.call(this,e):e.source?this.RenderSource(e):""},e.prototype.RenderSource=function(t){return'<span class="webix_fmanager_path_chunk" data-path="0">'+t.source+"</span>"},e}(a.panel),B=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.config=function(){var t=this,e=this.app.getService("users");return this.app.getService("localusers").users().then((function(i){return{localId:"comments",view:"comments",css:"webix_fmanager_comments",mentions:!0,users:i,currentUser:1,scheme:{$init:t.PrepareComments},listItem:{templateAvatar:function(t){var r=i.getItem(t.user_id);return'<div class="webix_comments_avatar"><img class="webix_comments_avatar_image" src="'+e.avatarUrl(r.id,r.avatar)+'" /></div>'}}}}))},e.prototype.init=function(){var t=this;this.Comments=this.$$("comments"),this.on(this.Comments,"onBeforeAdd",(function(e,i){return t.AddComment(i)})),this.on(this.Comments.queryView("list").data,"onDataUpdate",(function(e,i,r){return t.UpdateComment(e,i,r)})),this.on(this.Comments,"onBeforeDelete",(function(e){return t.RemoveComment(e)})),webix.extend(this.Comments.queryView("list"),webix.OverlayBox)},e.prototype.urlChange=function(){var t=this.getParam("file");this.LoadComments(t)},e.prototype.LoadComments=function(t){var e=this;this.File=t,this.app.getService("users").comments(t.id).then((function(t){e.Comments.clearAll(),e.Comments.parse(t),e.ChangeListState()}))},e.prototype.ChangeListState=function(){if(this.Comments.count())this.Comments.queryView("list").hideOverlay();else{var t=this.app.getService("locale")._;this.Comments.queryView("list").showOverlay('<div class="webix_fmanager_overlay">'+t("No comments yet")+"</div>")}},e.prototype.PrepareComments=function(t){t&&"string"==typeof t.date&&(t.date=new Date(t.date))},e.prototype.AddComment=function(t){var e=this;return this.app.getService("users").addComment(this.File.id,t.text).then((function(i){t.id=1*i.id,e.Silently("add",[t]),e.ChangeListState()})),!1},e.prototype.UpdateComment=function(t,e,i){var r=this;this.app.getService("users").updateComment(t,e.text).fail((function(){r.Comments.getItem(t).text=i.text,r.Comments.refresh(t)}))},e.prototype.RemoveComment=function(t){var e=this;return this.app.getService("users").deleteComment(t).then((function(t){e.Silently("remove",[t.id]),e.ChangeListState()})),!1},e.prototype.Silently=function(t,e){var i=this.Comments;i.blockEvent(),i[t].apply(i,e),i.unblockEvent()},e}(a.JetView),H=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.config=function(){var e=this.app.getService("locale")._,i=t.prototype.config.call(this);return{rows:[webix.copy(i.rows[0]),{localId:"tabview",view:"tabview",css:"webix_fmanager_preview_tabs",cells:[{header:e("Preview"),body:i.rows[1]},{header:e("Comments"),body:{$subview:!0,name:"comments"}}]}]}},e.prototype.ShowInfo=function(e){t.prototype.ShowInfo.call(this,e);var i=this.$$("tabview").getTabbar();"empty"===e.type?(i.setValue(i.config.options[0].id),i.hide()):(i.show(),this.show("preview.comments",{target:"comments",params:{file:e}}))},e}(a.preview),W=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.config=function(){var e=this,i=this.app.getService("locale")._,r={css:"webix_fmanager_tags_line",rows:[{view:"label",css:"webix_fmanager_info_title",label:i("Tags")},{cols:[{view:"multicombo",localId:"tags:combo",css:"preview_tags",placeholder:i("Add a tag"),newValues:!0,options:{template:"#name#",body:{data:[],template:function(t){return e.TaglistTemplate(t)}}},on:{onItemClick:function(t,i){return e.SearchTag(i.target)}}},{rows:[{cols:[{view:"icon",icon:"wxi-plus",css:"webix_fmanager_tags_plus",tooltip:i("Add a tag"),click:function(){var t=e.$$("tags:combo");t.getInputNode().click(),t.getList().show(t.$view)}},{view:"icon",icon:"dmi-cog",css:"webix_fmanager_tag_settings",tooltip:i("Open tag settings"),click:function(){e.app.callEvent("app:action",["tags"])}}]}]}]}]},n=t.prototype.config.call(this),o=n.cells[0].body;return o.css="webix_fmanager_info",o.rows.splice(0,0,r),n},e.prototype.init=function(){var e=this;t.prototype.init.call(this);var i=this.$$("tags:combo");this.HandleTagUpdate(i),this.HandleColoring(i),this.HandleTagCreation(i),this.on(this.app,"current:tags:updated",(function(){return e.ReloadTags()}))},e.prototype.ShowInfo=function(e){var i=this;if(t.prototype.ShowInfo.call(this,e),"empty"!==e.type){this.File=e;var r=this.$$("tags:combo"),n=this.app.getService("localtags").tags(),o=this.app.getService("tags").getTags(e.id);webix.promise.all([n,o]).then((function(t){r.getList().parse(t[0]),i.SetTagsSilent(r,t[1])}))}},e.prototype.HandleTagUpdate=function(t){var e=this;this.on(t,"onChange",(function(i,r){e.File&&e.app.getService("tags").setTags(e.File.id,i.join()).fail((function(){e.SetTagsSilent(t,r)}))}))},e.prototype.SetTagsSilent=function(t,e){t.blockEvent(),t.setValue(e),t.unblockEvent()},e.prototype.HandleColoring=function(t){var e="mini"===webix.skin.$name||"compact"===webix.skin.$name,i="material"===webix.skin.$name||"mini"===webix.skin.$name;t.$renderTag=function(t,r,n){var o=this.getList().getItem(n),a="<span>"+t+"</span><span class='webix_multicombo_delete' role='button' aria-label='"+webix.i18n.aria.removeItem+"'>"+(i?"&nbsp;&nbsp;":"x")+"</span>";return"<li class='webix_multicombo_value' style='line-height: "+(r+(e?2:0))+"px; background-color: "+o.color+";' optvalue='"+webix.template.escape(n)+"'>"+a+"</li>"}},e.prototype.ReloadTags=function(){var t=this;this.app.getService("tags").getTags(this.File.id).then((function(e){t.SetTagsSilent(t.$$("tags:combo"),e)}))},e.prototype.SearchTag=function(t){var e=this.$$("tags:combo");e.getPopup().hide();var i="webix_multicombo_value"===t.className?t:"webix_multicombo_value"===t.parentNode.className?t.parentNode:null;if(i){var r=i.getAttribute("optvalue");this.getParam("state").search="#"+e.getList().getItem(r).value}},e.prototype.SwitchTabs=function(e,i,r){this.State.search&&!this.State.selectedItem.length?e.show():e.hide(),t.prototype.SwitchTabs.call(this,e,i,r)},e.prototype.HandleTagCreation=function(t){var e=this,i=t.getList();this.on(i,"onBeforeAdd",(function(i,r){var n=t.getValue();return e.AddTag({name:r.value,tags:n}),!1})),this.SetTaglistOverlay(i)},e.prototype.AddTag=function(t){var e=this,i={name:t.name,color:V()};this.app.getService("operations").addTag(i,t.tags).then((function(){e.ReloadTags()}))},e.prototype.SetTaglistOverlay=function(t){var e=this;webix.extend(t,webix.OverlayBox),this.on(t.data,"onAfterFilter",(function(){return e.ToggleOverlay(t)})),this.on(t.getTopParentView(),"onShow",(function(){return e.ToggleOverlay(t)}))},e.prototype.ToggleOverlay=function(t){var e=this.app.getService("locale")._;t.count()?(t.define({autoheight:!0,yCount:5}),t.hideOverlay()):(t.define({yCount:1,autoheight:!1}),t.showOverlay(e("Press Enter to create a new tag"))),t.resize()},e.prototype.TaglistTemplate=function(t){var e=webix.skin.$active.listItemHeight,i='<span class="webix_fmanager_tag_marker" style="background-color:'+t.color+"; height:"+(e-12)+"px; width:"+(e-12)+"px; margin-top:"+e/10+'px;">&nbsp;</span>';return t.name+i},e}(a["preview/info"]),z=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.init=function(){var e=this;t.prototype.init.call(this),this.on(this.app,"app:action",(function(t,i){"share"===t?e.show("./menus.popup/menus.sharepopup",{target:"popup",params:{info:i,compact:e.Compact,label:"Share File"}}):"tags"===t&&e.show("./menus.popup/menus.tagspopup",{target:"popup",params:{compact:e.Compact,label:"Manage Tags"}})}))},e}(a.top),N=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.config=function(){var e=this,i=t.prototype.config.call(this),r=webix.skin.$active,n=this.app.getService("locale")._;return i.cols.find((function(t){return"previewMode"===t.localId})).icon="dmi-gesture-double-tap",i.cols.splice(5,0,{localId:"emptyTrash",css:"webix_fmanager_empty_trash",view:"button",type:"icon",icon:"dmi-delete-empty",tooltip:n("Empty trash"),width:r.toolbarHeight<37?48:60,hidden:!0,click:function(){return e.app.callEvent("app:action",["remove","all"])}}),i},e.prototype.init=function(){var e=this;t.prototype.init.call(this);var i=this.getParam("state");this.on(i.$changes,"source",(function(t,i){"trash"===t?(e.$$("emptyTrash").show(),e.$$("previewMode").hide()):"trash"===i&&(e.$$("emptyTrash").hide(),e.getParam("compact")||e.$$("previewMode").show())}))},e}(a.topbar),G={};G.cards=T,G.editor=C,G.excel=I,G.folders=F,G.history=P,G.list=E,G["menus/menubody"]=D,G["menus/popup"]=j,G["menus/sharepopup"]=R,G["menus/tagspopup"]=M,G["panel-double"]=O,G.panel=U,G["preview/comments"]=B,G.preview=H,G["preview/info"]=W,G.top=z,G.topbar=N;var q=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.files=function(e,i){return i?this._files(this.url("files"),{id:e,source:i}):t.prototype.files.call(this,e)},e.prototype.removePermanent=function(t){return webix.ajax().del(this.url("delete?id="+encodeURIComponent(t))).then((function(t){return t.json()}))},e.prototype.restore=function(t,e){return webix.ajax().put(this.url("delete"),{id:t,target:e}).then((function(t){return t.json()}))},e.prototype.favour=function(t){return webix.ajax().post(this.url("favorite"),{id:t}).then((function(t){return t.json()}))},e.prototype.unfavour=function(t){return webix.ajax().del(this.url("favorite?id="+encodeURIComponent(t))).then((function(t){return t.json()}))},e.prototype.writeBinary=function(t,e,i){var r=new FormData;return r.append("upload",i,e),webix.ajax().post(this.url("direct?id="+encodeURIComponent(t)),r).then((function(t){return t.json()}))},e}(s.Backend),K=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.files=function(e,i,r){if(r){var n=this.fscache.get(r);return i?n:n?Promise.resolve(n):(n=new webix.DataCollection({scheme:{$change:this.prepareData,$serialize:this.serializeData}}),this.fscache.set(r,n),this.reload(n,e,r))}return t.prototype.files.call(this,e,i)},e.prototype.refresh=function(t,e){var i=this.fscache.get(e||t);if(i)return this.reload(i,t,e)},e.prototype.reload=function(e,i,r){var n=this;return r?this.app.getService("backend").files(i,r).then((function(t){return e.clearAll(),e.parse(n.backToFiles().concat(t)),e})):t.prototype.reload.call(this,e,i)},e.prototype.backToFiles=function(){return[{type:"folder",id:"/",value:"..",$row:function(t,e){return e.backIcon()+"<span class='webix_fmanager_back'>"+e.backToFiles()+"</span>"}}]},e.prototype.defaultTree=function(){return[{value:"My Files",id:"../files",open:!0},{value:"Favorite",$css:{"margin-top":"20px"},id:"../favorite",icon:"dmi-star"},{value:"Recent",id:"../recent",icon:"dmi-history"},{value:"Shared",id:"../shared",icon:"dmi-share-all"},{value:"Trash",$css:{"margin-top":"20px"},id:"../trash",icon:"wxi-trash"}]},e.prototype.addFile=function(e,i){this.hierarchy.exists(e)||(e="/"),t.prototype.addFile.call(this,e,i)},e}(s.LocalData),J=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.initEvents=function(){var e=this;t.prototype.initEvents.call(this),this.app.attachEvent("app:action",(function(t,i,r){switch(t){case"trashed":e.addToClipboard(t);break;case"restore":e.restore(i,r);break;case"remove":e.removePermanent(i);break;case"favorite":case"unfavorite":e.favour(i)}}))},e.prototype.remove=function(e){var i=this;(e||this.state.selectedItem.length)&&t.prototype.remove.call(this,e).then((function(){i.local().refresh("/","trash")}))},e.prototype.restore=function(t,e){var i=this,r=this.state,n=this.app.getService("locale")._;t||(t=r.selectedItem),t.length&&(t=this.extractIds(t),this.app.getService("progress").files(n("Restoring..."),t,(function(t){return i.backend().restore(t,e).then((function(e){var r=i.local();r.deleteFile(t),r.addFile(i.dir(e.id),e)}))})))},e.prototype.removePermanent=function(t){var e=this,i=this.state,r=this.app.getService("locale")._;if("all"===t?t=this.local().files("/",!0,"trash").serialize():t||(t=i.selectedItem),t.length)return t=this.extractIds(t),webix.confirm(r("Are you sure ?")).then((function(){e.app.getService("progress").files(r("Deleting..."),t,(function(t){return e.backend().removePermanent(t).then((function(i){i.invalid||e.local().deleteFile(t)}))}))}))},e.prototype.addToClipboard=function(e){"files"!==this.state.source&&"trash"!==this.state.source||t.prototype.addToClipboard.call(this,e)},e.prototype.paste=function(){var e=this.state;e.clipboard&&("files"===e.source?"trashed"===e.clipboard.mode?this.restore(e.clipboard.files,e.path):t.prototype.paste.call(this):"trash"===e.source&&"cut"===e.clipboard.mode&&this.remove(e.clipboard.files))},e.prototype.favour=function(t){var e=this,i=t[0],r=!i.star,n=this.backend();(r?n.favour:n.unfavour).call(n,i.id).then((function(t){t.invalid||(e.local().updateFile(t.id,{star:r}),e.local().refresh("/","favorite"))}))},e.prototype.dir=function(t){return t.slice(0,t.lastIndexOf("/"))||"/"},e.prototype.edit=function(t){var e=this.state;t||(t=e.selectedItem);var i,r=t[0];t.length&&("xls"===r.$ext||"xlsx"===r.$ext?i="/excel":"code"===r.type&&(i="/editor"),i&&this.app.show(i,{params:{file:r,state:e}}))},e.prototype.writeBinary=function(t,e,i){var r=this;return this.backend().writeBinary(t,e,i).then((function(e){return r.local().updateFile(t,{size:e.size,date:e.date})}))},e.prototype.users=function(){return this.app.getService("users")},e.prototype.share=function(t,e){var i=this;return this.users().share(t.id,e).then((function(r){return i.local().updateFile(r.id,{users:(t.users||[]).concat(e)})}))},e.prototype.removeUser=function(t,e){var i=this;return this.users().removeUser(t.id,e).then((function(r){return i.local().updateFile(r.id,{users:t.users.filter((function(t){return t!==e}))})}))},e.prototype.tags=function(){return this.app.getService("tags")},e.prototype.localtags=function(){return this.app.getService("localtags")},e.prototype.addTag=function(t,e){var i=this;return this.tags().addTag(t).then((function(t){if(void 0!==e){var r=i.state.selectedItem,n=r[r.length-1];i.tags().setTags(n.id,e+","+t.id).then((function(){i.app.callEvent("current:tags:updated")}))}return i.localtags().addTag(t)}))},e.prototype.updateTag=function(t,e){var i=this;return this.tags().updateTag(t,e).then((function(e){i.app.callEvent("current:tags:updated"),i.localtags().updateTag(t,e)}))},e.prototype.removeTag=function(t){var e=this,i=this.app.getService("locale")._;webix.confirm(i("Are you sure ?")).then((function(){e.tags().removeTag(t).then((function(t){e.app.callEvent("current:tags:updated"),e.localtags().removeTag(t.id)}))}))},e}(s.Operations),Y=function(){function t(t,e){this._url=e}return t.prototype.url=function(t){return this._url+t},t.prototype.users=function(){return webix.ajax().get(this.url("users/all")).then((function(t){return t.json()}))},t.prototype.avatarUrl=function(t,e){return this.url(""+e.slice(1))},t.prototype.share=function(t,e){return webix.ajax().post(this.url("share"),{id:t,user:e}).then((function(t){return t.json()}))},t.prototype.removeUser=function(t,e){return webix.ajax().del(this.url("share?id="+encodeURIComponent(t)+"&user="+e)).then((function(t){return t.json()}))},t.prototype.comments=function(t){return webix.ajax().get(this.url("comments?id="+encodeURIComponent(t))).then((function(t){return t.json()}))},t.prototype.addComment=function(t,e){return webix.ajax().post(this.url("comments?id="+encodeURIComponent(t)),{value:e}).then((function(t){return t.json()}))},t.prototype.updateComment=function(t,e){return webix.ajax().put(this.url("comments/"+t),{value:e}).then((function(t){return t.json()}))},t.prototype.deleteComment=function(t){return webix.ajax().del(this.url("comments/"+t)).then((function(t){return t.json()}))},t}(),X=function(){function t(t){this.app=t,this.userlist=new webix.DataCollection({scheme:{$change:function(t){t.value=t.name}}}),this.users_ready=null}return t.prototype.users=function(t){var e=this.userlist;return!t&&this.users_ready||(this.users_ready=this.app.getService("users").users().then((function(t){return e.clearAll(),e.parse(t),e}))),this.users_ready},t}(),Z=function(){function t(t,e){this._url=e}return t.prototype.url=function(t){return this._url+t},t.prototype.tags=function(){return webix.ajax().get(this.url("tags/all")).then((function(t){return t.json()}))},t.prototype.getTags=function(t){return webix.ajax().get(this.url("tags?id="+encodeURIComponent(t))).then((function(t){return t.json()}))},t.prototype.setTags=function(t,e){return webix.ajax().put(this.url("tags"),{id:t,value:e}).then((function(t){return t.json()}))},t.prototype.addTag=function(t){return webix.ajax().post(this.url("tags"),t).then((function(t){return t.json()}))},t.prototype.updateTag=function(t,e){return webix.ajax().put(this.url("tags/"+t),e).then((function(t){return t.json()}))},t.prototype.removeTag=function(t){return webix.ajax().del(this.url("tags/"+t)).then((function(t){return t.json()}))},t}(),Q=function(){function t(t){this.app=t,this.taglist=new webix.DataCollection({}),this.tags_ready=null}return t.prototype.tags=function(t){var e=this.taglist;return!t&&this.tags_ready||(this.tags_ready=this.app.getService("tags").tags().then((function(t){return e.clearAll(),e.parse(t),e}))),this.tags_ready},t.prototype.addTag=function(t){return this.taglist.add(t)},t.prototype.updateTag=function(t,e){this.taglist.exists(t)&&this.taglist.updateItem(t,e)},t.prototype.removeTag=function(t){this.taglist.exists(t)&&this.taglist.remove(t)},t}(),tt=function(){function t(t,e){this._url=e}return t.prototype.url=function(t){return this._url+t},t.prototype.versions=function(t){return webix.ajax().get(this.url("versions"),{id:t}).then((function(t){return t.json()}))},t.prototype.readText=function(t,e){var i={mode:"text"};return e&&(i.diff=!0),webix.ajax().get(this.url("versions/"+t),i).then((function(t){return t.text()}))},t.prototype.restore=function(t,e){return webix.ajax().post(this.url("versions"),{id:t,version:e}).then((function(t){return t.json()}))},t.prototype.directLink=function(t){return this.url("versions/"+t+"?mode=binary")},t}(),et=function(t){function e(e){var i=this,n=new Map([[a.top,G.top],[a.cards,G.cards],[a.editor,G.editor],[a.folders,G.folders],[a.list,G.list],[a["menus/menubody"],G["menus/menubody"]],[a.panel,G.panel],[a["panel-double"],G["panel-double"]],[a["preview/info"],G["preview/info"]],[a.preview,G.preview],[a.topbar,G.topbar],[s.Backend,it.Backend],[s.LocalData,it.LocalData],[s.Operations,it.Operations]]);return e.override&&e.override.forEach((function(t,e){return n.set(e,t)})),(i=t.call(this,r(r(r({},{version:"8.0.5"}),e),{override:n}))||this).setService("users",new(i.dynamic(Y))(i,i.config.url)),i.setService("localusers",new(i.dynamic(X))(i)),i.setService("tags",new(i.dynamic(Z))(i,i.config.url)),i.setService("localtags",new(i.dynamic(Q))(i)),i.setService("versions",new(i.dynamic(tt))(i,i.config.url)),i}return i(e,t),e.prototype.require=function(t,e){return"jet-views"===t?G[e]:"jet-locales"===t?rt[e]:null},e.prototype.dynamic=function(t){var e=this.config.override;if(e){for(var i=void 0;t;)i=t,t=e.get(t);return i}return t},e}(l);webix.protoUI({name:"docmanager",app:et,getState:function(){return this.$app.getState()},getService:function(t){return this.$app.getService(t)},$init:function(){var t=this.$app.getState();for(var e in t)p(t,this.config,e)}},webix.ui.jetapp),webix.extend(G,a);var it={LocalData:K,Backend:q,Operations:J,Users:Y,LocalUsers:X,Tags:Z,LocalTags:Q,Versions:tt,Progress:s.Progress,Upload:s.Upload},rt={en:webix.extend({Favorite:"Favorite",Recent:"Recent",Shared:"Shared",Trash:"Trash","Add to favorites":"Add to favorites","Remove from favorites":"Remove from favorites",Share:"Share",Tags:"Tags",Comments:"Comments","Can view":"Can view","Can edit":"Can edit","Share File":"Share File","Invite someone...":"Invite someone...",Invite:"Invite",Restore:"Restore","Delete from trash":"Delete from trash","Restoring...":"Restoring...","Empty trash":"Empty trash","back to ":"back to ","Select a user":"Select a user","Add a tag":"Add a tag","No comments yet":"No comments yet","No users":"No users","Available to":"Available to","user(s)":"user(s)","Manage Tags":"Manage Tags","Press Enter to create a new tag":"Press Enter to create a new tag","Click Add to create a new tag":"Click Add to create a new tag","Open tag settings":"Open tag settings","Type to search a tag":"Type to search a tag","Show version history":"Show version history","Unsaved changes will be lost. Are you sure?":"Unsaved changes will be lost. Are you sure?","Last edited at":"Last edited at","Last edited on":"Last edited on","Back to editor":"Back to editor","Version history":"Version history","Show changes":"Show changes","Restored from":"Restored from"},c.en)};t.App=et,t.locales=rt,t.services=it,t.views=G,Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=docmanager.min.js.map
