"use strict";r.define("core",function(){var a="views";function o(i,t){if(-1==t)return l(this,i);if(this._subs[i])return l(this._subs[i],t);var n=function(i){for(;i;){if(i.app)return i;i=i.parent}return w}(this),e=this.index;if("string"==typeof i){0===i.indexOf("./")&&(e++,i=i.substr(2));var o=h(i);n.path=n.path.slice(0,e).concat(o)}else webix.extend(n.path[e].params,i,!0);n.show(function(i){for(var t=[],n=w.config.layout?1:0;n<i.length;n++){t.push("/"+i[n].page);var e=s(i[n].params);e&&t.push(":"+e)}return t.join("")}(n.path),-1)}function s(i){var t=[];for(var n in i)t.length&&t.push(":"),t.push(n+"="+i[n]);return t.join("")}function u(i,t,n){if(t.page!=this.name){this.name=t.page,this.ui=$,this.on=g,this.show=o,this.module=i,function i(){if(!this._ui)return;this.$layout&&i.call(this.$layout);var t=this._handlers;for(var n=t.length-1;0<=n;n--)t[n].obj.detachEvent(t[n].id);this._handlers=[];this._uis;this._uis=[];_(this._destroy,this._ui,this)}.call(this),this._init=[],this._destroy=[],this._windows=[],this._events=[],this._subs={},this.$layout=!1;var e=c(i,null,this);e.$scope=this,function(i){console.log(i),this._uis=[],this._handlers=[],this.root&&this.root.config&&function i(t){delete webix.ui.views[t.config.id];t.config.id="";var n=t.getChildViews();for(var e=n.length-1;0<=e;e--)i(n[e])}(this.root);for(var t=0;t<this._windows.length;t++)this.ui(this._windows[t]);this._ui=webix.ui(i),this.parent&&(this.root=this._ui);for(t=0;t<this._events.length;t+=2)this.on(w,this._events[t],this._events[t+1]);_(this._init,this._ui,this)}.call(this,e),this.$layout&&(this.$layout={root:(this._ui.$$||webix.$$)(this.name+":subview"),sub:u,parent:this,index:this.index+1})}return this.$layout}function h(i){var t=i.split("/");t[0]||(w.config.layout?t[0]=w.config.layout:t.shift());for(var n=0;n<t.length;n++){var e=t[n],o={},s=e.indexOf(":");if(-1!==s){var r=e.substr(s+1).split(":");if(-1!==r[0].indexOf("=")){o={};for(var a=0;a<r.length;a++){var u=r[a].split("=");o[u[0]]=u[1]}}else o=r}t[n]={page:-1<s?e.substr(0,s):e,params:o}}return t}function c(i,t,n){if(i.$oninit&&n._init.push(i.$oninit),i.$ondestroy&&n._destroy.push(i.$ondestroy),i.$onevent)for(var e in i.$onevent)n._events.push(e,i.$onevent[e]);if(i.$windows&&n._windows.push.apply(n._windows,i.$windows),i.$subview)if("string"==typeof i.$subview){var o=n.name+":subview:"+i.$subview;n._subs[i.$subview]={parent:this,root:o,sub:u,index:0,app:!0};i.id=o}else i={id:n.name+":subview"},n.$layout=!0;if(i.$ui&&(i=i.$ui),i.$init)return i;for(var s in t=t||(webix.isArray(i)?[]:{}),i)i[s]&&"object"==typeof i[s]&&!webix.isDate(i[s])?t[s]=c(i[s],webix.isArray(i[s])?[]:{},n):t[s]=i[s];return t}function l(i,t){i.root&&(i.root=webix.$$(i.root));var n=h(t);v(i,[].concat(n))}var f=function(i,t){var n=r.require(i);console.log(n),n.then?n.then(function(i){t()}):t(n)};function v(n,e,i){var o=e[0];if(o){var s=o.page;console.log("+ render -> "+s);s.indexOf(".");"$"==(s=(s=(s=s.replace(/\./g,"/")).replace(/[\/]+/g,"/")).replace(/\/[^\/]+\/\$/g,"/"))[0]&&(s=i+"/"+s.substring(1));var t=function(i){"function"==typeof i&&(i=i()),e.shift();var t=n.sub(i,o,e);console.log(t),v(n,e,s)};r.defined(s)?f(s,t):r.load((a||"views")+"/"+s+".js",function(){f(s,t)})}}var n=[],e=[],d=[];function p(n){function i(i){Object.defineProperty(i,"oldURL",{enumerable:!0,configurable:!0,value:e}),Object.defineProperty(i,"newURL",{enumerable:!0,configurable:!0,value:document.URL});var t=function(i,t){for(var n=0,e=i.split("/"),o=t.split("/"),s=[];n<e.length;n++)o[n]!=e[n]&&s.push(e[n]);return s}(document.URL,e);n(t.join("/")),e=document.URL}var e=document.URL;window.addEventListener?window.addEventListener("hashchange",i,!1):window.attachEvent("onhashchange",i)}var w={create:function(i){w.config=webix.extend({name:"App",version:"1.0",container:document.body,start:"/"},i,!0),w.debug=i.debug,w.$layout={sub:u,root:w.config.container,index:0,add:!0},a=w.config.viewdir||"views",setTimeout(function(){w.start()},1);var t=document.getElementsByTagName("title")[0];return t&&(t.innerHTML=w.config.name),w},ui:$,_params:function(){var i=h(location.hash);return i.splice(0,1),i},params:function(){var i=h(location.hash);return i.splice(0,1),i.reduce(function(i,t){return i[t.page]=t.params,i},{})},router:function(i){var t=h(i.replace("#!",""));v(w.$layout,[].concat(t))},show:function(i,t){window.location.hash!="#!"+i?window.location.hash="!"+i:w.router(i)},start:function(i){p(w.router);var t="";t=window.location.hash?window.location.hash.replace("#!",""):w.config.start,console.log(t),w.show(t)},use:function(i,t){i.$oninit&&i.$oninit(this,t||{}),i.$onurlchange&&e.push(i.$onurlchange),i.$onurl&&d.push(i.$onurl),i.$onui&&n.push(i.$onui)},trigger:function(i){w.apply(i,[].splice.call(arguments,1))},apply:function(i,t){w.callEvent(i,t)},action:function(i){return function(){w.apply(i,arguments)}},on:function(i,t){this.attachEvent(i,t)},_uis:[],_handlers:[]};function g(i,t,n){var e=i.attachEvent(t,n);return this._handlers.push({obj:i,id:e}),e}function _(i,t,n){if(i)for(var e=0;e<i.length;e++)i[e](t,n)}function $(i,t){var n,e={_init:[],_destroy:[],_windows:[],_events:[]},o=c(i,null,e);if(o.$scope=this,o.id&&(n=$$(o.id)),!n){for(var s=0;s<e._windows.length;s++)this.ui(e._windows[s]);n=webix.ui(o,t),this._uis.push(n);for(s=0;s<e._events.length;s+=2)this.on(w,e._events[s],e._events[s+1]);_(e._init,n,this)}return n}return w});
