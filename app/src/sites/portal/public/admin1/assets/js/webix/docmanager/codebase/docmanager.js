/*
@license
Webix <%= pkg.productName %> v.<%= pkg.version %>
This software is covered by Webix Trial License.
Usage without proper license is prohibited.
(c) XB Software Ltd.
*/
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e=e||self).docManager={})}(this,(function(e){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation. All rights reserved.
    Licensed under the Apache License, Version 2.0 (the "License"); you may not use
    this file except in compliance with the License. You may obtain a copy of the
    License at http://www.apache.org/licenses/LICENSE-2.0

    THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
    WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
    MERCHANTABLITY OR NON-INFRINGEMENT.

    See the Apache Version 2.0 License for specific language governing permissions
    and limitations under the License.
    ***************************************************************************** */var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,i)};function i(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}var r=function(){return(r=Object.assign||function(e){for(var t,i=1,r=arguments.length;i<r;i++)for(var n in t=arguments[i])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)};"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;var n,o=function(e,t){return e(t={exports:{}},t.exports),t.exports}((function(e,t){!function(e){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,i)};function i(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}var r=function(){return(r=Object.assign||function(e){for(var t,i=1,r=arguments.length;i<r;i++)for(var n in t=arguments[i])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)},n=function(){},o=function(){function e(e,t){this.webixJet=!0,this.webix=e,this._events=[],this._subs={},this._data={},t&&t.params&&e.extend(this._data,t.params)}return e.prototype.getRoot=function(){return this._root},e.prototype.destructor=function(){this._detachEvents(),this._destroySubs(),this._events=this._container=this.app=this._parent=this._root=null},e.prototype.setParam=function(e,t,i){if(this._data[e]!==t&&(this._data[e]=t,this._segment.update(e,t,0),i))return this.show(null)},e.prototype.getParam=function(e,t){var i=this._data[e];if(void 0!==i||!t)return i;var r=this.getParentView();return r?r.getParam(e,t):void 0},e.prototype.getUrl=function(){return this._segment.suburl()},e.prototype.getUrlString=function(){return this._segment.toString()},e.prototype.getParentView=function(){return this._parent},e.prototype.$$=function(e){if("string"==typeof e){var t=this.getRoot();return t.queryView((function(i){return(i.config.id===e||i.config.localId===e)&&i.$scope===t.$scope}),"self")}return e},e.prototype.on=function(e,t,i){var r=e.attachEvent(t,i);return this._events.push({obj:e,id:r}),r},e.prototype.contains=function(e){for(var t in this._subs){var i=this._subs[t].view;if(i===e||i.contains(e))return!0}return!1},e.prototype.getSubView=function(e){var t=this.getSubViewInfo(e);if(t)return t.subview.view},e.prototype.getSubViewInfo=function(e){var t=this._subs[e||"default"];return t?{subview:t,parent:this}:"_top"===e?(this._subs[e]={url:"",id:null,popup:!0},this.getSubViewInfo(e)):this._parent?this._parent.getSubViewInfo(e):null},e.prototype._detachEvents=function(){for(var e=this._events,t=e.length-1;t>=0;t--)e[t].obj.detachEvent(e[t].id)},e.prototype._destroySubs=function(){for(var e in this._subs){var t=this._subs[e].view;t&&t.destructor()}this._subs={}},e.prototype._init_url_data=function(){var e=this._segment.current();this._data={},this.webix.extend(this._data,e.params,!0)},e.prototype._getDefaultSub=function(){if(this._subs.default)return this._subs.default;for(var e in this._subs){var t=this._subs[e];if(!t.branch&&t.view&&"_top"!==e){var i=t.view._getDefaultSub();if(i)return i}}},e.prototype._routed_view=function(){var e=this.getParentView();if(!e)return!0;var t=e._getDefaultSub();return!(!t&&t!==this)&&e._routed_view()},e}();function a(e){"/"===e[0]&&(e=e.substr(1));for(var t=e.split("/"),i=[],r=0;r<t.length;r++){var n=t[r],o={},a=n.indexOf(":");if(-1===a&&(a=n.indexOf("?")),-1!==a)for(var s=0,c=n.substr(a+1).split(/[\:\?\&]/g);s<c.length;s++){var u=c[s].split("=");o[u[0]]=decodeURIComponent(u[1])}i[r]={page:a>-1?n.substr(0,a):n,params:o,isNew:!0}}return i}function s(e){for(var t=[],i=0,r=e;i<r.length;i++){var n=r[i];t.push("/"+n.page);var o=c(n.params);o&&t.push("?"+o)}return t.join("")}function c(e){var t=[];for(var i in e)"object"!=typeof e[i]&&(t.length&&t.push("&"),t.push(i+"="+encodeURIComponent(e[i])));return t.join("")}var u=function(){function e(e,t){this._next=1,this.route="string"==typeof e?{url:a(e),path:e}:e,this.index=t}return e.prototype.current=function(){return this.route.url[this.index]},e.prototype.next=function(){return this.route.url[this.index+this._next]},e.prototype.suburl=function(){return this.route.url.slice(this.index)},e.prototype.shift=function(t){var i=new e(this.route,this.index+this._next);return i.setParams(i.route.url,t,i.index),i},e.prototype.setParams=function(e,t,i){if(t){var r=e[i].params;for(var n in t)r[n]=t[n]}},e.prototype.refresh=function(){for(var e=this.route.url,t=this.index+1;t<e.length;t++)e[t].isNew=!0},e.prototype.toString=function(){var e=s(this.suburl());return e?e.substr(1):""},e.prototype._join=function(e,t){var i=this.route.url;if(null===e)return i;var r=this.route.url,n=!0;if(i=r.slice(0,this.index+(t?this._next:0)),e){i=i.concat(a(e));for(var o=0;o<i.length;o++)r[o]&&(i[o].view=r[o].view),n&&r[o]&&i[o].page===r[o].page?i[o].isNew=!1:i[o].isNew&&(n=!1)}return i},e.prototype.append=function(e){var t=this._join(e,!0);return this.route.path=s(t),this.route.url=t,this.route.path},e.prototype.show=function(e,t,i){var r=this,o=this._join(e.url,i);return this.setParams(o,e.params,this.index+(i?this._next:0)),new Promise((function(e,i){var a=s(o),c={url:o,redirect:a,confirm:Promise.resolve()},u=t?t.app:null;!u||u.callEvent("app:guard",[c.redirect,t,c])?c.confirm.catch((function(e){return i(e)})).then((function(){if(null!==c.redirect){if(c.redirect!==a)return u.show(c.redirect),void i(new n);r.route.path=a,r.route.url=o,e()}else i(new n)})):i(new n)}))},e.prototype.size=function(e){this._next=e},e.prototype.split=function(){var t={url:this.route.url.slice(this.index+1),path:""};return t.url.length&&(t.path=s(t.url)),new e(t,0)},e.prototype.update=function(e,t,i){var r=this.route.url[this.index+(i||0)];if(!r)return this.route.url.push({page:"",params:{}}),this.update(e,t,i);""===e?r.page=t:r.params[e]=t,this.route.path=s(this.route.url)},e}(),l=function(e){function t(t,i){var r=e.call(this,t.webix)||this;return r.app=t,r._children=[],r}return i(t,e),t.prototype.ui=function(e,t){var i=(t=t||{}).container||e.container,r=this.app.createView(e);return this._children.push(r),r.render(i,this._segment,this),"object"!=typeof e||e instanceof o?r:r.getRoot()},t.prototype.show=function(e,t){if(t=t||{},"object"==typeof e){for(var i in e)this.setParam(i,e[i]);e=null}else{if("/"===e.substr(0,1))return this.app.show(e,t);if(0===e.indexOf("./")&&(e=e.substr(2)),0===e.indexOf("../")){var r=this.getParentView();return r?r.show(e.substr(3),t):this.app.show("/"+e.substr(3))}var n=this.getSubViewInfo(t.target);if(n){if(n.parent!==this)return n.parent.show(e,t);if(t.target&&"default"!==t.target)return this._renderFrameLock(t.target,n.subview,{url:e,params:t.params})}else if(e)return this.app.show("/"+e,t)}return this._show(this._segment,{url:e,params:t.params},this)},t.prototype._show=function(e,t,i){var r=this;return e.show(t,i,!0).then((function(){return r._init_url_data(),r._urlChange()})).then((function(){e.route.linkRouter&&(r.app.getRouter().set(e.route.path,{silent:!0}),r.app.callEvent("app:route",[e.route.path]))}))},t.prototype.init=function(e,t){},t.prototype.ready=function(e,t){},t.prototype.config=function(){this.app.webix.message("View:Config is not implemented")},t.prototype.urlChange=function(e,t){},t.prototype.destroy=function(){},t.prototype.destructor=function(){this.destroy(),this._destroyKids(),this._root&&(this._root.destructor(),e.prototype.destructor.call(this))},t.prototype.use=function(e,t){e(this.app,this,t)},t.prototype.refresh=function(){return this.getUrl(),this.destroy(),this._destroyKids(),this._destroySubs(),this._detachEvents(),this._container.tagName&&this._root.destructor(),this._segment.refresh(),this._render(this._segment)},t.prototype.render=function(e,t,i){var r=this;"string"==typeof t&&(t=new u(t,0)),this._segment=t,this._parent=i,this._init_url_data();var n="string"==typeof(e=e||document.body)?this.webix.toNode(e):e;return this._container!==n?(this._container=n,this._render(t)):this._urlChange().then((function(){return r.getRoot()}))},t.prototype._render=function(e){var t=this,i=this.config();return i.then?i.then((function(i){return t._render_final(i,e)})):this._render_final(i,e)},t.prototype._render_final=function(e,t){var i,r=this,n=null,o=null,a=!1;if(this._container.tagName?o=this._container:(n=this._container).popup?(o=document.body,a=!0):o=this.webix.$$(n.id),!this.app||!o)return Promise.reject(null);var s=this._segment.current(),c={ui:{}};this.app.copyConfig(e,c.ui,this._subs),this.app.callEvent("app:render",[this,t,c]),c.ui.$scope=this,!n&&s.isNew&&s.view&&s.view.destructor();try{if(n&&!a){var u=o,l=u.getParentView();l&&"multiview"===l.name&&!c.ui.id&&(c.ui.id=u.config.id)}this._root=this.app.webix.ui(c.ui,o);var p=this._root;a&&p.setPosition&&!p.isVisible()&&p.show(),n&&(n.view&&n.view!==this&&n.view!==this.app&&n.view.destructor(),n.id=this._root.config.id,this.getParentView()||!this.app.app?n.view=this:n.view=this.app),s.isNew&&(s.view=this,s.isNew=!1),i=Promise.resolve(this._init(this._root,t)).then((function(){return r._urlChange().then((function(){return r._initUrl=null,r.ready(r._root,t.suburl())}))}))}catch(e){i=Promise.reject(e)}return i.catch((function(e){return r._initError(r,e)}))},t.prototype._init=function(e,t){return this.init(e,t.suburl())},t.prototype._urlChange=function(){var e=this;this.app.callEvent("app:urlchange",[this,this._segment]);var t=[];for(var i in this._subs){var r=this._subs[i],n=this._renderFrameLock(i,r,null);n&&t.push(n)}return Promise.all(t).then((function(){return e.urlChange(e._root,e._segment.suburl())}))},t.prototype._renderFrameLock=function(e,t,i){if(!t.lock){var r=this._renderFrame(e,t,i);r&&(t.lock=r.then((function(){return t.lock=null}),(function(){return t.lock=null})))}return t.lock},t.prototype._renderFrame=function(e,t,i){var r=this;if("default"===e){if(this._segment.next()){var n=i?i.params:null;return t.params&&(n=this.webix.extend(n||{},t.params)),this._createSubView(t,this._segment.shift(n))}t.view&&t.popup&&(t.view.destructor(),t.view=null)}if(null!==i&&(t.url=i.url,t.params&&(i.params=this.webix.extend(i.params||{},t.params))),t.route){if(null!==i)return t.route.show(i,t.view).then((function(){return r._createSubView(t,t.route)}));if(t.branch)return}var o=t.view;if(!o&&t.url){if("string"==typeof t.url)return t.route=new u(t.url,0),i&&t.route.setParams(t.route.route.url,i.params,0),t.params&&t.route.setParams(t.route.route.url,t.params,0),this._createSubView(t,t.route);"function"!=typeof t.url||o instanceof t.url||(o=new(this.app._override(t.url))(this.app,"")),o||(o=t.url)}if(o)return o.render(t,t.route||this._segment,this)},t.prototype._initError=function(e,t){return this.app&&this.app.error("app:error:initview",[t,e]),!0},t.prototype._createSubView=function(e,t){var i=this;return this.app.createFromURL(t.current()).then((function(r){return r.render(e,t,i)}))},t.prototype._destroyKids=function(){for(var e=this._children,t=e.length-1;t>=0;t--)e[t]&&e[t].destructor&&e[t].destructor();this._children=[]},t}(o),p=function(e){function t(t,i){var r=e.call(this,t,i)||this;return r._ui=i.ui,r}return i(t,e),t.prototype.config=function(){return this._ui},t}(l),h=function(){function e(e,t,i){this.path="",this.app=i}return e.prototype.set=function(e,t){this.path=e;var i=this.app;i.app.getRouter().set(i._segment.append(this.path),{silent:!0})},e.prototype.get=function(){return this.path},e}(),f=!0,d=function(e){function t(t){var i=this,r=(t||{}).webix||window.webix;return t=r.extend({name:"App",version:"1.0",start:"/home"},t,!0),(i=e.call(this,r,t)||this).config=t,i.app=i.config.app,i.ready=Promise.resolve(),i._services={},i.webix.extend(i,i.webix.EventSystem),i}return i(t,e),t.prototype.getUrl=function(){return this._subSegment.suburl()},t.prototype.getUrlString=function(){return this._subSegment.toString()},t.prototype.getService=function(e){var t=this._services[e];return"function"==typeof t&&(t=this._services[e]=t(this)),t},t.prototype.setService=function(e,t){this._services[e]=t},t.prototype.destructor=function(){this.getSubView().destructor(),e.prototype.destructor.call(this)},t.prototype.copyConfig=function(e,t,i){if((e instanceof o||"function"==typeof e&&e.prototype instanceof o)&&(e={$subview:e}),void 0!==e.$subview)return this.addSubView(e,t,i);var r=e instanceof Array;for(var n in t=t||(r?[]:{}),e){var a=e[n];if("function"==typeof a&&a.prototype instanceof o&&(a={$subview:a}),!a||"object"!=typeof a||a instanceof this.webix.DataCollection||a instanceof RegExp||a instanceof Map)t[n]=a;else if(a instanceof Date)t[n]=new Date(a);else{var s=this.copyConfig(a,a instanceof Array?[]:{},i);null!==s&&(r?t.push(s):t[n]=s)}}return t},t.prototype.getRouter=function(){return this.$router},t.prototype.clickHandler=function(e,t){if(e&&(t=t||e.target||e.srcElement)&&t.getAttribute){var i=t.getAttribute("trigger");if(i)return this._forView(t,(function(e){return e.app.trigger(i)})),e.cancelBubble=!0,e.preventDefault();var r=t.getAttribute("route");if(r)return this._forView(t,(function(e){return e.show(r)})),e.cancelBubble=!0,e.preventDefault()}var n=t.parentNode;n&&this.clickHandler(e,n)},t.prototype.getRoot=function(){return this.getSubView().getRoot()},t.prototype.refresh=function(){var e=this;return this._subSegment?this.getSubView().refresh().then((function(t){return e.callEvent("app:route",[e.getUrl()]),t})):Promise.resolve(null)},t.prototype.loadView=function(e){var t=this,i=this.config.views,r=null;if(""===e)return Promise.resolve(this._loadError("",new Error("Webix Jet: Empty url segment")));try{i&&"string"==typeof(r="function"==typeof i?i(e):i[e])&&(e=r,r=null),r||("_hidden"===e?r={hidden:!0}:"_blank"===e?r={}:(e=e.replace(/\./g,"/"),r=this.require("jet-views",e)))}catch(t){r=this._loadError(e,t)}return r.then||(r=Promise.resolve(r)),r=r.then((function(e){return e.__esModule?e.default:e})).catch((function(i){return t._loadError(e,i)}))},t.prototype._forView=function(e,t){var i=this.webix.$$(e);i&&t(i.$scope)},t.prototype._loadViewDynamic=function(e){return null},t.prototype.createFromURL=function(e){var t=this;return e.isNew||!e.view?this.loadView(e.page).then((function(i){return t.createView(i,name,e.params)})):Promise.resolve(e.view)},t.prototype._override=function(e){var t=this.config.override;if(t){for(var i=void 0;e;)i=e,e=t.get(e);return i}return e},t.prototype.createView=function(e,i,r){if("function"==typeof(e=this._override(e))){if(e.prototype instanceof t)return new e({app:this,name:i,params:r,router:h});if(e.prototype instanceof o)return new e(this,{name:i,params:r});e=e(this)}return e instanceof o?e:new p(this,{name:i,ui:e})},t.prototype.show=function(e,t){return e&&this.app&&0==e.indexOf("//")?this.app.show(e.substr(1),t):this.render(this._container,e||this.config.start,t)},t.prototype.trigger=function(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];this.apply(e,t)},t.prototype.apply=function(e,t){this.callEvent(e,t)},t.prototype.action=function(e){return this.webix.bind((function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];this.apply(e,t)}),this)},t.prototype.on=function(e,t){this.attachEvent(e,t)},t.prototype.use=function(e,t){e(this,null,t)},t.prototype.error=function(e,t){if(this.callEvent(e,t),this.callEvent("app:error",t),this.config.debug)for(var i=0;i<t.length;i++)if(console.error(t[i]),t[i]instanceof Error){var r=t[i].message;0===r.indexOf("Module build failed")?(r=r.replace(/\x1b\[[0-9;]*m/g,""),document.body.innerHTML="<pre style='font-size:16px; background-color: #ec6873; color: #000; padding:10px;'>"+r+"</pre>"):(r+="<br><br>Check console for more details",this.webix.message({type:"error",text:r,expire:-1}))}},t.prototype.render=function(e,t,i){var r=this;this._container="string"==typeof e?this.webix.toNode(e):e||document.body;var n=null;this.$router?n="string"==typeof t?t:this.app?t.split().route.path||this.config.start:t.toString():(f&&"tagName"in this._container&&(this.webix.event(document.body,"click",(function(e){return r.clickHandler(e)})),f=!1),"string"==typeof t&&(t=new u(t,0)),this._subSegment=this._first_start(t),this._subSegment.route.linkRouter=!0);var o=i?i.params:this.config.params||null,a=this.getSubView(),s=this._subSegment,c=s.show({url:n,params:o},a).then((function(){return r.createFromURL(s.current())})).then((function(t){return t.render(e,s)})).then((function(e){return r.$router.set(s.route.path,{silent:!0}),r.callEvent("app:route",[r.getUrl()]),e}));return this.ready=this.ready.then((function(){return c})),c},t.prototype.getSubView=function(){if(this._subSegment){var e=this._subSegment.current().view;if(e)return e}return new l(this,{})},t.prototype.require=function(e,t){return null},t.prototype._first_start=function(e){var t=this;if(this._segment=e,this.$router=new this.config.router((function(e){return setTimeout((function(){t.show(e).catch((function(e){if(!(e instanceof n))throw e}))}),1)}),this.config,this),this._container===document.body&&!1!==this.config.animation){var i=this._container;this.webix.html.addCss(i,"webixappstart"),setTimeout((function(){t.webix.html.removeCss(i,"webixappstart"),t.webix.html.addCss(i,"webixapp")}),10)}if(e){if(this.app){var r=e.current().view;e.current().view=this,e.next()?(e.refresh(),e=e.split()):e=new u(this.config.start,0),e.current().view=r}}else{var o=this.$router.get();o||(o=this.config.start,this.$router.set(o,{silent:!0})),e=new u(o,0)}return e},t.prototype._loadError=function(e,t){return this.error("app:error:resolve",[t,e]),{template:" "}},t.prototype.addSubView=function(e,t,i){var r=!0!==e.$subview?e.$subview:null,n=e.name||(r?this.webix.uid():"default");return t.id=e.id||"s"+this.webix.uid(),(i[n]={id:t.id,url:r,branch:e.branch,popup:e.popup,params:e.params}).popup?null:t},t}(o),v=function(){function e(e,t){var i=this;this.config=t||{},this._detectPrefix(),this.cb=e,window.onpopstate=function(){return i.cb(i.get())}}return e.prototype.set=function(e,t){var i=this;if(this.config.routes){var r=e.split("?",2);for(var n in this.config.routes)if(this.config.routes[n]===r[0]){e=n+(r.length>1?"?"+r[1]:"");break}}this.get()!==e&&window.history.pushState(null,null,this.prefix+this.sufix+e),t&&t.silent||setTimeout((function(){return i.cb(e)}),1)},e.prototype.get=function(){var e=this._getRaw().replace(this.prefix,"").replace(this.sufix,"");if(e="/"!==e&&"#"!==e?e:"",this.config.routes){var t=e.split("?",2),i=this.config.routes[t[0]];i&&(e=i+(t.length>1?"?"+t[1]:""))}return e},e.prototype._detectPrefix=function(){var e=this.config.routerPrefix;this.sufix="#"+(void 0===e?"!":e),this.prefix=document.location.href.split("#",2)[0]},e.prototype._getRaw=function(){return document.location.href},e}(),g=!1;function m(e){if(!g&&e){g=!0;var t=window;t.Promise||(t.Promise=e.promise);var i=e.version.split(".");10*i[0]+1*i[1]<53&&(e.ui.freeze=function(t){var i=t();return i&&i.then?i.then((function(t){return e.ui.$freeze=!1,e.ui.resize(),t})):(e.ui.$freeze=!1,e.ui.resize()),i});var r=e.ui.baselayout.prototype.addView,n=e.ui.baselayout.prototype.removeView,o={addView:function(e,t){if(this.$scope&&this.$scope.webixJet&&!e.queryView){var i=this.$scope,n={};e=i.app.copyConfig(e,{},n),r.apply(this,[e,t]);var o=function(e){i._renderFrame(e,n[e],null).then((function(){i._subs[e]=n[e]}))};for(var a in n)o(a);return e.id}return r.apply(this,arguments)},removeView:function(){if(n.apply(this,arguments),this.$scope&&this.$scope.webixJet){var t=this.$scope._subs;for(var i in t){var r=t[i];e.$$(r.id)||(r.view.destructor(),delete t[i])}}}};e.extend(e.ui.layout.prototype,o,!0),e.extend(e.ui.baselayout.prototype,o,!0),e.protoUI({name:"jetapp",$init:function(t){this.$app=new this.app(t);var i=e.uid().toString();t.body={id:i},this.$ready.push((function(){this.callEvent("onInit",[this.$app]),this.$app.render({id:i})}))}},e.ui.proxy,e.EventSystem)}}var w=function(e){function t(t){var i;return t.router=t.router||v,m((i=e.call(this,t)||this).webix),i}return i(t,e),t.prototype.require=function(e,t){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}()},t}(d),y=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}i(t,e),t.prototype._detectPrefix=function(){this.prefix="",this.sufix=this.config.routerPrefix||""},t.prototype._getRaw=function(){return document.location.pathname+(document.location.search||"")}}(v),function(){function e(e,t){this.path="",this.cb=e}return e.prototype.set=function(e,t){var i=this;this.path=e,t&&t.silent||setTimeout((function(){return i.cb(e)}),1)},e.prototype.get=function(){return this.path},e}());function b(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function _(e,t,i){for(var r in e)b(e,r)&&t.call(i||e,e[r],r,e)}function x(e){e="Warning: "+e,"undefined"!=typeof console&&console.error(e);try{throw new Error(e)}catch(e){}}var S=String.prototype.replace,k=String.prototype.split,$=function(e){var t=e%10;return 11!==e&&1===t?0:2<=t&&t<=4&&!(e>=12&&e<=14)?1:2},C={arabic:function(e){if(e<3)return e;var t=e%100;return t>=3&&t<=10?3:t>=11?4:5},bosnian_serbian:$,chinese:function(){return 0},croatian:$,french:function(e){return e>1?1:0},german:function(e){return 1!==e?1:0},russian:$,lithuanian:function(e){return e%10==1&&e%100!=11?0:e%10>=2&&e%10<=9&&(e%100<11||e%100>19)?1:2},czech:function(e){return 1===e?0:e>=2&&e<=4?1:2},polish:function(e){if(1===e)return 0;var t=e%10;return 2<=t&&t<=4&&(e%100<10||e%100>=20)?1:2},icelandic:function(e){return e%10!=1||e%100==11?1:0},slovenian:function(e){var t=e%100;return 1===t?0:2===t?1:3===t||4===t?2:3}},I={arabic:["ar"],bosnian_serbian:["bs-Latn-BA","bs-Cyrl-BA","srl-RS","sr-RS"],chinese:["id","id-ID","ja","ko","ko-KR","lo","ms","th","th-TH","zh"],croatian:["hr","hr-HR"],german:["fa","da","de","en","es","fi","el","he","hi-IN","hu","hu-HU","it","nl","no","pt","sv","tr"],french:["fr","tl","pt-br"],russian:["ru","ru-RU"],lithuanian:["lt"],czech:["cs","cs-CZ","sk"],polish:["pl"],icelandic:["is"],slovenian:["sl-SL"]};function T(e){var t,i=(t={},_(I,(function(e,i){_(e,(function(e){t[e]=i}))})),t);return i[e]||i[k.call(e,/-/,1)[0]]||i.en}function F(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}var P=/\$/g,D=/%\{(.*?)\}/g;function E(e,t,i,r){if("string"!=typeof e)throw new TypeError("Polyglot.transformPhrase expects argument #1 to be string");if(null==t)return e;var n=e,o=r||D,a="number"==typeof t?{smart_count:t}:t;if(null!=a.smart_count&&n){var s=k.call(n,"||||");n=(s[function(e,t){return C[T(e)](t)}(i||"en",a.smart_count)]||s[0]).replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}return n=S.call(n,o,(function(e,t){return b(a,t)&&null!=a[t]?S.call(a[t],P,"$$"):e}))}function j(e){var t=e||{};this.phrases={},this.extend(t.phrases||{}),this.currentLocale=t.locale||"en";var i=t.allowMissing?E:null;this.onMissingKey="function"==typeof t.onMissingKey?t.onMissingKey:i,this.warn=t.warn||x,this.tokenRegex=function(e){var t=e&&e.prefix||"%{",i=e&&e.suffix||"}";if("||||"===t||"||||"===i)throw new RangeError('"||||" token is reserved for pluralization');return new RegExp(F(t)+"(.*?)"+F(i),"g")}(t.interpolation)}j.prototype.locale=function(e){return e&&(this.currentLocale=e),this.currentLocale},j.prototype.extend=function(e,t){_(e,(function(e,i){var r=t?t+"."+i:i;"object"==typeof e?this.extend(e,r):this.phrases[r]=e}),this)},j.prototype.unset=function(e,t){"string"==typeof e?delete this.phrases[e]:_(e,(function(e,i){var r=t?t+"."+i:i;"object"==typeof e?this.unset(e,r):delete this.phrases[r]}),this)},j.prototype.clear=function(){this.phrases={}},j.prototype.replace=function(e){this.clear(),this.extend(e)},j.prototype.t=function(e,t){var i,r,n=null==t?{}:t;return"string"==typeof this.phrases[e]?i=this.phrases[e]:"string"==typeof n._?i=n._:this.onMissingKey?r=(0,this.onMissingKey)(e,n,this.currentLocale,this.tokenRegex):(this.warn('Missing translation for key: "'+e+'"'),r=e),"string"==typeof i&&(r=E(i,n,this.currentLocale,this.tokenRegex)),r},j.prototype.has=function(e){return b(this.phrases,e)},j.transformPhrase=function(e,t,i){return E(e,t,i)};var R=j,A=window.webix;A&&m(A);var M=function(e,t,i){var r=(i=i||{}).storage,n=r?r.get("lang")||"en":i.lang||"en";function o(t,o,a){o.__esModule&&(o=o.default);var c={phrases:o};i.polyglot&&e.webix.extend(c,i.polyglot);var u=s.polyglot=new R(c);if(u.locale(t),s._=e.webix.bind(u.t,u),n=t,r&&r.put("lang",n),i.webix){var l=i.webix[t];l&&e.webix.i18n.setLocale(l)}return a?Promise.resolve():e.refresh()}function a(t,r){if(!1!==i.path){var n=(i.path?i.path+"/":"")+t;o(t,e.require("jet-locales",n),r)}}var s={getLang:function(){return n},setLang:a,setLangData:o,_:null,polyglot:null};e.setService("locale",s),a(n,!0)},V=window;V.Promise||(V.Promise=V.webix.promise);var U=1;function L(e,t,i){Object.defineProperty(t,i,{get:function(){return e[i]},set:function(t){return e[i]=t}})}function O(e,t){t=t||{};var i={},r={},n=function(e,t){var n=U++;return i[n]={mask:e,handler:t},t("*"===e?r:r[e],void 0,e),n},o=[],a=!1,s=function(e,t,r,n){if(a)o.push([e,t,r,n]);else for(var s=Object.keys(i),c=0;c<s.length;c++){var u=i[s[c]];u&&("*"!==u.mask&&u.mask!==e||u.handler(r,t,e,n))}};for(var c in e)if(e.hasOwnProperty(c)){var u=e[c];t.nested&&"object"==typeof u&&u?r[c]=O(u,t):B(r,u,c,s)}return Object.defineProperty(r,"$changes",{value:{attachEvent:n,detachEvent:function(e){delete i[e]}},enumerable:!1,configurable:!1}),Object.defineProperty(r,"$observe",{value:n,enumerable:!1,configurable:!1}),Object.defineProperty(r,"$batch",{value:function(e){if("function"!=typeof e){var t=e;e=function(){for(var e in t)r[e]=t[e]}}for(a=!0,e(r),a=!1;o.length;){var i=o.shift();s.apply(this,i)}},enumerable:!1,configurable:!1}),r}function B(e,t,i,r){Object.defineProperty(e,i,{get:function(){return t},set:function(e){if(null===t||null===e?t!==e:t.valueOf()!=e.valueOf()){var n=t;t=e,r(i,n,e,null)}},enumerable:!0,configurable:!1})}function W(e){return{attachEvent:function(t,i){return webix.UIManager.addHotKey(t,i,e),{key:t,handler:i}},detachEvent:function(t){var i=t.key,r=t.handler;return webix.UIManager.removeHotKey(i,r,e)}}}var z="<span class='webix_icon wxi-folder'></span>",H="<span class='webix_icon wxi-dots webix_fmanager_menu_icon'></span>",N=function(e){function t(t,i,r){var n=e.call(this,t,i)||this;return n.compact=!!r.compact,n.tree=!!r.tree,n}return i(t,e),t.prototype.config=function(){var e=this,t=this.app.getService("locale")._,i=[{id:"download",value:t("Download"),icon:"wxi-download",show:32,hotkey:"Ctrl+D"},{$template:"Separator",show:32},{id:"toggle-preview",value:t("Preview"),icon:"wxi-eye",show:17},{id:"locate",value:t("Open item location"),icon:"wxi-folder",hotkey:"Ctrl+Alt+O",show:65},{id:"open",value:t("Open"),icon:"wxi-folder-open",hotkey:"Ctrl+O",show:8},{$template:"Separator",show:8},{id:"copy",value:t("Copy"),hotkey:"Ctrl+C",icon:"fmi-content-copy",show:35},{id:"cut",value:t("Cut"),hotkey:"Ctrl+X",icon:"fmi-content-cut",show:35},{id:"paste",value:t("Paste"),hotkey:"Ctrl+V",icon:"fmi-content-paste",show:33},{$template:"Separator",show:35},{id:"rename",value:t("Rename"),icon:"fmi-rename-box",hotkey:"Ctrl+R",show:1},{id:"delete",value:t("Delete"),icon:"wxi-close",hotkey:"Del / &#8592;",show:3}];return this.app.config.editor&&i.splice(5,0,{id:"edit",value:t("Edit"),icon:"wxi-pencil",hotkey:"Ctrl+E",show:4}),{view:"menu",css:"webix_fmanager_menu",layout:"y",autoheight:!0,data:i,template:function(e){return(e.icon?'<span class="webix_list_icon webix_icon '+e.icon+'"></span>':"")+e.value+(e.hotkey?'<span class="webix_fmanager_context-menu-hotkey">'+e.hotkey+"</span>":"")},on:{onMenuItemClick:function(t){e.app.callEvent("app:action",[t,e.Files]),e.app.callEvent("app:filemenu:click")}}}},t.prototype.FilterOptions=function(e){var t=this;this.Files=e;var i=e[0],r=e.length>1,n=["image","audio","video","code","pdf"].find((function(e){return e===i.type||e===i.$ext})),o=this.app.getState().search;this.getRoot().define("width",o&&!r?270:200),this.getRoot().filter((function(e){return!(r&&!(2&e.show)||"folder"===i.type&&!(1&e.show)||4&e.show&&"code"!==i.type||8&e.show&&!n||16&e.show&&!t.compact||32&e.show&&t.tree||64&e.show&&!o)}))},t}(l),G=function(e){function t(t,i,r){var n=e.call(this,t,i)||this;return n._config=r,n}return i(t,e),t.prototype.config=function(){var e=this;return{view:"context",body:{$subview:new(this.app.dynamic(N))(this.app,"",r({},this._config)),name:"options"},on:{onBeforeShow:function(t){var i=e._Locate(t);if(!i)return!1;e.getSubView("options").FilterOptions(i)}}}},t.prototype.init=function(){var e=this;this.on(this.app,"app:filemenu:click",(function(){return e.getRoot().hide()}))},t.prototype.AttachTo=function(e,t){this._Locate=t,this.getRoot().attachTo(e)},t.prototype.Show=function(e){this.getRoot().show(e,{x:-e.offsetX,y:e.target.offsetHeight-e.offsetY})},t}(l),q=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.init=function(){var e=this;this.State=this.getParam("state"),this._Track=!0,this.WTable.attachEvent("onAfterSelect",(function(){e.getParam("trackActive",!0)&&(e.State.isActive=!0)})),this.WTable.attachEvent("onSelectChange",(function(){if(e._Track){var t=[].concat(e.WTable.getSelectedId(!0).map((function(t){return e.WTable.getItem(t)}))).filter((function(e){return".."!==e.value}));(t.length||e.State.selectedItem.length)&&(e.State.selectedItem=t)}})),this.on(this.State.$changes,"path",(function(t,i){e.State.search||(t="files"===e.State.source?t:e.State.source,i?e.app.getService("local").folders().then((function(r){e.State.selectedItem=e.GetPrevLocation(r,t,i),e.LoadData(t)})):e.LoadData(t))})),this.on(this.WTable.data,"onStoreUpdated",(function(t,i,r){!r&&e.WTable.count()&&e.State.selectedItem.length&&e.SelectActive()})),this.AddHotkeys();var t=this.getParam("compact",!0);this.Menu=this.ui(new(this.app.dynamic(G))(this.app,"",{compact:t,state:this.State})),this.Menu.AttachTo(this.WTable,(function(t){var i=e.WTable.locate(t);if(!i)return!1;var r=e.WTable.getItem(i);if(".."==r.value)return!1;e.WTable.isSelected(i)||e.WTable.select(i);var n=e.WTable.getSelectedId(!0);return 1===n.length?[r]:n.map((function(t){return e.WTable.getItem(t)}))})),this.on(this.WTable,"onAfterScroll",(function(){return webix.callEvent("onClick")}))},t.prototype.Activate=function(e){e&&("folder"===e.type?this.ShowSubFolder(".."===e.value?e.value:e.id):"code"===e.type&&this.app.config.editor?this.app.callEvent("app:action",["edit",[e]]):this.app.callEvent("app:action",["open",[e]]))},t.prototype.ShowSubFolder=function(e){var t;if(".."==e){var i=this.State.path.split("/");t="/"+i.slice(1,i.length-1).join("/")}else t=e;this.State.$batch({path:t,search:"",searchStats:null})},t.prototype.GetPrevLocation=function(e,t,i){if("/"===i)return[];var r;for("/"===t&&(t="../files");i;)if(r=i,(i=e.getParentId(i))===t){var n=e.getItem(r);return[{id:n.id,value:n.value,type:"folder",date:new Date(n.date)}]}return[]},t.prototype.GetTargetFolder=function(e){var t=e?this.WTable.getItem(e):null;return t&&"folder"===t.type&&".."!==t.value?t.id:this.State.path},t.prototype.SelectActive=function(){var e=this.WTable;if(!1!==this.State.isActive&&!e.getSelectedId()){for(var t=this.State.selectedItem,i=0;i<t.length;i++)e.exists(t[i].id)&&e.select(t[i].id,!0);if(!e.getSelectedId()){var r=e.getFirstId();r&&e.select(r)}webix.delay((function(){return webix.UIManager.setFocus(e)}))}},t.prototype.GetSelection=function(){return this.WTable.getItem(this.WTable.getSelectedId())},t.prototype.LoadData=function(e,t){var i=this;this._Track=!1;var r=this.WTable;t?(r.clearAll(),this.app.getService("backend").search(e,t).then((function(e){for(var t=0;t<e.length;++t)"number"==typeof e[t].date&&(e[t].date=new Date(1e3*e[t].date));r.parse(e),i.GetSearchStats(e)}))):r.data.url!==e&&(r.clearAll(),this.app.getService("local").files(e).then((function(e){i.RenderData(e),i.SelectActive()}))),this._Track=!0},t.prototype.MoveFiles=function(e,t){return this.app.getService("operations").move(e,this.GetTargetFolder(t)),!1},t.prototype.Icon=function(e){return'<img class="webix_fmanager_file-type-icon" src="'+this.app.getService("backend").icon(e)+'" />'},t.prototype.DragMarker=function(e){var t=this.WTable,i=t.find((function(e){return".."===e.value}),!0);if(i){var r=e.source.indexOf(i.id);-1!==r&&e.source.splice(r,1)}var n=e.source.length;if(!n)return!1;1===n&&t.select(e.source[0]);var o=t.getItem(e.source[0]),a="<div class='webix_fmanager_grid_drag_zone_list'>";if(a+='<div class="webix_fmanager_inner_drag_zone_list">'+("folder"===o.type?z:this.Icon(o))+o.value+"</div>",a+="</div>",n>1){a="<div class='webix_drag_main'>"+a+"</div>";var s="<div class='webix_drag_multiple'></div>";n>2&&(s="<div class='webix_drag_multiple_last'></div>"+s),a=s+(a+="<div class='webix_badge'>"+n+"</div>")}e.html=a},t.prototype.AddHotkeys=function(){var e=this,t=webix.env.isMac?"COMMAND":"CTRL",i=[{key:"DELETE",oper:"delete"},{key:"BACKSPACE",oper:"delete"},{key:t+"+C",oper:"copy"},{key:t+"+X",oper:"cut"},{key:t+"+V",oper:"paste"},{key:t+"+R",oper:"rename"},{key:t+"+O",oper:"open"},{key:t+"+D",oper:"download"},{key:t+"+Alt+O",oper:"locate"}];this.app.config.editor&&i.push({key:t+"+E",oper:"edit"});for(var r=function(t){n.on(W(n.getRoot()),i[t].key,(function(r,n){var o=[i[t].oper];e.app.callEvent("app:action",o),webix.html.preventEvent(n)}))},n=this,o=0;o<i.length;++o)r(o);this.on(W(this.getRoot()),t+"+A",(function(t,i){e.WTable.selectAll(),webix.html.preventEvent(i)}))},t.prototype.GetSearchStats=function(e){var t=e.length,i=e.filter((function(e){return"folder"===e.type}));this.State.searchStats={folders:i?i.length:0,files:t-i.length}},t}(l),K=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.config=function(){var e=this,t=this.getParam("compact",!0),i=webix.skin.$active.listItemHeight<29?{height:151,width:184}:{height:200,width:240};return{view:"dataview",localId:"cards",prerender:t,drag:!t,multiselect:!0,css:"webix_noselect webix_fmanager_cards",template:function(t){return e.CardTemplate(t)},type:r(r({},i),{type:"tiles",templateStart:webix.template('<div\nclass="{common.classname()}" {common.aria()}\nstyle="width: {common.width}px; height: {common.height}px; float: left; overflow: hidden; ">')}),on:{onItemDblClick:function(){return e.Activate(e.GetSelection())},onEnter:function(){return e.Activate(e.GetSelection())},onBeforeDrag:function(t){return e.DragMarker(t)},onBeforeDrop:function(t){return e.MoveFiles(t.source,t.target)}},onClick:{webix_fmanager_card:function(t,i){return e.SelectItem(t,i)},webix_fmanager_menu_icon:function(t){e.Menu.Show(t)}},onContext:{}}},t.prototype.init=function(){this.WTable=this.$$("cards"),e.prototype.init.call(this)},t.prototype.RenderData=function(e){var t=this;this.WTable.sync(e,(function(){return t.WTable.filter((function(e){return".."!==e.value}))}))},t.prototype.CardTemplate=function(e){var t,i,r=this.app.getService("locale")._;if("folder"===e.type)t="<div class=\"webix_fmanager_card_preview\"><span class='webix_icon wxi-folder webix_fmanager_folder_icon'></span></div>",i='<div class="webix_fmanager_card_panel">\n\t\t<span class="webix_fmanager_card_label">'+r("Folder")+'</span>\n\t\t<span class="webix_fmanager_card_name folder">'+e.value+"</span>"+H+"\n\t\t</div>";else{var n=webix.skin.$active.listItemHeight<29?[163,92]:[214,124],o=this.app.getService("backend").previewURL(e,n[0],n[1]);t='<div class="webix_fmanager_card_preview file"><img height="'+n[1]+'" width="'+n[0]+'" src="'+o+'" onerror=\'this.style.display="none"\'/></div>',i='<div class="webix_fmanager_card_panel file">\n\t\t<span class="webix_fmanager_card_name">'+this.Icon(e)+'<span class="file_name_text">'+e.value+"</span></span>"+H+"\n\t\t</div>"}return'<div class="webix_fmanager_card_outer"><div class="webix_fmanager_card" webix_l_id="'+e.id+'">'+(t+i)+"</div></div>"},t.prototype.SelectItem=function(e,t){var i,r=this.WTable,n=e.ctrlKey||e.metaKey,o=e.shiftKey,a=r.getSelectedId(!0);if(a.length&&o){var s=r.getIndexById(a[a.length-1]),c=r.getIndexById(t);if(s===c)return;s>c&&(s=(i=[c,s])[0],c=i[1]);var u=r.data.order.slice(s,c+1);r.select(u,!0)}else r.isSelected(t)&&n?r.unselect(t):r.select(t,n)},t}(q);webix.protoUI({name:"codemirror-editor",defaults:{mode:"javascript",lineNumbers:!0,matchBrackets:!0,theme:"default"},$init:function(e){this.$view.innerHTML="<textarea style='width:100%;height:100%;'></textarea>",this._textarea=this.$view.firstChild,this._waitEditor=webix.promise.defer(),this.$ready.push(this._render_cm_editor)},complex_types:{php:{mode:["xml","javascript","css","htmlmixed","clike"]},htmlembedded:{mode:["xml","javascript","css","htmlmixed"],addon:["mode/multiplex"]},htmlmixed:{mode:["xml","javascript","css"]},dockerfile:{addon:["mode/simple"]}},_render_cm_editor:function(){if(!1!==this.config.cdn){var e=this.config.cdn||"https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.48.4/",t=[e+"/codemirror.css",e+"/codemirror.js"],i=this.config.mode?this.config.mode:"javascript",r=this.complex_types[i];r&&(r.mode&&r.mode.forEach((function(i){var r="/mode/"+i+"/"+i+".js";t.push(e+r)})),r.addon&&r.addon.forEach((function(i){var r="/addon/"+i+".js";t.push(e+r)}))),t.push(e+"/mode/"+i+"/"+i+".js"),this.config.theme&&"default"!==this.config.theme&&t.push(e+"/theme/"+this.config.theme+".css"),this.config.matchBrackets&&t.push(e+"/addon/edit/matchbrackets.js"),webix.require(t).then(webix.bind(this._render_when_ready,this)).catch((function(e){console.log(e)}))}else this._render_when_ready},_render_when_ready:function(){this._editor=CodeMirror.fromTextArea(this._textarea,{mode:this.config.mode,lineNumbers:this.config.lineNumbers,matchBrackets:this.config.matchBrackets,theme:this.config.theme}),this._waitEditor.resolve(this._editor),this.setValue(this.config.value),this._focus_await&&this.focus()},_set_inner_size:function(){this._editor&&this.$width&&(this._updateScrollSize(),this._editor.scrollTo(0,0))},_updateScrollSize:function(){var e=this._editor.getWrapperElement(),t=(this.$height||0)+"px";e.style.height=t,e.style.width=(this.$width||0)+"px";var i=this._editor.getScrollerElement();i.style.height!=t&&(i.style.height=t,this._editor.refresh())},$setSize:function(e,t){webix.ui.view.prototype.$setSize.call(this,e,t)&&this._set_inner_size()},setValue:function(e){e||0===e||(e=""),this.config.value=e,this._editor&&(this._editor.setValue(e),this.config.preserveUndoHistory||this._editor.clearHistory(),this._updateScrollSize())},getValue:function(){return this._editor?this._editor.getValue():this.config.value},focus:function(){this._focus_await=!0,this._editor&&this._editor.focus()},getEditor:function(e){return e?this._waitEditor:this._editor},undo:function(){this._editor.undo()},redo:function(){this._editor.redo()},undoLength:function(){return this._editor.historySize().undo}},webix.ui.view);var J={css:["css","less"],go:["go"],htmlmixed:["html","xml","svg"],javascript:["js","mjs","json","ts"],markdown:["md"],php:["php","phtml","php3","php4","php5","php7","php-s","pht","phar"],python:["py","pyc","pyd","pyo","pyw","pyz"],sql:["sql","sqlite3","sqlite","db"],yaml:["yaml","yml"],shell:["sh"]},X=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.config=function(){var e=this,t=this.app.getService("locale")._;this.File=this.getParam("file");var i=this.GetFileType(this.File);return{type:"wide",rows:[{view:"toolbar",padding:{left:28,right:4},cols:[{view:"button",localId:"saveBtn",type:"icon",label:t("Save"),icon:"wxi-check",css:"webix_primary webix_fmanager_editor_save",width:90,hotkey:"Ctrl+S",click:function(){return e.Save()}},{width:10},{view:"label",label:" ",localId:"name"},{},{view:"icon",icon:"wxi-close",hotkey:"esc",click:function(){return e.Confirm()}}]},{view:"codemirror-editor",localId:"editor",mode:i}]}},t.prototype.init=function(){var e=this;this.$$("name").setValue(this.File.id);var t=this.$$("editor");webix.extend(t,webix.ProgressBar),t.showProgress({type:"top"}),this.app.getService("operations").read(this.File.id).then((function(i){e._oldValue=i,t.getEditor(!0).then((function(){t.setValue(i)}))})).finally((function(){t.hideProgress()})),t.getEditor(!0).then((function(i){i.on("changes",(function(){return e.TextChanged(t)}))}))},t.prototype.Back=function(){this.show("/top",{params:{state:this.getParam("state")}})},t.prototype.Confirm=function(){var e=this,t=this.app.getService("locale")._;this._changed?webix.confirm({text:t("Are you sure you want to exit without saving?")}).then((function(){return e.Back()})):this.Back()},t.prototype.Save=function(){var e=this.$$("editor").getValue();this.app.getService("operations").write(this.File.id,e),this._oldValue=e,this.ChangeTextState(!1)},t.prototype.GetFileType=function(e){if("Dockerfile"===e.value)return"dockerfile";if(e.$ext)for(var t in J)if(-1!==J[t].indexOf(e.$ext))return t;return"htmlmixed"},t.prototype.TextChanged=function(e){var t=e.getValue()==this._oldValue;this.ChangeTextState(!t)},t.prototype.ChangeTextState=function(e){if(e!==!!this._changed){this._changed=e;var t=this.$$("saveBtn");t.config.icon=e?"webix_fmanager_icon fmi-circle":"wxi-check",t.refresh()}},t}(l);function Y(e){var t=e.value.lastIndexOf(".");t>-1?e.setSelectionRange(0,t):e.select()}function Z(e){return e>=1e9?(e/1e9).toFixed(1)+" Gb":e>=1e6?(e/1e6).toFixed(1)+" Mb":e>=1e3?(e/1e3).toFixed(1)+" kb":e+" b"}function Q(e){return e.length?e[e.length-1]:{type:"empty",value:"Nothing is selected"}}function ee(e){for(e=e.replace(/[/\\:*?"<>|]/g,"").trim();"."===e[0];)e=e.substr(1).trim();return e}function te(e){return e?e.charAt(0).toUpperCase()+e.slice(1):""}function ie(e){var t=new webix.promise.defer,i=webix.ui({view:"window",css:"webix_fmanager_prompt",modal:!0,move:!0,head:{view:"toolbar",padding:{left:12,right:4},borderless:!0,elements:[{view:"label",label:e.text},{view:"icon",icon:"wxi-close",hotkey:"esc",click:function(){t.reject("prompt cancelled"),i.close()}}]},position:e.master?"":"center",body:{view:"form",padding:{top:0,left:12,right:12,bottom:12},rows:[{margin:10,cols:[{view:"text",name:"name",value:e.value,width:230,validate:ee,css:"webix_fmanager_prompt_input"},{view:"button",value:e.button,css:"webix_primary",width:100,hotkey:"enter",click:function(){var e=this.getTopParentView(),i=e.getBody();if(i.validate()){var r=i.getValues().name;t.resolve(r),e.close()}else webix.UIManager.setFocus(i)}}]}]},on:{onShow:function(){var t=this.getBody().elements.name.getInputNode();t.focus(),e.selectMask?e.selectMask(t):t.select()}}}),r=e.master?{x:50}:null;return webix.delay((function(){return i.show(e.master,r)})),t}var re,ne=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.config=function(){var e=this,t=this.app.getService("locale")._;return{view:"popup",width:198,body:{view:"menu",autoheight:!0,layout:"y",css:"webix_fmanager_add_new_menu",data:[{id:"makefile",value:t("Add new file"),icon:"webix_fmanager_icon fmi-file-plus-outline"},{id:"makedir",value:t("Add new folder"),icon:"webix_fmanager_icon fmi-folder-plus-outline"},{id:"upload",value:t("Upload file"),icon:"webix_fmanager_icon fmi-file-upload-outline"}],on:{onMenuItemClick:function(t){if("makefile"===t||"makedir"===t){var i=e.app.getService("locale")._;ie({text:i("Enter a new name"),button:i("Add"),selectMask:Y,value:"New "+("makefile"===t?"file.txt":"folder")}).then((function(i){e.app.callEvent("app:action",[t,ee(i)])}))}else e.app.callEvent("app:action",[t]);e.getRoot().hide()}}}}},t.prototype.Show=function(e){this.getRoot().show(e,{x:20})},t}(l),oe=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.config=function(){var e=this,t=this.app.getService("locale")._;return{view:"proxy",body:{rows:[{view:"button",value:t("Add New"),inputWidth:210,css:"webix_primary",align:"center",click:function(){this.$scope.Menu.Show(this.$view)}},{view:"tree",localId:"tree",css:"webix_fmanager_tree",select:!0,drag:"target",type:{template:function(e,i){return""+i.icon(e)+i.folder(e)+" <span>"+(1===e.$level?t(e.value):e.value)+"</span>"},folder:function(e){return"<div class='webix_icon wxi-"+(e.icon||"folder")+"'></div>"}},borderless:!0,on:{onBeforeDrop:function(t){return e.MoveFiles(t.source,t.target)},onBeforeContextMenu:function(t){if(".."===t.substr(0,2))return!1;e.Tree.select(t)}}},{localId:"fs:stats",borderless:!0,height:68,css:"webix_fmanager_fsstats",template:function(e){return"<svg viewBox='0 0 100 10'>\n\t\t\t\t<rect y='1' rx='2' ry='2' width='100' height='4' style='fill:#DFE2E6;' />\n\t\t\t\t<rect y='1' rx='2' ry='2' width='"+(Math.floor(e.used/e.total*100)||0)+"' height='4' style='fill:"+webix.skin.$active.timelineColor+';\' />\n\t\t\t\tSorry, your browser does not support inline SVG.\n\t\t\t\t</svg><div class="webix_fmanager_fsstats_label">'+Z(e.used||0)+" "+t("of")+" "+Z(e.total||0)+" "+t("used")+"</div>"}}],padding:{top:8,bottom:4}}}},t.prototype.init=function(){var e=this;this.State=this.getParam("state"),this.Tree=this.$$("tree"),this.Ready=this.app.getService("local").folders().then((function(t){e.Tree.sync(t),e.Subscribe(),e.GetFsStats()})),this.Menu=this.ui(ne),this.ContextMenu=this.ui(new(this.app.dynamic(G))(this.app,"",{compact:!1,tree:!0})),this.ContextMenu.AttachTo(this.Tree,(function(t){var i=e.Tree.locate(t);return i?[e.Tree.getItem(i)]:null}))},t.prototype.Subscribe=function(){var e=this;this.Tree.attachEvent("onAfterSelect",(function(){var t=e.Tree.getSelectedId();".."==t.substr(0,2)?e.State.$batch({source:t.slice(3),path:"/"}):e.State.$batch({source:e.GetRootId(t).slice(3),path:t})})),this.on(this.State.$changes,"path",(function(t){if(e.State.path=t,e.Tree.exists(t)){e.Tree.select(t);var i=e.Tree.getParentId(t);i&&e.Tree.open(i),e.Tree.showItem(t)}else e.Tree.select("../"+e.State.source)}))},t.prototype.GetFsStats=function(){var e=this;this.app.getService("backend").getInfo().then((function(t){e.$$("fs:stats").setValues(t.stats)}))},t.prototype.MoveFiles=function(e,t){return"../files"===t&&(t="/"),this.app.getService("operations").move(e,t),!1},t.prototype.GetRootId=function(e){for(var t;e;)t=e,e=this.Tree.getParentId(e);return t},t}(l),ae=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.config=function(){var e=this,t=this.app.getService("locale")._,i=this.getParam("compact",!0),r={view:"datatable",localId:"table",css:"webix_noselect webix_header_border webix_fmanager_filelist",select:"row",multiselect:!0,drag:!0,resizeColumn:{headerOnly:!0},sort:"multi",type:{backIcon:function(){return"<span class='webix_icon wxi-angle-double-left webix_fmanager_back_icon'></span>"},backLabel:function(){return t("back to parent folder")}},on:{onItemDblClick:function(){return e.Activate(e.GetSelection())},onEnter:function(){return e.Activate(e.GetSelection())},onBeforeDrag:function(t){return e.DragMarker(t)},onBeforeDrop:function(t){return e.MoveFiles(t.source,t.target)},onBeforeSort:function(e,t){return re="asc"===t?1:-1}},columns:[{id:"value",header:"",template:function(t){return e.NameTemplate(t)},sort:se("value"),fillspace:!0},{id:"size",header:t("Size"),template:function(e){return"folder"!==e.type?Z(e.size):""},sort:se("size")},{id:"date",header:t("Date"),sort:se("date"),format:function(e){return e instanceof Date&&!isNaN(e)?webix.i18n.longDateFormatStr(e):""},width:150}]};return i&&r.columns.splice(1,2),r},t.prototype.init=function(){var t=this;this.WTable=this.$$("table"),e.prototype.init.call(this),this.on(this.State.$changes,"isActive",(function(e){e?(t.SelectActive(),webix.delay((function(){return webix.UIManager.setFocus(t.WTable)}))):(t._Track=!1,t.WTable.unselect(),t._Track=!0)})),this.on(this.State.$changes,"file",(function(e){e&&t.WTable.exists(e)&&t.WTable.select(e,!0)})),this.on(W(this.getRoot()),"TAB",(function(){t.getParam("trackActive",!0)&&(t.State.isActive=!1)}))},t.prototype.RenderData=function(e){this.WTable.sync(e)},t.prototype.NameTemplate=function(e){return"folder"===e.type?z+e.value:this.Icon(e)+'<span class="file-name">'+e.value+"</span>"},t}(q);function se(e){return function(t,i){return".."===t.value||"folder"===t.type&&"folder"!==i.type?-1*re:".."===i.value||"folder"===i.type&&"folder"!==t.type?1*re:t[e]<i[e]?-1:t[e]>i[e]?1:0}}var ce=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.config=function(){return{view:"window",head:!1,fullscreen:!0,body:{$subview:!0,branch:!0,name:"preview"}}},t.prototype.IsVisible=function(){return this.getRoot().isVisible()},t.prototype.Show=function(e){this.show("preview",{target:"preview",params:{state:e.state,compact:!0}}),this.getRoot().show()},t.prototype.Hide=function(){this.show("_blank",{target:"preview"}),this.getRoot().hide()},t}(l),ue=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.config=function(){return{view:"sidemenu",width:300,state:function(e){var t=webix.skin.$active.toolbarHeight+14;e.top=t,e.height-=t},body:oe}},t.prototype.IsVisible=function(){return this.getRoot().isVisible()},t.prototype.Show=function(){this.getRoot().show()},t}(l),le=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.config=function(){return{type:"wide",cols:[{$subview:!0,branch:!0,name:"left"},{view:"resizer"},{$subview:!0,branch:!0,name:"right"}]}},t.prototype.init=function(){this.State=this.getParam("state");var e=O({selectedItem:[].concat(this.State.selectedItem),path:this.State.path,source:this.GetSource("left"),mode:"list",isActive:!0}),t=O({selectedItem:[],path:this.State.path,source:this.GetSource("right"),mode:"list",isActive:!1});this._TrackChanges(e,t),this._TrackChanges(t,e),this.show("panel/list",{target:"left",params:{trackActive:!0,state:e}}),this.show("panel/list",{target:"right",params:{trackActive:!0,state:t}})},t.prototype._TrackChanges=function(e,t){var i=this;this.on(e.$changes,"path",(function(e){return i.State.path=e})),this.on(e.$changes,"source",(function(e){return i.State.source=e})),this.on(e.$changes,"selectedItem",(function(t){e.isActive&&(i.State.selectedItem=t)})),this.on(e.$changes,"isActive",(function(r){r&&i.State.$batch({path:e.path,source:e.source}),t.isActive=!r})),this.on(this.app,"pathChanged",(function(t,i){e.path===t&&(e.path=i)}))},t.prototype.GetSource=function(){return this.State.source},t}(l),pe=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.config=function(){var e=this;this.State=this.getParam("state");var t=this.app.getService("locale")._;return{rows:[{view:"toolbar",cols:[{view:"icon",icon:"wxi-angle-left",click:function(){e.State.$batch({search:"",searchStats:null})}},{localId:"header",type:"header",borderless:!0,css:"webix_fmanager_path",template:function(i){var r=t("Search results in"),n=e.app.getService("backend").getRootName(),o="";return i&&i.path&&"/"!==i.path&&(o=webix.template.escape(i.path)),r+" "+n+o}},{}]},{$subview:!0,params:{state:this.State}}]}},t.prototype.init=function(){this.$$("header").setValues({path:this.State.path})},t.prototype.ready=function(){var e=this;this.on(this.State.$changes,"search",(function(t){(t=t.trim())&&(e.State.selectedItem=[]),e.getSubView().LoadData(e.State.path,t)}))},t}(l),he=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.config=function(){var e=this;return{rows:[{view:"toolbar",paddingX:4,cols:[{view:"icon",icon:"wxi-sync",css:"webix_fmanager_spec_icon",tooltip:"Refresh",click:function(){e.app.getService("local").refresh(e.State.path)}},{view:"template",localId:"path",type:"header",borderless:!0,css:"webix_fmanager_path",template:function(t){return e.RenderPath(t)},onClick:{webix_fmanager_path_chunk:function(t){return e.ChangePath(t)}}}]},{$subview:!0,params:{state:this.getParam("state")}}]}},t.prototype.init=function(){var e=this;this.State=this.getParam("state"),this.on(this.State.$changes,"path",(function(t){return e.ProcessPath(t)}));var t=this.app.getService("upload").getUploader();t.addDropZone(this.getRoot().$view),this.on(t,"onBeforeFileDrop",(function(i,r){e.getRoot().$view.contains(r.target)&&(t.config.tempUrlData={id:e.State.path})}))},t.prototype.ProcessPath=function(e){var t=this;this.app.getService("local").folders().then((function(i){var r=["/"];if("/"!==e)for(var n=e.split("/"),o=1,a="";o<n.length;++o)a+="/"+n[o],r.push(i.getItem(a).value);t.$$("path").setValues({path:r})}))},t.prototype.RenderPath=function(e){if(e.path&&e.path.length){var t=this.app.getService("backend").getRootName(),i="";return e.path.forEach((function(r,n){i+='<span class="webix_fmanager_path_chunk" data-path="'+n+'">'+(n?r:t)+"</span>",n<e.path.length-1&&(i+="<span class='webix_icon wxi-angle-right'></span>")})),i}return""},t.prototype.ChangePath=function(e){var t=1*e.target.getAttribute("data-path"),i=this.State.path.split("/");i.splice(t+1,i.length-1);var r=i.join("/")||"/";this.State.path=r},t}(l),fe=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.config=function(){var e=this,t=this.app.getService("locale")._,i=webix.Date.dateToStr("%M %j, %Y&nbsp;&nbsp;&nbsp;&nbsp;%H:%i:%s"),r={css:"webix_fmanager_preview_info",localId:"info",borderless:!0,autoheight:!0,template:function(t){if(!t.id)return"";var r=e.app.getService("locale")._;return"<div><div class='key_col'>"+("folder"===t.type?["Type","Date"]:["Type","Size","Date"]).map((function(e){return"<div class='key_value_cell''>"+r(e)+"</div>"})).join("")+'</div><div class="value_col">'+("folder"===t.type?[te(r(t.type)),i(t.date)]:[te(r(t.type)),Z(t.size),i(t.date)]).map((function(e){return"<div class='key_value_cell'>"+e+"</div>"})).join("")+"</div></div>"}},n={css:"webix_fmanager_preview_info extra",localId:"extra:info",hidden:!0,autoheight:!0,template:function(e){for(var t=Object.keys(e),i="<div class='key_col'>",r=0;r<t.length;++r)i+="<div class='key_value_cell key'>"+t[r]+"</div>";i+="</div>";var n="<div class='value_col'>";for(var o in e){var a=e[o].trim();n+="<div class='key_value_cell'>"+(a&&"0"!=a?a:"<span class='webix_fmanager_id3tags-unknown'>Unknown</span>")+"</div>"}return'<div><div class="webix_fmanager_info_header">\n<span class="webix_fmanager_icon fmi-information-outline"></span>\n<span class="webix_fmanager_info_title">Extra info</span>\n</div>'+i+(n+="</div>")+"</div>"}},o={localId:"search:counter",css:"webix_fmanager_preview_info",height:104,borderless:!0,template:function(e){return"<div><div class='key_col search'>"+[t("Folders"),t("Files")].map((function(e){return"<div class='key_value_cell''>"+t(e)+"</div>"})).join("")+'</div><div class="value_col search">'+[e.folders,e.files].map((function(e){return"<div class='key_value_cell'>"+e+"</div>"})).join("")+"</div></div>"}};return{localId:"info:tabs",view:"tabview",css:"webix_fmanager_info_tab",cells:[{header:t("Information"),body:{view:"scrollview",body:{padding:14,margin:14,rows:[r,n,{}]}}},{header:t("Search results"),body:{padding:14,margin:14,rows:[o,{}]}}]}},t.prototype.init=function(){var e=this;this.Tabview=this.$$("info:tabs"),this.State=this.getParam("state"),this.on(this.State.$changes,"selectedItem",(function(t){e.ShowInfo(Q(t))})),this.on(this.State.$changes,"searchStats",(function(t){t?e.$$("search:counter").setValues(t):e.State.selectedItem.length||e.Tabview.hide()}))},t.prototype.ShowInfo=function(e){var t=this,i=this.Tabview.getTabbar(),r=i.config.options[0].id,n=i.config.options[1].id;if("empty"!==e.type){this.SetInfo(this.$$("info"),e),this.SwitchTabs(i,n,r);var o=this.$$("extra:info"),a=this.app.getService("backend").getMeta(e);a?a.then((function(e){return t.SetExtraInfo(o,e)})).fail((function(){return o.hide()})):o.hide()}else this.State.search?this.SwitchTabs(i,r,n):this.Tabview.hide()},t.prototype.SetExtraInfo=function(e,t){!function e(t){for(var i in t){if("object"==typeof t[i])return e(t[i]);if(t[i]&&"0"!==t[i])return!1}return!0}(t)?this.SetInfo(e,t):e.hide()},t.prototype.SetInfo=function(e,t){e.setValues(t),e.show()},t.prototype.SwitchTabs=function(e,t,i){e.hideOption(t),e.setValue(i),e.showOption(i),this.Tabview.show()},t}(l),de=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.config=function(){var e=this,t=this.app.getService("locale")._,i=this.getParam("compact");return{type:"wide",margin:10,rows:[{minHeight:453,rows:[{view:"toolbar",localId:"toolbar",height:webix.skin.$active.toolbarHeight+2,padding:{right:6},elements:[{view:"label",localId:"filename:label",css:"webix_fmanager_preview_name"},{view:"icon",icon:"wxi-download",css:"webix_fmanager_spec_icon",localId:"download",tooltip:t("Download file"),click:function(){e.app.callEvent("app:action",["download",[e.FileInfo]])}},{view:"icon",icon:"wxi-close",hidden:!i,click:function(){return e.app.callEvent("app:action",["toggle-preview"])}}]},{$subview:!0,name:"preview"}]},fe]}},t.prototype.init=function(){var e=this;this.on(this.getParam("state").$changes,"selectedItem",(function(t){var i=Q(t);e.ShowInfo(i),e.FileInfo=i;var r=e.$$("download");"folder"===i.type?r.hide():r.show()}))},t.prototype.ShowInfo=function(e){var t="preview.template";!this.app.config.player||"audio"!==e.type&&"video"!==e.type||(t="preview.media"),"empty"!==e.type?(this.$$("filename:label").setValue(e.value),this.$$("toolbar").show()):this.$$("toolbar").hide(),this.show(t,{target:"preview",params:{info:e}})},t}(l);webix.protoUI({name:"plyr-player",defaults:{config:{},source:{}},$init:function(){this.$view.innerHTML='<div class="webix_player_parent"><audio></audio></div>',this._container=this.$view.firstChild.firstChild,this.$view.style.overflow="visible",this._waitView=webix.promise.defer(),this.$ready.push(this.render)},getPlayer:function(e){return e?this._waitView:this._player},render:function(){if(!1===this.config.cdn||window.Plyr)this._initPlyr();else{var e=this.config.cdn?this.config.cdn:"https://cdn.plyr.io/3.5.10";webix.require([e+"/plyr.js",e+"/plyr.css"]).then(webix.bind(this._initPlyr,this)).catch((function(e){console.log(e)}))}},_initPlyr:function(){if(this.$view){var e=webix.extend({},this.config.config);this._player=new Plyr(this._container,e),this._player.elements.container.setAttribute("tabindex","-1"),this.attachEvent("onDestroy",(function(){this._player&&this._player.destroy()})),this._waitView.resolve(this._player),this._player.on("canplay",webix.bind((function(){this._player.media&&(this._player.media.setAttribute("tabindex","-1"),this._normalizeRatio())}),this)),this._player.on("ready",webix.bind((function(){this.$view&&(this.$view.querySelector(".plyr--full-ui").style["min-width"]="0px",this._normalizeRatio())}),this))}},$setSize:function(e,t){this.$view.firstChild.style.width=e+"px",this.$view.firstChild.style.height=t-2+"px",this._player&&this._normalizeRatio(e,t)},source_setter:function(e){this._waitView.then((function(t){e&&(t.source=e)}))},getPlyr:function(e){return e?this._waitView:this._player},_gcdRatio:function(e,t){for(e=Math.abs(e),t=Math.abs(t);t;){var i=t;t=e%t,e=i}return e},_normalizeRatio:function(e,t){if(this.$view){e=e||this.$view.clientWidth,t=t||this.$view.clientHeight;var i=this._gcdRatio(e,t),r=(e/i).toString()+":"+(t/i).toString();this._player.ratio=r}}},webix.ui.view,webix.EventSystem);var ve=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.config=function(){return{rows:[{localId:"albumArt",hidden:!0,css:"webix_fmanager_preview",template:'<img class="webix_fmanager_preview_icon" src="'+this.app.getService("backend").icon({type:"audio"},"big")+'" />'},{view:"plyr-player",css:"webix_fmanager_player",localId:"player",config:{controls:["play-large","play","progress","current-time","mute","volume"]}}]}},t.prototype.init=function(){var e=this,t=this.$$("albumArt").$view;webix.event(t,"dblclick",(function(){var t=e.getParam("info");e.app.callEvent("app:action",["open",[t]])}))},t.prototype.urlChange=function(){var e=this.getParam("info");this.ShowPreview(e)},t.prototype.ShowPreview=function(e){if(e){var t=this.app.getService("backend").directLink(e.id);this.SetMedia(t,e.type,e.$ext);var i=this.$$("albumArt"),r=this.$$("player");"audio"===e.type?(r.config.height=50,i.show()):(r.config.height=0,i.hide())}},t.prototype.SetMedia=function(e,t,i){this.$$("player").define({source:{type:t,sources:[{src:e,type:t+"/"+i}]}})},t}(l),ge=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.config=function(){return{view:"template",localId:"preview",css:"webix_fmanager_preview"}},t.prototype.init=function(){var e=this,t=this.getRoot().$view;webix.event(t,"dblclick",(function(){var t=e.getParam("info");"code"===t.type&&e.app.config.editor?e.app.callEvent("app:action",["edit",[t]]):"folder"!==t.type&&"empty"!==t.type&&e.app.callEvent("app:action",["open",[t]])}))},t.prototype.urlChange=function(){var e=this.getParam("info");this.ShowPreview(e)},t.prototype.ShowPreview=function(e){var t=this.$$("preview");if("folder"===e.type)t.setHTML('<img class="webix_fmanager_preview_icon" src="'+this.app.getService("backend").icon({type:"folder"},"big")+'" />');else if("empty"===e.type)t.setHTML('<img class="webix_fmanager_preview_icon" src="'+this.app.getService("backend").icon({type:"none"},"big")+'" />');else{var i=this.app.getService("backend").previewURL(e,464,407);t.setHTML("<img style='width:100%; height:100%;' src='"+i+"' onerror='this.style.display=\"none\"'>")}},t}(l),me=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.config=function(){var e=this;return this.Config=this.getParam("config"),{view:"window",position:"center",modal:!0,css:"webix_fmanager_progress",head:{template:this.Config.head,css:"webix_fmanager_progress_head",height:54},body:{padding:{top:0,bottom:20,left:20,right:20},margin:10,rows:[{template:function(e){return'<div class="webix_fmanager_progress_bar">\n<div class="webix_fmanager_progress_counter">'+e.done+" of "+e.total+' items</div>\n<div class="webix_fmanager_progress_name">'+e.file+"</div></div>"},localId:"counter",borderless:!0,height:59},{view:"button",value:"Stop",css:"webix_fmanager_progress_cancel",click:function(){e.State.cancel=!0,e.getRoot().disable()}}]}}},t.prototype.init=function(){var e=this;this.WaitClose=webix.promise.defer(),this.Counter=this.$$("counter"),this.Counter.setValues({done:0,total:this.Config.files.length,file:this.Config.files[0]}),webix.extend(this.Counter,webix.ProgressBar),this.State=O({i:0,cancel:!1}),function e(t,i,r){if(!((r=r||{i:0,cancel:!1}).i>=t.length))return i(t[r.i],r.i).then((function(){if(r.i+=1,!r.cancel)return e(t,i,r)}))}(this.Config.files,this.Config.code,this.State).finally((function(){return e.Close()})),this.on(this.State.$changes,"i",(function(t){return e.Step(t+1)}))},t.prototype.Close=function(){this.Counter.showProgress({type:"bottom",position:1,delay:100}),this.show("_blank",{target:"popup"}),this.WaitClose.resolve()},t.prototype.Step=function(e){var t=this.Counter.getValues().done;this.Counter.setValues({done:e,file:this.Config.files[e-1]},!0),t=(t+1)/this.Config.files.length,this.Counter.showProgress({type:"bottom",position:Math.min(1,t),delay:100})},t}(l);webix.protoUI({name:"r-layout",sizeTrigger:function(e,t,i){this._compactValue=i,this._compactWidth=e,this._compactHandler=t,this._checkTrigger(this.$view.width,i)},_checkTrigger:function(e,t){return!this._compactWidth||!(e<=this._compactWidth&&!t||e>this._compactWidth&&t)||(this._compactWidth=null,this._compactHandler(!t),!1)},$setSize:function(e,t){if(this._checkTrigger(e,this._compactValue))return webix.ui.layout.prototype.$setSize.call(this,e,t)}},webix.ui.layout);var we=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.config=function(){var e=this,t=this.getParam("compact"),i=webix.skin.$active,r=this.app.getService("locale")._;return{view:"toolbar",height:i.toolbarHeight+12,margin:20,paddingY:9,paddingX:12,cols:[{view:"icon",icon:"webix_fmanager_icon fmi-file-tree",click:function(){return e.app.callEvent("app:action",["toggle-folders"])},hidden:!t},{view:"label",label:r("Files"),autowidth:!0,hidden:t},{view:"search",width:t?0:300,localId:"search",placeholder:r("Search files and folders")},{hidden:t},{view:"toggle",css:"webix_fmanager_preview_toggle",type:"icon",icon:"wxi-eye",tooltip:r("Preview"),width:i.toolbarHeight<37?48:60,localId:"previewMode",click:function(){return e.app.callEvent("app:action",["toggle-preview"])},hidden:t},{view:"segmented",width:124,optionWidth:40,localId:"modes",tooltip:function(e){switch(e.id){case"grid":return r("Table");case"cards":return r("Cards");case"double":return r("Total");default:return te(e.id+"")}},options:[{value:"<span class='webix_fmanager_icon fmi-view-list webix_fmanager_mode_icon'></span>",id:"grid"},{value:"<span class='webix_fmanager_icon fmi-view-grid webix_fmanager_mode_icon'></span>",id:"cards"},{value:"<span class='webix_fmanager_icon fmi-view-array webix_fmanager_mode_icon'></span>",id:"double"}]}]}},t.prototype.init=function(){var e=this.getParam("state"),t=this.$$("modes");t.attachEvent("onChange",(function(t){t&&e.$batch({mode:t,search:""})})),this.on(e.$changes,"mode",(function(e){t.getOption(e)?t.setValue(e):t.setValue()}));var i=this.$$("search");i.attachEvent("onTimedKeyPress",(function(){e.search=i.getValue().trim()})),this.on(e.$changes,"search",(function(e){e=e.trim(),i.setValue(e)})),this.on(W(),(webix.env.isMac?"COMMAND":"CTRL")+" + F",(function(e,t){i.focus(),webix.html.preventEvent(t)}))},t}(l),ye=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.config=function(){var e=this.getParam("forceCompact");void 0!==e&&this.setParam("compact",e),this.Compact=this.getParam("compact");var t={view:"proxy",localId:"tree",width:240,hidden:!0,borderless:!0,body:oe},i={type:"wide",cols:[{$subview:!0,name:"center",branch:!0},{view:"proxy",borderless:!0,width:470,hidden:!0,localId:"r-side",body:{$subview:"",branch:!0,name:"r-side"}}]};return this.Compact||i.cols.unshift(t),{view:void 0===e?"r-layout":"layout",type:"wide",rows:[we,i,{$subview:!0,popup:!0,name:"popup"}]}},t.prototype.init=function(){var e=this,t=this.getRoot();t.sizeTrigger&&t.sizeTrigger(640,(function(t){return e.SetCompactMode(t)}),!!this.Compact);var i=this.getParam("state");this.State=i,this.Compact?(this.Tree={show:be,hide:be},this.SideTree=this.ui(ue),this.PreviewPopup=this.ui(ce)):this.Tree=this.$$("tree"),this.on(this.app,"app:action",(function(t){switch(t){case"toggle-preview":e.TogglePreview();break;case"toggle-folders":e.ToggleFolders()}})),this.on(i.$changes,"mode",(function(t,i){return e.ShowMode(t,i)})),this.on(i.$changes,"search",(function(t){return e.ShowSearch(t)})),this.app.getService("progress").handle(this.getRoot(),this.ShowProgress.bind(this))},t.prototype.ShowMode=function(e,t){var i={state:this.getParam("state"),compact:this.Compact};"grid"===e?(this.Tree.show(),this.show("panel/list",{target:"center",params:i})):"cards"===e?(this.Tree.show(),this.show("panel/cards",{target:"center",params:i})):"double"===e?(this.Tree.hide(),this.show("panel-double",{target:"center",params:i})):"search"===e&&(this.Tree.hide(),this.PrevMode=this.PrevMode||t,this.show("panel-search/cards",{target:"center",params:i}))},t.prototype.ShowProgress=function(e){var t=this;return this.show("./progress",{target:"popup",params:e}).then((function(){return t.getSubView("popup")}))},t.prototype.TogglePreview=function(){if(this.Compact)this.PreviewPopup.IsVisible()?this.PreviewPopup.Hide():this.PreviewPopup.Show({state:this.State});else{var e=this.$$("r-side");e.isVisible()?(this.show("_blank",{target:"r-side"}),e.hide()):(this.show("preview",{target:"r-side",params:{state:this.State}}),e.show())}},t.prototype.ToggleFolders=function(){this.SideTree.IsVisible()||this.SideTree.Show()},t.prototype.ShowSearch=function(e){e?this.State.mode="search":("search"===this.State.mode&&(this.State.mode=this.PrevMode||"grid"),this.PrevMode="")},t.prototype.SetCompactMode=function(e){this.setParam("compact",e),this.refresh()},t}(l);function be(){}var _e={JetView:l};_e.cards=K,_e.editor=X,_e.folders=oe,_e.list=ae,_e["menus/addnewmenu"]=ne,_e["menus/contextmenu"]=G,_e["menus/menubody"]=N,_e["mobile/previewpopup"]=ce,_e["mobile/sidetree"]=ue,_e["panel-double"]=le,_e["panel-search"]=pe,_e.panel=he,_e.preview=de,_e["preview/info"]=fe,_e["preview/media"]=ve,_e["preview/template"]=ge,_e.progress=me,_e["sections/dataview"]=q,_e.top=ye,_e.topbar=we;var xe=function(){function e(e,t){this.app=e,this._url=t,this._features={preview:{},meta:{}}}return e.prototype.url=function(e){return this._url+e},e.prototype.search=function(e,t){return e=e||"/",this._files(e,this.url("files?id="+encodeURIComponent(e)+"&search="+encodeURIComponent(t)))},e.prototype.files=function(e){return e=e||"/",this._files(e,this.url("files?id="+encodeURIComponent(e)))},e.prototype._files=function(e,t){var i=webix.ajax(t).then((function(e){return e.json()}));return this.getInfo().then((function(){return i}))},e.prototype.folders=function(){return webix.ajax(this.url("folders")).then((function(e){return e.json()}))},e.prototype.icon=function(e,t){return this.url("icons/"+(t||"small")+"/"+e.type+"/"+e.$ext+".svg")},e.prototype.upload=function(){return this.url("upload")},e.prototype.readText=function(e){return webix.ajax(this.url("text?id="+encodeURIComponent(e))).then((function(e){return e.text()}))},e.prototype.writeText=function(e,t){return webix.ajax().post(this.url("text"),{id:e,content:t}).then((function(e){return e.json()}))},e.prototype.directLink=function(e,t){return this.url("direct?id="+encodeURIComponent(e)+(t?"&download=true":""))},e.prototype.previewURL=function(e,t,i){return this._features.preview[e.type]?this.url("preview?width="+t+"&height="+i+"&id="+encodeURIComponent(e.id)):this.icon(e,"big")},e.prototype.remove=function(e){return webix.ajax().post(this.url("delete"),{id:e}).then((function(e){return e.json()}))},e.prototype.makedir=function(e,t){return webix.ajax().post(this.url("makedir"),{id:e,name:t}).then((function(e){return e.json()}))},e.prototype.makefile=function(e,t){return webix.ajax().post(this.url("makefile"),{id:e,name:t}).then((function(e){return e.json()}))},e.prototype.copy=function(e,t){return webix.ajax().post(this.url("copy"),{id:e,to:t}).then((function(e){return e.json()}))},e.prototype.move=function(e,t){return webix.ajax().post(this.url("move"),{id:e,to:t}).then((function(e){return e.json()}))},e.prototype.rename=function(e,t){return webix.ajax().post(this.url("rename"),{id:e,name:t}).then((function(e){return e.json()}))},e.prototype.getRootName=function(){return(0,this.app.getService("locale")._)("My Files")},e.prototype.getMeta=function(e){return!!this._features.meta[e.type]&&webix.ajax(this.url("meta"),{id:e.id}).then((function(e){return e.json()}))},e.prototype.getInfo=function(e){var t=this;return this._info&&!e?this._info:this._info=webix.ajax(this.url("info")).then((function(e){return e=e.json(),t._features=e.features,e}))},e}(),Se=function(){function e(e){this._store=new Map,this._limit=e,this._i=1}return e.prototype.each=function(e){this._store.forEach((function(t){return e(t.obj)}))},e.prototype.set=function(e,t){this._store.size>=this._limit&&this.prune(),this._store.set(e,{obj:t,key:e,t:this._i++})},e.prototype.get=function(e){var t=this._store.get(e);return t?(t.t=this._i++,t.obj):null},e.prototype.prune=function(){var e=[];this._store.forEach((function(t){return e.push(t)})),e=e.sort((function(e,t){return e.t>t.t?-1:1}));for(var t=Math.floor(this._limit/2);t<e.length;t++)this._store.delete(e[t].key)},e.prototype.delete=function(e){this._store.has(e)&&this._store.delete(e)},e.prototype.clear=function(){this._store.clear()},e}(),ke=function(){function e(e,t){this.app=e,this.fscache=new Se(t),this.hierarchy=new webix.TreeCollection,this.folders_ready=null}return e.prototype.defaultDir=function(e){var t=[];return"/"!==e&&t.push({type:"folder",value:"..",$row:function(e,t){return t.backIcon()+"<span class='webix_fmanager_back'>"+t.backLabel()+"</span>"}}),t},e.prototype.files=function(e,t){var i=this.fscache.get(e);return t?i:i?Promise.resolve(i):(i=new webix.DataCollection({scheme:{$change:this.prepareData,$serialize:this.serializeData}}),this.fscache.set(e,i),this.reload(i,e))},e.prototype.serializeData=function(e){if(".."==e.value)return!1;var t={};for(var i in e)0!==i.indexOf("$")&&(t[i]=e[i]);return t},e.prototype.prepareData=function(e){"number"==typeof e.date&&(e.date=new Date(1e3*e.date)),"folder"===e.type?e.$css=e.type:e.$ext=function(e){if(!e)return"";var t=e.split(".");return t.length<2?"":t[t.length-1]}(e.value)},e.prototype.reload=function(e,t){var i=this;return this.app.getService("backend").files(t).then((function(r){return e.clearAll(),e.parse(i.defaultDir(t).concat(r)),e}))},e.prototype.refresh=function(e){var t=this.fscache.get(e);if(t)return this.reload(t,e)},e.prototype.addFile=function(e,t){var i=this.fscache.get(e);i&&(i.exists(t.id)||i.add(t,this.getFsPosition(i,t))),"folder"===t.type&&("/"===e&&(e="../files"),this.hierarchy.add(t,null,e))},e.prototype.getFsPosition=function(e,t){if("folder"!==t.type)return-1;var i=e.data;return i.order.findIndex((function(e){return"folder"!==i.getItem(e).type}))},e.prototype.deleteFile=function(e){var t=this.fscache,i=this.hierarchy;t.each((function(t){t&&t.exists(e)&&t.remove(e)})),t.delete(e),i.exists(e)&&i.remove(e)},e.prototype.updateFile=function(e,t,i){var r=this.hierarchy;this.fscache.each((function(r){r&&r.exists(e)&&(r.updateItem(e,t),i&&e!=i&&r.data.changeId(e,i))})),r.exists(e)&&(r.updateItem(e,t),i&&e!=i&&(r.data.changeId(e,i),r.data.each((function(t){-1!==t.id.indexOf(e)&&r.data.changeId(t.id,t.id.replace(e,i))}))))},e.prototype.defaultTree=function(){return[{value:"My Files",id:"../files",open:!0}]},e.prototype.folders=function(e){var t=this,i=this.hierarchy;return!e&&this.folders_ready||(this.folders_ready=this.app.getService("backend").folders().then((function(e){return i.clearAll(),i.parse(t.defaultTree()),i.parse({parent:"../files",data:e}),i}))),this.folders_ready},e}(),$e=function(){function e(e,t){this.initUploader(e),this.initEvents(e,t)}return e.prototype.initEvents=function(e,t){e.attachEvent("app:action",(function(i,r){"upload"==i&&(r=r||t.path||"/",e.getService("upload").fileDialog(r))}))},e.prototype.initUploader=function(e){this.uploader=webix.ui({view:"uploader",apiOnly:!0,upload:e.getService("backend").upload(),on:{onAfterFileAdd:function(e){e.urlData=this.config.tempUrlData},onFileUpload:function(t,i){e.getService("local").addFile(t.urlData.id,i)},onUploadComplete:function(){e.getService("progress").end()}}}),this.uploader.$updateProgress=function(t,i){e.getService("progress").start(i/100)}},e.prototype.getUploader=function(){return this.uploader},e.prototype.fileDialog=function(e){this.uploader.config.tempUrlData={id:e},this.uploader.fileDialog()},e}(),Ce=function(){function e(){this.view=null,this.popup=null}return e.prototype.handle=function(e,t){this.view=e,webix.extend(e,webix.ProgressBar),this.popup=t},e.prototype.start=function(e){var t=this.view;t&&!t.$destructed&&t.showProgress({type:"top",delay:3e3,hide:!0,progress:e||0})},e.prototype.end=function(){var e=this.view;e&&!e.$destructed&&e.hideProgress()},e.prototype.files=function(e,t,i){var r=this;if(t.length)return 1==t.length?(this.start(),i(t[0],0).finally((function(){return r.end()}))):this.popup?this.popup({config:{head:e,files:t,code:i}}).then((function(e){return e.WaitClose})):void 0},e}(),Ie=function(){function e(e,t){this.app=e,this.state=t,this.initEvents()}return e.prototype.backend=function(){return this.app.getService("backend")},e.prototype.local=function(){return this.app.getService("local")},e.prototype.initEvents=function(){var e=this;this.app.attachEvent("app:action",(function(t,i){switch(t){case"open":e.open(i);break;case"download":e.download(i);break;case"edit":e.edit(i);break;case"delete":e.remove(i);break;case"makefile":e.makeFile(i);break;case"makedir":e.makeFolder(i);break;case"rename":e.rename(i);break;case"copy":case"cut":e.addToClipboard(t);break;case"paste":e.paste();break;case"locate":e.goUp(i)}}))},e.prototype.write=function(e,t){var i=this;return this.backend().writeText(e,t).then((function(t){return i.local().updateFile(e,{size:t.size,date:t.date})}))},e.prototype.read=function(e){return this.backend().readText(e)},e.prototype.makeFile=function(e){var t=this,i=this.state.path||"/";this.backend().makefile(i,e).then((function(e){e.invalid||t.local().addFile(i,e)}))},e.prototype.makeFolder=function(e){var t=this,i=this.state.path||"/";this.backend().makedir(i,e).then((function(e){e.invalid||t.local().addFile(i,e)}))},e.prototype.edit=function(e){var t=this.state;e||(e=t.selectedItem);var i=e[0];e.length&&"code"===i.type&&this.app.show("/editor",{params:{file:i,state:t}})},e.prototype.open=function(e){e||(e=this.state.selectedItem);for(var t=0;t<e.length;++t)"folder"!=e[t].type&&window.open(this.backend().directLink(e[t].id),"_blank")},e.prototype.download=function(e){e||(e=this.state.selectedItem),window.open(this.backend().directLink(e[0].id,!0),"_self")},e.prototype.remove=function(e){var t=this,i=this.state;if((e=this.extractIds(e||i.selectedItem)).length){var r=this.app.getService("locale")._;return webix.confirm({title:r("Delete files"),text:this.removeConfirmMessage(i.selectedItem),css:"webix_fmanager_confirm"}).then((function(){return t.app.getService("progress").files(r("Deleting..."),e,(function(e){return t.backend().remove(e).then((function(r){if(!r.invalid){t.local().deleteFile(e),i.path===e&&(i.path="/",t.app.callEvent("pathChanged",[e,"/"]));var n=i.selectedItem.filter((function(t){return t.id!==e}));i.selectedItem=n,i.search&&(i.search=i.search+" ")}}))}))}))}},e.prototype.removeConfirmMessage=function(e){for(var t=this.app.getService("locale")._,i='<div class="question">'+t("Are you sure you want to delete")+" "+(e.length>1?t("these items:"):t("this item:"))+"</div>",r=0,n="&#9679;&nbsp;",o=e.length<6?e.length:5;r<o;++r)i+='<div class="item">'+n+e[r].value+"</div>";return r<e.length&&(i+="<div>"+n+t("and")+" "+(e.length-r)+" "+t("more file(s)")+"</div>"),i},e.prototype.rename=function(e){var t=this,i=this.state,n=e?e[0]:i.selectedItem[0];if(n){var o=this.app.getService("locale")._,a=n.id;ie({text:o("Enter a new name"),button:o("Rename"),value:n.value,selectMask:"folder"!==n.type?Y:null}).then((function(e){(e=ee(e))&&e!==n.value&&t.backend().rename(a,e).then((function(n){t.local().updateFile(a,{value:e},n.id),t.state.path===a&&(t.state.path=n.id,t.app.callEvent("pathChanged",[a,n.id])),i.selectedItem[0].id===a&&(i.selectedItem[0]=r(r({},i.selectedItem[0]),{value:e,id:n.id})),i.search&&(i.search=i.search+" ")}))}))}},e.prototype.copy=function(e,t){var i=this;if(e.length){var r=this.local(),n=this.app.getService("locale")._;return this.app.getService("progress").files(n("Copying..."),e,(function(e){return i.backend().copy(e,t).then((function(e){e.invalid||r.addFile(t,e)}))}))}},e.prototype.move=function(e,t){var i=this;if(e.length&&t){var r=this.local(),n=r.files(t,!0);if(n&&(e=e.filter((function(e){return!n.exists(e)}))),(e=e.filter((function(e){return e!=t}))).length){var o=this.app.getService("locale")._;return this.app.getService("progress").files(o("Moving..."),e,(function(e){return i.backend().move(e,t).then((function(n){n.invalid||(r.deleteFile(e),r.addFile(t,n),i.state.path===e&&(i.state.path=n.id,i.app.callEvent("pathChanged",[e,n.id])))}))}))}}},e.prototype.extractIds=function(e){if(!e.length||"string"==typeof e[0])return e;for(var t=[],i=0;i<e.length;++i)t.push(e[i].id);return t},e.prototype.addToClipboard=function(e){var t=this.extractIds(this.state.selectedItem);t.length&&(this.state.clipboard={files:t,mode:e})},e.prototype.clearClipboard=function(){this.state.clipboard=null},e.prototype.paste=function(){var e=this.state;e.clipboard&&("copy"===e.clipboard.mode?this.copy(e.clipboard.files,e.path):"cut"===e.clipboard.mode&&this.move(e.clipboard.files,e.path),this.clearClipboard())},e.prototype.goUp=function(e){var t=this.state;if(t.search){var i=e?e[0]:t.selectedItem[0];if(!i)return;var r=i.id.split("/"),n="/"+r.slice(1,r.length-1).join("/");t.$batch({search:"",searchStats:null,path:n})}},e}(),Te=function(e){function t(t){var i=this,n=O({mode:t.mode||"grid",selectedItem:[],search:"",searchStats:null,path:t.path||"/",source:t.source||"files",clipboard:null}),o={router:y,version:"7.3.5",debug:!0,start:"/top",params:{state:n,forceCompact:t.compact},editor:!0,player:!0};return(i=e.call(this,r(r({},o),t))||this).setService("backend",new(i.dynamic(xe))(i,i.config.url)),i.setService("local",new(i.dynamic(ke))(i,10)),i.setService("progress",new(i.dynamic(Ce))(i)),i.setService("upload",new(i.dynamic($e))(i,n)),i.setService("operations",new(i.dynamic(Ie))(i,n)),i.use(M,i.config.locale||{lang:"en",webix:{en:"en-US",zh:"zh-CN"}}),i}return i(t,e),t.prototype.dynamic=function(e){return this.config.override&&this.config.override.get(e)||e},t.prototype.require=function(e,t){return"jet-views"===e?_e[t]:"jet-locales"===e?Pe[t]:null},t.prototype.getState=function(){return this.config.params.state},t}(w);webix.protoUI({name:"filemanager",app:Te,getState:function(){return this.$app.getState()},getService:function(e){return this.$app.getService(e)},$init:function(){var e=this.$app.getState();for(var t in e)L(e,this.config,t)}},webix.ui.jetapp);var Fe={Backend:xe,LocalData:ke,Upload:$e,Progress:Ce,Operations:Ie},Pe={en:{Save:"Save",Rename:"Rename",Open:"Open",Edit:"Edit",Delete:"Delete",Folder:"Folder","Add New":"Add New","My Files":"My Files",Size:"Size",Date:"Date","back to parent folder":"back to parent folder",Download:"Download",Type:"Type",Information:"Information",Files:"Files",Table:"Table",Cards:"Cards",Total:"Total","Are you sure ?":"Are you sure ?",Details:"Details","Enter a new name":"Enter a new name",Add:"Add","Select something":"Select something","Download file":"Download file",Preview:"Preview",Refresh:"Refresh","Are you sure you want to exit without saving?":"Are you sure you want to exit without saving?",Copy:"Copy",Cut:"Cut",Paste:"Paste","Deleting...":"Deleting...","Copying...":"Copying...","Moving...":"Moving...",Folders:"Folders","Search results":"Search results","Search results in":"Search results in","Search files and folders":"Search files and folders","Add new file":"Add new file","Add new folder":"Add new folder","Upload file":"Upload file",folder:"folder",file:"file",archive:"archive",audio:"audio",image:"image",video:"video",code:"code",document:"document",of:"of",used:"used","Open item location":"Open item location","Are you sure you want to delete":"Are you sure you want to delete","these items:":"these items:","this item:":"this item:","Delete files":"Delete files",and:"and","more file(s)":"more file(s)"}};e.App=Te,e.locales=Pe,e.services=Fe,e.views=_e,Object.defineProperty(e,"__esModule",{value:!0})}(t)}));(n=o)&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")&&n.default;var a=o.views,s=o.services,c=o.locales,u=o.App;function l(e,t,i){Object.defineProperty(t,i,{get:function(){return e[i]},set:function(t){return e[i]=t}})}var p="<span class='webix_icon wxi-dots webix_fmanager_menu_icon'></span>";function h(e){return{attachEvent:function(t,i){return webix.UIManager.addHotKey(t,i,e),{key:t,handler:i}},detachEvent:function(t){var i=t.key,r=t.handler;return webix.UIManager.removeHotKey(i,r,e)}}}function f(e,t){return"files"===this.State.source?this.app.getService("operations").move(e,this.GetTargetFolder(t)):"trash"===this.State.source&&this.app.callEvent("app:action",["delete",e]),!1}function d(){for(var e=this,t=webix.env.isMac?"COMMAND":"CTRL",i=[{key:"DELETE",oper:"delete",trash:"remove"},{key:"BACKSPACE",oper:"delete",trash:"remove"},{key:t+"+C",oper:"copy"},{key:t+"+X",oper:"cut",trash:"trashed"},{key:t+"+V",oper:"paste",trash:"paste"},{key:t+"+R",oper:"rename"},{key:t+"+O",oper:"open"},{key:t+"+E",oper:"edit"},{key:t+"+D",oper:"download"}],r=function(t){n.on(h(n.getRoot()),i[t].key,(function(r,n){var o="trash"!==e.State.source?i[t].oper:i[t].trash;o&&e.app.callEvent("app:action",[o]),webix.html.preventEvent(n)}))},n=this,o=0;o<i.length;++o)r(o)}function v(){var e=this;this.on(this.State.$changes,"source",(function(t,i){i&&("files"!==e.State.source?(e.State.selectedItem=[],e.LoadData(e.State.path,"",t)):e.LoadData(e.State.path))}))}function g(e){var t=this.State.source;return("files"===t||"trash"===t)&&(e.stateSource=t,this.__proto__.DragMarker.call(this,e))}function m(e){return"trash"!==e.stateSource?this.MoveFiles(e.source,e.target):"trash"!==this.State.source&&void this.app.callEvent("app:action",["restore",e.source,this.GetTargetFolder(e.target)])}function w(e,t,i){var r=this;if(i){this._Track=!1;var n=this.WTable;n.data.url!==e&&(n.clearAll(),this.app.getService("local").files(e,!1,i).then((function(e){r.RenderData(e),r.SelectActive()}))),this._Track=!0}else this.__proto__.LoadData.call(this,e,t)}function y(e){if("trash"!==this.State.source||"/"===e.id){if(!e)return;"folder"===e.type?this.ShowSubFolder(".."===e.value?e.value:e.id):"code"===e.type||"xls"===e.$ext||"xlsx"===e.$ext?this.app.callEvent("app:action",["edit",[e]]):this.app.callEvent("app:action",["open",[e]])}}function b(e){this.__proto__.ShowSubFolder.call(this,e),this.State.source="files"}function _(){var e=this;webix.extend(this.WTable,{$dragMark:function(t){e.WTable._marked&&e.WTable._marked!=t.target&&e.WTable.removeCss(e.WTable._marked,"webix_drag_over"),t.target&&"trash"!==e.State.source?(e.WTable.addCss(t.target,"webix_drag_over"),e.WTable._marked=t.target):"trash"==e.State.source&&t.stateSource&&"trash"!==t.stateSource&&webix.html.addCss(e.WTable.$view,"webix_drag_over")},$dragOut:function(t,i,r){"trash"==e.State.source&&i!==r&&webix.html.removeCss(e.WTable.$view,"webix_drag_over")}},!0)}function x(e){e.MoveFiles=f,e.AddHotkeys=d,e.SourceHandlers=v,e.ShowSubFolder=b,e.Activate=y,e.LoadData=w,e.HandleDrag=g,e.HandleDrop=m,e.DragMark=_}var S=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.config=function(){var t=this;return x(this),this.app.getService("localusers").users().then((function(i){t.Users=i;var r=e.prototype.config.call(t);return r.on.onBeforeDrag=function(e){return t.HandleDrag(e)},r.on.onBeforeDrop=function(e){return t.HandleDrop(e)},r}))},t.prototype.init=function(){e.prototype.init.call(this),this.SourceHandlers(),this.DragMark(),webix.TooltipControl.addTooltip(this.WTable.$view)},t.prototype.RenderData=function(e){var t=this;this.WTable.sync(e,(function(){return t.WTable.filter((function(e){return e.value&&".."!==e.value}))}))},t.prototype.CardTemplate=function(e){var t="";if(e.users&&e.users.length){t="<div class='webix_fmanager_card_shared'>";for(var i=[],r=e.users.length>4?1:0,n=0;n<e.users.length&&(n<3||3===n&&n-e.users.length==-1);++n){var o=this.Users.getItem(e.users[n]);i.push('<img class="shared_user_name user_'+(r+n)+'" webix_tooltip="'+o.name+"<br>("+o.email+')" src="'+this.app.getService("users").avatarUrl(o.id,o.avatar)+'" />')}r&&i.unshift('<span class="shared_user_name user_plus">+'+(e.users.length-3)+"</span>"),t+=i.reverse().join(""),t+="</div>"}var a,s,c=this.app.getService("locale")._,u=e.star&&"trash"!==this.State.source?"<div class='webix_fmanager_star'><span class='webix_docmanager_icon dmi-star'></span></div>":"";if("folder"===e.type)a='<div class="webix_fmanager_card_preview">'+u+"<span class='webix_icon wxi-folder webix_fmanager_folder_icon'></span></div>",s='<div class="webix_fmanager_card_panel">\n\t\t<span class="webix_fmanager_card_label">'+c("Folder")+'</span>\n\t\t<span class="webix_fmanager_card_name folder">'+e.value+"</span>"+p+"\n\t\t</div>";else{var l=webix.skin.$active.listItemHeight<29?[163,92]:[214,124],h=this.app.getService("backend").previewURL(e,l[0],l[1]);a='<div class="webix_fmanager_card_preview file">'+u+('<img height="'+l[1]+'" width="'+l[0]+'" src="'+h+'" onerror=\'this.style.display="none"\'/>')+t+"</div>",s='<div class="webix_fmanager_card_panel file">\n\t\t<span class="webix_fmanager_card_name">'+this.Icon(e)+'<span class="file_name_text">'+e.value+"</span></span>"+p+"\n\t\t</div>"}return'<div class="webix_fmanager_card_outer"><div class="webix_fmanager_card" webix_l_id="'+e.id+'">'+(a+s)+"</div></div>"},t}(a.cards),k=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.config=function(){var t=e.prototype.config.call(this);return t.rows[1]={view:"excelviewer",editable:!0,editaction:"dblclick",css:"webix_data_border",areaselect:!0,header:!1,localId:"editor"},t},t.prototype.init=function(){var e=this;this.$$("name").setValue(this.File.id);var t=this.$$("editor");webix.extend(t,webix.ProgressBar),t.showProgress({type:"top"});var i=this.app.getService("backend").directLink(this.File.id);t.load("binary->"+i,"excel").then((function(){return t.hideProgress()})),this.on(t,"onAfterEditStop",(function(t){t.value!==t.old&&e.ChangeTextState(!0)})),this.on(h(t),"any",(function(){var e=t.getSelectedId();e&&t.edit(e)}))},t.prototype.Save=function(){var e=this,t=this.$$("editor");t.editStop(),webix.toExcel(t,{download:!1,styles:!0,spans:!0,heights:!0,header:!1}).then((function(t){e.app.getService("operations").writeBinary(e.File.id,e.File.value,t),e.ChangeTextState(!1)}))},t}(a.editor),$=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.config=function(){var t=this,i=e.prototype.config.call(this),r=i.body.rows[1];return r.type.folder=function(e){return"<div class='"+("dmi"===(e.icon?e.icon.slice(0,3):"")?"webix_docmanager_icon":"webix_icon")+" "+(e.icon||"wxi-folder")+"'></div>"},r.on.onBeforeDrop=function(e){return t.HandleDrop(e)},i},t.prototype.init=function(){e.prototype.init.call(this),this.DragMark()},t.prototype.DragMark=function(){var e=this;webix.extend(this.Tree,{$dragMark:function(t){if(e.Tree._marked&&e.Tree._marked!=t.target&&e.Tree.removeCss(e.Tree._marked,"webix_drag_over"),t.target){var i="../trash"===t.target&&"trash"!==t.stateSource;0===t.target.indexOf("..")&&"../files"!==t.target&&!i||(e.Tree.addCss(t.target,"webix_drag_over"),e.Tree._marked=t.target)}}},!0)},t.prototype.HandleDrop=function(e){if(!e.target)return!1;"../files"===e.target&&(e.target="/");var t="trash"===e.stateSource;return 0===e.target.indexOf("..")?"../trash"!==e.target||t||this.app.callEvent("app:action",["delete",e.source]):t?this.app.callEvent("app:action",["restore",e.source,e.target]):this.app.getService("operations").move(e.source,e.target),!1},t.prototype.Subscribe=function(){var t=this;e.prototype.Subscribe.call(this),this.on(this.State.$changes,"source",(function(e){"/"===t.State.path&&t.Tree.select("../"+e);var i=t.getRoot().queryView("button");"files"!==e?i.disable():i.enable()}))},t}(a.folders),C=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.config=function(){var t=this;x(this);var i=e.prototype.config.call(this),r=this.app.getService("locale")._;return i.type.backToFiles=function(){return r("back to ")+t.app.getService("backend").getRootName()},i.on.onBeforeDrag=function(e){return t.HandleDrag(e)},i.on.onBeforeDrop=function(e){return t.HandleDrop(e)},i},t.prototype.NameTemplate=function(e){return(e.star&&"trash"!==this.State.source?"<div class='webix_fmanager_star'><span class='webix_docmanager_icon dmi-star'></span></div>":"")+("folder"===e.type?"<span class='webix_icon wxi-folder'></span>"+e.value:this.Icon(e)+'<span class="file-name">'+e.value+"</span>")},t.prototype.init=function(){e.prototype.init.call(this),this.SourceHandlers(),this.DragMark()},t}(a.list),I=function(e){function t(t,i,r){var n=e.call(this,t,i,r)||this;return n.state=r.state,n}return i(t,e),t.prototype.config=function(){var t,i=this.app.getService("locale")._,r=e.prototype.config.call(this),n=[{$template:"Separator",show:32},{id:"favorite",show:161,value:i("Add to favorites"),icon:"dmi-star-outline"},{id:"unfavorite",show:161,value:i("Remove from favorites"),icon:"dmi-star"},{id:"share",value:i("Share"),show:32,icon:"dmi-share"}];return(t=r.data).splice.apply(t,function(){for(var e=0,t=0,i=arguments.length;t<i;t++)e+=arguments[t].length;var r=Array(e),n=0;for(t=0;t<i;t++)for(var o=arguments[t],a=0,s=o.length;a<s;a++,n++)r[n]=o[a];return r}([10,0],n)),r.data=r.data.concat([{id:"restore",value:i("Restore"),show:127,icon:"dmi-delete-restore"},{id:"remove",value:i("Delete from trash"),show:127,icon:"dmi-delete-empty",hotkey:"Del / &#8592;"}]),r.template=function(e){return(e.icon?'<span class="webix_list_icon webix_icon '+e.icon+'"></span>':"")+e.value+(e.hotkey?'<span class="webix_fmanager_context-menu-hotkey">'+e.hotkey+"</span>":"")},r},t.prototype.FilterOptions=function(e){var t=this,i=this.state?this.state.source:null,r=this.getRoot();if(this.Files=e,"trash"!==i){var n=e[0],o=e.length>1,a=["image","audio","video","code","pdf"].find((function(e){return e===n.type||e===n.$ext})),s="code"===n.type||"xls"===n.$ext||"xlsx"===n.$ext,c=this.app.getState().search;this.getRoot().define("width",c&&!o?270:200),this.getRoot().filter((function(e){return!(o&&!(2&e.show)||"folder"===n.type&&!(1&e.show)||4&e.show&&!s||8&e.show&&!a||16&e.show&&!t.compact||32&e.show&&t.tree||64&e.show&&!c||(128&e.show&&n.star?"favorite"===e.id:"unfavorite"===e.id))})),this.FilterCopyPaste(i,r)}else r.define("width",250),r.filter((function(e){return"remove"===e.id||"restore"===e.id}))},t.prototype.FilterCopyPaste=function(e,t){"files"!==e&&t.filter((function(e){return 35^e.show&&33^e.show}),null,!0)},t}(a["menus/menubody"]);var T=[{bg:"#2EADC2",c:"#FFFFFF"},{bg:"#3B3ABB",c:"#FFFFFF"},{bg:"#813EBB",c:"#FFFFFF"},{bg:"#B442A8",c:"#FFFFFF"},{bg:"#B43D64",c:"#FFFFFF"},{bg:"#D25640",c:"#FFFFFF"},{bg:"#DBA10D",c:"#FFFFFF"},{bg:"#7BBD48",c:"#FFFFFF"},{bg:"#5EBD90",c:"#FFFFFF"}],F=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.config=function(){var e=this;this._=this.app.getService("locale")._;var t=this.getParam("compact"),i={localId:"counter",borderless:!0,template:function(t){return t?t.users?e._("Available to")+" "+t.users+" "+e._("user(s)"):e._("No users"):"&nbsp;"},autoheight:!0},r={view:"list",localId:"list",css:"webix_fmanager_shared_list",template:function(t){return e.ListTemplate(t)},type:{height:49},autoheight:!0,onClick:{webix_fmanager_remove_user:function(t,i){return e.RemoveUser(1*i)}}},n={view:"window",position:"center",head:!1,modal:!0,body:{rows:[{padding:{top:6,right:6},cols:[{template:this._("Share File"),height:36,borderless:!0,css:"webix_fmanager_shared_title"},{view:"icon",icon:"wxi-close",css:"webix_fmanager_shared_close",click:function(){return e.Hide()}}]},{borderless:!0,padding:{top:7,right:40,left:40,bottom:40},margin:0,rows:[{height:25},{localId:"users",view:"text",placeholder:this._("Invite someone..."),suggest:{template:"#email#",body:{css:"webix_fmanager_user_list",data:[],template:function(t){return e.InputListTemplate(t)}}}},{height:14},{view:"button",label:this._("Invite"),inputWidth:140,css:"webix_primary",click:function(){return e.Done()}},{height:37},i,r]}]}};return t?(n.fullscreen=!0,r.yCount=0):(n.width=540,r.yCount=4),n},t.prototype.init=function(){var e=this;this.List=this.$$("list"),this.Input=this.$$("users"),this.File=this.getParam("info")[0],webix.extend(this.List,webix.OverlayBox),this.app.getService("localusers").users().then((function(t){e.Data=t;var i=webix.$$(e.Input.config.suggest).getList();i.clearAll(),i.sync(t);var r=e.File.users;r&&r.length&&e.List.parse(r.map((function(e){return t.getItem(e)}))),e.UpdateCounter(r)})),this.Input.focus(),webix.TooltipControl.addTooltip(this.List.$view)},t.prototype.RemoveUser=function(e){var t=this;webix.confirm(this._("Are you sure ?")).then((function(){return t.app.getService("operations").removeUser(t.File,e).then((function(){t.List.remove(e),t.UpdateCounter(t.File.users)}))}))},t.prototype.ClearInput=function(){this.Input.setValue("")},t.prototype.Hide=function(){this.show("_blank",{target:"popup"})},t.prototype.Done=function(){var e=this,t=this.Input.getValue();if(t){var i=this.Data.find((function(e){return e.email===t}),!0);if(i&&!this.List.find((function(e){return e.id===i.id}),!0))return this.app.getService("operations").share(this.File,i.id).then((function(){e.List.add(i),e.List.showItem(i.id),e.ClearInput(),e.UpdateCounter(e.File.users)}));this.ClearInput()}},t.prototype.ListTemplate=function(e){return(e.avatar?'<img class="avatar_img" webix_tooltip="'+e.email+'" src="'+this.app.getService("users").avatarUrl(e.id,e.avatar)+'">':function(e){var t="",i=T[Math.floor(Math.random()*T.length)];"string"!=typeof e&&(e=""),e=e.split(" ");for(var r=0;r<e.length&&t.length<2;r++)e[r]&&(t+=e[r].charAt(0));return'<div class="default_avatar" style="background:'+i.bg+"; color:"+i.c+';">'+(t||"no")+"</div>"}(e.name))+'<span webix_tooltip="'+e.email+'">'+e.name+"</span><span class='webix_fmanager_remove_user webix_icon wxi-trash'></span>"},t.prototype.InputListTemplate=function(e){return e.name+'&nbsp;<span class="webix_fmanager_user_email">'+e.email+"</span>"},t.prototype.UpdateCounter=function(e){this.$$("counter").setValues({users:e?e.length:0}),e&&e.length?webix.html.removeCss(this.List.$view,"no-border"):webix.html.addCss(this.List.$view,"no-border")},t}(a.JetView),P=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.GetSource=function(e){return"left"===e?this.State.source:"files"},t}(a["panel-double"]),D=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.config=function(){var t=this,i=e.prototype.config.call(this);return i.rows[0].cols[0].click=function(){var e="files"!==t.State.source?t.State.source:"";t.app.getService("local").refresh(t.State.path,e)},i},t.prototype.init=function(){var t=this;e.prototype.init.call(this);var i=this.app.getService("upload").getUploader();this.on(i,"onBeforeFileDrop",(function(e,i){if(t.getRoot().$view.contains(i.target)&&"files"!==t.State.source)return!1})),this.on(this.State.$changes,"source",(function(e){return t.ProcessSource(e)}))},t.prototype.ProcessPath=function(t){"/"!==this.State.path&&e.prototype.ProcessPath.call(this,t)},t.prototype.ProcessSource=function(e){var t=this,i=this.app.getService("locale")._;this.app.getService("local").folders().then((function(r){var n=i(r.getItem("../"+e).value);t.$$("path").setValues({source:n})}))},t.prototype.RenderPath=function(t){return t.path?e.prototype.RenderPath.call(this,t):t.source?this.RenderSource(t):""},t.prototype.RenderSource=function(e){return'<span class="webix_fmanager_path_chunk" data-path="0">'+e.source+"</span>"},t}(a.panel),E=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.config=function(){var e=this,t=this.app.getService("users");return this.app.getService("localusers").users().then((function(i){return{localId:"comments",view:"comments",css:"webix_fmanager_comments",mentions:!0,users:i,currentUser:1,scheme:{$init:e.PrepareComments},listItem:{templateAvatar:function(e){var r=i.getItem(e.user_id);return'<div class="webix_comments_avatar"><img class="webix_comments_avatar_image" src="'+t.avatarUrl(r.id,r.avatar)+'" /></div>'}}}}))},t.prototype.init=function(){var e=this;this.Comments=this.$$("comments"),this.on(this.Comments,"onBeforeAdd",(function(t,i){return e.AddComment(i)})),this.on(this.Comments.queryView("list").data,"onDataUpdate",(function(t,i,r){return e.UpdateComment(t,i,r)})),this.on(this.Comments,"onBeforeDelete",(function(t){return e.RemoveComment(t)})),webix.extend(this.Comments.queryView("list"),webix.OverlayBox)},t.prototype.urlChange=function(){var e=this.getParam("file");this.LoadComments(e)},t.prototype.LoadComments=function(e){var t=this;this.File=e,this.app.getService("users").comments(e.id).then((function(e){t.Comments.clearAll(),t.Comments.parse(e),t.ChangeListState()}))},t.prototype.ChangeListState=function(){if(this.Comments.count())this.Comments.queryView("list").hideOverlay();else{var e=this.app.getService("locale")._;this.Comments.queryView("list").showOverlay('<div class="webix_fmanager_overlay">'+e("No comments yet")+"</div>")}},t.prototype.PrepareComments=function(e){e&&"string"==typeof e.date&&(e.date=new Date(e.date))},t.prototype.AddComment=function(e){var t=this;return this.app.getService("users").addComment(this.File.id,e.text).then((function(i){e.id=1*i.id,t.Silently("add",[e]),t.ChangeListState()})),!1},t.prototype.UpdateComment=function(e,t,i){var r=this;this.app.getService("users").updateComment(e,t.text).fail((function(){r.Comments.getItem(e).text=i.text,r.Comments.refresh(e)}))},t.prototype.RemoveComment=function(e){var t=this;return this.app.getService("users").deleteComment(e).then((function(e){t.Silently("remove",[e.id]),t.ChangeListState()})),!1},t.prototype.Silently=function(e,t){var i=this.Comments;i.blockEvent(),i[e].apply(i,t),i.unblockEvent()},t}(a.JetView),j=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.config=function(){var t=this.app.getService("locale")._,i=e.prototype.config.call(this),r=webix.copy(i.rows[0].rows[0]);return i.rows[0].rows.splice(0,1),i.type="line",i.margin=0,{rows:[r,{localId:"tabview",view:"tabview",cells:[{header:t("Preview"),body:i},{header:t("Comments"),body:{$subview:!0,name:"comments"}}]}]}},t.prototype.ShowInfo=function(t){e.prototype.ShowInfo.call(this,t);var i=this.$$("tabview").getTabbar();"empty"===t.type?(i.setValue(i.config.options[0].id),i.hide()):(i.show(),this.show("preview.comments",{target:"comments",params:{file:t}}))},t}(a.preview),R=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.config=function(){var t=this,i=this.app.getService("locale")._,r={css:"webix_fmanager_tags_line",rows:[{view:"label",css:"webix_fmanager_info_title",label:i("Tags")},{cols:[{view:"multicombo",localId:"tags:combo",css:"preview_tags",placeholder:i("Add a tag"),options:{body:{data:[],template:"#name#"}},on:{onItemClick:function(e,i){return t.SearchTag(i.target)}}},{view:"icon",icon:"wxi-plus",click:function(){var e=t.$$("tags:combo");e.getInputNode().click(),e.getList().show(e.$view)}}]}]},n=e.prototype.config.call(this);return n.cells[0].body.body.rows.splice(0,0,r),n},t.prototype.init=function(){var t=this;e.prototype.init.call(this);var i=this.$$("tags:combo");this.on(i,"onChange",(function(e,r){t.File&&t.app.getService("tags").setTags(t.File.id,e.join()).fail((function(){t.SetTagsSilent(i,r)}))}))},t.prototype.ShowInfo=function(t){var i=this;if(e.prototype.ShowInfo.call(this,t),"empty"!==t.type){this.File=t;var r=this.$$("tags:combo"),n=this.app.getService("localtags").tags(),o=this.app.getService("tags").getTags(t.id);webix.promise.all([n,o]).then((function(e){r.getList().parse(e[0]),i.SetTagsSilent(r,e[1])}))}},t.prototype.SetTagsSilent=function(e,t){e.blockEvent(),e.setValue(t),e.unblockEvent()},t.prototype.SearchTag=function(e){var t=this.$$("tags:combo");t.getPopup().hide();var i="webix_multicombo_value"===e.className?e:"webix_multicombo_value"===e.parentNode.className?e.parentNode:null;if(i){var r=i.getAttribute("optvalue");this.getParam("state").search="#"+t.getList().getItem(r).value}},t.prototype.SwitchTabs=function(t,i,r){this.State.search&&!this.State.selectedItem.length?t.show():t.hide(),e.prototype.SwitchTabs.call(this,t,i,r)},t}(a["preview/info"]),A=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.init=function(){var t=this;e.prototype.init.call(this),this.on(this.app,"app:action",(function(e,i){"share"===e&&t.show("./menus.sharepopup",{target:"popup",params:{info:i,compact:t.Compact}})}))},t}(a.top),M=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.config=function(){var t=this,i=e.prototype.config.call(this),r=webix.skin.$active,n=this.app.getService("locale")._;return i.cols.find((function(e){return"previewMode"===e.localId})).icon="dmi-gesture-double-tap",i.cols.splice(5,0,{localId:"emptyTrash",css:"webix_fmanager_empty_trash",view:"button",type:"icon",icon:"dmi-delete-empty",tooltip:n("Empty trash"),width:r.toolbarHeight<37?48:60,hidden:!0,click:function(){return t.app.callEvent("app:action",["remove","all"])}}),i},t.prototype.init=function(){var t=this;e.prototype.init.call(this);var i=this.getParam("state");this.on(i.$changes,"source",(function(e,i){"trash"===e?(t.$$("emptyTrash").show(),t.$$("previewMode").hide()):"trash"===i&&(t.$$("emptyTrash").hide(),t.getParam("compact")||t.$$("previewMode").show())}))},t}(a.topbar),V={};V.cards=S,V.excel=k,V.folders=$,V.list=C,V["menus/menubody"]=I,V["menus/sharepopup"]=F,V["panel-double"]=P,V.panel=D,V["preview/comments"]=E,V.preview=j,V["preview/info"]=R,V.top=A,V.topbar=M;var U=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.files=function(t,i){return i?this._files(t,this.url("files?id="+encodeURIComponent(t)+"&source="+encodeURIComponent(i))):e.prototype.files.call(this,t)},t.prototype.removePermanent=function(e){return webix.ajax().del(this.url("delete?id="+encodeURIComponent(e))).then((function(e){return e.json()}))},t.prototype.restore=function(e,t){return webix.ajax().put(this.url("delete"),{id:e,target:t}).then((function(e){return e.json()}))},t.prototype.favour=function(e){return webix.ajax().post(this.url("favorite"),{id:e}).then((function(e){return e.json()}))},t.prototype.unfavour=function(e){return webix.ajax().del(this.url("favorite?id="+encodeURIComponent(e))).then((function(e){return e.json()}))},t.prototype.writeBinary=function(e,t,i){var r=new FormData;return r.append("upload",i,t),webix.ajax().post(this.url("direct?id="+encodeURIComponent(e)),r).then((function(e){return e.json()}))},t}(s.Backend),L=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.files=function(t,i,r){if(r){var n=this.fscache.get(r);return i?n:n?Promise.resolve(n):(n=new webix.DataCollection({scheme:{$change:this.prepareData,$serialize:this.serializeData}}),this.fscache.set(r,n),this.reload(n,t,r))}return e.prototype.files.call(this,t,i)},t.prototype.refresh=function(e,t){var i=this.fscache.get(t||e);if(i)return this.reload(i,e,t)},t.prototype.reload=function(t,i,r){var n=this;return r?this.app.getService("backend").files(i,r).then((function(e){return t.clearAll(),t.parse(n.backToFiles().concat(e)),t})):e.prototype.reload.call(this,t,i)},t.prototype.backToFiles=function(){return[{type:"folder",id:"/",value:"..",$row:function(e,t){return t.backIcon()+"<span class='webix_fmanager_back'>"+t.backToFiles()+"</span>"}}]},t.prototype.defaultTree=function(){return[{value:"My Files",id:"../files",open:!0},{value:"Favorite",$css:{"margin-top":"20px"},id:"../favorite",icon:"dmi-star"},{value:"Recent",id:"../recent",icon:"dmi-history"},{value:"Shared",id:"../shared",icon:"dmi-share-all"},{value:"Trash",$css:{"margin-top":"20px"},id:"../trash",icon:"wxi-trash"}]},t.prototype.addFile=function(t,i){this.hierarchy.exists(t)||(t="/"),e.prototype.addFile.call(this,t,i)},t}(s.LocalData),O=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.initEvents=function(){var t=this;e.prototype.initEvents.call(this),this.app.attachEvent("app:action",(function(e,i,r){switch(e){case"trashed":t.addToClipboard(e);break;case"restore":t.restore(i,r);break;case"remove":t.removePermanent(i);break;case"favorite":case"unfavorite":t.favour(i)}}))},t.prototype.remove=function(t){var i=this;(t||this.state.selectedItem.length)&&e.prototype.remove.call(this,t).then((function(){i.local().refresh("/","trash")}))},t.prototype.restore=function(e,t){var i=this,r=this.state,n=this.app.getService("locale")._;e||(e=r.selectedItem),e.length&&(e=this.extractIds(e),this.app.getService("progress").files(n("Restoring..."),e,(function(e){return i.backend().restore(e,t).then((function(t){var r=i.local();r.deleteFile(e),r.addFile(i.dir(t.id),t)}))})))},t.prototype.removePermanent=function(e){var t=this,i=this.state,r=this.app.getService("locale")._;if("all"===e?e=this.local().files("/",!0,"trash").serialize():e||(e=i.selectedItem),e.length)return e=this.extractIds(e),webix.confirm(r("Are you sure ?")).then((function(){t.app.getService("progress").files(r("Deleting..."),e,(function(e){return t.backend().removePermanent(e).then((function(i){i.invalid||t.local().deleteFile(e)}))}))}))},t.prototype.addToClipboard=function(t){"files"!==this.state.source&&"trash"!==this.state.source||e.prototype.addToClipboard.call(this,t)},t.prototype.paste=function(){var t=this.state;t.clipboard&&("files"===t.source?"trashed"===t.clipboard.mode?this.restore(t.clipboard.files,t.path):e.prototype.paste.call(this):"trash"===t.source&&"cut"===t.clipboard.mode&&this.remove(t.clipboard.files))},t.prototype.favour=function(e){var t=this,i=e[0],r=!i.star,n=this.backend();(r?n.favour:n.unfavour).call(n,i.id).then((function(e){e.invalid||(t.local().updateFile(e.id,{star:r}),t.local().refresh("/","favorite"))}))},t.prototype.dir=function(e){return e.slice(0,e.lastIndexOf("/"))||"/"},t.prototype.edit=function(e){var t=this.state;e||(e=t.selectedItem);var i,r=e[0];e.length&&("xls"===r.$ext||"xlsx"===r.$ext?i="/excel":"code"===r.type&&(i="/editor"),i&&this.app.show(i,{params:{file:r,state:t}}))},t.prototype.writeBinary=function(e,t,i){var r=this;this.backend().writeBinary(e,t,i).then((function(t){r.local().updateFile(e,{size:t.size,date:t.date})}))},t.prototype.users=function(){return this.app.getService("users")},t.prototype.share=function(e,t){var i=this;return this.users().share(e.id,t).then((function(r){return i.app.getService("local").updateFile(r.id,{users:(e.users||[]).concat(t)})}))},t.prototype.removeUser=function(e,t){var i=this;return this.users().removeUser(e.id,t).then((function(r){return i.app.getService("local").updateFile(r.id,{users:e.users.filter((function(e){return e!==t}))})}))},t}(s.Operations),B=function(){function e(e,t){this._url=t}return e.prototype.url=function(e){return this._url+e},e.prototype.users=function(){return webix.ajax().get(this.url("users/all")).then((function(e){return e.json()}))},e.prototype.avatarUrl=function(e,t){return this.url(""+t.slice(1))},e.prototype.share=function(e,t){return webix.ajax().post(this.url("share"),{id:e,user:t}).then((function(e){return e.json()}))},e.prototype.removeUser=function(e,t){return webix.ajax().del(this.url("share?id="+encodeURIComponent(e)+"&user="+t)).then((function(e){return e.json()}))},e.prototype.comments=function(e){return webix.ajax().get(this.url("comments?id="+encodeURIComponent(e))).then((function(e){return e.json()}))},e.prototype.addComment=function(e,t){return webix.ajax().post(this.url("comments?id="+encodeURIComponent(e)),{value:t}).then((function(e){return e.json()}))},e.prototype.updateComment=function(e,t){return webix.ajax().put(this.url("comments/"+e),{value:t}).then((function(e){return e.json()}))},e.prototype.deleteComment=function(e){return webix.ajax().del(this.url("comments/"+e)).then((function(e){return e.json()}))},e}(),W=function(){function e(e){this.app=e,this.userlist=new webix.DataCollection({scheme:{$change:function(e){e.value=e.name}}}),this.users_ready=null}return e.prototype.users=function(e){var t=this.userlist;return!e&&this.users_ready||(this.users_ready=this.app.getService("users").users().then((function(e){return t.clearAll(),t.parse(e),t}))),this.users_ready},e}(),z=function(){function e(e,t){this._url=t}return e.prototype.url=function(e){return this._url+e},e.prototype.tags=function(){return webix.ajax().get(this.url("tags/all")).then((function(e){return e.json()}))},e.prototype.getTags=function(e){return webix.ajax().get(this.url("tags?id="+encodeURIComponent(e))).then((function(e){return e.json()}))},e.prototype.setTags=function(e,t){return webix.ajax().put(this.url("tags"),{id:e,value:t}).then((function(e){return e.json()}))},e}(),H=function(){function e(e){this.app=e,this.taglist=new webix.DataCollection({}),this.tags_ready=null}return e.prototype.tags=function(e){var t=this.taglist;return!e&&this.tags_ready||(this.tags_ready=this.app.getService("tags").tags().then((function(e){return t.clearAll(),t.parse(e),t}))),this.tags_ready},e}(),N=function(e){function t(t){var i=this,n=new Map([[a.top,V.top],[a.cards,V.cards],[a.folders,V.folders],[a.list,V.list],[a["menus/menubody"],V["menus/menubody"]],[a.panel,V.panel],[a["panel-double"],V["panel-double"]],[a["preview/info"],V["preview/info"]],[a.preview,V.preview],[a.topbar,V.topbar],[s.Backend,G.Backend],[s.LocalData,G.LocalData],[s.Operations,G.Operations]]);return t.override&&t.override.forEach((function(e,t){return n.set(t,e)})),(i=e.call(this,r(r(r({},{version:"7.3.5"}),t),{override:n}))||this).setService("users",new(i.dynamic(B))(i,i.config.url)),i.setService("localusers",new(i.dynamic(W))(i)),i.setService("tags",new(i.dynamic(z))(i,i.config.url)),i.setService("localtags",new(i.dynamic(H))(i)),i}return i(t,e),t.prototype.require=function(e,t){return"jet-views"===e?V[t]:"jet-locales"===e?q[t]:null},t.prototype.dynamic=function(e){var t=this.config.override;if(t){for(var i=void 0;e;)i=e,e=t.get(e);return i}return e},t}(u);webix.protoUI({name:"docmanager",app:N,getState:function(){return this.$app.getState()},getService:function(e){return this.$app.getService(e)},$init:function(){var e=this.$app.getState();for(var t in e)l(e,this.config,t)}},webix.ui.jetapp),webix.extend(V,a);var G={LocalData:L,Backend:U,Operations:O,Users:B,LocalUsers:W,Tags:z,LocalTags:H,Progress:s.Progress,Upload:s.Upload},q={en:webix.extend({Favorite:"Favorite",Recent:"Recent",Shared:"Shared",Trash:"Trash","Add to favorites":"Add to favorites","Remove from favorites":"Remove from favorites",Share:"Share",Tags:"Tags",Comments:"Comments","Can view":"Can view","Can edit":"Can edit","Share File":"Share File","Invite someone...":"Invite someone...",Invite:"Invite",Restore:"Restore","Delete from trash":"Delete from trash","Restoring...":"Restoring...","Empty trash":"Empty trash","back to ":"back to ","Select a user":"Select a user","Add a tag":"Add a tag","No comments yet":"No comments yet","No users":"No users","Available to":"Available to","user(s)":"user(s)"},c.en)};e.App=N,e.locales=q,e.services=G,e.views=V,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=docmanager.min.js.map
