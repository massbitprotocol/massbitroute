server {
    # listen 8001;
    listen unix:/tmp/4dao7542f-e8b4-45a0-b845-c09ba5099fbf-4.sock;
    location / {
        proxy_redirect off;
        proxy_set_header X-Api-Key 95ba6cea-d4c6-4879-9d10-7a5d92838abe;
        proxy_set_header Host eth.getblock.io;
        proxy_pass https://eth.getblock.io/mainnet/;
        proxy_ssl_verify off;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection $connection_upgrade;
    }
}
server {
    # listen 8002;
    listen unix:/tmp/4dao7542f-e8b4-45a0-b845-c09ba5099fbf-3.sock;
    location / {
        proxy_redirect off;
        set_encode_base64 $digest :041976b28753465cacbf1f69da6b8bac;
        proxy_set_header Authorization 'Basic $digest';
        proxy_ssl_verify off;
        proxy_pass https://mainnet.infura.io/v3/273e12fa9a2548a7adee821bfa1c5a72;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection $connection_upgrade;
    }
}
server {
    # listen 8003;
    listen unix:/tmp/4dao7542f-e8b4-45a0-b845-c09ba5099fbf-2.sock;
    location / {
        proxy_redirect off;
        proxy_ssl_server_name on;
        proxy_pass https://patient-blue-sunset.solana-mainnet.quiknode.pro/4f30251f53507f000ac39700f2d07eee9026ae84/;
        proxy_http_version 1.1;
        proxy_ssl_verify off;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection $connection_upgrade;
    }
}
server {
    # listen 8004;
    listen unix:/tmp/4dao7542f-e8b4-45a0-b845-c09ba5099fbf-1.sock;
    location / {
        proxy_redirect off;
        proxy_pass http://194.163.156.242:8899/;
        proxy_http_version 1.1;
        proxy_ssl_verify off;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection $connection_upgrade;
    }
}
upstream upstream_4dao7542f-e8b4-45a0-b845-c09ba5099fbf {
    # server 127.0.0.1:8003 max_fails=3 fail_timeout=15s;
    # server 127.0.0.1:8004 max_fails=3 fail_timeout=15s;
    server unix:/tmp/4dao7542f-e8b4-45a0-b845-c09ba5099fbf-1.sock;
    keepalive 32;
}
server {
    listen 80;
    listen 443 ssl;
    ssl_certificate /etc/letsencrypt/live/massbitroute.com/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/massbitroute.com/privkey.pem;
    resolver 8.8.4.4 ipv6=off;
    client_body_buffer_size 512K;
    client_max_body_size 1G;
    server_name node01-sol-mainnet.massbitroute.com api.massbitroute.local;
    access_log /massbit/massbitroute/app/src/sites/services/gateway/logs/nginx-access.log main_json;
    error_log /massbit/massbitroute/app/src/sites/services/gateway/logs/nginx-error.log debug;
    location /__internal_status_vhost/ {
        vhost_traffic_status_bypass_limit on;
        vhost_traffic_status_bypass_stats on;
        vhost_traffic_status_display;
        vhost_traffic_status_display_format html;
    }
    location / {
        # location /4dao7542f-e8b4-45a0-b845-c09ba5099fbf/ {
        # if ($http_x_api_key != "bbaab1f3-2019-4c15-ad2e-a28442552e67") {
        #       return 401;
        #   }
        rewrite /(.*) / break;
        # proxy_method POST;
        # proxy_redirect off;
        # proxy_http_version 1.1;
        # proxy_set_header Connection '';
        # proxy_set_header X-Api-Key "95ba6cea-d4c6-4879-9d10-7a5d92838abe";
        # proxy_set_header Host "eth.getblock.io";
        # proxy_socket_keepalive on;
        # proxy_ssl_verify off;
        # proxy_ssl_session_reuse on;
        # proxy_buffering on;
        # proxy_request_buffering on;
        # proxy_next_upstream_timeout 3s;
        # proxy_next_upstream_tries 1;
        # proxy_http_version 1.1;
        # proxy_connect_timeout 3s;
        # proxy_send_timeout 3s;
        # proxy_read_timeocmut 3s;
        proxy_cache_use_stale updating error timeout invalid_header http_500 http_502 http_503 http_504;
        proxy_next_upstream error timeout invalid_header http_500 http_502 http_503 http_504;
        proxy_connect_timeout 10s;
        proxy_cache_methods GET HEAD POST;
        proxy_cache_key $request_uri|$request_body;
        proxy_cache_min_uses 1;
        proxy_cache cache;
        proxy_cache_valid 200 3s;
        proxy_cache_background_update on;
        add_header X-Cached $upstream_cache_status;
        proxy_ssl_verify off;
        proxy_pass http://upstream_4dao7542f-e8b4-45a0-b845-c09ba5099fbf/;
        #	proxy_pass http://server_4dao7542f-e8b4-45a0-b845-c09ba5099fbf_1;
        #upstream_4dao7542f-e8b4-45a0-b845-c09ba5099fbf/;
        # eth.getblock.io/mainnet/;
        # proxy_pass https://eth.getblock.io/mainnet/;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection $connection_upgrade;
    }
}
